<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AP_ADSB/AP_ADSB.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_2d0f04f8df9bd021c880eb1e76f83a78.html">AP_ADSB</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AP_ADSB.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AP__ADSB_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">   This program is free software: you can redistribute it and/or modify</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">   it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">   the Free Software Foundation, either version 3 of the License, or</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">   (at your option) any later version.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">   This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">   GNU General Public License for more details.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">   You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">    AP_ADSB.cpp</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">    ADS-B RF based collision avoidance module</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">    https://en.wikipedia.org/wiki/Automatic_dependent_surveillance_%E2%80%93_broadcast</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL/AP_HAL.h</a>&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__ADSB_8h.html">AP_ADSB.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="GCS__MAVLink_8h.html">GCS_MAVLink/GCS_MAVLink.h</a>&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="stdio_8h.html">stdio.h</a>&gt;</span>  <span class="comment">// for sprintf</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;limits.h&gt;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Vehicle_8h.html">AP_Vehicle/AP_Vehicle.h</a>&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="GCS_8h.html">GCS_MAVLink/GCS.h</a>&gt;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Logger_8h.html">AP_Logger/AP_Logger.h</a>&gt;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__GPS_8h.html">AP_GPS/AP_GPS.h</a>&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Baro_8h.html">AP_Baro/AP_Baro.h</a>&gt;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="AP__ADSB_8cpp.html#aa2b6ef19449ca9fd858c5b87504af865">   35</a></span>&#160;<span class="preprocessor">#define VEHICLE_TIMEOUT_MS              5000   // if no updates in this time, drop it from the list</span></div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="AP__ADSB_8cpp.html#a4943745fd5e0e8496ba2c59aee55cf8f">   36</a></span>&#160;<span class="preprocessor">#define ADSB_VEHICLE_LIST_SIZE_DEFAULT  25</span></div><div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="AP__ADSB_8cpp.html#acbf294cfc0b0358d48eb0f05beedcb20">   37</a></span>&#160;<span class="preprocessor">#define ADSB_VEHICLE_LIST_SIZE_MAX      100</span></div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="AP__ADSB_8cpp.html#a0f52ffdc49d1bb629db3107bde9460f1">   38</a></span>&#160;<span class="preprocessor">#define ADSB_CHAN_TIMEOUT_MS            15000</span></div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="AP__ADSB_8cpp.html#a3ebc3fa29b90b7525469e89143525636">   39</a></span>&#160;<span class="preprocessor">#define ADSB_SQUAWK_OCTAL_DEFAULT       1200</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="AP__ADSB_8cpp.html#a4d83d9e89c77e728007eb15717e4a3da">   41</a></span>&#160;<span class="preprocessor">#define ADSB_BITBASK_RF_CAPABILITIES_UAT_IN         (1 &lt;&lt; 0)</span></div><div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="AP__ADSB_8cpp.html#abdd03b806b454b3c1c81bab5fe46bcea">   42</a></span>&#160;<span class="preprocessor">#define ADSB_BITBASK_RF_CAPABILITIES_1090ES_IN      (1 &lt;&lt; 1)</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#if APM_BUILD_TYPE(APM_BUILD_ArduPlane)</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">    #define ADSB_LIST_RADIUS_DEFAULT        10000 // in meters</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#else // APM_BUILD_TYPE(APM_BUILD_ArduCopter), Rover, Boat</span></div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="AP__ADSB_8cpp.html#a1e9dc3c491b5c38cba9386eb838a02c5">   47</a></span>&#160;<span class="preprocessor">    #define ADSB_LIST_RADIUS_DEFAULT        2000 // in meters</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">extern</span> <span class="keyword">const</span> <a class="code" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code" href="AP__ADSB_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">// table of user settable parameters</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">const</span> <a class="code" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code" href="classAP__ADSB.html#a1879e5a78aa219b2211100ac2abc6267">AP_ADSB::var_info</a>[] = {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// @Param: ENABLE</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// @DisplayName: Enable ADSB</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">// @Description: Enable ADS-B</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// @Values: 0:Disabled,1:Enabled</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="AP__Param_8h.html#ac24e2eb16c2194e975d27e47ddcb7f1c">AP_GROUPINFO_FLAGS</a>(<span class="stringliteral">&quot;ENABLE&quot;</span>,     0, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, _enabled,    0, <a class="code" href="AP__Param_8h.html#ae25c1c7495435989f8be5781c86be078">AP_PARAM_FLAG_ENABLE</a>),</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// index 1 is reserved - was BEHAVIOR</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// @Param: LIST_MAX</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// @DisplayName: ADSB vehicle list size</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// @Description: ADSB list size of nearest vehicles. Longer lists take longer to refresh with lower SRx_ADSB values.</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// @Range: 1 100</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LIST_MAX&quot;</span>,   2, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, in_state.<a class="code" href="classAP__ADSB.html#af2fc35ba33b725e5602401d2a95824e8">list_size_param</a>, <a class="code" href="AP__ADSB_8cpp.html#a4943745fd5e0e8496ba2c59aee55cf8f">ADSB_VEHICLE_LIST_SIZE_DEFAULT</a>),</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// @Param: LIST_RADIUS</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// @DisplayName: ADSB vehicle list radius filter</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// @Description: ADSB vehicle list radius filter. Vehicles detected outside this radius will be completely ignored. They will not show up in the SRx_ADSB stream to the GCS and will not be considered in any avoidance calculations. A value of 0 will disable this filter.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// @Range: 0 100000</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LIST_RADIUS&quot;</span>,   3, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, in_state.<a class="code" href="classAP__ADSB.html#a70e157e54b5b20d852e7560976aa807c">list_radius</a>, <a class="code" href="AP__ADSB_8cpp.html#a1e9dc3c491b5c38cba9386eb838a02c5">ADSB_LIST_RADIUS_DEFAULT</a>),</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// @Param: ICAO_ID</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// @DisplayName: ICAO_ID vehicle identification number</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// @Description: ICAO_ID unique vehicle identification number of this aircraft. This is a integer limited to 24bits. If set to 0 then one will be randomly generated. If set to -1 then static information is not sent, transceiver is assumed pre-programmed.</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// @Range: -1 16777215</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ICAO_ID&quot;</span>,   4, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, out_state.<a class="code" href="classAP__ADSB.html#a9dd03ee3ba08ae887b6fe97b63e99c31">cfg</a>.ICAO_id_param, 0),</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// @Param: EMIT_TYPE</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// @DisplayName: Emitter type</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// @Description: ADSB classification for the type of vehicle emitting the transponder signal. Default value is 14 (UAV).</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// @Values: 0:NoInfo,1:Light,2:Small,3:Large,4:HighVortexlarge,5:Heavy,6:HighlyManuv,7:Rotocraft,8:RESERVED,9:Glider,10:LightAir,11:Parachute,12:UltraLight,13:RESERVED,14:UAV,15:Space,16:RESERVED,17:EmergencySurface,18:ServiceSurface,19:PointObstacle</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;EMIT_TYPE&quot;</span>,   5, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, out_state.<a class="code" href="classAP__ADSB.html#a9dd03ee3ba08ae887b6fe97b63e99c31">cfg</a>.emitterType, ADSB_EMITTER_TYPE_UAV),</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">// @Param: LEN_WIDTH</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">// @DisplayName: Aircraft length and width</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">// @Description: Aircraft length and width dimension options in Length and Width in meters. In most cases, use a value of 1 for smallest size.</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// @Values: 0:NO_DATA,1:L15W23,2:L25W28P5,3:L25W34,4:L35W33,5:L35W38,6:L45W39P5,7:L45W45,8:L55W45,9:L55W52,10:L65W59P5,11:L65W67,12:L75W72P5,13:L75W80,14:L85W80,15:L85W90</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LEN_WIDTH&quot;</span>,   6, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, out_state.<a class="code" href="classAP__ADSB.html#a9dd03ee3ba08ae887b6fe97b63e99c31">cfg</a>.lengthWidth, UAVIONIX_ADSB_OUT_CFG_AIRCRAFT_SIZE_L15M_W23M),</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// @Param: OFFSET_LAT</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// @DisplayName: GPS antenna lateral offset</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// @Description: GPS antenna lateral offset. This describes the physical location offest from center of the GPS antenna on the aircraft.</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// @Values: 0:NoData,1:Left2m,2:Left4m,3:Left6m,4:Center,5:Right2m,6:Right4m,7:Right6m</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;OFFSET_LAT&quot;</span>,   7, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, out_state.<a class="code" href="classAP__ADSB.html#a9dd03ee3ba08ae887b6fe97b63e99c31">cfg</a>.gpsLatOffset, UAVIONIX_ADSB_OUT_CFG_GPS_OFFSET_LAT_RIGHT_0M),</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// @Param: OFFSET_LON</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">// @DisplayName: GPS antenna longitudinal offset</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// @Description: GPS antenna longitudinal offset. This is usually set to 1, Applied By Sensor</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// @Values: 0:NO_DATA,1:AppliedBySensor</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;OFFSET_LON&quot;</span>,   8, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, out_state.<a class="code" href="classAP__ADSB.html#a9dd03ee3ba08ae887b6fe97b63e99c31">cfg</a>.gpsLonOffset, UAVIONIX_ADSB_OUT_CFG_GPS_OFFSET_LON_APPLIED_BY_SENSOR),</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// @Param: RF_SELECT</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">// @DisplayName: Transceiver RF selection</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// @Description: Transceiver RF selection for Rx enable and/or Tx enable. This only effects devices that can Tx and Rx. Rx-only devices override this to always be Rx-only.</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// @Values: 0:Disabled,1:Rx-Only,2:Tx-Only,3:Rx and Tx Enabled</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RF_SELECT&quot;</span>,   9, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, out_state.<a class="code" href="classAP__ADSB.html#a9dd03ee3ba08ae887b6fe97b63e99c31">cfg</a>.rfSelect, UAVIONIX_ADSB_OUT_RF_SELECT_RX_ENABLED),</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">// @Param: SQUAWK</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">// @DisplayName: Squawk code</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">// @Description: VFR squawk (Mode 3/A) code is a pre-programmed default code when the pilot is flying VFR and not in contact with ATC. In the USA, the VFR squawk code is octal 1200 (hex 0x280, decimal 640) and in most parts of Europe the VFR squawk code is octal 7000. If an invalid octal number is set then it will be reset to 1200.</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">// @Range: 0 7777</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// @Units: octal</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SQUAWK&quot;</span>,  10, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, out_state.<a class="code" href="classAP__ADSB.html#a9dd03ee3ba08ae887b6fe97b63e99c31">cfg</a>.squawk_octal_param, <a class="code" href="AP__ADSB_8cpp.html#a3ebc3fa29b90b7525469e89143525636">ADSB_SQUAWK_OCTAL_DEFAULT</a>),</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// @Param: RF_CAPABLE</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">// @DisplayName: RF capabilities</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// @Description: Describes your hardware RF In/Out capabilities.</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// @Values: 0:Unknown,1:Rx UAT only,3:Rx UAT and 1090ES,7:Rx&amp;Tx UAT and 1090ES</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">// @Bitmask: 0:UAT_in,1:1090ES_in,2:UAT_out,3:1090ES_out</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RF_CAPABLE&quot;</span>,  11, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, out_state.<a class="code" href="classAP__ADSB.html#a9dd03ee3ba08ae887b6fe97b63e99c31">cfg</a>.rf_capable, 0),</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">// @Param: LIST_ALT</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// @DisplayName: ADSB vehicle list altitude filter</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// @Description: ADSB vehicle list altitude filter. Vehicles detected above this altitude will be completely ignored. They will not show up in the SRx_ADSB stream to the GCS and will not be considered in any avoidance calculations. A value of 0 will disable this filter.</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// @Range: 0 32767</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LIST_ALT&quot;</span>,   12, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, in_state.<a class="code" href="classAP__ADSB.html#a6bccc80eb94615d907d4d29637527957">list_altitude</a>, 0),</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">// @Param: ICAO_SPECL</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// @DisplayName: ICAO_ID of special vehicle</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">// @Description: ICAO_ID of special vehicle that ignores ADSB_LIST_RADIUS and ADSB_LIST_ALT. The vehicle is always tracked. Use 0 to disable.</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ICAO_SPECL&quot;</span>,  13, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, _special_ICAO_target, 0),</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">// @Param: LOG</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// @DisplayName: ADS-B logging</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">// @Description: 0: no logging, 1: log only special ID, 2:log all</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// @Values: 0:no logging,1:log only special ID,2:log all</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LOG&quot;</span>,  14, <a class="code" href="classAP__ADSB.html">AP_ADSB</a>, _log, 1),</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;};</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment"> * Initialize variables and allocate memory for array</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#afcd0982d6c1f245d47e5ffeee6ecb6fb">  164</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#afcd0982d6c1f245d47e5ffeee6ecb6fb">AP_ADSB::init</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;{</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// in_state</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count = 0;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_size_param != <a class="code" href="AP__Math_8h.html#a68558c4f79a8582543daefde13c64abc">constrain_int16</a>(<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_size_param, 1, <a class="code" href="AP__ADSB_8cpp.html#acbf294cfc0b0358d48eb0f05beedcb20">ADSB_VEHICLE_LIST_SIZE_MAX</a>)) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_size_param.set_and_notify(<a class="code" href="AP__ADSB_8cpp.html#a4943745fd5e0e8496ba2c59aee55cf8f">ADSB_VEHICLE_LIST_SIZE_DEFAULT</a>);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_size_param.save();</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_size = <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_size_param;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list = <span class="keyword">new</span> <a class="code" href="structAP__ADSB_1_1adsb__vehicle__t.html">adsb_vehicle_t</a>[<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_size];</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="comment">// dynamic RAM allocation of _vehicle_list[] failed, disable gracefully</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <a class="code" href="AP__ADSB_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">console</a>-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">printf</a>(<span class="stringliteral">&quot;Unable to initialize ADS-B vehicle list\n&quot;</span>);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <a class="code" href="classAP__ADSB.html#a7b5c1580d2f17276dd881d26e2d97609">_enabled</a>.set_and_notify(0);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <a class="code" href="classAP__ADSB.html#a16c9818568c26d818d59ad8bdd127514">furthest_vehicle_distance</a> = 0;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <a class="code" href="classAP__ADSB.html#ae1a76d029faaec40a58604b8a14297f9">furthest_vehicle_index</a> = 0;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">// out_state</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <a class="code" href="classAP__ADSB.html#a7de4de7744351d284010855bf56e6134">set_callsign</a>(<span class="stringliteral">&quot;PING1234&quot;</span>, <span class="keyword">false</span>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;}</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment"> * de-initialize and free up some memory</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#add7a243975e67e15fb4de691568c5668">  193</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#add7a243975e67e15fb4de691568c5668">AP_ADSB::deinit</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;{</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count = 0;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keyword">delete</span> [] <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;}</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment"> * periodic update to handle vehicle timeouts and trigger collision detection</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#ab8305f5d3238ab9efff026ed1e6dc283">  205</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#ab8305f5d3238ab9efff026ed1e6dc283">AP_ADSB::update</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;{</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// update _my_loc</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a>().get_position(<a class="code" href="classAP__ADSB.html#a0fdfe9333f3ecd913b0054ad7be884df">_my_loc</a>)) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <a class="code" href="classAP__ADSB.html#a0fdfe9333f3ecd913b0054ad7be884df">_my_loc</a>.<a class="code" href="classLocation.html#a460f1d61d6d547f8e835f69afce5e70c">zero</a>();</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__ADSB.html#a7b5c1580d2f17276dd881d26e2d97609">_enabled</a>) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <a class="code" href="classAP__ADSB.html#add7a243975e67e15fb4de691568c5668">deinit</a>();</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="comment">// nothing to do</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list == <span class="keyword">nullptr</span>)  {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <a class="code" href="classAP__ADSB.html#afcd0982d6c1f245d47e5ffeee6ecb6fb">init</a>();</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_size != <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_size_param) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <a class="code" href="classAP__ADSB.html#add7a243975e67e15fb4de691568c5668">deinit</a>();</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keyword">const</span> uint32_t now = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// check current list for vehicles that time out</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    uint16_t index = 0;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">while</span> (index &lt; <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count) {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="comment">// check list and drop stale vehicles. When disabled, the list will get flushed</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordflow">if</span> (now - <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list[index].last_update_ms &gt; <a class="code" href="AP__ADSB_8cpp.html#aa2b6ef19449ca9fd858c5b87504af865">VEHICLE_TIMEOUT_MS</a>) {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            <span class="comment">// don&#39;t increment index, we want to check this same index again because the contents changed</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="comment">// also, if we&#39;re disabled then clear the list</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <a class="code" href="classAP__ADSB.html#a0da828560dafae3d5df5c4a3c1874095">delete_vehicle</a>(index);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            index++;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        }</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a0fdfe9333f3ecd913b0054ad7be884df">_my_loc</a>.<a class="code" href="classLocation.html#a666152fbac270c9392fb15a98f6774d3">is_zero</a>()) {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="comment">// if we don&#39;t have a GPS lock then there&#39;s nothing else to do</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.chan &lt; 0) {</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="comment">// if there&#39;s no transceiver detected then do not set ICAO and do not service the transceiver</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.squawk_octal_param != <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.squawk_octal) {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="comment">// param changed, check that it&#39;s a valid octal</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="AP__Math_8cpp.html#a2bd0c215ea1a8a2e17b96aeff65a5e6b">is_valid_octal</a>(<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.squawk_octal_param)) {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            <span class="comment">// invalid, reset it to default</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.squawk_octal_param = <a class="code" href="AP__ADSB_8cpp.html#a3ebc3fa29b90b7525469e89143525636">ADSB_SQUAWK_OCTAL_DEFAULT</a>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.squawk_octal = (uint16_t)<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.squawk_octal_param;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">// ensure it&#39;s positive 24bit but allow -1</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id_param &lt;= -1 || <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id_param &gt; 0x00FFFFFF) {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="comment">// icao param of -1 means static information is not sent, transceiver is assumed pre-programmed.</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="comment">// reset timer constantly so it never reaches 10s so it never sends</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.last_config_ms = now;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id == 0 ||</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id_param_prev != <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id_param) {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="comment">// if param changed then regenerate. This allows the param to be changed back to zero to trigger a re-generate</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id_param == 0) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id = <a class="code" href="classAP__ADSB.html#a0d37acc7717814c4c79f6ce8187bff42">genICAO</a>(<a class="code" href="classAP__ADSB.html#a0fdfe9333f3ecd913b0054ad7be884df">_my_loc</a>);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id = <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id_param;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id_param_prev = <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id_param;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <a class="code" href="classAP__ADSB.html#a7de4de7744351d284010855bf56e6134">set_callsign</a>(<span class="stringliteral">&quot;PING&quot;</span>, <span class="keyword">true</span>);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="GCS_8h.html#a1d3cc361b864ddf64a44c12ab3bd044e">gcs</a>().<a class="code" href="classGCS.html#a9866f3484283db744409e40719cef765">send_text</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;ADSB: Using ICAO_id %d and Callsign %s&quot;</span>, <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id, <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.last_config_ms = 0; <span class="comment">// send now</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// send static configuration data to transceiver, every 5s</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.chan_last_ms &gt; 0 &amp;&amp; now - <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.chan_last_ms &gt; <a class="code" href="AP__ADSB_8cpp.html#a0f52ffdc49d1bb629db3107bde9460f1">ADSB_CHAN_TIMEOUT_MS</a>) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="comment">// haven&#39;t gotten a heartbeat health status packet in a while, assume hardware failure</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="comment">// TODO: reset out_state.chan</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.chan = -1;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <a class="code" href="GCS_8h.html#a1d3cc361b864ddf64a44c12ab3bd044e">gcs</a>().<a class="code" href="classGCS.html#a9866f3484283db744409e40719cef765">send_text</a>(MAV_SEVERITY_ERROR, <span class="stringliteral">&quot;ADSB: Transceiver heartbeat timed out&quot;</span>);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.chan &lt; <a class="code" href="GCS__MAVLink_8h.html#aff625e94451bf446bdd56f5d0e081077">MAVLINK_COMM_NUM_BUFFERS</a>) {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keyword">const</span> mavlink_channel_t <a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a> = (mavlink_channel_t)(MAVLINK_COMM_0 + <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.chan);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">if</span> (now - <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.last_config_ms &gt;= 5000 &amp;&amp; <a class="code" href="GCS_8h.html#a6bcce1fe6fd8b6277f4f2dd0e738aec1">HAVE_PAYLOAD_SPACE</a>(<a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>, UAVIONIX_ADSB_OUT_CFG)) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.last_config_ms = now;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <a class="code" href="classAP__ADSB.html#a8bdb848d1a5cc65bda90dc380da53d7d">send_configure</a>(<a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        } <span class="comment">// last_config_ms</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="comment">// send dynamic data to transceiver at 5Hz</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">if</span> (now - <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.last_report_ms &gt;= 200 &amp;&amp; <a class="code" href="GCS_8h.html#a6bcce1fe6fd8b6277f4f2dd0e738aec1">HAVE_PAYLOAD_SPACE</a>(<a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>, UAVIONIX_ADSB_OUT_DYNAMIC)) {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.last_report_ms = now;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            <a class="code" href="classAP__ADSB.html#a5fc91d1889d6ad20d7d2fe27a2eef084">send_dynamic_out</a>(<a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        } <span class="comment">// last_report_ms</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    } <span class="comment">// chan_last_ms</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;}</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment"> * determine index and distance of furthest vehicle. This is</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment"> * used to bump it off when a new closer aircraft is detected</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00308"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#a2ddb84bb48288042dd7772ba78753624">  308</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#a2ddb84bb48288042dd7772ba78753624">AP_ADSB::determine_furthest_aircraft</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;{</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordtype">float</span> max_distance = 0;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    uint16_t max_distance_index = 0;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">for</span> (uint16_t index = 0; index &lt; <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count; index++) {</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a3e9c415af781fa2accec47c4d5e026fd">is_special_vehicle</a>(<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list[index].info.ICAO_address)) {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a> = <a class="code" href="classAP__ADSB.html#a0fdfe9333f3ecd913b0054ad7be884df">_my_loc</a>.<a class="code" href="classLocation.html#a9e973101205763fabc1c9e65ec3ae41d">get_distance</a>(<a class="code" href="classAP__ADSB.html#ae9c8aa14548f48cb22ae3cfe003db195">get_location</a>(<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list[index]));</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">if</span> (max_distance &lt; <a class="code" href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a> || index == 0) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            max_distance = <a class="code" href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a>;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            max_distance_index = index;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    } <span class="comment">// for index</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <a class="code" href="classAP__ADSB.html#ae1a76d029faaec40a58604b8a14297f9">furthest_vehicle_index</a> = max_distance_index;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <a class="code" href="classAP__ADSB.html#a16c9818568c26d818d59ad8bdd127514">furthest_vehicle_distance</a> = max_distance;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment"> * Convert/Extract a Location from a vehicle</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00331"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#ae9c8aa14548f48cb22ae3cfe003db195">  331</a></span>&#160;<a class="code" href="classLocation.html">Location</a> <a class="code" href="classAP__ADSB.html#ae9c8aa14548f48cb22ae3cfe003db195">AP_ADSB::get_location</a>(<span class="keyword">const</span> <a class="code" href="structAP__ADSB_1_1adsb__vehicle__t.html">adsb_vehicle_t</a> &amp;<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>)<span class="keyword"> const</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keyword">const</span> <a class="code" href="classLocation.html">Location</a> loc = <a class="code" href="classLocation.html">Location</a>(</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.lat,</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.lon,</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.altitude * 0.1f,</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <a class="code" href="classLocation.html#af494dabb88cd43e0d4efa99f04d31351a3a0bc063b6db8cae0361657958be836f">Location::AltFrame::ABSOLUTE</a>);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">return</span> loc;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;}</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment"> *  delete a vehicle by copying last vehicle to</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment"> *  current index then decrementing count</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#a0da828560dafae3d5df5c4a3c1874095">  346</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#a0da828560dafae3d5df5c4a3c1874095">AP_ADSB::delete_vehicle</a>(<span class="keyword">const</span> uint16_t index)</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;{</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">if</span> (index &gt;= <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count) {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="comment">// index out of range</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">// if the vehicle is the furthest, invalidate it. It has been bumped</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span> (index == <a class="code" href="classAP__ADSB.html#ae1a76d029faaec40a58604b8a14297f9">furthest_vehicle_index</a> &amp;&amp; <a class="code" href="classAP__ADSB.html#a16c9818568c26d818d59ad8bdd127514">furthest_vehicle_distance</a> &gt; 0) {</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <a class="code" href="classAP__ADSB.html#a16c9818568c26d818d59ad8bdd127514">furthest_vehicle_distance</a> = 0;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <a class="code" href="classAP__ADSB.html#ae1a76d029faaec40a58604b8a14297f9">furthest_vehicle_index</a> = 0;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    }</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">if</span> (index != (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count-1)) {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list[index] = <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list[<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count-1];</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    }</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// TODO: is memset needed? When we decrement the index we essentially forget about it</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    memset(&amp;<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list[<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count-1], 0, <span class="keyword">sizeof</span>(<a class="code" href="structAP__ADSB_1_1adsb__vehicle__t.html">adsb_vehicle_t</a>));</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count--;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;}</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment"> * Search _vehicle_list for the given vehicle. A match</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment"> * depends on ICAO_address. Returns true if match found</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment"> * and index is populated. otherwise, return false.</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00371"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#a37dc2cde075c2608a95a7a6b07dacef5">  371</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__ADSB.html#a37dc2cde075c2608a95a7a6b07dacef5">AP_ADSB::find_index</a>(<span class="keyword">const</span> <a class="code" href="structAP__ADSB_1_1adsb__vehicle__t.html">adsb_vehicle_t</a> &amp;<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>, uint16_t *index)<span class="keyword"> const</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count; i++) {</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list[i].info.ICAO_address == <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.ICAO_address) {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            *index = i;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        }</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;}</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment"> * Update the vehicle list. If the vehicle is already in the</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"> * list then it will update it, otherwise it will be added.</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00386"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#aff9bf5fb12ef29cf49a939814d8f86ce">  386</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#aff9bf5fb12ef29cf49a939814d8f86ce">AP_ADSB::handle_vehicle</a>(<span class="keyword">const</span> mavlink_message_t* packet)</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;{</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="comment">// We are only null when disabled. Updating is inhibited.</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    uint16_t index = <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_size + 1; <span class="comment">// initialize with invalid index</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <a class="code" href="structAP__ADSB_1_1adsb__vehicle__t.html">adsb_vehicle_t</a> <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a> {};</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    mavlink_msg_adsb_vehicle_decode(packet, &amp;<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keyword">const</span> <a class="code" href="classLocation.html">Location</a> vehicle_loc = <a class="code" href="classAP__ADSB.html#ae9c8aa14548f48cb22ae3cfe003db195">AP_ADSB::get_location</a>(<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> my_loc_is_zero = <a class="code" href="classAP__ADSB.html#a0fdfe9333f3ecd913b0054ad7be884df">_my_loc</a>.<a class="code" href="classLocation.html#a666152fbac270c9392fb15a98f6774d3">is_zero</a>();</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> my_loc_distance_to_vehicle = <a class="code" href="classAP__ADSB.html#a0fdfe9333f3ecd913b0054ad7be884df">_my_loc</a>.<a class="code" href="classLocation.html#a9e973101205763fabc1c9e65ec3ae41d">get_distance</a>(vehicle_loc);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> is_special = <a class="code" href="classAP__ADSB.html#a3e9c415af781fa2accec47c4d5e026fd">is_special_vehicle</a>(<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.ICAO_address);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> out_of_range = <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_radius &gt; 0 &amp;&amp; !my_loc_is_zero &amp;&amp; my_loc_distance_to_vehicle &gt; <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_radius &amp;&amp; !is_special;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> out_of_range_alt = <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_altitude &gt; 0 &amp;&amp; !my_loc_is_zero &amp;&amp; abs(vehicle_loc.<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> - <a class="code" href="classAP__ADSB.html#a0fdfe9333f3ecd913b0054ad7be884df">_my_loc</a>.<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>) &gt; <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_altitude*100 &amp;&amp; !is_special;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> is_tracked_in_list = <a class="code" href="classAP__ADSB.html#a37dc2cde075c2608a95a7a6b07dacef5">find_index</a>(<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>, &amp;index);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keyword">const</span> uint32_t now = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="comment">// note the last time the receiver got a packet from the aircraft</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.last_update_ms = now - (<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.tslc * 1000);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keyword">const</span> uint16_t required_flags_position = ADSB_FLAGS_VALID_COORDS | ADSB_FLAGS_VALID_ALTITUDE;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> detected_ourself = (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id != 0) &amp;&amp; ((uint32_t)<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id == <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.ICAO_address);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">if</span> (vehicle_loc.<a class="code" href="classLocation.html#a666152fbac270c9392fb15a98f6774d3">is_zero</a>() ||</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            out_of_range ||</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            out_of_range_alt ||</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            detected_ourself ||</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            (<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.ICAO_address &gt; 0x00FFFFFF) || <span class="comment">// ICAO address is 24bits, so ignore higher values.</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            !(<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.flags &amp; required_flags_position) ||</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            now - <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.last_update_ms &gt; <a class="code" href="AP__ADSB_8cpp.html#aa2b6ef19449ca9fd858c5b87504af865">VEHICLE_TIMEOUT_MS</a>) {</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="comment">// vehicle is out of range or invalid lat/lng. If we&#39;re tracking it, delete from list. Otherwise ignore it.</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">if</span> (is_tracked_in_list) {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <a class="code" href="classAP__ADSB.html#a0da828560dafae3d5df5c4a3c1874095">delete_vehicle</a>(index);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        }</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_tracked_in_list) {</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="comment">// found, update it</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <a class="code" href="classAP__ADSB.html#abffef5718e0d1248d24375e9b5cc506f">set_vehicle</a>(index, <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count &lt; <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_size) {</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="comment">// not found and there&#39;s room, add it to the end of the list</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <a class="code" href="classAP__ADSB.html#abffef5718e0d1248d24375e9b5cc506f">set_vehicle</a>(<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count, <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count++;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="comment">// buffer is full. if new vehicle is closer than furthest, replace furthest with new</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">if</span> (my_loc_is_zero) {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="comment">// nothing else to do</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            <a class="code" href="classAP__ADSB.html#a16c9818568c26d818d59ad8bdd127514">furthest_vehicle_distance</a> = 0;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            <a class="code" href="classAP__ADSB.html#ae1a76d029faaec40a58604b8a14297f9">furthest_vehicle_index</a> = 0;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a16c9818568c26d818d59ad8bdd127514">furthest_vehicle_distance</a> &lt;= 0) {</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                <span class="comment">// ensure this is populated</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                <a class="code" href="classAP__ADSB.html#a2ddb84bb48288042dd7772ba78753624">determine_furthest_aircraft</a>();</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            }</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            <span class="keywordflow">if</span> (my_loc_distance_to_vehicle &lt; <a class="code" href="classAP__ADSB.html#a16c9818568c26d818d59ad8bdd127514">furthest_vehicle_distance</a>) { <span class="comment">// is closer than the furthest</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                <span class="comment">// replace with the furthest vehicle</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                <a class="code" href="classAP__ADSB.html#abffef5718e0d1248d24375e9b5cc506f">set_vehicle</a>(<a class="code" href="classAP__ADSB.html#ae1a76d029faaec40a58604b8a14297f9">furthest_vehicle_index</a>, <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                <span class="comment">// furthest_vehicle_index is now invalid because the vehicle was overwritten, need</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                <span class="comment">// to run determine_furthest_aircraft() to determine a new one next time</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                <a class="code" href="classAP__ADSB.html#a16c9818568c26d818d59ad8bdd127514">furthest_vehicle_distance</a> = 0;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                <a class="code" href="classAP__ADSB.html#ae1a76d029faaec40a58604b8a14297f9">furthest_vehicle_index</a> = 0;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            }</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    } <span class="comment">// if buffer full</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keyword">const</span> uint16_t required_flags_avoidance =</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            ADSB_FLAGS_VALID_COORDS |</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            ADSB_FLAGS_VALID_ALTITUDE |</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            ADSB_FLAGS_VALID_HEADING |</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            ADSB_FLAGS_VALID_VELOCITY;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.flags &amp; required_flags_avoidance) {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <a class="code" href="classAP__ADSB.html#aa5070d9073186185ba2dca9311239125">push_sample</a>(<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>); <span class="comment">// note that set_vehicle modifies vehicle</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    }</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;}</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment"> * Copy a vehicle&#39;s data into the list</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00476"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#abffef5718e0d1248d24375e9b5cc506f">  476</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#abffef5718e0d1248d24375e9b5cc506f">AP_ADSB::set_vehicle</a>(<span class="keyword">const</span> uint16_t index, <span class="keyword">const</span> <a class="code" href="structAP__ADSB_1_1adsb__vehicle__t.html">adsb_vehicle_t</a> &amp;<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>)</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;{</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">if</span> (index &gt;= <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.list_size) {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="comment">// out of range</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list[index] = <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="classAP__ADSB.html#a46e1a973f9e4e2ed98156ec3007bf869">write_log</a>(<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;}</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#a98b061dafee84504998fa42c3bad7610">  487</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#a98b061dafee84504998fa42c3bad7610">AP_ADSB::send_adsb_vehicle</a>(<span class="keyword">const</span> mavlink_channel_t <a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>)</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;{</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list == <span class="keyword">nullptr</span> || <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count == 0) {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    uint32_t now = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.send_index[<a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>] &gt;= <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count) {</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="comment">// we&#39;ve finished a list</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keywordflow">if</span> (now - <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.send_start_ms[<a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>] &lt; 1000) {</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="comment">// too soon to start a new one</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            <span class="comment">// start new list</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.send_start_ms[<a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>] = now;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.send_index[<a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>] = 0;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        }</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.send_index[<a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>] &lt; <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_count) {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        mavlink_adsb_vehicle_t <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a> = <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list[<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.send_index[<a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>]].info;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.send_index[<a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>]++;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        mavlink_msg_adsb_vehicle_send(<a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>,</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.ICAO_address,</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.lat,</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.lon,</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.altitude_type,</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.altitude,</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.heading,</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.hor_velocity,</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.ver_velocity,</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.callsign,</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.emitter_type,</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.tslc,</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.flags,</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.squawk);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;}</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#a5fc91d1889d6ad20d7d2fe27a2eef084">  529</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#a5fc91d1889d6ad20d7d2fe27a2eef084">AP_ADSB::send_dynamic_out</a>(<span class="keyword">const</span> mavlink_channel_t <a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>)</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;{</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAP__GPS.html">AP_GPS</a> &amp;<a class="code" href="AHRS__Test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a> = <a class="code" href="namespaceAP.html#ae6eeec356455220f913e47e323057cd5">AP::gps</a>();</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keyword">const</span> <a class="code" href="classVector3.html">Vector3f</a> &amp;gps_velocity = <a class="code" href="AHRS__Test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="code" href="classAP__GPS.html#ac92efd3f6c2ad2af5b59635cb2c8eced">velocity</a>();</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keyword">const</span> int32_t latitude = <a class="code" href="classAP__ADSB.html#a0fdfe9333f3ecd913b0054ad7be884df">_my_loc</a>.<a class="code" href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a>;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keyword">const</span> int32_t longitude = <a class="code" href="classAP__ADSB.html#a0fdfe9333f3ecd913b0054ad7be884df">_my_loc</a>.<a class="code" href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keyword">const</span> int32_t altGNSS = <a class="code" href="classAP__ADSB.html#a0fdfe9333f3ecd913b0054ad7be884df">_my_loc</a>.<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> * 10; <span class="comment">// convert cm to mm</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keyword">const</span> int16_t velVert = gps_velocity.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> * 1E2; <span class="comment">// convert m/s to cm/s</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keyword">const</span> int16_t nsVog = gps_velocity.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> * 1E2; <span class="comment">// convert m/s to cm/s</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keyword">const</span> int16_t ewVog = gps_velocity.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> * 1E2; <span class="comment">// convert m/s to cm/s</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keyword">const</span> uint8_t fixType = <a class="code" href="AHRS__Test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="code" href="classAP__GPS.html#ac22b61d2e6cf0b6ff647173ea336de01">status</a>(); <span class="comment">// this lines up perfectly with our enum</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keyword">const</span> uint8_t emStatus = 0; <span class="comment">// TODO: implement this ENUM. no emergency = 0</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keyword">const</span> uint8_t numSats = <a class="code" href="AHRS__Test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="code" href="classAP__GPS.html#a5f6209342aaccbfacf35e844fc1d4f51">num_sats</a>();</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keyword">const</span> uint16_t squawk = <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.squawk_octal;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    uint32_t accHoriz = UINT_MAX;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordtype">float</span> accHoriz_f;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AHRS__Test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="code" href="classAP__GPS.html#abca09c2218f7fec3eef23679dead41b4">horizontal_accuracy</a>(accHoriz_f)) {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        accHoriz = accHoriz_f * 1E3; <span class="comment">// convert m to mm</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    }</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    uint16_t accVert = USHRT_MAX;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordtype">float</span> accVert_f;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AHRS__Test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="code" href="classAP__GPS.html#afa08eb7c0337c97e2ebab7e7c930423d">vertical_accuracy</a>(accVert_f)) {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        accVert = accVert_f * 1E2; <span class="comment">// convert m to cm</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    uint16_t accVel = USHRT_MAX;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordtype">float</span> accVel_f;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AHRS__Test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="code" href="classAP__GPS.html#a32634fda14b879872e3434733dac25ba">speed_accuracy</a>(accVel_f)) {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        accVel = accVel_f * 1E3; <span class="comment">// convert m/s to mm/s</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    uint16_t <a class="code" href="main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a> = 0;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>._is_in_auto_mode) {</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <a class="code" href="main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a> |= UAVIONIX_ADSB_OUT_DYNAMIC_STATE_AUTOPILOT_ENABLED;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    }</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.is_flying) {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <a class="code" href="main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a> |= UAVIONIX_ADSB_OUT_DYNAMIC_STATE_ON_GROUND;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    }</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">// TODO: confirm this sets utcTime correctly</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keyword">const</span> uint64_t <a class="code" href="sitl__gps_8cpp.html#a97c4c56ae21d368d04cc37ff7d97ac0e">gps_time</a> = <a class="code" href="AHRS__Test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="code" href="classAP__GPS.html#ad5311f0750e62e87bc2bb666024028f6">time_epoch_usec</a>();</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keyword">const</span> uint32_t utcTime = <a class="code" href="sitl__gps_8cpp.html#a97c4c56ae21d368d04cc37ff7d97ac0e">gps_time</a> / 1000000ULL;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAP__Baro.html">AP_Baro</a> &amp;<a class="code" href="ModuleTest_8cpp.html#a53fcf9055dcf2464b865c886fb0c3853">baro</a> = <a class="code" href="namespaceAP.html#a8aec57eb0b7a79044cbc1f0ca4b75bcf">AP::baro</a>();</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    int32_t altPres = INT_MAX;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ModuleTest_8cpp.html#a53fcf9055dcf2464b865c886fb0c3853">baro</a>.<a class="code" href="classAP__Baro.html#adf354fe73e210f7be030a4e4d95113d6">healthy</a>()) {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="comment">// Altitude difference between sea level pressure and current pressure. Result in millimeters</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        altPres = <a class="code" href="ModuleTest_8cpp.html#a53fcf9055dcf2464b865c886fb0c3853">baro</a>.<a class="code" href="classAP__Baro.html#a54dee5f283f1b59007fd4872db0f6eea">get_altitude_difference</a>(<a class="code" href="definitions_8h.html#abd956ad98bf4ff5ad0d5377149cd40e7">SSL_AIR_PRESSURE</a>, <a class="code" href="ModuleTest_8cpp.html#a53fcf9055dcf2464b865c886fb0c3853">baro</a>.<a class="code" href="classAP__Baro.html#a41b3c00624c78b883413b53fc5a81a32">get_pressure</a>()) * 1E3; <span class="comment">// convert m to mm;</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    mavlink_msg_uavionix_adsb_out_dynamic_send(</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>,</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            utcTime,</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            latitude,</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            longitude,</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            altGNSS,</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            fixType,</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            numSats,</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            altPres,</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            accHoriz,</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            accVert,</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            accVel,</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            velVert,</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            nsVog,</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            ewVog,</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            emStatus,</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <a class="code" href="main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a>,</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            squawk);</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;}</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment"> * To expand functionality in their HW, uAvionix has extended a few of the unused MAVLink bits to pack in more new features</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment"> * This function will override the MSB byte of the 24bit ICAO address. To ensure an invalid &gt;24bit ICAO is never broadcasted,</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment"> * this function is used to create the encoded verison without ever writing to the actual ICAO number. It&#39;s created on-demand</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00610"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#ac7c1a5e786e77dd16fdd6b3d98530424">  610</a></span>&#160;uint32_t <a class="code" href="classAP__ADSB.html#ac7c1a5e786e77dd16fdd6b3d98530424">AP_ADSB::get_encoded_icao</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;{</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="comment">// utilize the upper unused 8bits of the icao with special flags.</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="comment">// This encoding is required for uAvionix devices that break the MAVLink spec.</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="comment">// ensure the user assignable icao is 24 bits</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    uint32_t encoded_icao = (uint32_t)<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id &amp; 0x00FFFFFF;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    encoded_icao &amp;= ~0x20000000;    <span class="comment">// useGnssAltitude should always be FALSE</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    encoded_icao |=  0x10000000;    <span class="comment">// csidLogic       should always be TRUE</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="comment">//SIL/SDA are special fields that should be set to 0 with only expert user adjustment</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    encoded_icao &amp;= ~0x03000000;    <span class="comment">// SDA should always be FALSE</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    encoded_icao &amp;= ~0x0C000000;    <span class="comment">// SIL should always be FALSE</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="keywordflow">return</span> encoded_icao;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;}</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment"> * To expand functionality in their HW, uAvionix has extended a few of the unused MAVLink bits to pack in more new features</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment"> * This function will override the usually-null ending char of the callsign. It always encodes the last byte [8], even if</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment"> * the callsign string is less than 9 chars and there are other zero-padded nulls.</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00633"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#a38dbf4ebafde7e3b864a493ef0510f1e">  633</a></span>&#160;uint8_t <a class="code" href="classAP__ADSB.html#a38dbf4ebafde7e3b864a493ef0510f1e">AP_ADSB::get_encoded_callsign_null_char</a>()</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;{</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">//  Encoding of the 8bit null char</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">//  (LSB) - knots</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">//  bit.1 - knots</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">//  bit.2 - knots</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">//  bit.3 - (unused)</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">//  bit.4 - flag - ADSB_BITBASK_RF_CAPABILITIES_1090ES_IN</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">//  bit.5 - flag - ADSB_BITBASK_RF_CAPABILITIES_UAT_IN</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">//  bit.6 - flag - 0 = callsign is treated as callsign, 1 = callsign is treated as flightPlanID/Squawk</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">//  (MSB) - (unused)</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    uint8_t encoded_null = 0;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.maxAircraftSpeed_knots &lt;= 0) {</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <span class="comment">// not set or unknown. no bits set</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.maxAircraftSpeed_knots &lt;= 75) {</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        encoded_null |= 0x01;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.maxAircraftSpeed_knots &lt;= 150) {</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        encoded_null |= 0x02;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.maxAircraftSpeed_knots &lt;= 300) {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        encoded_null |= 0x03;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.maxAircraftSpeed_knots &lt;= 600) {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        encoded_null |= 0x04;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.maxAircraftSpeed_knots &lt;= 1200) {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        encoded_null |= 0x05;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        encoded_null |= 0x06;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.rf_capable &amp; <a class="code" href="AP__ADSB_8cpp.html#abdd03b806b454b3c1c81bab5fe46bcea">ADSB_BITBASK_RF_CAPABILITIES_1090ES_IN</a>) {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        encoded_null |= 0x10;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    }</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.rf_capable &amp; <a class="code" href="AP__ADSB_8cpp.html#a4d83d9e89c77e728007eb15717e4a3da">ADSB_BITBASK_RF_CAPABILITIES_UAT_IN</a>) {</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        encoded_null |= 0x20;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    }</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">    If the user has an 8 digit flightPlanID assigned from a filed flight plan, this should be assigned to FlightPlanID, (assigned by remote app)</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">    else if the user has an assigned squawk code from ATC this should be converted from 4 digit octal to 4 character alpha string and assigned to FlightPlanID,</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">    else if a tail number is known it should be set to the tail number of the aircraft, (assigned by remote app)</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment">    else it should be left blank (all 0&#39;s)</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="comment">// using the above logic, we must always assign the squawk. once we get configured</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="comment">// externally then get_encoded_callsign_null_char() stops getting called</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <a class="code" href="stdio_8h.html#a37c1e8ce8a2b411fa666dc33972a2cec">snprintf</a>(<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign, 5, <span class="stringliteral">&quot;%04d&quot;</span>, <span class="keywordtype">unsigned</span>(<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.squawk_octal) &amp; 0x1FFF);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    memset(&amp;<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign[4], 0, 5); <span class="comment">// clear remaining 5 chars</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    encoded_null |= 0x40;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">return</span> encoded_null;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;}</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment"> * handle incoming packet UAVIONIX_ADSB_OUT_CFG.</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment"> * This allows a GCS to send cfg info through the autopilot to the ADSB hardware.</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment"> * This is done indirectly by reading and storing the packet and then another mechanism sends it out periodically</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00693"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#ac7066b092ade854495cd52cb74c0d5bd">  693</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#ac7066b092ade854495cd52cb74c0d5bd">AP_ADSB::handle_out_cfg</a>(<span class="keyword">const</span> mavlink_message_t* msg)</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;{</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    mavlink_uavionix_adsb_out_cfg_t packet {};</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    mavlink_msg_uavionix_adsb_out_cfg_decode(msg, &amp;packet);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.was_set_externally = <span class="keyword">true</span>;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id = packet.ICAO;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id_param = <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id_param_prev = packet.ICAO &amp; 0x00FFFFFFFF;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="comment">// May contain a non-null value at the end so accept it as-is with memcpy instead of strcpy</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    memcpy(<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign, packet.callsign, <span class="keyword">sizeof</span>(<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign));</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.emitterType = packet.emitterType;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.lengthWidth = packet.aircraftSize;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.gpsLatOffset = packet.gpsOffsetLat;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.gpsLonOffset = packet.gpsOffsetLon;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.rfSelect = packet.rfSelect;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.stall_speed_cm = packet.stallSpeed;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="comment">// guard against string with non-null end char</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> c = <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign[MAVLINK_MSG_UAVIONIX_ADSB_OUT_CFG_FIELD_CALLSIGN_LEN-1];</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign[MAVLINK_MSG_UAVIONIX_ADSB_OUT_CFG_FIELD_CALLSIGN_LEN-1] = 0;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <a class="code" href="GCS_8h.html#a1d3cc361b864ddf64a44c12ab3bd044e">gcs</a>().<a class="code" href="classGCS.html#a9866f3484283db744409e40719cef765">send_text</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;ADSB: Using ICAO_id %d and Callsign %s&quot;</span>, <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id, <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign[MAVLINK_MSG_UAVIONIX_ADSB_OUT_CFG_FIELD_CALLSIGN_LEN-1] = c;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">// send now</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.last_config_ms = 0;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;}</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment"> * populate and send MAVLINK_MSG_UAVIONIX_ADSB_OUT_CFG</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00726"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#a8bdb848d1a5cc65bda90dc380da53d7d">  726</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#a8bdb848d1a5cc65bda90dc380da53d7d">AP_ADSB::send_configure</a>(<span class="keyword">const</span> mavlink_channel_t <a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>)</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;{</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="comment">// MAVLink spec says the 9 byte callsign field is 8 byte string with 9th byte as null.</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">// Here we temporarily set some flags in that null char to signify the callsign</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="comment">// may be a flightplanID instead</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    int8_t <a class="code" href="classAP__ADSB.html#a7c00fba44347d075b35789fc9ff6a817">callsign</a>[<span class="keyword">sizeof</span>(<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign)];</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    uint32_t icao;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    memcpy(<a class="code" href="classAP__ADSB.html#a7c00fba44347d075b35789fc9ff6a817">callsign</a>, <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign, <span class="keyword">sizeof</span>(<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign));</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.was_set_externally) {</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="comment">// take values as-is</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        icao = <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <a class="code" href="classAP__ADSB.html#a7c00fba44347d075b35789fc9ff6a817">callsign</a>[MAVLINK_MSG_UAVIONIX_ADSB_OUT_CFG_FIELD_CALLSIGN_LEN-1] = (int8_t)<a class="code" href="classAP__ADSB.html#a38dbf4ebafde7e3b864a493ef0510f1e">get_encoded_callsign_null_char</a>();</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        icao = <a class="code" href="classAP__ADSB.html#ac7c1a5e786e77dd16fdd6b3d98530424">get_encoded_icao</a>();</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    }</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    mavlink_msg_uavionix_adsb_out_cfg_send(</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            <a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>,</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            icao,</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            (<span class="keyword">const</span> <span class="keywordtype">char</span>*)<a class="code" href="classAP__ADSB.html#a7c00fba44347d075b35789fc9ff6a817">callsign</a>,</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            (uint8_t)<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.emitterType,</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            (uint8_t)<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.lengthWidth,</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            (uint8_t)<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.gpsLatOffset,</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            (uint8_t)<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.gpsLonOffset,</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.stall_speed_cm,</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            (uint8_t)<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.rfSelect);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;}</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment"> * this is a message from the transceiver reporting it&#39;s health. Using this packet</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment"> * we determine which channel is on so we don&#39;t have to send out_state to all channels</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#a3e100c93ec641fc04cbf8b0472a482f2">  761</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#a3e100c93ec641fc04cbf8b0472a482f2">AP_ADSB::handle_transceiver_report</a>(<span class="keyword">const</span> mavlink_channel_t <a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>, <span class="keyword">const</span> mavlink_message_t* msg)</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;{</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    mavlink_uavionix_adsb_transceiver_health_report_t packet {};</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    mavlink_msg_uavionix_adsb_transceiver_health_report_decode(msg, &amp;packet);</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.chan != <a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>) {</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <a class="code" href="GCS_8h.html#a1d3cc361b864ddf64a44c12ab3bd044e">gcs</a>().<a class="code" href="classGCS.html#a9866f3484283db744409e40719cef765">send_text</a>(MAV_SEVERITY_DEBUG, <span class="stringliteral">&quot;ADSB: Found transceiver on channel %d&quot;</span>, <a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    }</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.chan_last_ms = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.chan = <a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.status = (UAVIONIX_ADSB_RF_HEALTH)packet.rfHealth;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;}</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment"> @brief Generates pseudorandom ICAO from gps time, lat, and lon.</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment"> Reference: DO282B, 2.2.4.5.1.3.2</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment"> Note gps.time is the number of seconds since UTC midnight</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00781"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#a0d37acc7717814c4c79f6ce8187bff42">  781</a></span>&#160;uint32_t <a class="code" href="classAP__ADSB.html#a0d37acc7717814c4c79f6ce8187bff42">AP_ADSB::genICAO</a>(<span class="keyword">const</span> <a class="code" href="classLocation.html">Location</a> &amp;loc)</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;{</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="comment">// gps_time is not seconds since UTC midnight, but it is an equivalent random number</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="comment">// TODO: use UTC time instead of GPS time</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="keyword">const</span> <a class="code" href="classAP__GPS.html">AP_GPS</a> &amp;<a class="code" href="AHRS__Test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a> = <a class="code" href="namespaceAP.html#ae6eeec356455220f913e47e323057cd5">AP::gps</a>();</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keyword">const</span> uint64_t <a class="code" href="sitl__gps_8cpp.html#a97c4c56ae21d368d04cc37ff7d97ac0e">gps_time</a> = <a class="code" href="AHRS__Test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="code" href="classAP__GPS.html#ad5311f0750e62e87bc2bb666024028f6">time_epoch_usec</a>();</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    uint32_t timeSum = 0;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keyword">const</span> uint32_t M3 = 4096 * (loc.<a class="code" href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> &amp; 0x00000FFF) + (loc.<a class="code" href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a> &amp; 0x00000FFF);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;24; i++) {</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        timeSum += (((<a class="code" href="sitl__gps_8cpp.html#a97c4c56ae21d368d04cc37ff7d97ac0e">gps_time</a> &amp; 0x00FFFFFF)&gt;&gt; i) &amp; 0x00000001);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    }</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">return</span>( (timeSum ^ M3) &amp; 0x00FFFFFF);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;}</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment">// assign a string to out_state.cfg.callsign but ensure it&#39;s null terminated</span></div><div class="line"><a name="l00798"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#a7de4de7744351d284010855bf56e6134">  798</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#a7de4de7744351d284010855bf56e6134">AP_ADSB::set_callsign</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* str, <span class="keyword">const</span> <span class="keywordtype">bool</span> append_icao)</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;{</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordtype">bool</span> zero_char_pad = <span class="keyword">false</span>;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="comment">// clean slate</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    memset(<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign, 0, <span class="keyword">sizeof</span>(<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign));</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="comment">// copy str to cfg.callsign but we can&#39;t use strncpy because we need</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="comment">// to restrict values to only &#39;A&#39; - &#39;Z&#39; and &#39;0&#39; - &#39;9&#39; and pad</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<span class="keyword">sizeof</span>(<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign)-1; i++) {</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordflow">if</span> (!str[i] || zero_char_pad) {</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            <span class="comment">// finish early. Either pad the rest with zero char or null terminate and call it a day</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            <span class="keywordflow">if</span> ((append_icao &amp;&amp; i&lt;4) || zero_char_pad) {</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign[i] = <span class="charliteral">&#39;0&#39;</span>;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                zero_char_pad = <span class="keyword">true</span>;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                <span class="comment">// already null terminated via memset so just stop</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="charliteral">&#39;A&#39;</span> &lt;= str[i] &amp;&amp; str[i] &lt;= <span class="charliteral">&#39;Z&#39;</span>) ||</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                   (<span class="charliteral">&#39;0&#39;</span> &lt;= str[i] &amp;&amp; str[i] &lt;= <span class="charliteral">&#39;9&#39;</span>)) {</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <span class="comment">// valid as-is</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            <span class="comment">// spaces are also allowed but are handled in the last else</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign[i] = str[i];</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="charliteral">&#39;a&#39;</span> &lt;= str[i] &amp;&amp; str[i] &lt;= <span class="charliteral">&#39;z&#39;</span>) {</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            <span class="comment">// toupper()</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign[i] = str[i] - (<span class="charliteral">&#39;a&#39;</span> - <span class="charliteral">&#39;A&#39;</span>);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 0) {</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            <span class="comment">// invalid, pad to char zero because first index can&#39;t be space</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign[i] = <span class="charliteral">&#39;0&#39;</span>;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;            <span class="comment">// invalid, pad with space</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            <a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign[i] = <span class="charliteral">&#39; &#39;</span>;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        }</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    } <span class="comment">// for i</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">if</span> (append_icao) {</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <a class="code" href="stdio_8h.html#a37c1e8ce8a2b411fa666dc33972a2cec">snprintf</a>(&amp;<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.callsign[4], 5, <span class="stringliteral">&quot;%04X&quot;</span>, <span class="keywordtype">unsigned</span>(<a class="code" href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">out_state</a>.cfg.ICAO_id % 0x10000));</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    }</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;}</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#aa5070d9073186185ba2dca9311239125">  844</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#aa5070d9073186185ba2dca9311239125">AP_ADSB::push_sample</a>(<a class="code" href="structAP__ADSB_1_1adsb__vehicle__t.html">adsb_vehicle_t</a> &amp;<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>)</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;{</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <a class="code" href="classAP__ADSB.html#a7841306d3b02ad92f967b8ae47da75ed">samples</a>.push_back(<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;}</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#a258ed889071f57f799f4680f41394932">  849</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__ADSB.html#a258ed889071f57f799f4680f41394932">AP_ADSB::next_sample</a>(<a class="code" href="structAP__ADSB_1_1adsb__vehicle__t.html">adsb_vehicle_t</a> &amp;<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>)</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;{</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classAP__ADSB.html#a7841306d3b02ad92f967b8ae47da75ed">samples</a>.pop_front(<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;}</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#add2ce2f5a7bb949117e97164712f814e">  854</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#add2ce2f5a7bb949117e97164712f814e">AP_ADSB::handle_message</a>(<span class="keyword">const</span> mavlink_channel_t <a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>, <span class="keyword">const</span> mavlink_message_t* msg)</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;{</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordflow">switch</span> (msg-&gt;msgid) {</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="keywordflow">case</span> MAVLINK_MSG_ID_ADSB_VEHICLE:</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <a class="code" href="classAP__ADSB.html#aff9bf5fb12ef29cf49a939814d8f86ce">handle_vehicle</a>(msg);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keywordflow">case</span> MAVLINK_MSG_ID_UAVIONIX_ADSB_TRANSCEIVER_HEALTH_REPORT:</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <a class="code" href="classAP__ADSB.html#a3e100c93ec641fc04cbf8b0472a482f2">handle_transceiver_report</a>(<a class="code" href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">chan</a>, msg);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">case</span> MAVLINK_MSG_ID_UAVIONIX_ADSB_OUT_CFG:</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <a class="code" href="classAP__ADSB.html#ac7066b092ade854495cd52cb74c0d5bd">handle_out_cfg</a>(msg);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="keywordflow">case</span> MAVLINK_MSG_ID_UAVIONIX_ADSB_OUT_DYNAMIC:</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="comment">// unhandled, this is an outbound packet only</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    }</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;}</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">// If that ICAO is found in the database then return true with a fully populated vehicle</span></div><div class="line"><a name="l00877"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#a5c07acfc45486d3ef9fcdcd4dd7f31c7">  877</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__ADSB.html#a5c07acfc45486d3ef9fcdcd4dd7f31c7">AP_ADSB::get_vehicle_by_ICAO</a>(<span class="keyword">const</span> uint32_t icao, <a class="code" href="structAP__ADSB_1_1adsb__vehicle__t.html">adsb_vehicle_t</a> &amp;<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>)<span class="keyword"> const</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <a class="code" href="structAP__ADSB_1_1adsb__vehicle__t.html">adsb_vehicle_t</a> temp_vehicle;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    temp_vehicle.<a class="code" href="structAP__ADSB_1_1adsb__vehicle__t.html#a38e1163fdb9783e269f52028b9d45ffd">info</a>.ICAO_address = icao;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    uint16_t i;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__ADSB.html#a37dc2cde075c2608a95a7a6b07dacef5">find_index</a>(temp_vehicle, &amp;i)) {</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        <span class="comment">// vehicle is tracked in list.</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <span class="comment">// we must memcpy it because the database may reorganize itself and we don&#39;t</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <span class="comment">// want the reference to magically start pointing at a different vehicle</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        memcpy(&amp;<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>, &amp;<a class="code" href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">in_state</a>.vehicle_list[i], <span class="keyword">sizeof</span>(<a class="code" href="structAP__ADSB_1_1adsb__vehicle__t.html">adsb_vehicle_t</a>));</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;}</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment"> * Write vehicle to log</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00896"></a><span class="lineno"><a class="line" href="classAP__ADSB.html#a46e1a973f9e4e2ed98156ec3007bf869">  896</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__ADSB.html#a46e1a973f9e4e2ed98156ec3007bf869">AP_ADSB::write_log</a>(<span class="keyword">const</span> <a class="code" href="structAP__ADSB_1_1adsb__vehicle__t.html">adsb_vehicle_t</a> &amp;<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>)</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;{</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="classAP__ADSB.html#a3f398326a55803f67cebef5bcf32d866">_log</a>) {</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <span class="keywordflow">case</span> logging::SPECIAL_ONLY:</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="classAP__ADSB.html#a3e9c415af781fa2accec47c4d5e026fd">is_special_vehicle</a>(<a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.ICAO_address)) {</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            }</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <span class="keywordflow">case</span> logging::ALL:</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="keywordflow">case</span> logging::NONE:</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    }</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keyword">struct </span><a class="code" href="structlog__ADSB.html">log_ADSB</a> pkt = {</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <a class="code" href="LogStructure_8h.html#abca6b52da10346c72b10dd04698e4420">LOG_PACKET_HEADER_INIT</a>(<a class="code" href="LogStructure_8h.html#aec1abc8a4fd0e25bbcf703a19b991a05a4fc012615870c24578a2840f88278565">LOG_ADSB_MSG</a>),</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <a class="code" href="structlog__ADSB.html#ae9c57214c17ff78ab6b5aa2d2a99beaf">time_us</a>       : <a class="code" href="namespaceAP__HAL.html#a7aa0ce7625c9680e30ff4a99940907a5">AP_HAL::micros64</a>(),</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <a class="code" href="structlog__ADSB.html#a7d8a7fd1a0d15d53c92e8888593609d0">ICAO_address</a>  : <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.ICAO_address,</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <a class="code" href="structlog__ADSB.html#a35e01d76d90c98a51ff439369c626e84">lat</a>           : <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.lat,</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <a class="code" href="structlog__ADSB.html#a91bebd9d646e609706579b035f2195d8">lng</a>           : <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.lon,</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <a class="code" href="structlog__ADSB.html#a177ec4443a0c49f71258050e0856a378">alt</a>           : <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.altitude,</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <a class="code" href="structlog__ADSB.html#a2f2df92d8b8530228175ad20a96c2947">heading</a>       : <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.heading,</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <a class="code" href="structlog__ADSB.html#ae21f29a75c2e0363d09f41cb09dceacb">hor_velocity</a>  : <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.hor_velocity,</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <a class="code" href="structlog__ADSB.html#aee317ec103e588aaf2d49928f6d0d168">ver_velocity</a>  : <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.ver_velocity,</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        <a class="code" href="structlog__ADSB.html#a3f7db022d971f9eb3aa6c9fbb0900ca3">squawk</a>        : <a class="code" href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a>.info.squawk,</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    };</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <a class="code" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().<a class="code" href="classAP__Logger.html#ada8172473eb14aabbf121c20ef6ad76b">WriteBlock</a>(&amp;pkt, <span class="keyword">sizeof</span>(pkt));</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;}</div><div class="ttc" id="classAP__ADSB_html_abd890373877a69765ec93cf5fef5f6a5"><div class="ttname"><a href="classAP__ADSB.html#abd890373877a69765ec93cf5fef5f6a5">AP_ADSB::out_state</a></div><div class="ttdeci">struct AP_ADSB::@4 out_state</div></div>
<div class="ttc" id="classAP__GPS_html"><div class="ttname"><a href="classAP__GPS.html">AP_GPS</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00043">AP_GPS.h:43</a></div></div>
<div class="ttc" id="AP__Baro_8h_html"><div class="ttname"><a href="AP__Baro_8h.html">AP_Baro.h</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a98b061dafee84504998fa42c3bad7610"><div class="ttname"><a href="classAP__ADSB.html#a98b061dafee84504998fa42c3bad7610">AP_ADSB::send_adsb_vehicle</a></div><div class="ttdeci">void send_adsb_vehicle(mavlink_channel_t chan)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00487">AP_ADSB.cpp:487</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a8c9a9716c63559af51457ea99867bebf"><div class="ttname"><a href="classAP__ADSB.html#a8c9a9716c63559af51457ea99867bebf">AP_ADSB::in_state</a></div><div class="ttdeci">struct AP_ADSB::@3 in_state</div></div>
<div class="ttc" id="classAP__ADSB_html_a6bccc80eb94615d907d4d29637527957"><div class="ttname"><a href="classAP__ADSB.html#a6bccc80eb94615d907d4d29637527957">AP_ADSB::list_altitude</a></div><div class="ttdeci">AP_Int16 list_altitude</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00144">AP_ADSB.h:144</a></div></div>
<div class="ttc" id="structlog__ADSB_html_a3f7db022d971f9eb3aa6c9fbb0900ca3"><div class="ttname"><a href="structlog__ADSB.html#a3f7db022d971f9eb3aa6c9fbb0900ca3">log_ADSB::squawk</a></div><div class="ttdeci">uint16_t squawk</div><div class="ttdef"><b>Definition:</b> <a href="LogStructure_8h_source.html#l00765">LogStructure.h:765</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a2ddb84bb48288042dd7772ba78753624"><div class="ttname"><a href="classAP__ADSB.html#a2ddb84bb48288042dd7772ba78753624">AP_ADSB::determine_furthest_aircraft</a></div><div class="ttdeci">void determine_furthest_aircraft(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00308">AP_ADSB.cpp:308</a></div></div>
<div class="ttc" id="structlog__ADSB_html_a177ec4443a0c49f71258050e0856a378"><div class="ttname"><a href="structlog__ADSB.html#a177ec4443a0c49f71258050e0856a378">log_ADSB::alt</a></div><div class="ttdeci">int32_t alt</div><div class="ttdef"><b>Definition:</b> <a href="LogStructure_8h_source.html#l00761">LogStructure.h:761</a></div></div>
<div class="ttc" id="AP__ADSB_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__ADSB_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition:</b> <a href="AC__PID__test_8cpp_source.html#l00021">AC_PID_test.cpp:21</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a258ed889071f57f799f4680f41394932"><div class="ttname"><a href="classAP__ADSB.html#a258ed889071f57f799f4680f41394932">AP_ADSB::next_sample</a></div><div class="ttdeci">bool next_sample(adsb_vehicle_t &amp;obstacle)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00849">AP_ADSB.cpp:849</a></div></div>
<div class="ttc" id="AP__Param_8h_html_ae25c1c7495435989f8be5781c86be078"><div class="ttname"><a href="AP__Param_8h.html#ae25c1c7495435989f8be5781c86be078">AP_PARAM_FLAG_ENABLE</a></div><div class="ttdeci">#define AP_PARAM_FLAG_ENABLE</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00057">AP_Param.h:57</a></div></div>
<div class="ttc" id="classAP__ADSB_html_abffef5718e0d1248d24375e9b5cc506f"><div class="ttname"><a href="classAP__ADSB.html#abffef5718e0d1248d24375e9b5cc506f">AP_ADSB::set_vehicle</a></div><div class="ttdeci">void set_vehicle(const uint16_t index, const adsb_vehicle_t &amp;vehicle)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00476">AP_ADSB.cpp:476</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a68558c4f79a8582543daefde13c64abc"><div class="ttname"><a href="AP__Math_8h.html#a68558c4f79a8582543daefde13c64abc">constrain_int16</a></div><div class="ttdeci">int16_t constrain_int16(const int16_t amt, const int16_t low, const int16_t high)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00147">AP_Math.h:147</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a0fdfe9333f3ecd913b0054ad7be884df"><div class="ttname"><a href="classAP__ADSB.html#a0fdfe9333f3ecd913b0054ad7be884df">AP_ADSB::_my_loc</a></div><div class="ttdeci">Location _my_loc</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00133">AP_ADSB.h:133</a></div></div>
<div class="ttc" id="classAP__ADSB_html_ac7c1a5e786e77dd16fdd6b3d98530424"><div class="ttname"><a href="classAP__ADSB.html#ac7c1a5e786e77dd16fdd6b3d98530424">AP_ADSB::get_encoded_icao</a></div><div class="ttdeci">uint32_t get_encoded_icao(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00610">AP_ADSB.cpp:610</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a46e1a973f9e4e2ed98156ec3007bf869"><div class="ttname"><a href="classAP__ADSB.html#a46e1a973f9e4e2ed98156ec3007bf869">AP_ADSB::write_log</a></div><div class="ttdeci">void write_log(const adsb_vehicle_t &amp;vehicle)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00896">AP_ADSB.cpp:896</a></div></div>
<div class="ttc" id="structlog__ADSB_html_ae21f29a75c2e0363d09f41cb09dceacb"><div class="ttname"><a href="structlog__ADSB.html#ae21f29a75c2e0363d09f41cb09dceacb">log_ADSB::hor_velocity</a></div><div class="ttdeci">uint16_t hor_velocity</div><div class="ttdef"><b>Definition:</b> <a href="LogStructure_8h_source.html#l00763">LogStructure.h:763</a></div></div>
<div class="ttc" id="AP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_a92168462febe0f5ab9556dc9ea4ddb7a"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">AP_HAL::HAL::console</a></div><div class="ttdeci">AP_HAL::UARTDriver * console</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00110">HAL.h:110</a></div></div>
<div class="ttc" id="classAP__ADSB_html_afcd0982d6c1f245d47e5ffeee6ecb6fb"><div class="ttname"><a href="classAP__ADSB.html#afcd0982d6c1f245d47e5ffeee6ecb6fb">AP_ADSB::init</a></div><div class="ttdeci">void init()</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00164">AP_ADSB.cpp:164</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a38dbf4ebafde7e3b864a493ef0510f1e"><div class="ttname"><a href="classAP__ADSB.html#a38dbf4ebafde7e3b864a493ef0510f1e">AP_ADSB::get_encoded_callsign_null_char</a></div><div class="ttdeci">uint8_t get_encoded_callsign_null_char(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00633">AP_ADSB.cpp:633</a></div></div>
<div class="ttc" id="GCS_8h_html"><div class="ttname"><a href="GCS_8h.html">GCS.h</a></div><div class="ttdoc">Interface definition for the various Ground Control System.</div></div>
<div class="ttc" id="AP__ADSB_8cpp_html_acbf294cfc0b0358d48eb0f05beedcb20"><div class="ttname"><a href="AP__ADSB_8cpp.html#acbf294cfc0b0358d48eb0f05beedcb20">ADSB_VEHICLE_LIST_SIZE_MAX</a></div><div class="ttdeci">#define ADSB_VEHICLE_LIST_SIZE_MAX</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00037">AP_ADSB.cpp:37</a></div></div>
<div class="ttc" id="structlog__ADSB_html_a7d8a7fd1a0d15d53c92e8888593609d0"><div class="ttname"><a href="structlog__ADSB.html#a7d8a7fd1a0d15d53c92e8888593609d0">log_ADSB::ICAO_address</a></div><div class="ttdeci">uint32_t ICAO_address</div><div class="ttdef"><b>Definition:</b> <a href="LogStructure_8h_source.html#l00758">LogStructure.h:758</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a0d37acc7717814c4c79f6ce8187bff42"><div class="ttname"><a href="classAP__ADSB.html#a0d37acc7717814c4c79f6ce8187bff42">AP_ADSB::genICAO</a></div><div class="ttdeci">uint32_t genICAO(const Location &amp;loc)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00781">AP_ADSB.cpp:781</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00100">AP_Param.h:100</a></div></div>
<div class="ttc" id="AP__Logger_8h_html"><div class="ttname"><a href="AP__Logger_8h.html">AP_Logger.h</a></div></div>
<div class="ttc" id="classAP__ADSB_html_aa5070d9073186185ba2dca9311239125"><div class="ttname"><a href="classAP__ADSB.html#aa5070d9073186185ba2dca9311239125">AP_ADSB::push_sample</a></div><div class="ttdeci">void push_sample(adsb_vehicle_t &amp;vehicle)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00844">AP_ADSB.cpp:844</a></div></div>
<div class="ttc" id="classLocation_html_af494dabb88cd43e0d4efa99f04d31351a3a0bc063b6db8cae0361657958be836f"><div class="ttname"><a href="classLocation.html#af494dabb88cd43e0d4efa99f04d31351a3a0bc063b6db8cae0361657958be836f">Location::AltFrame::ABSOLUTE</a></div></div>
<div class="ttc" id="AP__Math_8cpp_html_a2bd0c215ea1a8a2e17b96aeff65a5e6b"><div class="ttname"><a href="AP__Math_8cpp.html#a2bd0c215ea1a8a2e17b96aeff65a5e6b">is_valid_octal</a></div><div class="ttdeci">bool is_valid_octal(uint16_t octal)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8cpp_source.html#l00274">AP_Math.cpp:274</a></div></div>
<div class="ttc" id="GCS_8h_html_a1d3cc361b864ddf64a44c12ab3bd044e"><div class="ttname"><a href="GCS_8h.html#a1d3cc361b864ddf64a44c12ab3bd044e">gcs</a></div><div class="ttdeci">GCS &amp; gcs()</div><div class="ttdef"><b>Definition:</b> <a href="GCS__Common_8cpp_source.html#l05004">GCS_Common.cpp:5004</a></div></div>
<div class="ttc" id="AP__ADSB_8cpp_html_a3ebc3fa29b90b7525469e89143525636"><div class="ttname"><a href="AP__ADSB_8cpp.html#a3ebc3fa29b90b7525469e89143525636">ADSB_SQUAWK_OCTAL_DEFAULT</a></div><div class="ttdeci">#define ADSB_SQUAWK_OCTAL_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00039">AP_ADSB.cpp:39</a></div></div>
<div class="ttc" id="sitl__gps_8cpp_html_a97c4c56ae21d368d04cc37ff7d97ac0e"><div class="ttname"><a href="sitl__gps_8cpp.html#a97c4c56ae21d368d04cc37ff7d97ac0e">gps_time</a></div><div class="ttdeci">static void gps_time(uint16_t *time_week, uint32_t *time_week_ms)</div><div class="ttdef"><b>Definition:</b> <a href="sitl__gps_8cpp_source.html#l00178">sitl_gps.cpp:178</a></div></div>
<div class="ttc" id="classAP__ADSB_html_aff9bf5fb12ef29cf49a939814d8f86ce"><div class="ttname"><a href="classAP__ADSB.html#aff9bf5fb12ef29cf49a939814d8f86ce">AP_ADSB::handle_vehicle</a></div><div class="ttdeci">void handle_vehicle(const mavlink_message_t *msg)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00386">AP_ADSB.cpp:386</a></div></div>
<div class="ttc" id="AP__ADSB_8cpp_html_a4d83d9e89c77e728007eb15717e4a3da"><div class="ttname"><a href="AP__ADSB_8cpp.html#a4d83d9e89c77e728007eb15717e4a3da">ADSB_BITBASK_RF_CAPABILITIES_UAT_IN</a></div><div class="ttdeci">#define ADSB_BITBASK_RF_CAPABILITIES_UAT_IN</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00041">AP_ADSB.cpp:41</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a3e100c93ec641fc04cbf8b0472a482f2"><div class="ttname"><a href="classAP__ADSB.html#a3e100c93ec641fc04cbf8b0472a482f2">AP_ADSB::handle_transceiver_report</a></div><div class="ttdeci">void handle_transceiver_report(mavlink_channel_t chan, const mavlink_message_t *msg)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00761">AP_ADSB.cpp:761</a></div></div>
<div class="ttc" id="structlog__ADSB_html_a91bebd9d646e609706579b035f2195d8"><div class="ttname"><a href="structlog__ADSB.html#a91bebd9d646e609706579b035f2195d8">log_ADSB::lng</a></div><div class="ttdeci">int32_t lng</div><div class="ttdef"><b>Definition:</b> <a href="LogStructure_8h_source.html#l00760">LogStructure.h:760</a></div></div>
<div class="ttc" id="examples_2location_2location_8cpp_html_a06f14a9abd47b91465f895d5259cdc1b"><div class="ttname"><a href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a></div><div class="ttdeci">float distance</div><div class="ttdef"><b>Definition:</b> <a href="examples_2location_2location_8cpp_source.html#l00095">location.cpp:95</a></div></div>
<div class="ttc" id="classAP__Logger_html_ada8172473eb14aabbf121c20ef6ad76b"><div class="ttname"><a href="classAP__Logger.html#ada8172473eb14aabbf121c20ef6ad76b">AP_Logger::WriteBlock</a></div><div class="ttdeci">void WriteBlock(const void *pBuffer, uint16_t size)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Logger_8cpp_source.html#l00578">AP_Logger.cpp:578</a></div></div>
<div class="ttc" id="structlog__ADSB_html_aee317ec103e588aaf2d49928f6d0d168"><div class="ttname"><a href="structlog__ADSB.html#aee317ec103e588aaf2d49928f6d0d168">log_ADSB::ver_velocity</a></div><div class="ttdeci">int16_t ver_velocity</div><div class="ttdef"><b>Definition:</b> <a href="LogStructure_8h_source.html#l00764">LogStructure.h:764</a></div></div>
<div class="ttc" id="classAP__Baro_html_a54dee5f283f1b59007fd4872db0f6eea"><div class="ttname"><a href="classAP__Baro.html#a54dee5f283f1b59007fd4872db0f6eea">AP_Baro::get_altitude_difference</a></div><div class="ttdeci">float get_altitude_difference(float base_pressure, float pressure) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Baro_8cpp_source.html#l00299">AP_Baro.cpp:299</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a37dc2cde075c2608a95a7a6b07dacef5"><div class="ttname"><a href="classAP__ADSB.html#a37dc2cde075c2608a95a7a6b07dacef5">AP_ADSB::find_index</a></div><div class="ttdeci">bool find_index(const adsb_vehicle_t &amp;vehicle, uint16_t *index) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00371">AP_ADSB.cpp:371</a></div></div>
<div class="ttc" id="GCS__MAVLink_8h_html"><div class="ttname"><a href="GCS__MAVLink_8h.html">GCS_MAVLink.h</a></div><div class="ttdoc">One size fits all header for MAVLink integration.</div></div>
<div class="ttc" id="classAP__ADSB_html_a7c00fba44347d075b35789fc9ff6a817"><div class="ttname"><a href="classAP__ADSB.html#a7c00fba44347d075b35789fc9ff6a817">AP_ADSB::callsign</a></div><div class="ttdeci">char callsign[MAVLINK_MSG_UAVIONIX_ADSB_OUT_CFG_FIELD_CALLSIGN_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00167">AP_ADSB.h:167</a></div></div>
<div class="ttc" id="classAP__Baro_html"><div class="ttname"><a href="classAP__Baro.html">AP_Baro</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Baro_8h_source.html#l00021">AP_Baro.h:21</a></div></div>
<div class="ttc" id="structAP__ADSB_1_1adsb__vehicle__t_html"><div class="ttname"><a href="structAP__ADSB_1_1adsb__vehicle__t.html">AP_ADSB::adsb_vehicle_t</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00043">AP_ADSB.h:43</a></div></div>
<div class="ttc" id="GCS__MAVLink_8h_html_aff625e94451bf446bdd56f5d0e081077"><div class="ttname"><a href="GCS__MAVLink_8h.html#aff625e94451bf446bdd56f5d0e081077">MAVLINK_COMM_NUM_BUFFERS</a></div><div class="ttdeci">#define MAVLINK_COMM_NUM_BUFFERS</div><div class="ttdef"><b>Definition:</b> <a href="GCS__MAVLink_8h_source.html#l00020">GCS_MAVLink.h:20</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a1879e5a78aa219b2211100ac2abc6267"><div class="ttname"><a href="classAP__ADSB.html#a1879e5a78aa219b2211100ac2abc6267">AP_ADSB::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00049">AP_ADSB.h:49</a></div></div>
<div class="ttc" id="namespaceAP_html_aa35bfac1ea2da16f110e8e72db7b3b20"><div class="ttname"><a href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a></div><div class="ttdeci">AP_Logger &amp; logger()</div><div class="ttdef"><b>Definition:</b> <a href="AP__Logger_8cpp_source.html#l01182">AP_Logger.cpp:1182</a></div></div>
<div class="ttc" id="classAP__ADSB_html_ac7066b092ade854495cd52cb74c0d5bd"><div class="ttname"><a href="classAP__ADSB.html#ac7066b092ade854495cd52cb74c0d5bd">AP_ADSB::handle_out_cfg</a></div><div class="ttdeci">void handle_out_cfg(const mavlink_message_t *msg)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00693">AP_ADSB.cpp:693</a></div></div>
<div class="ttc" id="AP__Param_8h_html_ac24e2eb16c2194e975d27e47ddcb7f1c"><div class="ttname"><a href="AP__Param_8h.html#ac24e2eb16c2194e975d27e47ddcb7f1c">AP_GROUPINFO_FLAGS</a></div><div class="ttdeci">#define AP_GROUPINFO_FLAGS(name, idx, clazz, element, def, flags)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00091">AP_Param.h:91</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a7de4de7744351d284010855bf56e6134"><div class="ttname"><a href="classAP__ADSB.html#a7de4de7744351d284010855bf56e6134">AP_ADSB::set_callsign</a></div><div class="ttdeci">void set_callsign(const char *str, const bool append_icao)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00798">AP_ADSB.cpp:798</a></div></div>
<div class="ttc" id="GCS_8h_html_a6bcce1fe6fd8b6277f4f2dd0e738aec1"><div class="ttname"><a href="GCS_8h.html#a6bcce1fe6fd8b6277f4f2dd0e738aec1">HAVE_PAYLOAD_SPACE</a></div><div class="ttdeci">#define HAVE_PAYLOAD_SPACE(chan, id)</div><div class="ttdef"><b>Definition:</b> <a href="GCS_8h_source.html#l00025">GCS.h:25</a></div></div>
<div class="ttc" id="classAP__HAL_1_1BetterStream_html_a8534aa004599bb81ad60f3e762791032"><div class="ttname"><a href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">AP_HAL::BetterStream::printf</a></div><div class="ttdeci">virtual void printf(const char *,...) FMT_PRINTF(2</div><div class="ttdef"><b>Definition:</b> <a href="BetterStream_8cpp_source.html#l00005">BetterStream.cpp:5</a></div></div>
<div class="ttc" id="classAP__GPS_html_ac92efd3f6c2ad2af5b59635cb2c8eced"><div class="ttname"><a href="classAP__GPS.html#ac92efd3f6c2ad2af5b59635cb2c8eced">AP_GPS::velocity</a></div><div class="ttdeci">const Vector3f &amp; velocity(uint8_t instance) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00223">AP_GPS.h:223</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00021">HAL.h:21</a></div></div>
<div class="ttc" id="classAP__ADSB_html_ad0c4acd5db5427f6ddf1eebd70df5eec"><div class="ttname"><a href="classAP__ADSB.html#ad0c4acd5db5427f6ddf1eebd70df5eec">AP_ADSB::chan</a></div><div class="ttdeci">int8_t chan</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00156">AP_ADSB.h:156</a></div></div>
<div class="ttc" id="classAP__ADSB_html"><div class="ttname"><a href="classAP__ADSB.html">AP_ADSB</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00032">AP_ADSB.h:32</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a7841306d3b02ad92f967b8ae47da75ed"><div class="ttname"><a href="classAP__ADSB.html#a7841306d3b02ad92f967b8ae47da75ed">AP_ADSB::samples</a></div><div class="ttdeci">AP_Buffer&lt; adsb_vehicle_t, max_samples &gt; samples</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00193">AP_ADSB.h:193</a></div></div>
<div class="ttc" id="classAP__GPS_html_a32634fda14b879872e3434733dac25ba"><div class="ttname"><a href="classAP__GPS.html#a32634fda14b879872e3434733dac25ba">AP_GPS::speed_accuracy</a></div><div class="ttdeci">bool speed_accuracy(uint8_t instance, float &amp;sacc) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00327">AP_GPS.cpp:327</a></div></div>
<div class="ttc" id="structlog__ADSB_html_a2f2df92d8b8530228175ad20a96c2947"><div class="ttname"><a href="structlog__ADSB.html#a2f2df92d8b8530228175ad20a96c2947">log_ADSB::heading</a></div><div class="ttdeci">uint16_t heading</div><div class="ttdef"><b>Definition:</b> <a href="LogStructure_8h_source.html#l00762">LogStructure.h:762</a></div></div>
<div class="ttc" id="AP__ADSB_8cpp_html_aa2b6ef19449ca9fd858c5b87504af865"><div class="ttname"><a href="AP__ADSB_8cpp.html#aa2b6ef19449ca9fd858c5b87504af865">VEHICLE_TIMEOUT_MS</a></div><div class="ttdeci">#define VEHICLE_TIMEOUT_MS</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00035">AP_ADSB.cpp:35</a></div></div>
<div class="ttc" id="classVector3_html_a561df88b28e106e337a25bb86554a569"><div class="ttname"><a href="classVector3.html#a561df88b28e106e337a25bb86554a569">Vector3::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00067">vector3.h:67</a></div></div>
<div class="ttc" id="classAP__ADSB_html_ae9c8aa14548f48cb22ae3cfe003db195"><div class="ttname"><a href="classAP__ADSB.html#ae9c8aa14548f48cb22ae3cfe003db195">AP_ADSB::get_location</a></div><div class="ttdeci">Location get_location(const adsb_vehicle_t &amp;vehicle) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00331">AP_ADSB.cpp:331</a></div></div>
<div class="ttc" id="ModuleTest_8cpp_html_a53fcf9055dcf2464b865c886fb0c3853"><div class="ttname"><a href="ModuleTest_8cpp.html#a53fcf9055dcf2464b865c886fb0c3853">baro</a></div><div class="ttdeci">static AP_Baro baro</div><div class="ttdef"><b>Definition:</b> <a href="ModuleTest_8cpp_source.html#l00019">ModuleTest.cpp:19</a></div></div>
<div class="ttc" id="namespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition:</b> <a href="ChibiOS_2system_8cpp_source.html#l00157">system.cpp:157</a></div></div>
<div class="ttc" id="definitions_8h_html_abd956ad98bf4ff5ad0d5377149cd40e7"><div class="ttname"><a href="definitions_8h.html#abd956ad98bf4ff5ad0d5377149cd40e7">SSL_AIR_PRESSURE</a></div><div class="ttdeci">#define SSL_AIR_PRESSURE</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00088">definitions.h:88</a></div></div>
<div class="ttc" id="AP__ADSB_8h_html"><div class="ttname"><a href="AP__ADSB_8h.html">AP_ADSB.h</a></div></div>
<div class="ttc" id="classVector3_html_ab3e7f5401dd6e951978bfa746809f74f"><div class="ttname"><a href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">Vector3::z</a></div><div class="ttdeci">T z</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00067">vector3.h:67</a></div></div>
<div class="ttc" id="classAP__ADSB_html_add2ce2f5a7bb949117e97164712f814e"><div class="ttname"><a href="classAP__ADSB.html#add2ce2f5a7bb949117e97164712f814e">AP_ADSB::handle_message</a></div><div class="ttdeci">void handle_message(const mavlink_channel_t chan, const mavlink_message_t *msg)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00854">AP_ADSB.cpp:854</a></div></div>
<div class="ttc" id="structAP__ADSB_1_1adsb__vehicle__t_html_a38e1163fdb9783e269f52028b9d45ffd"><div class="ttname"><a href="structAP__ADSB_1_1adsb__vehicle__t.html#a38e1163fdb9783e269f52028b9d45ffd">AP_ADSB::adsb_vehicle_t::info</a></div><div class="ttdeci">mavlink_adsb_vehicle_t info</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00044">AP_ADSB.h:44</a></div></div>
<div class="ttc" id="structAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00142">AP_Param.h:142</a></div></div>
<div class="ttc" id="namespaceAP__HAL_html_a7aa0ce7625c9680e30ff4a99940907a5"><div class="ttname"><a href="namespaceAP__HAL.html#a7aa0ce7625c9680e30ff4a99940907a5">AP_HAL::micros64</a></div><div class="ttdeci">uint64_t micros64()</div><div class="ttdef"><b>Definition:</b> <a href="ChibiOS_2system_8cpp_source.html#l00167">system.cpp:167</a></div></div>
<div class="ttc" id="structlog__ADSB_html_ae9c57214c17ff78ab6b5aa2d2a99beaf"><div class="ttname"><a href="structlog__ADSB.html#ae9c57214c17ff78ab6b5aa2d2a99beaf">log_ADSB::time_us</a></div><div class="ttdeci">uint64_t time_us</div><div class="ttdef"><b>Definition:</b> <a href="LogStructure_8h_source.html#l00757">LogStructure.h:757</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a5fc91d1889d6ad20d7d2fe27a2eef084"><div class="ttname"><a href="classAP__ADSB.html#a5fc91d1889d6ad20d7d2fe27a2eef084">AP_ADSB::send_dynamic_out</a></div><div class="ttdeci">void send_dynamic_out(const mavlink_channel_t chan)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00529">AP_ADSB.cpp:529</a></div></div>
<div class="ttc" id="classLocation_html_a666152fbac270c9392fb15a98f6774d3"><div class="ttname"><a href="classLocation.html#a666152fbac270c9392fb15a98f6774d3">Location::is_zero</a></div><div class="ttdeci">bool is_zero(void) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition:</b> <a href="Location_8cpp_source.html#l00019">Location.cpp:19</a></div></div>
<div class="ttc" id="AHRS__Test_8cpp_html_a96159f137b07706488f9ffbedf89e79d"><div class="ttname"><a href="AHRS__Test_8cpp.html#a96159f137b07706488f9ffbedf89e79d">vehicle</a></div><div class="ttdeci">static DummyVehicle vehicle</div><div class="ttdef"><b>Definition:</b> <a href="AHRS__Test_8cpp_source.html#l00040">AHRS_Test.cpp:40</a></div></div>
<div class="ttc" id="classGCS_html_a9866f3484283db744409e40719cef765"><div class="ttname"><a href="classGCS.html#a9866f3484283db744409e40719cef765">GCS::send_text</a></div><div class="ttdeci">void send_text(MAV_SEVERITY severity, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="GCS_8cpp_source.html#l00040">GCS.cpp:40</a></div></div>
<div class="ttc" id="classAP__Baro_html_adf354fe73e210f7be030a4e4d95113d6"><div class="ttname"><a href="classAP__Baro.html#adf354fe73e210f7be030a4e4d95113d6">AP_Baro::healthy</a></div><div class="ttdeci">bool healthy(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Baro_8h_source.html#l00052">AP_Baro.h:52</a></div></div>
<div class="ttc" id="classAP__Baro_html_a41b3c00624c78b883413b53fc5a81a32"><div class="ttname"><a href="classAP__Baro.html#a41b3c00624c78b883413b53fc5a81a32">AP_Baro::get_pressure</a></div><div class="ttdeci">float get_pressure(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Baro_8h_source.html#l00059">AP_Baro.h:59</a></div></div>
<div class="ttc" id="classAP__GPS_html_ac22b61d2e6cf0b6ff647173ea336de01"><div class="ttname"><a href="classAP__GPS.html#ac22b61d2e6cf0b6ff647173ea336de01">AP_GPS::status</a></div><div class="ttdeci">GPS_Status status(uint8_t instance) const</div><div class="ttdoc">Query GPS status.</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00185">AP_GPS.h:185</a></div></div>
<div class="ttc" id="AP__GPS_8h_html"><div class="ttname"><a href="AP__GPS_8h.html">AP_GPS.h</a></div></div>
<div class="ttc" id="classAP__ADSB_html_ae1a76d029faaec40a58604b8a14297f9"><div class="ttname"><a href="classAP__ADSB.html#ae1a76d029faaec40a58604b8a14297f9">AP_ADSB::furthest_vehicle_index</a></div><div class="ttdeci">uint16_t furthest_vehicle_index</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00185">AP_ADSB.h:185</a></div></div>
<div class="ttc" id="LogStructure_8h_html_aec1abc8a4fd0e25bbcf703a19b991a05a4fc012615870c24578a2840f88278565"><div class="ttname"><a href="LogStructure_8h.html#aec1abc8a4fd0e25bbcf703a19b991a05a4fc012615870c24578a2840f88278565">LOG_ADSB_MSG</a></div><div class="ttdef"><b>Definition:</b> <a href="LogStructure_8h_source.html#l01696">LogStructure.h:1696</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a3f398326a55803f67cebef5bcf32d866"><div class="ttname"><a href="classAP__ADSB.html#a3f398326a55803f67cebef5bcf32d866">AP_ADSB::_log</a></div><div class="ttdeci">AP_Int8 _log</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00198">AP_ADSB.h:198</a></div></div>
<div class="ttc" id="AP__Vehicle_8h_html"><div class="ttname"><a href="AP__Vehicle_8h.html">AP_Vehicle.h</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a3e9c415af781fa2accec47c4d5e026fd"><div class="ttname"><a href="classAP__ADSB.html#a3e9c415af781fa2accec47c4d5e026fd">AP_ADSB::is_special_vehicle</a></div><div class="ttdeci">bool is_special_vehicle(uint32_t icao) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00088">AP_ADSB.h:88</a></div></div>
<div class="ttc" id="classLocation_html_a5831f0aca9e51a15adb96fad465f72f8"><div class="ttname"><a href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">Location::lng</a></div><div class="ttdeci">int32_t lng</div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00022">Location.h:22</a></div></div>
<div class="ttc" id="stdio_8h_html"><div class="ttname"><a href="stdio_8h.html">stdio.h</a></div></div>
<div class="ttc" id="namespaceAP_html_a99432cfdb696952c9b7146f155a815aa"><div class="ttname"><a href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a></div><div class="ttdeci">AP_AHRS &amp; ahrs()</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8cpp_source.html#l00526">AP_AHRS.cpp:526</a></div></div>
<div class="ttc" id="classAP__GPS_html_a5f6209342aaccbfacf35e844fc1d4f51"><div class="ttname"><a href="classAP__GPS.html#a5f6209342aaccbfacf35e844fc1d4f51">AP_GPS::num_sats</a></div><div class="ttdeci">uint8_t num_sats(uint8_t instance) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00259">AP_GPS.h:259</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a7b5c1580d2f17276dd881d26e2d97609"><div class="ttname"><a href="classAP__ADSB.html#a7b5c1580d2f17276dd881d26e2d97609">AP_ADSB::_enabled</a></div><div class="ttdeci">AP_Int8 _enabled</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00131">AP_ADSB.h:131</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a70e157e54b5b20d852e7560976aa807c"><div class="ttname"><a href="classAP__ADSB.html#a70e157e54b5b20d852e7560976aa807c">AP_ADSB::list_radius</a></div><div class="ttdeci">AP_Int32 list_radius</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00143">AP_ADSB.h:143</a></div></div>
<div class="ttc" id="AP__ADSB_8cpp_html_a0f52ffdc49d1bb629db3107bde9460f1"><div class="ttname"><a href="AP__ADSB_8cpp.html#a0f52ffdc49d1bb629db3107bde9460f1">ADSB_CHAN_TIMEOUT_MS</a></div><div class="ttdeci">#define ADSB_CHAN_TIMEOUT_MS</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00038">AP_ADSB.cpp:38</a></div></div>
<div class="ttc" id="stdio_8h_html_a37c1e8ce8a2b411fa666dc33972a2cec"><div class="ttname"><a href="stdio_8h.html#a37c1e8ce8a2b411fa666dc33972a2cec">snprintf</a></div><div class="ttdeci">int snprintf(char *str, size_t size, const char *fmt,...)</div></div>
<div class="ttc" id="classLocation_html_a460f1d61d6d547f8e835f69afce5e70c"><div class="ttname"><a href="classLocation.html#a460f1d61d6d547f8e835f69afce5e70c">Location::zero</a></div><div class="ttdeci">void zero(void)</div><div class="ttdef"><b>Definition:</b> <a href="Location_8cpp_source.html#l00024">Location.cpp:24</a></div></div>
<div class="ttc" id="AP__ADSB_8cpp_html_abdd03b806b454b3c1c81bab5fe46bcea"><div class="ttname"><a href="AP__ADSB_8cpp.html#abdd03b806b454b3c1c81bab5fe46bcea">ADSB_BITBASK_RF_CAPABILITIES_1090ES_IN</a></div><div class="ttdeci">#define ADSB_BITBASK_RF_CAPABILITIES_1090ES_IN</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00042">AP_ADSB.cpp:42</a></div></div>
<div class="ttc" id="examples_2AnalogIn_2AnalogIn_8cpp_html_a130f3ebe4c1bb6993e1094760227ad6a"><div class="ttname"><a href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a></div><div class="ttdeci">AP_HAL::AnalogSource * chan</div><div class="ttdef"><b>Definition:</b> <a href="examples_2AnalogIn_2AnalogIn_8cpp_source.html#l00008">AnalogIn.cpp:8</a></div></div>
<div class="ttc" id="classLocation_html_a89e532f5bcc13db2f51ff9eed667c2b6"><div class="ttname"><a href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">Location::alt</a></div><div class="ttdeci">int32_t alt</div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00020">Location.h:20</a></div></div>
<div class="ttc" id="classAP__GPS_html_ad5311f0750e62e87bc2bb666024028f6"><div class="ttname"><a href="classAP__GPS.html#ad5311f0750e62e87bc2bb666024028f6">AP_GPS::time_epoch_usec</a></div><div class="ttdeci">uint64_t time_epoch_usec(uint8_t instance) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00367">AP_GPS.cpp:367</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a8bdb848d1a5cc65bda90dc380da53d7d"><div class="ttname"><a href="classAP__ADSB.html#a8bdb848d1a5cc65bda90dc380da53d7d">AP_ADSB::send_configure</a></div><div class="ttdeci">void send_configure(const mavlink_channel_t chan)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00726">AP_ADSB.cpp:726</a></div></div>
<div class="ttc" id="classAP__ADSB_html_af2fc35ba33b725e5602401d2a95824e8"><div class="ttname"><a href="classAP__ADSB.html#af2fc35ba33b725e5602401d2a95824e8">AP_ADSB::list_size_param</a></div><div class="ttdeci">AP_Int16 list_size_param</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00139">AP_ADSB.h:139</a></div></div>
<div class="ttc" id="classVector3_html"><div class="ttname"><a href="classVector3.html">Vector3&lt; float &gt;</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a9dd03ee3ba08ae887b6fe97b63e99c31"><div class="ttname"><a href="classAP__ADSB.html#a9dd03ee3ba08ae887b6fe97b63e99c31">AP_ADSB::cfg</a></div><div class="ttdeci">struct AP_ADSB::@4::@5 cfg</div></div>
<div class="ttc" id="namespaceAP_html_ae6eeec356455220f913e47e323057cd5"><div class="ttname"><a href="namespaceAP.html#ae6eeec356455220f913e47e323057cd5">AP::gps</a></div><div class="ttdeci">AP_GPS &amp; gps()</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l01574">AP_GPS.cpp:1574</a></div></div>
<div class="ttc" id="classAP__ADSB_html_ab8305f5d3238ab9efff026ed1e6dc283"><div class="ttname"><a href="classAP__ADSB.html#ab8305f5d3238ab9efff026ed1e6dc283">AP_ADSB::update</a></div><div class="ttdeci">void update(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00205">AP_ADSB.cpp:205</a></div></div>
<div class="ttc" id="AHRS__Test_8cpp_html_a962e3f0f8682f6dedb5a001a70bdd65e"><div class="ttname"><a href="AHRS__Test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a></div><div class="ttdeci">static AP_GPS gps</div><div class="ttdef"><b>Definition:</b> <a href="AHRS__Test_8cpp_source.html#l00025">AHRS_Test.cpp:25</a></div></div>
<div class="ttc" id="AP__ADSB_8cpp_html_a4943745fd5e0e8496ba2c59aee55cf8f"><div class="ttname"><a href="AP__ADSB_8cpp.html#a4943745fd5e0e8496ba2c59aee55cf8f">ADSB_VEHICLE_LIST_SIZE_DEFAULT</a></div><div class="ttdeci">#define ADSB_VEHICLE_LIST_SIZE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00036">AP_ADSB.cpp:36</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a16c9818568c26d818d59ad8bdd127514"><div class="ttname"><a href="classAP__ADSB.html#a16c9818568c26d818d59ad8bdd127514">AP_ADSB::furthest_vehicle_distance</a></div><div class="ttdeci">float furthest_vehicle_distance</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8h_source.html#l00186">AP_ADSB.h:186</a></div></div>
<div class="ttc" id="namespaceAP_html_a8aec57eb0b7a79044cbc1f0ca4b75bcf"><div class="ttname"><a href="namespaceAP.html#a8aec57eb0b7a79044cbc1f0ca4b75bcf">AP::baro</a></div><div class="ttdeci">AP_Baro &amp; baro()</div><div class="ttdef"><b>Definition:</b> <a href="AP__Baro_8cpp_source.html#l00860">AP_Baro.cpp:860</a></div></div>
<div class="ttc" id="classLocation_html"><div class="ttname"><a href="classLocation.html">Location</a></div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00009">Location.h:9</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a5c07acfc45486d3ef9fcdcd4dd7f31c7"><div class="ttname"><a href="classAP__ADSB.html#a5c07acfc45486d3ef9fcdcd4dd7f31c7">AP_ADSB::get_vehicle_by_ICAO</a></div><div class="ttdeci">bool get_vehicle_by_ICAO(const uint32_t icao, adsb_vehicle_t &amp;vehicle) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00877">AP_ADSB.cpp:877</a></div></div>
<div class="ttc" id="main_8c_html_a8d04d02fe8bb190484bba202fee18f5c"><div class="ttname"><a href="main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a></div><div class="ttdeci">static struct generator_state state</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00064">main.c:64</a></div></div>
<div class="ttc" id="classAP__GPS_html_afa08eb7c0337c97e2ebab7e7c930423d"><div class="ttname"><a href="classAP__GPS.html#afa08eb7c0337c97e2ebab7e7c930423d">AP_GPS::vertical_accuracy</a></div><div class="ttdeci">bool vertical_accuracy(uint8_t instance, float &amp;vacc) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00345">AP_GPS.cpp:345</a></div></div>
<div class="ttc" id="LogStructure_8h_html_abca6b52da10346c72b10dd04698e4420"><div class="ttname"><a href="LogStructure_8h.html#abca6b52da10346c72b10dd04698e4420">LOG_PACKET_HEADER_INIT</a></div><div class="ttdeci">#define LOG_PACKET_HEADER_INIT(id)</div><div class="ttdef"><b>Definition:</b> <a href="LogStructure_8h_source.html#l00110">LogStructure.h:110</a></div></div>
<div class="ttc" id="classAP__GPS_html_abca09c2218f7fec3eef23679dead41b4"><div class="ttname"><a href="classAP__GPS.html#abca09c2218f7fec3eef23679dead41b4">AP_GPS::horizontal_accuracy</a></div><div class="ttdeci">bool horizontal_accuracy(uint8_t instance, float &amp;hacc) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00336">AP_GPS.cpp:336</a></div></div>
<div class="ttc" id="AP__ADSB_8cpp_html_a1e9dc3c491b5c38cba9386eb838a02c5"><div class="ttname"><a href="AP__ADSB_8cpp.html#a1e9dc3c491b5c38cba9386eb838a02c5">ADSB_LIST_RADIUS_DEFAULT</a></div><div class="ttdeci">#define ADSB_LIST_RADIUS_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00047">AP_ADSB.cpp:47</a></div></div>
<div class="ttc" id="classLocation_html_a9e973101205763fabc1c9e65ec3ae41d"><div class="ttname"><a href="classLocation.html#a9e973101205763fabc1c9e65ec3ae41d">Location::get_distance</a></div><div class="ttdeci">float get_distance(const struct Location &amp;loc2) const</div><div class="ttdef"><b>Definition:</b> <a href="Location_8cpp_source.html#l00219">Location.cpp:219</a></div></div>
<div class="ttc" id="classAP__ADSB_html_add7a243975e67e15fb4de691568c5668"><div class="ttname"><a href="classAP__ADSB.html#add7a243975e67e15fb4de691568c5668">AP_ADSB::deinit</a></div><div class="ttdeci">void deinit()</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00193">AP_ADSB.cpp:193</a></div></div>
<div class="ttc" id="structlog__ADSB_html_a35e01d76d90c98a51ff439369c626e84"><div class="ttname"><a href="structlog__ADSB.html#a35e01d76d90c98a51ff439369c626e84">log_ADSB::lat</a></div><div class="ttdeci">int32_t lat</div><div class="ttdef"><b>Definition:</b> <a href="LogStructure_8h_source.html#l00759">LogStructure.h:759</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00118">AP_Param.h:118</a></div></div>
<div class="ttc" id="classLocation_html_ae51548c2cf32311043ca19b94b9a9223"><div class="ttname"><a href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">Location::lat</a></div><div class="ttdeci">int32_t lat</div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00021">Location.h:21</a></div></div>
<div class="ttc" id="classAP__ADSB_html_a0da828560dafae3d5df5c4a3c1874095"><div class="ttname"><a href="classAP__ADSB.html#a0da828560dafae3d5df5c4a3c1874095">AP_ADSB::delete_vehicle</a></div><div class="ttdeci">void delete_vehicle(const uint16_t index)</div><div class="ttdef"><b>Definition:</b> <a href="AP__ADSB_8cpp_source.html#l00346">AP_ADSB.cpp:346</a></div></div>
<div class="ttc" id="classVector3_html_a1a0f7e168c71ca798099f0ba8a444244"><div class="ttname"><a href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">Vector3::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00067">vector3.h:67</a></div></div>
<div class="ttc" id="structlog__ADSB_html"><div class="ttname"><a href="structlog__ADSB.html">log_ADSB</a></div><div class="ttdef"><b>Definition:</b> <a href="LogStructure_8h_source.html#l00755">LogStructure.h:755</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 11 2019 14:17:25 for APM:Libraries by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
