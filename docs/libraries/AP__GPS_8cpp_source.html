<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AP_GPS/AP_GPS.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_dc27bcd5d3e114c391ea7ea0e777b78e.html">AP_GPS</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AP_GPS.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AP__GPS_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">   This program is free software: you can redistribute it and/or modify</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">   it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">   the Free Software Foundation, either version 3 of the License, or</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">   (at your option) any later version.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">   This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">   GNU General Public License for more details.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">   You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS_8h.html">AP_GPS.h</a>&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Common_8h.html">AP_Common/AP_Common.h</a>&gt;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL/AP_HAL.h</a>&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Math_8h.html">AP_Math/AP_Math.h</a>&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Notify_8h.html">AP_Notify/AP_Notify.h</a>&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="GCS_8h.html">GCS_MAVLink/GCS.h</a>&gt;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__BoardConfig_8h.html">AP_BoardConfig/AP_BoardConfig.h</a>&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__RTC_8h.html">AP_RTC/AP_RTC.h</a>&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;climits&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS__NOVA_8h.html">AP_GPS_NOVA.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS__ERB_8h.html">AP_GPS_ERB.h</a>&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS__GSOF_8h.html">AP_GPS_GSOF.h</a>&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS__MTK_8h.html">AP_GPS_MTK.h</a>&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS__MTK19_8h.html">AP_GPS_MTK19.h</a>&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS__NMEA_8h.html">AP_GPS_NMEA.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS__SBF_8h.html">AP_GPS_SBF.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS__SBP_8h.html">AP_GPS_SBP.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS__SBP2_8h.html">AP_GPS_SBP2.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS__SIRF_8h.html">AP_GPS_SIRF.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS__UBLOX_8h.html">AP_GPS_UBLOX.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS__MAV_8h.html">AP_GPS_MAV.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="GPS__Backend_8h.html">GPS_Backend.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#if HAL_WITH_UAVCAN</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__BoardConfig__CAN_8h.html">AP_BoardConfig/AP_BoardConfig_CAN.h</a>&gt;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__UAVCAN_8h.html">AP_UAVCAN/AP_UAVCAN.h</a>&gt;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__GPS__UAVCAN_8h.html">AP_GPS_UAVCAN.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Logger_8h.html">AP_Logger/AP_Logger.h</a>&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="AP__GPS_8cpp.html#af476b309d3827917a4217a393c7bb6ed">   48</a></span>&#160;<span class="preprocessor">#define GPS_RTK_INJECT_TO_ALL 127</span></div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="AP__GPS_8cpp.html#a2d79705911859d95849c965ef469c5fb">   49</a></span>&#160;<span class="preprocessor">#define GPS_MAX_RATE_MS 200 // maximum value of rate_ms (i.e. slowest update rate) is 5hz or 200ms</span></div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="AP__GPS_8cpp.html#a2f6d184a58b49c746340c1139bd6e0ea">   50</a></span>&#160;<span class="preprocessor">#define GPS_BAUD_TIME_MS 1200</span></div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="AP__GPS_8cpp.html#aed01677f1b1efe774fa22e838b84f5db">   51</a></span>&#160;<span class="preprocessor">#define GPS_TIMEOUT_MS 4000u</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">// defines used to specify the mask position for use of different accuracy metrics in the blending algorithm</span></div><div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="AP__GPS_8cpp.html#af2a2b9d86200a37152ed36817f914ac7">   54</a></span>&#160;<span class="preprocessor">#define BLEND_MASK_USE_HPOS_ACC     1</span></div><div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="AP__GPS_8cpp.html#a5c474882dc169c97221822426d3d48ed">   55</a></span>&#160;<span class="preprocessor">#define BLEND_MASK_USE_VPOS_ACC     2</span></div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="AP__GPS_8cpp.html#af3476ae7cb8c401b7d55ab98b86ed292">   56</a></span>&#160;<span class="preprocessor">#define BLEND_MASK_USE_SPD_ACC      4</span></div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="AP__GPS_8cpp.html#a2f89c2cb9e2d16e7cebb42b9e313b05e">   57</a></span>&#160;<span class="preprocessor">#define BLEND_COUNTER_FAILURE_INCREMENT 10</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="keyword">extern</span> <span class="keyword">const</span> <a class="code" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a> &amp;<a class="code" href="AP__GPS_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">// baudrates to try to detect GPSes with</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keyword">const</span> uint32_t <a class="code" href="classAP__GPS.html#ac89218621af4ae16bce41e0fbcb8faf1">AP_GPS::_baudrates</a>[] = {9600U, 115200U, 4800U, 19200U, 38400U, 57600U, 230400U};</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">// initialisation blobs to send to the GPS to try to get it into the</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">// right mode</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="classAP__GPS.html#a1b88be4642982ed39abefd25e9f38003">AP_GPS::_initialisation_blob</a>[] = <a class="code" href="AP__GPS__UBLOX_8h.html#ab01245792ac1376be9de89e35cdc6690">UBLOX_SET_BINARY</a> <a class="code" href="AP__GPS__MTK__Common_8h.html#a33cc37eaf57637b4b2476d9efcf6611a">MTK_SET_BINARY</a> <a class="code" href="AP__GPS__SIRF_8h.html#a688aa025e0239993674de15fccc32285">SIRF_SET_BINARY</a>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<a class="code" href="classAP__GPS.html">AP_GPS</a> *<a class="code" href="classAP__GPS.html#ab7d394dafbbd1d9c7d046aa195d49063">AP_GPS::_singleton</a>;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">// table of user settable parameters</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keyword">const</span> <a class="code" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code" href="classAP__GPS.html#a58a05f48dce64267c71558d39b7917e9">AP_GPS::var_info</a>[] = {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// @Param: TYPE</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// @DisplayName: GPS type</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// @Description: GPS type</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// @Values: 0:None,1:AUTO,2:uBlox,3:MTK,4:MTK19,5:NMEA,6:SiRF,7:HIL,8:SwiftNav,9:UAVCAN,10:SBF,11:GSOF,13:ERB,14:MAV,15:NOVA</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// @RebootRequired: True</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TYPE&quot;</span>,    0, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _type[0], <a class="code" href="AP__HAL__Boards_8h.html#a3c0c1b7e4574fd0e968689e687c28dc3">HAL_GPS_TYPE_DEFAULT</a>),</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// @Param: TYPE2</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// @DisplayName: 2nd GPS type</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// @Description: GPS type of 2nd GPS</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// @Values: 0:None,1:AUTO,2:uBlox,3:MTK,4:MTK19,5:NMEA,6:SiRF,7:HIL,8:SwiftNav,9:UAVCAN,10:SBF,11:GSOF,13:ERB,14:MAV,15:NOVA</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// @RebootRequired: True</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TYPE2&quot;</span>,   1, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _type[1], 0),</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// @Param: NAVFILTER</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// @DisplayName: Navigation filter setting</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">// @Description: Navigation filter engine setting</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// @Values: 0:Portable,2:Stationary,3:Pedestrian,4:Automotive,5:Sea,6:Airborne1G,7:Airborne2G,8:Airborne4G</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;NAVFILTER&quot;</span>, 2, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _navfilter, GPS_ENGINE_AIRBORNE_4G),</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">// @Param: AUTO_SWITCH</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// @DisplayName: Automatic Switchover Setting</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">// @Description: Automatic switchover to GPS reporting best lock</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">// @Values: 0:Disabled,1:UseBest,2:Blend,3:UseSecond</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;AUTO_SWITCH&quot;</span>, 3, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _auto_switch, 1),</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// @Param: MIN_DGPS</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// @DisplayName: Minimum Lock Type Accepted for DGPS</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">// @Description: Sets the minimum type of differential GPS corrections required before allowing to switch into DGPS mode.</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">// @Values: 0:Any,50:FloatRTK,100:IntegerRTK</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// @RebootRequired: True</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MIN_DGPS&quot;</span>, 4, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _min_dgps, 100),</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// @Param: SBAS_MODE</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// @DisplayName: SBAS Mode</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">// @Description: This sets the SBAS (satellite based augmentation system) mode if available on this GPS. If set to 2 then the SBAS mode is not changed in the GPS. Otherwise the GPS will be reconfigured to enable/disable SBAS. Disabling SBAS may be worthwhile in some parts of the world where an SBAS signal is available but the baseline is too long to be useful.</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">// @Values: 0:Disabled,1:Enabled,2:NoChange</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SBAS_MODE&quot;</span>, 5, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _sbas_mode, 2),</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// @Param: MIN_ELEV</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// @DisplayName: Minimum elevation</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// @Description: This sets the minimum elevation of satellites above the horizon for them to be used for navigation. Setting this to -100 leaves the minimum elevation set to the GPS modules default.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// @Range: -100 90</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">// @Units: deg</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MIN_ELEV&quot;</span>, 6, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _min_elevation, -100),</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// @Param: INJECT_TO</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">// @DisplayName: Destination for GPS_INJECT_DATA MAVLink packets</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// @Description: The GGS can send raw serial packets to inject data to multiple GPSes.</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// @Values: 0:send to first GPS,1:send to 2nd GPS,127:send to all</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;INJECT_TO&quot;</span>,   7, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _inject_to, <a class="code" href="AP__GPS_8cpp.html#af476b309d3827917a4217a393c7bb6ed">GPS_RTK_INJECT_TO_ALL</a>),</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// @Param: SBP_LOGMASK</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">// @DisplayName: Swift Binary Protocol Logging Mask</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">// @Description: Masked with the SBP msg_type field to determine whether SBR1/SBR2 data is logged</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// @Values: 0:None (0x0000),-1:All (0xFFFF),-256:External only (0xFF00)</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SBP_LOGMASK&quot;</span>, 8, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _sbp_logmask, -256),</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// @Param: RAW_DATA</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// @DisplayName: Raw data logging</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">// @Description: Handles logging raw data; on uBlox chips that support raw data this will log RXM messages into logger; on Septentrio this will log on the equipment&#39;s SD card and when set to 2, the autopilot will try to stop logging after disarming and restart after arming</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// @Values: 0:Ignore,1:Always log,2:Stop logging when disarmed (SBF only),5:Only log every five samples (uBlox only)</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// @RebootRequired: True</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RAW_DATA&quot;</span>, 9, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _raw_data, 0),</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">// @Param: GNSS_MODE</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">// @DisplayName: GNSS system configuration</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="comment">// @Description: Bitmask for what GNSS system to use on the first GPS (all unchecked or zero to leave GPS as configured)</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// @Values: 0:Leave as currently configured, 1:GPS-NoSBAS, 3:GPS+SBAS, 4:Galileo-NoSBAS, 6:Galileo+SBAS, 8:Beidou, 51:GPS+IMES+QZSS+SBAS (Japan Only), 64:GLONASS, 66:GLONASS+SBAS, 67:GPS+GLONASS+SBAS</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">// @Bitmask: 0:GPS,1:SBAS,2:Galileo,3:Beidou,4:IMES,5:QZSS,6:GLOSNASS</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GNSS_MODE&quot;</span>, 10, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _gnss_mode[0], 0),</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// @Param: SAVE_CFG</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">// @DisplayName: Save GPS configuration</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// @Description: Determines whether the configuration for this GPS should be written to non-volatile memory on the GPS. Currently working for UBlox 6 series and above.</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// @Values: 0:Do not save config,1:Save config,2:Save only when needed</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SAVE_CFG&quot;</span>, 11, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _save_config, 2),</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">// @Param: GNSS_MODE2</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// @DisplayName: GNSS system configuration</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">// @Description: Bitmask for what GNSS system to use on the second GPS (all unchecked or zero to leave GPS as configured)</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// @Values: 0:Leave as currently configured, 1:GPS-NoSBAS, 3:GPS+SBAS, 4:Galileo-NoSBAS, 6:Galileo+SBAS, 8:Beidou, 51:GPS+IMES+QZSS+SBAS (Japan Only), 64:GLONASS, 66:GLONASS+SBAS, 67:GPS+GLONASS+SBAS</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// @Bitmask: 0:GPS,1:SBAS,2:Galileo,3:Beidou,4:IMES,5:QZSS,6:GLOSNASS</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GNSS_MODE2&quot;</span>, 12, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _gnss_mode[1], 0),</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">// @Param: AUTO_CONFIG</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// @DisplayName: Automatic GPS configuration</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// @Description: Controls if the autopilot should automatically configure the GPS based on the parameters and default settings</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">// @Values: 0:Disables automatic configuration,1:Enable automatic configuration</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;AUTO_CONFIG&quot;</span>, 13, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _auto_config, 1),</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">// @Param: RATE_MS</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">// @DisplayName: GPS update rate in milliseconds</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">// @Description: Controls how often the GPS should provide a position update. Lowering below 5Hz is not allowed</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">// @Units: ms</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// @Values: 100:10Hz,125:8Hz,200:5Hz</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// @Range: 50 200</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RATE_MS&quot;</span>, 14, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _rate_ms[0], 200),</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">// @Param: RATE_MS2</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// @DisplayName: GPS 2 update rate in milliseconds</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">// @Description: Controls how often the GPS should provide a position update. Lowering below 5Hz is not allowed</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">// @Units: ms</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// @Values: 100:10Hz,125:8Hz,200:5Hz</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// @Range: 50 200</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RATE_MS2&quot;</span>, 15, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _rate_ms[1], 200),</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment">// @Param: POS1_X</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">// @DisplayName: Antenna X position offset</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// @Description: X position of the first GPS antenna in body frame. Positive X is forward of the origin. Use antenna phase centroid location if provided by the manufacturer.</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">// @Param: POS1_Y</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// @DisplayName: Antenna Y position offset</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// @Description: Y position of the first GPS antenna in body frame. Positive Y is to the right of the origin. Use antenna phase centroid location if provided by the manufacturer.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// @Param: POS1_Z</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// @DisplayName: Antenna Z position offset</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">// @Description: Z position of the first GPS antenna in body frame. Positive Z is down from the origin. Use antenna phase centroid location if provided by the manufacturer.</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;POS1&quot;</span>, 16, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _antenna_offset[0], 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// @Param: POS2_X</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// @DisplayName: Antenna X position offset</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">// @Description: X position of the second GPS antenna in body frame. Positive X is forward of the origin. Use antenna phase centroid location if provided by the manufacturer.</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">// @Param: POS2_Y</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">// @DisplayName: Antenna Y position offset</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">// @Description: Y position of the second GPS antenna in body frame. Positive Y is to the right of the origin. Use antenna phase centroid location if provided by the manufacturer.</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// @Param: POS2_Z</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// @DisplayName: Antenna Z position offset</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// @Description: Z position of the second GPS antenna in body frame. Positive Z is down from the origin. Use antenna phase centroid location if provided by the manufacturer.</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;POS2&quot;</span>, 17, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _antenna_offset[1], 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">// @Param: DELAY_MS</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">// @DisplayName: GPS delay in milliseconds</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">// @Description: Controls the amount of GPS  measurement delay that the autopilot compensates for. Set to zero to use the default delay for the detected GPS type.</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">// @Units: ms</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">// @Range: 0 250</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">// @RebootRequired: True</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DELAY_MS&quot;</span>, 18, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _delay_ms[0], 0),</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="comment">// @Param: DELAY_MS2</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">// @DisplayName: GPS 2 delay in milliseconds</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">// @Description: Controls the amount of GPS  measurement delay that the autopilot compensates for. Set to zero to use the default delay for the detected GPS type.</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="comment">// @Units: ms</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">// @Range: 0 250</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// @RebootRequired: True</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DELAY_MS2&quot;</span>, 19, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _delay_ms[1], 0),</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="comment">// @Param: BLEND_MASK</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">// @DisplayName: Multi GPS Blending Mask</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// @Description: Determines which of the accuracy measures Horizontal position, Vertical Position and Speed are used to calculate the weighting on each GPS receiver when soft switching has been selected by setting GPS_AUTO_SWITCH to 2</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">// @Bitmask: 0:Horiz Pos,1:Vert Pos,2:Speed</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;BLEND_MASK&quot;</span>, 20, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _blend_mask, 5),</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// @Param: BLEND_TC</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">// @DisplayName: Blending time constant</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">// @Description: Controls the slowest time constant applied to the calculation of GPS position and height offsets used to adjust different GPS receivers for steady state position differences.</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">// @Units: s</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">// @Range: 5.0 30.0</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;BLEND_TC&quot;</span>, 21, <a class="code" href="classAP__GPS.html">AP_GPS</a>, _blend_tc, 10.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <a class="code" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;};</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">// constructor</span></div><div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="classAP__GPS.html#aa64e78056c0899273bae42ac4874b7e0">  276</a></span>&#160;<a class="code" href="classAP__GPS.html#aa64e78056c0899273bae42ac4874b7e0">AP_GPS::AP_GPS</a>()</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;{</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    static_assert((<span class="keyword">sizeof</span>(<a class="code" href="classAP__GPS.html#a1b88be4642982ed39abefd25e9f38003">_initialisation_blob</a>) * (CHAR_BIT + 2)) &lt; (4800 * <a class="code" href="AP__GPS_8cpp.html#a2f6d184a58b49c746340c1139bd6e0ea">GPS_BAUD_TIME_MS</a> * 1e-3),</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    <span class="stringliteral">&quot;GPS initilisation blob is too large to be completely sent before the baud rate changes&quot;</span>);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a>(<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#a58a05f48dce64267c71558d39b7917e9">var_info</a>);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#ab7d394dafbbd1d9c7d046aa195d49063">_singleton</a> != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <a class="code" href="namespaceAP__HAL.html#a71832f03d849a0c088f04fc98d3c8143">AP_HAL::panic</a>(<span class="stringliteral">&quot;AP_GPS must be singleton&quot;</span>);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <a class="code" href="classAP__GPS.html#ab7d394dafbbd1d9c7d046aa195d49063">_singleton</a> = <span class="keyword">this</span>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;}</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a603f934a204d3eb595257a854cb44759">  290</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#a603f934a204d3eb595257a854cb44759">AP_GPS::init</a>(<span class="keyword">const</span> <a class="code" href="classAP__SerialManager.html">AP_SerialManager</a>&amp; <a class="code" href="AHRS__Test_8cpp.html#a90ddf96040cbf0429052dafd4fa64c12">serial_manager</a>)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;{</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a> = 0;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">// search for serial ports with gps protocol</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[0] = <a class="code" href="AHRS__Test_8cpp.html#a90ddf96040cbf0429052dafd4fa64c12">serial_manager</a>.<a class="code" href="classAP__SerialManager.html#a58cb32ebb77d9fc18e4756d0270d1970">find_serial</a>(<a class="code" href="classAP__SerialManager.html#af95280ba50704a8adece62755cb348e7a22d7bc8b55699d3423ceb94263ad982d">AP_SerialManager::SerialProtocol_GPS</a>, 0);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[1] = <a class="code" href="AHRS__Test_8cpp.html#a90ddf96040cbf0429052dafd4fa64c12">serial_manager</a>.<a class="code" href="classAP__SerialManager.html#a58cb32ebb77d9fc18e4756d0270d1970">find_serial</a>(<a class="code" href="classAP__SerialManager.html#af95280ba50704a8adece62755cb348e7a22d7bc8b55699d3423ceb94263ad982d">AP_SerialManager::SerialProtocol_GPS</a>, 1);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="classAP__GPS.html#ac72f28687a306b821da873c6b2145241">_last_instance_swap_ms</a> = 0;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// Initialise class variables used to do GPS blending</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <a class="code" href="classAP__GPS.html#a020a2b10c64f877da888309232e1b3b2">_omega_lpf</a> = 1.0f / <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__GPS.html#a4b84d957422b1eae6170893a306b95cf">_blend_tc</a>, 5.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 30.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">// prep the state instance fields</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="AP__GPS_8h.html#a3a734b4d4de7ca88c6563a5a476e3e87">GPS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a95606c520bd395452a6e171828a4988d">instance</a> = i;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">// sanity check update rate</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#ace81d41034cf6bc7a468ec57baf62bec">_rate_ms</a>[i] &lt;= 0 || <a class="code" href="classAP__GPS.html#ace81d41034cf6bc7a468ec57baf62bec">_rate_ms</a>[i] &gt; <a class="code" href="AP__GPS_8cpp.html#a2d79705911859d95849c965ef469c5fb">GPS_MAX_RATE_MS</a>) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <a class="code" href="classAP__GPS.html#ace81d41034cf6bc7a468ec57baf62bec">_rate_ms</a>[i] = <a class="code" href="AP__GPS_8cpp.html#a2d79705911859d95849c965ef469c5fb">GPS_MAX_RATE_MS</a>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        }</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;}</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">// return number of active GPS sensors. Note that if the first GPS</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">// is not present but the 2nd is then we return 2. Note that a blended</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">// GPS solution is treated as an additional sensor.</span></div><div class="line"><a name="l00318"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a3d0a0e530c963bb5b7ffaf4eb74faef2">  318</a></span>&#160;uint8_t <a class="code" href="classAP__GPS.html#a3d0a0e530c963bb5b7ffaf4eb74faef2">AP_GPS::num_sensors</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__GPS.html#a5ec4e6f4bba7af336c54c75797148a38">_output_is_blended</a>) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classAP__GPS.html#a2632887b489c6de665ca309836a443f7">num_instances</a>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classAP__GPS.html#a2632887b489c6de665ca309836a443f7">num_instances</a>+1;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;}</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a32634fda14b879872e3434733dac25ba">  327</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__GPS.html#a32634fda14b879872e3434733dac25ba">AP_GPS::speed_accuracy</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <span class="keywordtype">float</span> &amp;sacc)<span class="keyword"> const</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].have_speed_accuracy) {</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        sacc = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0845d4035e6cb36a9e1e31f4a68531f2">speed_accuracy</a>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;}</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno"><a class="line" href="classAP__GPS.html#abca09c2218f7fec3eef23679dead41b4">  336</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__GPS.html#abca09c2218f7fec3eef23679dead41b4">AP_GPS::horizontal_accuracy</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <span class="keywordtype">float</span> &amp;hacc)<span class="keyword"> const</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].have_horizontal_accuracy) {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        hacc = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#ad0ebe176090d273b59cad3e6d86fd416">horizontal_accuracy</a>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;}</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="classAP__GPS.html#afa08eb7c0337c97e2ebab7e7c930423d">  345</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__GPS.html#afa08eb7c0337c97e2ebab7e7c930423d">AP_GPS::vertical_accuracy</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <span class="keywordtype">float</span> &amp;vacc)<span class="keyword"> const</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].have_vertical_accuracy) {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        vacc = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#af5066cda264f04cf812a5ffdb8248e46">vertical_accuracy</a>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    }</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;}</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a1f8530ce124421726e3544893cd05561">  358</a></span>&#160;uint64_t <a class="code" href="classAP__GPS.html#a1f8530ce124421726e3544893cd05561">AP_GPS::time_epoch_convert</a>(uint16_t gps_week, uint32_t gps_ms)</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;{</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    uint64_t fix_time_ms = <a class="code" href="AP__GPS_8h.html#ac159cf063a7c67cf309fa8939df8f727">UNIX_OFFSET_MSEC</a> + gps_week * <a class="code" href="definitions_8h.html#a7643e40a680579fe07946b46a153d8d0">AP_MSEC_PER_WEEK</a> + gps_ms;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">return</span> fix_time_ms;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;}</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno"><a class="line" href="classAP__GPS.html#ad5311f0750e62e87bc2bb666024028f6">  367</a></span>&#160;uint64_t <a class="code" href="classAP__GPS.html#a13771e63e584a3bca073142b10316c05">AP_GPS::time_epoch_usec</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)<span class="keyword"> const</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keyword">const</span> <a class="code" href="structAP__GPS_1_1GPS__State.html">GPS_State</a> &amp;istate = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>];</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">if</span> (istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a3fa38b751ea5cb9c140a2fc61ae6f568">last_gps_time_ms</a> == 0) {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    }</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    uint64_t fix_time_ms = <a class="code" href="classAP__GPS.html#a1f8530ce124421726e3544893cd05561">time_epoch_convert</a>(istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a1deb41c0495c03263d4a900c09cd5bc8">time_week</a>, istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a7f5493cb75218bca4a13c125f546c8af">time_week_ms</a>);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="comment">// add in the milliseconds since the last fix</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">return</span> (fix_time_ms + (<a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>() - istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a3fa38b751ea5cb9c140a2fc61ae6f568">last_gps_time_ms</a>)) * 1000ULL;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;}</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">  send some more initialisation string bytes if there is room in the</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">  UART transmit buffer</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00382"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a90b25b2edbb127b22e597a56f2a01e42">  382</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#a90b25b2edbb127b22e597a56f2a01e42">AP_GPS::send_blob_start</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *_blob, uint16_t size)</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;{</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <a class="code" href="classAP__GPS.html#ad59f76f7eba6465149870f76442446b1">initblob_state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].blob = _blob;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <a class="code" href="classAP__GPS.html#ad59f76f7eba6465149870f76442446b1">initblob_state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].remaining = size;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;}</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">  send some more initialisation string bytes if there is room in the</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">  UART transmit buffer</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00392"></a><span class="lineno"><a class="line" href="classAP__GPS.html#ad4512e4952aa41566d6afb110e0fd6a1">  392</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#ad4512e4952aa41566d6afb110e0fd6a1">AP_GPS::send_blob_update</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;{</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="comment">// exit immediately if no uart for this instance</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">// see if we can write some more of the initialisation blob</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#ad59f76f7eba6465149870f76442446b1">initblob_state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="classAP__GPS.html#a88ffa0ff28e2c65d11c8b1ced2c43760">remaining</a> &gt; 0) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        int16_t space = <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#ab0193c7791fd95eb2bfbfd6597bdf6d8">txspace</a>();</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">if</span> (space &gt; (int16_t)<a class="code" href="classAP__GPS.html#ad59f76f7eba6465149870f76442446b1">initblob_state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="classAP__GPS.html#a88ffa0ff28e2c65d11c8b1ced2c43760">remaining</a>) {</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            space = <a class="code" href="classAP__GPS.html#ad59f76f7eba6465149870f76442446b1">initblob_state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].remaining;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">while</span> (space &gt; 0) {</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a915cc01273d4b418c2fb2989fb31a508">write</a>(*<a class="code" href="classAP__GPS.html#ad59f76f7eba6465149870f76442446b1">initblob_state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="classAP__GPS.html#a9cc00433bd94933f1259dc8bfe859fe1">blob</a>);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            <a class="code" href="classAP__GPS.html#ad59f76f7eba6465149870f76442446b1">initblob_state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].blob++;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            space--;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            <a class="code" href="classAP__GPS.html#ad59f76f7eba6465149870f76442446b1">initblob_state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].remaining--;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        }</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;}</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">  run detection step for one GPS instance. If this finds a GPS then it</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">  will fill in drivers[instance] and change state[instance].status</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">  from NO_GPS to NO_FIX.</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00419"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a4bdd5c70ed358b4147a58c7d09f040dd">  419</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#a4bdd5c70ed358b4147a58c7d09f040dd">AP_GPS::detect_instance</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;{</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <a class="code" href="classAP__GPS__Backend.html">AP_GPS_Backend</a> *new_gps = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keyword">struct </span><a class="code" href="structAP__GPS_1_1detect__state.html">detect_state</a> *dstate = &amp;<a class="code" href="structAP__GPS_1_1detect__state.html">detect_state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>];</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keyword">const</span> uint32_t now = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0a8710bdc386183e8afea11565745c75">status</a> = <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca5eba95d16dc0519820e356de7be1362d">NO_GPS</a>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#ab346404b3a35776ea25982265c346974">hdop</a> = <a class="code" href="AP__GPS_8h.html#adcf9fb3187691bb28ccf836a46d493ce">GPS_UNKNOWN_DOP</a>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#acf132315548c8b639ecdaac75af61101">vdop</a> = <a class="code" href="AP__GPS_8h.html#adcf9fb3187691bb28ccf836a46d493ce">GPS_UNKNOWN_DOP</a>;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]) {</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="comment">// user has to explicitly set the MAV type, do not use AUTO</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="comment">// do not try to detect the MAV type, assume it&#39;s there</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6ac02030cdc32f8c77fa5d3109f22ff324">GPS_TYPE_MAV</a>:</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#aff3aa650f857cd70f6a34b8bbab72040">auto_detected_baud</a> = <span class="keyword">false</span>; <span class="comment">// specified, not detected</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        new_gps = <span class="keyword">new</span> <a class="code" href="classAP__GPS.html#a7bcfc49c7498cdd19ee51552d7edf506">AP_GPS_MAV</a>(*<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordflow">goto</span> found_gps;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">// user has to explicitly set the UAVCAN type, do not use AUTO</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6aefdd545e85fc6611b1678e42cef8c0a1">GPS_TYPE_UAVCAN</a>:</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="preprocessor">#if HAL_WITH_UAVCAN</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#aff3aa650f857cd70f6a34b8bbab72040">auto_detected_baud</a> = <span class="keyword">false</span>; <span class="comment">// specified, not detected</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        new_gps = <a class="code" href="classAP__GPS__UAVCAN.html#ade4c203985a3afdadb840ea2ea24bfe8">AP_GPS_UAVCAN::probe</a>(*<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordflow">goto</span> found_gps;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keywordflow">return</span>; <span class="comment">// We don&#39;t do anything here if UAVCAN is not supported</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    }</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="comment">// UART not available</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    }</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">// all remaining drivers automatically cycle through baud rates to detect</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="comment">// the correct baud rate, and should have the selected baud broadcast</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#aff3aa650f857cd70f6a34b8bbab72040">auto_detected_baud</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]) {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">// by default the sbf/trimble gps outputs no data on its port, until configured.</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a18e7fef3055b02873f12983bd9c8b350">GPS_TYPE_SBF</a>:</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        new_gps = <span class="keyword">new</span> <a class="code" href="classAP__GPS.html#a7c57cd937a1702a32ea63dc30f271d5b">AP_GPS_SBF</a>(*<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a76a222d514c32a4bc7cb319b4572bb41">GPS_TYPE_GSOF</a>:</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        new_gps = <span class="keyword">new</span> <a class="code" href="classAP__GPS.html#ab56525924639ff734a805b7bce10f5eb">AP_GPS_GSOF</a>(*<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a77521927cbe6149568d69e29b685fbcf">GPS_TYPE_NOVA</a>:</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        new_gps = <span class="keyword">new</span> <a class="code" href="classAP__GPS.html#acb11fb039b919cc571307c0c6c265d7a">AP_GPS_NOVA</a>(*<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    }</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span> (now - dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#a3a88e9dbec6da9c65c26f0167b7151ff">last_baud_change_ms</a> &gt; <a class="code" href="AP__GPS_8cpp.html#a2f6d184a58b49c746340c1139bd6e0ea">GPS_BAUD_TIME_MS</a>) {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="comment">// try the next baud rate</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="comment">// incrementing like this will skip the first element in array of bauds</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="comment">// this is okay, and relied upon</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#adc2dd3641c9e227dee48f3851658f63d">current_baud</a>++;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keywordflow">if</span> (dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#adc2dd3641c9e227dee48f3851658f63d">current_baud</a> == <a class="code" href="AP__Common_8h.html#a121caf32c5b5d704ef3453f0885a9ea5">ARRAY_SIZE</a>(<a class="code" href="classAP__GPS.html#ac89218621af4ae16bce41e0fbcb8faf1">_baudrates</a>)) {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#adc2dd3641c9e227dee48f3851658f63d">current_baud</a> = 0;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        uint32_t <a class="code" href="RCProtocolDecoder_8cpp.html#a24dfbdba9f3f5edd317e77f9b6f9b6f5">baudrate</a> = <a class="code" href="classAP__GPS.html#ac89218621af4ae16bce41e0fbcb8faf1">_baudrates</a>[dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#adc2dd3641c9e227dee48f3851658f63d">current_baud</a>];</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__HAL_1_1UARTDriver.html#a2a83124757f6f8f6eb4d25b11c9cb97e">begin</a>(<a class="code" href="RCProtocolDecoder_8cpp.html#a24dfbdba9f3f5edd317e77f9b6f9b6f5">baudrate</a>);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__HAL_1_1UARTDriver.html#ae831a0d75f4760267d444c522e1271a1">set_flow_control</a>(<a class="code" href="classAP__HAL_1_1UARTDriver.html#acd5e319d580fe14755931d37b5d4deafa67a3cf106c9c7c7d6e454a7a9610a7d8">AP_HAL::UARTDriver::FLOW_CONTROL_DISABLE</a>);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#a3a88e9dbec6da9c65c26f0167b7151ff">last_baud_change_ms</a> = now;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a4570c56a31686eb4fd74eaee91a00052">_auto_config</a> == <a class="code" href="classAP__GPS.html#abbd67f2b9539b783cc40c5eb18f57077a77aec478494939b825c1105de409acbb">GPS_AUTO_CONFIG_ENABLE</a> &amp;&amp; new_gps == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            <a class="code" href="classAP__GPS.html#a90b25b2edbb127b22e597a56f2a01e42">send_blob_start</a>(<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <a class="code" href="classAP__GPS.html#a1b88be4642982ed39abefd25e9f38003">_initialisation_blob</a>, <span class="keyword">sizeof</span>(<a class="code" href="classAP__GPS.html#a1b88be4642982ed39abefd25e9f38003">_initialisation_blob</a>));</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        }</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    }</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a4570c56a31686eb4fd74eaee91a00052">_auto_config</a> == <a class="code" href="classAP__GPS.html#abbd67f2b9539b783cc40c5eb18f57077a77aec478494939b825c1105de409acbb">GPS_AUTO_CONFIG_ENABLE</a> &amp;&amp; new_gps == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <a class="code" href="classAP__GPS.html#ad4512e4952aa41566d6afb110e0fd6a1">send_blob_update</a>(<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="classAP__GPS.html#ad59f76f7eba6465149870f76442446b1">initblob_state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="classAP__GPS.html#a88ffa0ff28e2c65d11c8b1ced2c43760">remaining</a> == 0 &amp;&amp; <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;available() &gt; 0</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;           &amp;&amp; new_gps == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        uint8_t data = <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a65082ecb994170fc6d2a7ff2bcc301a7">read</a>();</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">          running a uBlox at less than 38400 will lead to packet</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">          corruption, as we can&#39;t receive the packets in the 200ms</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">          window for 5Hz fixes. The NMEA startup message should force</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">          the uBlox into 115200 no matter what rate it is configured</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">          for.</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a316eaa99b513960bd73ffc65f3ce94d3">GPS_TYPE_AUTO</a> || <a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6afb53d6f3afb17c9ce056c2ce4dbfad79">GPS_TYPE_UBLOX</a>) &amp;&amp;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            ((!<a class="code" href="classAP__GPS.html#a4570c56a31686eb4fd74eaee91a00052">_auto_config</a> &amp;&amp; <a class="code" href="classAP__GPS.html#ac89218621af4ae16bce41e0fbcb8faf1">_baudrates</a>[dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#adc2dd3641c9e227dee48f3851658f63d">current_baud</a>] &gt;= 38400) ||</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;             <a class="code" href="classAP__GPS.html#ac89218621af4ae16bce41e0fbcb8faf1">_baudrates</a>[dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#adc2dd3641c9e227dee48f3851658f63d">current_baud</a>] == 115200) &amp;&amp;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            <a class="code" href="classAP__GPS__UBLOX.html#abd6e355abac6f9d1914591b92298395b">AP_GPS_UBLOX::_detect</a>(dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#a1f091c7a044d04d64919d7aadedf1495">ublox_detect_state</a>, data)) {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            new_gps = <span class="keyword">new</span> <a class="code" href="classAP__GPS.html#a46e5d33707cf47859f90bbbdc1bdbfc7">AP_GPS_UBLOX</a>(*<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        }</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="preprocessor">#if !HAL_MINIMIZE_FEATURES</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="comment">// we drop the MTK drivers when building a small build as they are so rarely used</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="comment">// and are surprisingly large</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a316eaa99b513960bd73ffc65f3ce94d3">GPS_TYPE_AUTO</a> || <a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a8d6520721ac1203489b975cc09ef815e">GPS_TYPE_MTK19</a>) &amp;&amp;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                 <a class="code" href="classAP__GPS__MTK19.html#ae7dd973d7154070da15101cfc9f4a58b">AP_GPS_MTK19::_detect</a>(dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#a6102db4d46470019b42a5809752c82ae">mtk19_detect_state</a>, data)) {</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            new_gps = <span class="keyword">new</span> <a class="code" href="classAP__GPS.html#ae75149bb82042813fcb3fc301a87fe03">AP_GPS_MTK19</a>(*<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a316eaa99b513960bd73ffc65f3ce94d3">GPS_TYPE_AUTO</a> || <a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a75e6abea4be518c0367016185ac3e53f">GPS_TYPE_MTK</a>) &amp;&amp;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                   <a class="code" href="classAP__GPS__MTK.html#aaaa210f0bb36cd3e6150b617418c3a92">AP_GPS_MTK::_detect</a>(dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#add10334deb707e361ad8d3ddc0eaec36">mtk_detect_state</a>, data)) {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            new_gps = <span class="keyword">new</span> <a class="code" href="classAP__GPS.html#a68a4f8c7edd5900e2e14029232790cb2">AP_GPS_MTK</a>(*<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a316eaa99b513960bd73ffc65f3ce94d3">GPS_TYPE_AUTO</a> || <a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a755a5b90129ac93c5b947fd0430252aa">GPS_TYPE_SBP</a>) &amp;&amp;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                 <a class="code" href="classAP__GPS__SBP2.html#aa7c133a66a1d1b717fced68f92dcec14">AP_GPS_SBP2::_detect</a>(dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#aff6604d92bd10a17ca5fad75f48780d6">sbp2_detect_state</a>, data)) {</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            new_gps = <span class="keyword">new</span> <a class="code" href="classAP__GPS.html#a345149947e2742dfde06a095e40e5a9c">AP_GPS_SBP2</a>(*<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        }</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a316eaa99b513960bd73ffc65f3ce94d3">GPS_TYPE_AUTO</a> || <a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a755a5b90129ac93c5b947fd0430252aa">GPS_TYPE_SBP</a>) &amp;&amp;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                 <a class="code" href="classAP__GPS__SBP.html#ae1ae391d424ba0cc24b0b8b70a263bcc">AP_GPS_SBP::_detect</a>(dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#a2e80a2a45e99a54129c084a0db6ec6e6">sbp_detect_state</a>, data)) {</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            new_gps = <span class="keyword">new</span> <a class="code" href="classAP__GPS.html#ab61a817d51c7c3a3f1ae0dc36982b437">AP_GPS_SBP</a>(*<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="preprocessor">#if !HAL_MINIMIZE_FEATURES</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a316eaa99b513960bd73ffc65f3ce94d3">GPS_TYPE_AUTO</a> || <a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a1f0ab654d6f0fbe978f0f35438c04734">GPS_TYPE_SIRF</a>) &amp;&amp;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                 <a class="code" href="classAP__GPS__SIRF.html#a99c1e4f27c9077aaadead6cc6ad031a0">AP_GPS_SIRF::_detect</a>(dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#a77c207fe0e20e8a532332e3feefe5e1a">sirf_detect_state</a>, data)) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            new_gps = <span class="keyword">new</span> <a class="code" href="classAP__GPS.html#a42591c1b4bded833142990e8757c9f24">AP_GPS_SIRF</a>(*<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a316eaa99b513960bd73ffc65f3ce94d3">GPS_TYPE_AUTO</a> || <a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a9df7e102648dfe6247fc3390099c8e26">GPS_TYPE_ERB</a>) &amp;&amp;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                 <a class="code" href="classAP__GPS__ERB.html#a4ddd7b585ea06578c407d19d6d3964c5">AP_GPS_ERB::_detect</a>(dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#a886f135417cf30f4c95540af6e8c90ab">erb_detect_state</a>, data)) {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            new_gps = <span class="keyword">new</span> <a class="code" href="classAP__GPS.html#a43a8bf081e4d4415aa9bf6a273bcd0b6">AP_GPS_ERB</a>(*<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6ae7f79347a000fb1cf52a29057a14c77d">GPS_TYPE_NMEA</a> &amp;&amp;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                   <a class="code" href="classAP__GPS__NMEA.html#a14edc53eb3e6907cba8b59832c69fd33">AP_GPS_NMEA::_detect</a>(dstate-&gt;<a class="code" href="structAP__GPS_1_1detect__state.html#ade0e499bceae920fe4d93ad1f9040776">nmea_detect_state</a>, data)) {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            new_gps = <span class="keyword">new</span> <a class="code" href="classAP__GPS.html#a292dd764eb38dab205786a85e8ee7203">AP_GPS_NMEA</a>(*<span class="keyword">this</span>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], <a class="code" href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">_port</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        }</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    }</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;found_gps:</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keywordflow">if</span> (new_gps != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0a8710bdc386183e8afea11565745c75">status</a> = <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca4166c675325c7b3e3e83c7c3ec1fbafb">NO_FIX</a>;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] = new_gps;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a6bbf268f8a99e5748b44975d97a5ae00">last_message_time_ms</a> = now;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a77d2a7ea1547b32a34ee112f304dbc3b">delta_time_ms</a> = <a class="code" href="AP__GPS_8cpp.html#aed01677f1b1efe774fa22e838b84f5db">GPS_TIMEOUT_MS</a>;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        new_gps-&gt;<a class="code" href="classAP__GPS__Backend.html#a3b19a929f00d465fd3aca9c0ae1fcaa7">broadcast_gps_type</a>();</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    }</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;}</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a3bf60c1850eb76bcec1416168ad384b3">  559</a></span>&#160;<a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fc">AP_GPS::GPS_Status</a> <a class="code" href="classAP__GPS.html#a3bf60c1850eb76bcec1416168ad384b3">AP_GPS::highest_supported_status</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)<span class="keyword"> const</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &lt; <a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a> &amp;&amp; <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__GPS__Backend.html#a8c5b16c4ac289e283effa184eb9df9c8">highest_supported_status</a>();</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    }</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a>;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;}</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a8d10f943cb245f20b1dc5f8e727f52eb">  567</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__GPS.html#a8d10f943cb245f20b1dc5f8e727f52eb">AP_GPS::should_log</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <a class="code" href="classAP__Logger.html">AP_Logger</a> *<a class="code" href="AHRS__Test_8cpp.html#a9fede12aaeb5750bcb131cae0430647c">logger</a> = <a class="code" href="classAP__Logger.html#a7dfeda4dc3df2edc8531110c9d7252dc">AP_Logger::get_singleton</a>();</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AHRS__Test_8cpp.html#a9fede12aaeb5750bcb131cae0430647c">logger</a> == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    }</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#ace74b654aa086c9acccf62b71a58d5e8">_log_gps_bit</a> == (uint32_t)-1) {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    }</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="AHRS__Test_8cpp.html#a9fede12aaeb5750bcb131cae0430647c">logger</a>-&gt;<a class="code" href="classAP__Logger.html#a8bed25359bc401b7d00def25bd8173b9">should_log</a>(<a class="code" href="classAP__GPS.html#ace74b654aa086c9acccf62b71a58d5e8">_log_gps_bit</a>)) {</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    }</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">  update one GPS instance. This should be called at 10Hz or greater</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00586"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a83302e8b52e5d01ae67375b3542eb460">  586</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#a83302e8b52e5d01ae67375b3542eb460">AP_GPS::update_instance</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;{</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a09943533b34b8f6a3981a11329270230">GPS_TYPE_HIL</a>) {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="comment">// in HIL, leave info alone</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    }</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6acb925988f6661c9552b576d7078f8ca1">GPS_TYPE_NONE</a>) {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        <span class="comment">// not enabled</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0a8710bdc386183e8afea11565745c75">status</a> = <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca5eba95d16dc0519820e356de7be1362d">NO_GPS</a>;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#ab346404b3a35776ea25982265c346974">hdop</a> = <a class="code" href="AP__GPS_8h.html#adcf9fb3187691bb28ccf836a46d493ce">GPS_UNKNOWN_DOP</a>;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#acf132315548c8b639ecdaac75af61101">vdop</a> = <a class="code" href="AP__GPS_8h.html#adcf9fb3187691bb28ccf836a46d493ce">GPS_UNKNOWN_DOP</a>;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    }</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#af5f34786e914886cbfe9f47cfcf2220d">locked_ports</a> &amp; (1U&lt;&lt;<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)) {</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="comment">// the port is locked by another driver</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    }</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <span class="keyword">nullptr</span> || <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> == <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca5eba95d16dc0519820e356de7be1362d">NO_GPS</a>) {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="comment">// we don&#39;t yet know the GPS type of this one, or it has timed</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="comment">// out and needs to be re-initialised</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <a class="code" href="classAP__GPS.html#a4bdd5c70ed358b4147a58c7d09f040dd">detect_instance</a>(<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    }</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a4570c56a31686eb4fd74eaee91a00052">_auto_config</a> == <a class="code" href="classAP__GPS.html#abbd67f2b9539b783cc40c5eb18f57077a77aec478494939b825c1105de409acbb">GPS_AUTO_CONFIG_ENABLE</a>) {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <a class="code" href="classAP__GPS.html#ad4512e4952aa41566d6afb110e0fd6a1">send_blob_update</a>(<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="comment">// we have an active driver for this instance</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="Printf_8cpp.html#a5558580ea8d3854253a721ee58cff12d">result</a> = <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__GPS__Backend.html#a4da5fd4a69edd3a0a393e74cc0ca391a">read</a>();</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    uint32_t tnow = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="comment">// if we did not get a message, and the idle timer of 2 seconds</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="comment">// has expired, re-initialise the GPS. This will cause GPS</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="comment">// detection to run again</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordtype">bool</span> data_should_be_logged = <span class="keyword">false</span>;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="Printf_8cpp.html#a5558580ea8d3854253a721ee58cff12d">result</a>) {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="keywordflow">if</span> (tnow - <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="classAP__GPS.html#a704e437c25ef2105580fbbfdaa8f9df4">last_message_time_ms</a> &gt; <a class="code" href="AP__GPS_8cpp.html#aed01677f1b1efe774fa22e838b84f5db">GPS_TIMEOUT_MS</a>) {</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            memset((<span class="keywordtype">void</span> *)&amp;<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], 0, <span class="keyword">sizeof</span>(<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]));</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a95606c520bd395452a6e171828a4988d">instance</a> = <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#ab346404b3a35776ea25982265c346974">hdop</a> = <a class="code" href="AP__GPS_8h.html#adcf9fb3187691bb28ccf836a46d493ce">GPS_UNKNOWN_DOP</a>;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#acf132315548c8b639ecdaac75af61101">vdop</a> = <a class="code" href="AP__GPS_8h.html#adcf9fb3187691bb28ccf836a46d493ce">GPS_UNKNOWN_DOP</a>;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a6bbf268f8a99e5748b44975d97a5ae00">last_message_time_ms</a> = tnow;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a77d2a7ea1547b32a34ee112f304dbc3b">delta_time_ms</a> = <a class="code" href="AP__GPS_8cpp.html#aed01677f1b1efe774fa22e838b84f5db">GPS_TIMEOUT_MS</a>;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <span class="comment">// do not try to detect again if type is MAV</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6ac02030cdc32f8c77fa5d3109f22ff324">GPS_TYPE_MAV</a>) {</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0a8710bdc386183e8afea11565745c75">status</a> = <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca4166c675325c7b3e3e83c7c3ec1fbafb">NO_FIX</a>;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <span class="comment">// free the driver before we run the next detection, so we</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                <span class="comment">// don&#39;t end up with two allocated at any time</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                <span class="keyword">delete</span> <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>];</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0a8710bdc386183e8afea11565745c75">status</a> = <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca5eba95d16dc0519820e356de7be1362d">NO_GPS</a>;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            }</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            <span class="comment">// log this data as a &quot;flag&quot; that the GPS is no longer</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            <span class="comment">// valid (see PR#8144)</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            data_should_be_logged = <span class="keyword">true</span>;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        }</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].uart_timestamp_ms != 0) {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            <span class="comment">// set the timestamp for this messages based on</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            <span class="comment">// set_uart_timestamp() in backend, if available</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            tnow = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a794387e866d36d1906864dff89e963a4">uart_timestamp_ms</a>;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a794387e866d36d1906864dff89e963a4">uart_timestamp_ms</a> = 0;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        }</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="comment">// delta will only be correct after parsing two messages</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a77d2a7ea1547b32a34ee112f304dbc3b">delta_time_ms</a> = tnow - <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a6bbf268f8a99e5748b44975d97a5ae00">last_message_time_ms</a>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a6bbf268f8a99e5748b44975d97a5ae00">last_message_time_ms</a> = tnow;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &gt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff">GPS_OK_FIX_2D</a>) {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a196a0fde4a1ac10bc27977eb60d69e4e">last_fix_time_ms</a> = tnow;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        data_should_be_logged = <span class="keyword">true</span>;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    }</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">if</span> (data_should_be_logged &amp;&amp;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <a class="code" href="classAP__GPS.html#a8d10f943cb245f20b1dc5f8e727f52eb">should_log</a>() &amp;&amp;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        !<a class="code" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a>().have_ekf_logging()) {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <a class="code" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().<a class="code" href="classAP__Logger.html#ad7ea6c85db8ab8fc74b7e78d3732e01d">Write_GPS</a>(<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    }</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &gt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">GPS_OK_FIX_3D</a>) {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="keyword">const</span> uint64_t now = <a class="code" href="classAP__GPS.html#a13771e63e584a3bca073142b10316c05">time_epoch_usec</a>(<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <a class="code" href="namespaceAP.html#ac357c38b6638140c5510e6ba566b998b">AP::rtc</a>().<a class="code" href="classAP__RTC.html#abb961ded9907a2dbaa1b20de2b3b5ce0">set_utc_usec</a>(now, <a class="code" href="classAP__RTC.html#af5ed0a2bd918379395e227179c7d6af3a9529f9ffd3c21a3d934042b6976a4a93">AP_RTC::SOURCE_GPS</a>);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    }</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;}</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">  update all GPS instances</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00677"></a><span class="lineno"><a class="line" href="classAP__GPS.html#afe04427a47ab5e630cb979815abd911e">  677</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#afe04427a47ab5e630cb979815abd911e">AP_GPS::update</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;{</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <a class="code" href="classAP__GPS.html#a83302e8b52e5d01ae67375b3542eb460">update_instance</a>(i);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    }</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="comment">// calculate number of instances</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> != <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca5eba95d16dc0519820e356de7be1362d">NO_GPS</a>) {</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            <a class="code" href="classAP__GPS.html#a2632887b489c6de665ca309836a443f7">num_instances</a> = i+1;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        }</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="comment">// if blending is requested, attempt to calculate weighting for each GPS</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a6ea12f82bdeac194c101ce53c5ebf6bd">_auto_switch</a> == 2) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <a class="code" href="classAP__GPS.html#a5ec4e6f4bba7af336c54c75797148a38">_output_is_blended</a> = <a class="code" href="classAP__GPS.html#ad6736a9d4cbb5352caf3d76e4928a356">calc_blend_weights</a>();</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="comment">// adjust blend health counter</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classAP__GPS.html#a5ec4e6f4bba7af336c54c75797148a38">_output_is_blended</a>) {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            <a class="code" href="classAP__GPS.html#aa11fde1563dedb624c0d308b0e542cb6">_blend_health_counter</a> = <a class="code" href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a>(<a class="code" href="classAP__GPS.html#aa11fde1563dedb624c0d308b0e542cb6">_blend_health_counter</a>+<a class="code" href="AP__GPS_8cpp.html#a2f89c2cb9e2d16e7cebb42b9e313b05e">BLEND_COUNTER_FAILURE_INCREMENT</a>, 100);</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#aa11fde1563dedb624c0d308b0e542cb6">_blend_health_counter</a> &gt; 0) {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            <a class="code" href="classAP__GPS.html#aa11fde1563dedb624c0d308b0e542cb6">_blend_health_counter</a>--;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        }</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="comment">// stop blending if unhealthy</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#aa11fde1563dedb624c0d308b0e542cb6">_blend_health_counter</a> &gt;= 50) {</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            <a class="code" href="classAP__GPS.html#a5ec4e6f4bba7af336c54c75797148a38">_output_is_blended</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        }</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <a class="code" href="classAP__GPS.html#a5ec4e6f4bba7af336c54c75797148a38">_output_is_blended</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <a class="code" href="classAP__GPS.html#aa11fde1563dedb624c0d308b0e542cb6">_blend_health_counter</a> = 0;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a5ec4e6f4bba7af336c54c75797148a38">_output_is_blended</a>) {</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <span class="comment">// Use the weighting to calculate blended GPS states</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <a class="code" href="classAP__GPS.html#a86e388032563bbd72cca1bce9ec24d17">calc_blended_state</a>();</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="comment">// set primary to the virtual instance</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a> = <a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="comment">// use switch logic to find best GPS</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        uint32_t now = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a6ea12f82bdeac194c101ce53c5ebf6bd">_auto_switch</a> == 3) {</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            <span class="comment">// select the second GPS instance</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            <a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a> = 1;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a6ea12f82bdeac194c101ce53c5ebf6bd">_auto_switch</a> &gt;= 1) {</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            <span class="comment">// handling switching away from blended GPS</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a> == <a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>) {</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                <a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a> = 0;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                <span class="keywordflow">for</span> (uint8_t i=1; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                    <span class="comment">// choose GPS with highest state or higher number of satellites</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                    <span class="keywordflow">if</span> ((<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &gt; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a>].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a>) ||</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                        ((<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> == <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a>].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a>) &amp;&amp; (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#ab97af8b3f61b2c16596fd0617bfe93a0">num_sats</a> &gt; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a>].<a class="code" href="classAP__GPS.html#ab97af8b3f61b2c16596fd0617bfe93a0">num_sats</a>))) {</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                        <a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a> = i;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                        <a class="code" href="classAP__GPS.html#ac72f28687a306b821da873c6b2145241">_last_instance_swap_ms</a> = now;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                    }</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                }</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                <span class="comment">// handle switch between real GPSs</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                    <span class="keywordflow">if</span> (i == <a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a>) {</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                    }</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &gt; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a>].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a>) {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                        <span class="comment">// we have a higher status lock, or primary is set to the blended GPS, change GPS</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                        <a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a> = i;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                        <a class="code" href="classAP__GPS.html#ac72f28687a306b821da873c6b2145241">_last_instance_swap_ms</a> = now;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                    }</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                    <span class="keywordtype">bool</span> another_gps_has_1_or_more_sats = (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a13d2ae016510be58fa8054f7d130d944">num_sats</a> &gt;= <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a13d2ae016510be58fa8054f7d130d944">num_sats</a> + 1);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> == <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a>].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &amp;&amp; another_gps_has_1_or_more_sats) {</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                        <span class="keywordtype">bool</span> another_gps_has_2_or_more_sats = (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a13d2ae016510be58fa8054f7d130d944">num_sats</a> &gt;= <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a13d2ae016510be58fa8054f7d130d944">num_sats</a> + 2);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                        <span class="keywordflow">if</span> ((another_gps_has_1_or_more_sats &amp;&amp; (now - <a class="code" href="classAP__GPS.html#ac72f28687a306b821da873c6b2145241">_last_instance_swap_ms</a>) &gt;= 20000) ||</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                            (another_gps_has_2_or_more_sats &amp;&amp; (now - <a class="code" href="classAP__GPS.html#ac72f28687a306b821da873c6b2145241">_last_instance_swap_ms</a>) &gt;= 5000)) {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                            <span class="comment">// this GPS has more satellites than the</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                            <span class="comment">// current primary, switch primary. Once we switch we will</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                            <span class="comment">// then tend to stick to the new GPS as primary. We don&#39;t</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                            <span class="comment">// want to switch too often as it will look like a</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                            <span class="comment">// position shift to the controllers.</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                            <a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a> = i;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                            <a class="code" href="classAP__GPS.html#ac72f28687a306b821da873c6b2145241">_last_instance_swap_ms</a> = now;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                        }</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                    }</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                }</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            }</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            <span class="comment">// AUTO_SWITCH is 0 so no switching of GPSs</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            <a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a> = 0;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        }</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="comment">// copy the primary instance to the blended instance in case it is enabled later</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>] = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a>];</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <a class="code" href="classAP__GPS.html#a09de09009fdec7d5242a04adeb7f842c">_blended_antenna_offset</a> = <a class="code" href="classAP__GPS.html#a4ff8670878e8371b8be04da456778045">_antenna_offset</a>[<a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a>];</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    }</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="comment">// update notify with gps status. We always base this on the primary_instance</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <a class="code" href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a>.<a class="code" href="structAP__Notify_1_1notify__flags__and__values__type.html#a804d7278d01f92ef395c3f36e464d5a8">gps_status</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0a8710bdc386183e8afea11565745c75">status</a>;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <a class="code" href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a>.<a class="code" href="structAP__Notify_1_1notify__flags__and__values__type.html#a6bc8e854e9a06270cd01c3b126d07575">gps_num_sats</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">primary_instance</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a13d2ae016510be58fa8054f7d130d944">num_sats</a>;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;}</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno"><a class="line" href="classAP__GPS.html#ab23fbd832b645879b3a7a8db446aef03">  779</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#ab23fbd832b645879b3a7a8db446aef03">AP_GPS::handle_gps_inject</a>(<span class="keyword">const</span> mavlink_message_t *msg)</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;{</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    mavlink_gps_inject_data_t packet;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    mavlink_msg_gps_inject_data_decode(msg, &amp;packet);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="comment">//TODO: check target</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <a class="code" href="classAP__GPS.html#aa712de51140898ff1942d428e2008ee7">inject_data</a>(packet.data, packet.len);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;}</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">  pass along a mavlink message (for MAV type)</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00791"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a3074764330bd4dfd9da851b59a6df2ed">  791</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#a3074764330bd4dfd9da851b59a6df2ed">AP_GPS::handle_msg</a>(<span class="keyword">const</span> mavlink_message_t *msg)</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;{</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keywordflow">switch</span> (msg-&gt;msgid) {</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">case</span> MAVLINK_MSG_ID_GPS_RTCM_DATA:</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="comment">// pass data to de-fragmenter</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <a class="code" href="classAP__GPS.html#a09fc3eb0ae4581f5d34d180431b0295f">handle_gps_rtcm_data</a>(msg);</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="keywordflow">case</span> MAVLINK_MSG_ID_GPS_INJECT_DATA:</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <a class="code" href="classAP__GPS.html#ab23fbd832b645879b3a7a8db446aef03">handle_gps_inject</a>(msg);</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="keywordflow">default</span>: {</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        uint8_t i;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="classAP__GPS.html#a2632887b489c6de665ca309836a443f7">num_instances</a>; i++) {</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[i] != <span class="keyword">nullptr</span>) &amp;&amp; (<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[i] != <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6acb925988f6661c9552b576d7078f8ca1">GPS_TYPE_NONE</a>)) {</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[i]-&gt;<a class="code" href="classAP__GPS__Backend.html#a5c024a64031affcfe0874e92756d3d88">handle_msg</a>(msg);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            }</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        }</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    }</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    }</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;}</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="comment">  set HIL (hardware in the loop) status for a GPS instance</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00816"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a654d818f4bc4dca13c461daea586bd0b">  816</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#a654d818f4bc4dca13c461daea586bd0b">AP_GPS::setHIL</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fc">GPS_Status</a> _status, uint64_t time_epoch_ms,</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classLocation.html">Location</a> &amp;_location, <span class="keyword">const</span> <a class="code" href="classVector3.html">Vector3f</a> &amp;_velocity, uint8_t _num_sats,</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                    uint16_t hdop)</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;{</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &gt;= <a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>) {</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    }</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keyword">const</span> uint32_t tnow = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <a class="code" href="structAP__GPS_1_1GPS__State.html">GPS_State</a> &amp;istate = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>];</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a0a8710bdc386183e8afea11565745c75">status</a> = _status;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a20e1b00d3fc64a8dae7a39c3763cfa08">location</a> = _location;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a583c2c58093b9c2ce6abcb0fa9be2c79">velocity</a> = _velocity;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#aa6b54a6f8a46a0418ae505a45480ff45">ground_speed</a> = <a class="code" href="AP__Math_8h.html#a45fe9f81332c93a04d1fdbcf0bc89c29">norm</a>(istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a583c2c58093b9c2ce6abcb0fa9be2c79">velocity</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a583c2c58093b9c2ce6abcb0fa9be2c79">velocity</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a037e16c03fbb1091bec680ef2dfc73c7">ground_course</a> = <a class="code" href="AP__Math_8cpp.html#aac44349f9b159f31fc43fe924d52f7fc">wrap_360</a>(<a class="code" href="moduletest_8c.html#a903c4797a4c2860e3b9a6a978f98a44d">degrees</a>(atan2f(istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a583c2c58093b9c2ce6abcb0fa9be2c79">velocity</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>, istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a583c2c58093b9c2ce6abcb0fa9be2c79">velocity</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>)));</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#ab346404b3a35776ea25982265c346974">hdop</a> = hdop;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a13d2ae016510be58fa8054f7d130d944">num_sats</a> = _num_sats;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a3fa38b751ea5cb9c140a2fc61ae6f568">last_gps_time_ms</a> = tnow;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    uint64_t gps_time_ms = time_epoch_ms - <a class="code" href="AP__GPS_8h.html#ac159cf063a7c67cf309fa8939df8f727">UNIX_OFFSET_MSEC</a>;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a1deb41c0495c03263d4a900c09cd5bc8">time_week</a>     = gps_time_ms / <a class="code" href="definitions_8h.html#a7643e40a680579fe07946b46a153d8d0">AP_MSEC_PER_WEEK</a>;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a7f5493cb75218bca4a13c125f546c8af">time_week_ms</a>  = gps_time_ms - istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a1deb41c0495c03263d4a900c09cd5bc8">time_week</a> * <a class="code" href="definitions_8h.html#a7643e40a680579fe07946b46a153d8d0">AP_MSEC_PER_WEEK</a>;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a6bbf268f8a99e5748b44975d97a5ae00">last_message_time_ms</a> = tnow;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a196a0fde4a1ac10bc27977eb60d69e4e">last_fix_time_ms</a> = tnow;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].set(<a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a09943533b34b8f6a3981a11329270230">GPS_TYPE_HIL</a>);</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;}</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">// set accuracy for HIL</span></div><div class="line"><a name="l00842"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a90091852976695c3a8dd7c2311ca5a54">  842</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#a90091852976695c3a8dd7c2311ca5a54">AP_GPS::setHIL_Accuracy</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <span class="keywordtype">float</span> vdop, <span class="keywordtype">float</span> hacc, <span class="keywordtype">float</span> vacc, <span class="keywordtype">float</span> sacc, <span class="keywordtype">bool</span> _have_vertical_velocity, uint32_t sample_ms)</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;{</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &gt;= <a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>) {</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    }</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <a class="code" href="structAP__GPS_1_1GPS__State.html">GPS_State</a> &amp;istate = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>];</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#acf132315548c8b639ecdaac75af61101">vdop</a> = vdop * 100;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#ad0ebe176090d273b59cad3e6d86fd416">horizontal_accuracy</a> = hacc;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#af5066cda264f04cf812a5ffdb8248e46">vertical_accuracy</a> = vacc;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a0845d4035e6cb36a9e1e31f4a68531f2">speed_accuracy</a> = sacc;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a67fb5cd3a118c2517a6d1fdc928f9227">have_horizontal_accuracy</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#a464226322ab0371a941f490cd1a818d8">have_vertical_accuracy</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#aef86178057c2197396dfd8836bf8e1b5">have_speed_accuracy</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    istate.<a class="code" href="structAP__GPS_1_1GPS__State.html#ab8bec1358e2740e4d76f60d1f8545130">have_vertical_velocity</a> |= _have_vertical_velocity;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordflow">if</span> (sample_ms != 0) {</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a6bbf268f8a99e5748b44975d97a5ae00">last_message_time_ms</a> = sample_ms;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a196a0fde4a1ac10bc27977eb60d69e4e">last_fix_time_ms</a> = sample_ms;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    }</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;}</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a27bb197524818a82bd813d22a6b0c1b5">  867</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#a27bb197524818a82bd813d22a6b0c1b5">AP_GPS::lock_port</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <span class="keywordtype">bool</span> lock)</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;{</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &gt;= <a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>) {</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    }</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">if</span> (lock) {</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <a class="code" href="classAP__GPS.html#af5f34786e914886cbfe9f47cfcf2220d">locked_ports</a> |= (1U&lt;&lt;<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>);</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        <a class="code" href="classAP__GPS.html#af5f34786e914886cbfe9f47cfcf2220d">locked_ports</a> &amp;= ~(1U&lt;&lt;<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    }</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;}</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">// Inject a packet of raw binary to a GPS</span></div><div class="line"><a name="l00881"></a><span class="lineno"><a class="line" href="classAP__GPS.html#aa712de51140898ff1942d428e2008ee7">  881</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#aa712de51140898ff1942d428e2008ee7">AP_GPS::inject_data</a>(uint8_t *data, uint16_t len)</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;{</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="comment">//Support broadcasting to all GPSes.</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a5c43f8a7049939c439960e2d5431b09b">_inject_to</a> == <a class="code" href="AP__GPS_8cpp.html#af476b309d3827917a4217a393c7bb6ed">GPS_RTK_INJECT_TO_ALL</a>) {</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            <a class="code" href="classAP__GPS.html#aa712de51140898ff1942d428e2008ee7">inject_data</a>(i, data, len);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        }</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <a class="code" href="classAP__GPS.html#aa712de51140898ff1942d428e2008ee7">inject_data</a>(<a class="code" href="classAP__GPS.html#a5c43f8a7049939c439960e2d5431b09b">_inject_to</a>, data, len);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    }</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;}</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno"><a class="line" href="classAP__GPS.html#ae827da9251839fd6c1ccdebdd7a1199e">  893</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#aa712de51140898ff1942d428e2008ee7">AP_GPS::inject_data</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, uint8_t *data, uint16_t len)</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;{</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &lt; <a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a> &amp;&amp; <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__GPS__Backend.html#a1d0f842ede7aff19b688f948d8d9231b">inject_data</a>(data, len);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;}</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a266ef4a39f7a303fc1905bf7f9e4ed09">  900</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#a266ef4a39f7a303fc1905bf7f9e4ed09">AP_GPS::send_mavlink_gps_raw</a>(mavlink_channel_t <a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>)</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;{</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keyword">static</span> uint32_t last_send_time_ms[<a class="code" href="GCS__MAVLink_8h.html#aff625e94451bf446bdd56f5d0e081077">MAVLINK_COMM_NUM_BUFFERS</a>];</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a>(0) &gt; <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca5eba95d16dc0519820e356de7be1362d">AP_GPS::NO_GPS</a>) {</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="comment">// when we have a GPS then only send new data</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="keywordflow">if</span> (last_send_time_ms[<a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>] == <a class="code" href="classAP__GPS.html#a704e437c25ef2105580fbbfdaa8f9df4">last_message_time_ms</a>(0)) {</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        }</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        last_send_time_ms[<a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>] = <a class="code" href="classAP__GPS.html#a704e437c25ef2105580fbbfdaa8f9df4">last_message_time_ms</a>(0);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="comment">// when we don&#39;t have a GPS then send at 1Hz</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        uint32_t now = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="keywordflow">if</span> (now - last_send_time_ms[<a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>] &lt; 1000) {</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        }</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        last_send_time_ms[<a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>] = now;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    }</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="keyword">const</span> <a class="code" href="classLocation.html">Location</a> &amp;loc = <a class="code" href="classAP__GPS.html#ae1b0d107cbdc490c1a41a452191952ea">location</a>(0);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="keywordtype">float</span> hacc = 0.0f;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="keywordtype">float</span> vacc = 0.0f;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="keywordtype">float</span> sacc = 0.0f;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    <a class="code" href="classAP__GPS.html#abca09c2218f7fec3eef23679dead41b4">horizontal_accuracy</a>(0, hacc);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <a class="code" href="classAP__GPS.html#afa08eb7c0337c97e2ebab7e7c930423d">vertical_accuracy</a>(0, vacc);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    <a class="code" href="classAP__GPS.html#a32634fda14b879872e3434733dac25ba">speed_accuracy</a>(0, sacc);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    mavlink_msg_gps_raw_int_send(</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>,</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <a class="code" href="classAP__GPS.html#a8501b8d502d21be0e12bfd11db3e7dfe">last_fix_time_ms</a>(0)*(uint64_t)1000,</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a>(0),</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        loc.<a class="code" href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a>,        <span class="comment">// in 1E7 degrees</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        loc.<a class="code" href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a>,        <span class="comment">// in 1E7 degrees</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        loc.<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> * 10UL, <span class="comment">// in mm</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        <a class="code" href="classAP__GPS.html#aa6e8517c91f43e38d41af7cf338c8d4f">get_hdop</a>(0),</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <a class="code" href="classAP__GPS.html#a1673a3811b1c622d90db33b223950557">get_vdop</a>(0),</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        <a class="code" href="classAP__GPS.html#a79f121ff20c9d3fe180f19f89150af4f">ground_speed</a>(0)*100,  <span class="comment">// cm/s</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <a class="code" href="classAP__GPS.html#aa7e3f1447d7a25eebcc5f06d66cbf395">ground_course</a>(0)*100, <span class="comment">// 1/100 degrees,</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <a class="code" href="classAP__GPS.html#ab97af8b3f61b2c16596fd0617bfe93a0">num_sats</a>(0),</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        0,                    <span class="comment">// TODO: Elipsoid height in mm</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        hacc * 1000,          <span class="comment">// one-sigma standard deviation in mm</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        vacc * 1000,          <span class="comment">// one-sigma standard deviation in mm</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        sacc * 1000,          <span class="comment">// one-sigma standard deviation in mm/s</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        0);                   <span class="comment">// TODO one-sigma heading accuracy standard deviation</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;}</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a559c00ff3bbc1232f68e64d29a892128">  943</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#a559c00ff3bbc1232f68e64d29a892128">AP_GPS::send_mavlink_gps2_raw</a>(mavlink_channel_t <a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>)</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;{</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="keyword">static</span> uint32_t last_send_time_ms[<a class="code" href="GCS__MAVLink_8h.html#aff625e94451bf446bdd56f5d0e081077">MAVLINK_COMM_NUM_BUFFERS</a>];</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a2632887b489c6de665ca309836a443f7">num_instances</a> &lt; 2 || <a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a>(1) &lt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca5eba95d16dc0519820e356de7be1362d">AP_GPS::NO_GPS</a>) {</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    }</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="comment">// when we have a GPS then only send new data</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="keywordflow">if</span> (last_send_time_ms[<a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>] == <a class="code" href="classAP__GPS.html#a704e437c25ef2105580fbbfdaa8f9df4">last_message_time_ms</a>(1)) {</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    }</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    last_send_time_ms[<a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>] = <a class="code" href="classAP__GPS.html#a704e437c25ef2105580fbbfdaa8f9df4">last_message_time_ms</a>(1);</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keyword">const</span> <a class="code" href="classLocation.html">Location</a> &amp;loc = <a class="code" href="classAP__GPS.html#ae1b0d107cbdc490c1a41a452191952ea">location</a>(1);</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    mavlink_msg_gps2_raw_send(</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>,</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <a class="code" href="classAP__GPS.html#a8501b8d502d21be0e12bfd11db3e7dfe">last_fix_time_ms</a>(1)*(uint64_t)1000,</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        <a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a>(1),</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        loc.<a class="code" href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a>,</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        loc.<a class="code" href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a>,</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        loc.<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> * 10UL,</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        <a class="code" href="classAP__GPS.html#aa6e8517c91f43e38d41af7cf338c8d4f">get_hdop</a>(1),</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <a class="code" href="classAP__GPS.html#a1673a3811b1c622d90db33b223950557">get_vdop</a>(1),</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <a class="code" href="classAP__GPS.html#a79f121ff20c9d3fe180f19f89150af4f">ground_speed</a>(1)*100,  <span class="comment">// cm/s</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        <a class="code" href="classAP__GPS.html#aa7e3f1447d7a25eebcc5f06d66cbf395">ground_course</a>(1)*100, <span class="comment">// 1/100 degrees,</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        <a class="code" href="classAP__GPS.html#ab97af8b3f61b2c16596fd0617bfe93a0">num_sats</a>(1),</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[1].rtk_num_sats,</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[1].rtk_age_ms);</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;}</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno"><a class="line" href="classAP__GPS.html#af0ca31342e4c693bf1ef3ec174145963">  972</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#af0ca31342e4c693bf1ef3ec174145963">AP_GPS::send_mavlink_gps_rtk</a>(mavlink_channel_t <a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>, uint8_t inst)</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;{</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordflow">if</span> (inst &gt;= <a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>) {</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    }</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[inst] != <span class="keyword">nullptr</span> &amp;&amp; <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[inst]-&gt;supports_mavlink_gps_rtk_message()) {</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[inst]-&gt;<a class="code" href="classAP__GPS__Backend.html#a9156c8c353af70a675e4972d98f757cb">send_mavlink_gps_rtk</a>(<a class="code" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>);</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    }</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;}</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a9f5e2b62bdd0d4c6c24cba8e9941c1fb">  982</a></span>&#160;uint8_t <a class="code" href="classAP__GPS.html#a9f5e2b62bdd0d4c6c24cba8e9941c1fb">AP_GPS::first_unconfigured_gps</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[i] != <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6acb925988f6661c9552b576d7078f8ca1">GPS_TYPE_NONE</a> &amp;&amp; (<a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[i] == <span class="keyword">nullptr</span> || !<a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[i]-&gt;is_configured())) {</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            <span class="keywordflow">return</span> i;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        }</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    }</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classAP__GPS.html#a621df669080080ed806ac311331a8b1ba551da4aa8c5d7cd39c532572d289c7ab">GPS_ALL_CONFIGURED</a>;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;}</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div><div class="line"><a name="l00992"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a24ab7def0009b4aa846163e9b9704338">  992</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#a24ab7def0009b4aa846163e9b9704338">AP_GPS::broadcast_first_configuration_failure_reason</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keyword">const</span> uint8_t unconfigured = <a class="code" href="classAP__GPS.html#a9f5e2b62bdd0d4c6c24cba8e9941c1fb">first_unconfigured_gps</a>();</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[unconfigured] == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <a class="code" href="GCS_8h.html#a1d3cc361b864ddf64a44c12ab3bd044e">gcs</a>().<a class="code" href="classGCS.html#a9866f3484283db744409e40719cef765">send_text</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;GPS %d: was not found&quot;</span>, unconfigured + 1);</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[unconfigured]-&gt;<a class="code" href="classAP__GPS__Backend.html#a1bbca91e9e762d373c1a4b6c0d958ca1">broadcast_configuration_failure_reason</a>();</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    }</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;}</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment">// pre-arm check that all GPSs are close to each other.  farthest distance between GPSs (in meters) is returned</span></div><div class="line"><a name="l01003"></a><span class="lineno"><a class="line" href="classAP__GPS.html#ac2c5a58b9aa31a268047ce499f61f96c"> 1003</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__GPS.html#ac2c5a58b9aa31a268047ce499f61f96c">AP_GPS::all_consistent</a>(<span class="keywordtype">float</span> &amp;<a class="code" href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a>)<span class="keyword"> const</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="comment">// return true immediately if only one valid receiver</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a2632887b489c6de665ca309836a443f7">num_instances</a> &lt;= 1 ||</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[0] == <span class="keyword">nullptr</span> || <a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[0] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6acb925988f6661c9552b576d7078f8ca1">GPS_TYPE_NONE</a>) {</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <a class="code" href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a> = 0;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    }</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="comment">// calculate distance</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <a class="code" href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[0].<a class="code" href="structAP__GPS_1_1GPS__State.html#a20e1b00d3fc64a8dae7a39c3763cfa08">location</a>.<a class="code" href="classLocation.html#a77ca1da10b7da6216bb6cf1253ed3dfc">get_distance_NED</a>(<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[1].<a class="code" href="classAP__GPS.html#ae1b0d107cbdc490c1a41a452191952ea">location</a>).<a class="code" href="classVector3.html#afcdfe81173c23d57e4a53a0282cddae7">length</a>();</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="comment">// success if distance is within 50m</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a> &lt; 50);</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;}</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">// pre-arm check of GPS blending.  True means healthy or that blending is not being used</span></div><div class="line"><a name="l01019"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a6534cf5404afbe11d4c7edf06813ce4a"> 1019</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__GPS.html#a6534cf5404afbe11d4c7edf06813ce4a">AP_GPS::blend_health_check</a>()<span class="keyword"> const</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="classAP__GPS.html#aa11fde1563dedb624c0d308b0e542cb6">_blend_health_counter</a> &lt; 50);</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;}</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">   re-assemble GPS_RTCM_DATA message</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01027"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a09fc3eb0ae4581f5d34d180431b0295f"> 1027</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#a09fc3eb0ae4581f5d34d180431b0295f">AP_GPS::handle_gps_rtcm_data</a>(<span class="keyword">const</span> mavlink_message_t *msg)</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;{</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    mavlink_gps_rtcm_data_t packet;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    mavlink_msg_gps_rtcm_data_decode(msg, &amp;packet);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="keywordflow">if</span> (packet.len &gt; MAVLINK_MSG_GPS_RTCM_DATA_FIELD_DATA_LEN) {</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        <span class="comment">// invalid packet</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    }</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    <span class="keywordflow">if</span> ((packet.flags &amp; 1) == 0) {</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <span class="comment">// it is not fragmented, pass direct</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        <a class="code" href="classAP__GPS.html#aa712de51140898ff1942d428e2008ee7">inject_data</a>(packet.data, packet.len);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    }</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="comment">// see if we need to allocate re-assembly buffer</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a> == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a> = (<span class="keyword">struct </span><a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a> *)<a class="code" href="malloc_8c.html#a62b7798461bd461da64c5f9d35feddf7">calloc</a>(1, <span class="keyword">sizeof</span>(*<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>));</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a> == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            <span class="comment">// nothing to do but discard the data</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        }</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    }</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    uint8_t fragment = (packet.flags &gt;&gt; 1U) &amp; 0x03;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    uint8_t sequence = (packet.flags &gt;&gt; 3U) &amp; 0x1F;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="comment">// see if this fragment is consistent with existing fragments</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#ab584acfcd7a44555b85c5df6cd62346f">fragments_received</a> &amp;&amp;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        (<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#a3ea184c76817cff75e802b9d8ed76f3c">sequence</a> != sequence ||</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        (<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#ab584acfcd7a44555b85c5df6cd62346f">fragments_received</a> &amp; (1U&lt;&lt;fragment)))) {</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <span class="comment">// we have one or more partial fragments already received</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        <span class="comment">// which conflict with the new fragment, discard previous fragments</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        memset(<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>, 0, <span class="keyword">sizeof</span>(*<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>));</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    }</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="comment">// add this fragment</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#a3ea184c76817cff75e802b9d8ed76f3c">sequence</a> = sequence;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#ab584acfcd7a44555b85c5df6cd62346f">fragments_received</a> |= (1U &lt;&lt; fragment);</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="comment">// copy the data</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    memcpy(&amp;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#ad226fe9edff09af33d662e581fab2f48">buffer</a>[MAVLINK_MSG_GPS_RTCM_DATA_FIELD_DATA_LEN*(uint16_t)fragment], packet.data, packet.len);</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="comment">// when we get a fragment of less than max size then we know the</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="comment">// number of fragments. Note that this means if you want to send a</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="comment">// block of RTCM data of an exact multiple of the buffer size you</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="comment">// need to send a final packet of zero length</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordflow">if</span> (packet.len &lt; MAVLINK_MSG_GPS_RTCM_DATA_FIELD_DATA_LEN) {</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#a800b67d4b608233efb1eeb1deb73ca15">fragment_count</a> = fragment+1;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#a5dfe66bc0c5d4f1e87b06bb36f9dc4db">total_length</a> = (MAVLINK_MSG_GPS_RTCM_DATA_FIELD_DATA_LEN*fragment) + packet.len;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#ab584acfcd7a44555b85c5df6cd62346f">fragments_received</a> == 0x0F) {</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <span class="comment">// special case of 4 full fragments</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        <a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#a800b67d4b608233efb1eeb1deb73ca15">fragment_count</a> = 4;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#a5dfe66bc0c5d4f1e87b06bb36f9dc4db">total_length</a> = MAVLINK_MSG_GPS_RTCM_DATA_FIELD_DATA_LEN*4;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    }</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="comment">// see if we have all fragments</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#a800b67d4b608233efb1eeb1deb73ca15">fragment_count</a> != 0 &amp;&amp;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        <a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#ab584acfcd7a44555b85c5df6cd62346f">fragments_received</a> == (1U &lt;&lt; <a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#a800b67d4b608233efb1eeb1deb73ca15">fragment_count</a>) - 1) {</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <span class="comment">// we have them all, inject</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        <a class="code" href="classAP__GPS.html#aa712de51140898ff1942d428e2008ee7">inject_data</a>(<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#ad226fe9edff09af33d662e581fab2f48">buffer</a>, <a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>-&gt;<a class="code" href="structAP__GPS_1_1rtcm__buffer.html#a5dfe66bc0c5d4f1e87b06bb36f9dc4db">total_length</a>);</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        memset(<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>, 0, <span class="keyword">sizeof</span>(*<a class="code" href="structAP__GPS_1_1rtcm__buffer.html">rtcm_buffer</a>));</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    }</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;}</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div><div class="line"><a name="l01094"></a><span class="lineno"><a class="line" href="classAP__GPS.html#adb1d7e0cbc5e14f4d80008f5e5db0eed"> 1094</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#adb1d7e0cbc5e14f4d80008f5e5db0eed">AP_GPS::Write_AP_Logger_Log_Startup_messages</a>()</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;{</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="keywordflow">for</span> (uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>=0; <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>&lt;<a class="code" href="classAP__GPS.html#a2632887b489c6de665ca309836a443f7">num_instances</a>; <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>++) {</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <span class="keyword">nullptr</span> || <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> == <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca5eba95d16dc0519820e356de7be1362d">NO_GPS</a>) {</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        }</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__GPS__Backend.html#a2d73140d3b37b74b167a95deae6c213c">Write_AP_Logger_Log_Startup_messages</a>();</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    }</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;}</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">  return the expected lag (in seconds) in the position and velocity readings from the gps</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment">  return true if the GPS hardware configuration is known or the delay parameter has been set</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01108"></a><span class="lineno"><a class="line" href="classAP__GPS.html#aaeb8dc7cbdae6534526a00444a53cda1"> 1108</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__GPS.html#aaeb8dc7cbdae6534526a00444a53cda1">AP_GPS::get_lag</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <span class="keywordtype">float</span> &amp;lag_sec)<span class="keyword"> const</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="comment">// always enusre a lag is provided</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    lag_sec = 0.22f;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &gt;= <a class="code" href="AP__GPS_8h.html#a3a734b4d4de7ca88c6563a5a476e3e87">GPS_MAX_INSTANCES</a>) {</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    }</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="comment">// return lag of blended GPS</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> == <a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>) {</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        lag_sec = <a class="code" href="classAP__GPS.html#a4463d97bdd728f628ec944f39266376b">_blended_lag_sec</a>;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        <span class="comment">// auto switching uses all GPS receivers, so all must be configured</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classAP__GPS.html#a883504971ad9fa1a695d2debc078a930">all_configured</a>();</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    }</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a145c5605ca4a49f0ae8a0936706ca221">_delay_ms</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] &gt; 0) {</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        <span class="comment">// if the user has specified a non zero time delay, always return that value</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        lag_sec = 0.001f * (float)<a class="code" href="classAP__GPS.html#a145c5605ca4a49f0ae8a0936706ca221">_delay_ms</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>];</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <span class="comment">// the user is always right !!</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <span class="keyword">nullptr</span> || <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> == <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca5eba95d16dc0519820e356de7be1362d">NO_GPS</a>) {</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        <span class="comment">// no GPS was detected in this instance so return the worst possible lag term</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6acb925988f6661c9552b576d7078f8ca1">GPS_TYPE_NONE</a>) {</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            lag_sec = 0.0f;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        }</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">_type</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <a class="code" href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a316eaa99b513960bd73ffc65f3ce94d3">GPS_TYPE_AUTO</a>;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        <span class="comment">// the user has not specified a delay so we determine it from the GPS type</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__GPS__Backend.html#a537b2420185215ce22358e93f8c73e62">get_lag</a>(lag_sec);</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    }</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;}</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment">// return a 3D vector defining the offset of the GPS antenna in meters relative to the body frame origin</span></div><div class="line"><a name="l01143"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a7647cae1e8f90b75020d3cd6c31470ff"> 1143</a></span>&#160;<span class="keyword">const</span> <a class="code" href="classVector3.html">Vector3f</a> &amp;<a class="code" href="classAP__GPS.html#a7647cae1e8f90b75020d3cd6c31470ff">AP_GPS::get_antenna_offset</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)<span class="keyword"> const</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &gt;= <a class="code" href="AP__GPS_8h.html#a3a734b4d4de7ca88c6563a5a476e3e87">GPS_MAX_INSTANCES</a>) {</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        <span class="comment">// we have to return a reference so use instance 0</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classAP__GPS.html#a4ff8670878e8371b8be04da456778045">_antenna_offset</a>[0];</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    }</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> == <a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>) {</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        <span class="comment">// return an offset for the blended GPS solution</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classAP__GPS.html#a09de09009fdec7d5242a04adeb7f842c">_blended_antenna_offset</a>;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    }</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classAP__GPS.html#a4ff8670878e8371b8be04da456778045">_antenna_offset</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>];</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;}</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment">  returns the desired gps update rate in milliseconds</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">  this does not provide any guarantee that the GPS is updating at the requested</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">  rate it is simply a helper for use in the backends for determining what rate</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment">  they should be configuring the GPS to run at</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01164"></a><span class="lineno"><a class="line" href="classAP__GPS.html#ac9f4da4e698ba211f2323a9a6731826c"> 1164</a></span>&#160;uint16_t <a class="code" href="classAP__GPS.html#ac9f4da4e698ba211f2323a9a6731826c">AP_GPS::get_rate_ms</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)<span class="keyword"> const</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="comment">// sanity check</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &gt;= <a class="code" href="classAP__GPS.html#a2632887b489c6de665ca309836a443f7">num_instances</a> || <a class="code" href="classAP__GPS.html#ace81d41034cf6bc7a468ec57baf62bec">_rate_ms</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] &lt;= 0) {</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="AP__GPS_8cpp.html#a2d79705911859d95849c965ef469c5fb">GPS_MAX_RATE_MS</a>;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    }</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a>(<a class="code" href="classAP__GPS.html#ace81d41034cf6bc7a468ec57baf62bec">_rate_ms</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>], <a class="code" href="AP__GPS_8cpp.html#a2d79705911859d95849c965ef469c5fb">GPS_MAX_RATE_MS</a>);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;}</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment"> calculate the weightings used to blend GPSs location and velocity data</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01176"></a><span class="lineno"><a class="line" href="classAP__GPS.html#ad6736a9d4cbb5352caf3d76e4928a356"> 1176</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__GPS.html#ad6736a9d4cbb5352caf3d76e4928a356">AP_GPS::calc_blend_weights</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;{</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="comment">// zero the blend weights</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    memset(&amp;<a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>));</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="comment">// exit immediately if not enough receivers to do blending</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[0].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &lt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca4166c675325c7b3e3e83c7c3ec1fbafb">NO_FIX</a> || <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[1].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &lt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca4166c675325c7b3e3e83c7c3ec1fbafb">NO_FIX</a>) {</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    }</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="comment">// Use the oldest non-zero time, but if time difference is excessive, use newest to prevent a disconnected receiver from blocking updates</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    uint32_t max_ms = 0; <span class="comment">// newest non-zero system time of arrival of a GPS message</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    uint32_t min_ms = -1; <span class="comment">// oldest non-zero system time of arrival of a GPS message</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    int16_t max_rate_ms = 0; <span class="comment">// largest update interval of a GPS receiver</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        <span class="comment">// Find largest and smallest times</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].last_gps_time_ms &gt; max_ms) {</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;            max_ms = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a3fa38b751ea5cb9c140a2fc61ae6f568">last_gps_time_ms</a>;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        }</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].last_gps_time_ms &lt; min_ms) &amp;&amp; (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].last_gps_time_ms &gt; 0)) {</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;            min_ms = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a3fa38b751ea5cb9c140a2fc61ae6f568">last_gps_time_ms</a>;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        }</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#ac9f4da4e698ba211f2323a9a6731826c">get_rate_ms</a>(i) &gt; max_rate_ms) {</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            max_rate_ms = <a class="code" href="classAP__GPS.html#ac9f4da4e698ba211f2323a9a6731826c">get_rate_ms</a>(i);</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        }</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    }</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="keywordflow">if</span> ((int32_t)(max_ms - min_ms) &lt; (int32_t)(2 * max_rate_ms)) {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        <span class="comment">// data is not too delayed so use the oldest time_stamp to give a chance for data from that receiver to be updated</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a3fa38b751ea5cb9c140a2fc61ae6f568">last_gps_time_ms</a> = min_ms;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <span class="comment">// receiver data has timed out so fail out of blending</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    }</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    <span class="comment">// calculate the sum squared speed accuracy across all GPS sensors</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    <span class="keywordtype">float</span> speed_accuracy_sum_sq = 0.0f;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a10564ab5cea24ce00f9fd6f641fe339a">_blend_mask</a> &amp; <a class="code" href="AP__GPS_8cpp.html#af3476ae7cb8c401b7d55ab98b86ed292">BLEND_MASK_USE_SPD_ACC</a>) {</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &gt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">GPS_OK_FIX_3D</a>) {</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].have_speed_accuracy &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a32634fda14b879872e3434733dac25ba">speed_accuracy</a> &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                    speed_accuracy_sum_sq += <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0845d4035e6cb36a9e1e31f4a68531f2">speed_accuracy</a> * <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0845d4035e6cb36a9e1e31f4a68531f2">speed_accuracy</a>;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                    <span class="comment">// not all receivers support this metric so set it to zero and don&#39;t use it</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                    speed_accuracy_sum_sq = 0.0f;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                }</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            }</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        }</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    }</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="comment">// calculate the sum squared horizontal position accuracy across all GPS sensors</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="keywordtype">float</span> horizontal_accuracy_sum_sq = 0.0f;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a10564ab5cea24ce00f9fd6f641fe339a">_blend_mask</a> &amp; <a class="code" href="AP__GPS_8cpp.html#af2a2b9d86200a37152ed36817f914ac7">BLEND_MASK_USE_HPOS_ACC</a>) {</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &gt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff">GPS_OK_FIX_2D</a>) {</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].have_horizontal_accuracy &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#abca09c2218f7fec3eef23679dead41b4">horizontal_accuracy</a> &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;                    horizontal_accuracy_sum_sq += <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#ad0ebe176090d273b59cad3e6d86fd416">horizontal_accuracy</a> * <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#ad0ebe176090d273b59cad3e6d86fd416">horizontal_accuracy</a>;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;                    <span class="comment">// not all receivers support this metric so set it to zero and don&#39;t use it</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;                    horizontal_accuracy_sum_sq = 0.0f;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                }</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;            }</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        }</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    }</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    <span class="comment">// calculate the sum squared vertical position accuracy across all GPS sensors</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    <span class="keywordtype">float</span> vertical_accuracy_sum_sq = 0.0f;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a10564ab5cea24ce00f9fd6f641fe339a">_blend_mask</a> &amp; <a class="code" href="AP__GPS_8cpp.html#a5c474882dc169c97221822426d3d48ed">BLEND_MASK_USE_VPOS_ACC</a>) {</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &gt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">GPS_OK_FIX_3D</a>) {</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].have_vertical_accuracy &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#afa08eb7c0337c97e2ebab7e7c930423d">vertical_accuracy</a> &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                    vertical_accuracy_sum_sq += <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#af5066cda264f04cf812a5ffdb8248e46">vertical_accuracy</a> * <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#af5066cda264f04cf812a5ffdb8248e46">vertical_accuracy</a>;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                    <span class="comment">// not all receivers support this metric so set it to zero and don&#39;t use it</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                    vertical_accuracy_sum_sq = 0.0f;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                }</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;            }</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;        }</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    }</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="comment">// Check if we can do blending using reported accuracy</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keywordtype">bool</span> can_do_blending = (horizontal_accuracy_sum_sq &gt; 0.0f || vertical_accuracy_sum_sq &gt; 0.0f || speed_accuracy_sum_sq &gt; 0.0f);</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="comment">// if we can&#39;t do blending using reported accuracy, return false and hard switch logic will be used instead</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="keywordflow">if</span> (!can_do_blending) {</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    }</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keywordtype">float</span> sum_of_all_weights = 0.0f;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="comment">// calculate a weighting using the reported horizontal position</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="keywordtype">float</span> hpos_blend_weights[<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>] = {};</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keywordflow">if</span> (horizontal_accuracy_sum_sq &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> &amp;&amp; (<a class="code" href="classAP__GPS.html#a10564ab5cea24ce00f9fd6f641fe339a">_blend_mask</a> &amp; <a class="code" href="AP__GPS_8cpp.html#af2a2b9d86200a37152ed36817f914ac7">BLEND_MASK_USE_HPOS_ACC</a>)) {</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        <span class="comment">// calculate the weights using the inverse of the variances</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;        <span class="keywordtype">float</span> sum_of_hpos_weights = 0.0f;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &gt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff">GPS_OK_FIX_2D</a> &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#abca09c2218f7fec3eef23679dead41b4">horizontal_accuracy</a> &gt;= 0.001<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;                hpos_blend_weights[i] = horizontal_accuracy_sum_sq / (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#ad0ebe176090d273b59cad3e6d86fd416">horizontal_accuracy</a> * <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#ad0ebe176090d273b59cad3e6d86fd416">horizontal_accuracy</a>);</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                sum_of_hpos_weights += hpos_blend_weights[i];</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;            }</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        }</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        <span class="comment">// normalise the weights</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <span class="keywordflow">if</span> (sum_of_hpos_weights &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;            <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                hpos_blend_weights[i] = hpos_blend_weights[i] / sum_of_hpos_weights;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;            }</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;            sum_of_all_weights += 1.0f;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        }</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    }</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="comment">// calculate a weighting using the reported vertical position accuracy</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keywordtype">float</span> vpos_blend_weights[<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>] = {};</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="keywordflow">if</span> (vertical_accuracy_sum_sq &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> &amp;&amp; (<a class="code" href="classAP__GPS.html#a10564ab5cea24ce00f9fd6f641fe339a">_blend_mask</a> &amp; <a class="code" href="AP__GPS_8cpp.html#a5c474882dc169c97221822426d3d48ed">BLEND_MASK_USE_VPOS_ACC</a>)) {</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        <span class="comment">// calculate the weights using the inverse of the variances</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        <span class="keywordtype">float</span> sum_of_vpos_weights = 0.0f;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &gt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">GPS_OK_FIX_3D</a> &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#afa08eb7c0337c97e2ebab7e7c930423d">vertical_accuracy</a> &gt;= 0.001<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                vpos_blend_weights[i] = vertical_accuracy_sum_sq / (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#af5066cda264f04cf812a5ffdb8248e46">vertical_accuracy</a> * <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#af5066cda264f04cf812a5ffdb8248e46">vertical_accuracy</a>);</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                sum_of_vpos_weights += vpos_blend_weights[i];</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;            }</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        }</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <span class="comment">// normalise the weights</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        <span class="keywordflow">if</span> (sum_of_vpos_weights &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;            <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                vpos_blend_weights[i] = vpos_blend_weights[i] / sum_of_vpos_weights;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            }</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            sum_of_all_weights += 1.0f;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        };</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    }</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <span class="comment">// calculate a weighting using the reported speed accuracy</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="keywordtype">float</span> spd_blend_weights[<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>] = {};</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="keywordflow">if</span> (speed_accuracy_sum_sq &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> &amp;&amp; (<a class="code" href="classAP__GPS.html#a10564ab5cea24ce00f9fd6f641fe339a">_blend_mask</a> &amp; <a class="code" href="AP__GPS_8cpp.html#af3476ae7cb8c401b7d55ab98b86ed292">BLEND_MASK_USE_SPD_ACC</a>)) {</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;        <span class="comment">// calculate the weights using the inverse of the variances</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        <span class="keywordtype">float</span> sum_of_spd_weights = 0.0f;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &gt;= <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">GPS_OK_FIX_3D</a> &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a32634fda14b879872e3434733dac25ba">speed_accuracy</a> &gt;= 0.001<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;                spd_blend_weights[i] = speed_accuracy_sum_sq / (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0845d4035e6cb36a9e1e31f4a68531f2">speed_accuracy</a> * <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0845d4035e6cb36a9e1e31f4a68531f2">speed_accuracy</a>);</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;                sum_of_spd_weights += spd_blend_weights[i];</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;            }</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        }</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        <span class="comment">// normalise the weights</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <span class="keywordflow">if</span> (sum_of_spd_weights &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;            <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                spd_blend_weights[i] = spd_blend_weights[i] / sum_of_spd_weights;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;            }</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            sum_of_all_weights += 1.0f;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        }</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    }</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <span class="comment">// calculate an overall weight</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        <a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i] = (hpos_blend_weights[i] + vpos_blend_weights[i] + spd_blend_weights[i]) / sum_of_all_weights;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    }</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;}</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment"> calculate a blended GPS state</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01338"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a86e388032563bbd72cca1bce9ec24d17"> 1338</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__GPS.html#a86e388032563bbd72cca1bce9ec24d17">AP_GPS::calc_blended_state</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;{</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <span class="comment">// initialise the blended states so we can accumulate the results using the weightings for each GPS receiver</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a95606c520bd395452a6e171828a4988d">instance</a> = <a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0a8710bdc386183e8afea11565745c75">status</a> = <a class="code" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca4166c675325c7b3e3e83c7c3ec1fbafb">NO_FIX</a>;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a7f5493cb75218bca4a13c125f546c8af">time_week_ms</a> = 0;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a1deb41c0495c03263d4a900c09cd5bc8">time_week</a> = 0;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#aa6b54a6f8a46a0418ae505a45480ff45">ground_speed</a> = 0.0f;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a037e16c03fbb1091bec680ef2dfc73c7">ground_course</a> = 0.0f;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#ab346404b3a35776ea25982265c346974">hdop</a> = <a class="code" href="AP__GPS_8h.html#adcf9fb3187691bb28ccf836a46d493ce">GPS_UNKNOWN_DOP</a>;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#acf132315548c8b639ecdaac75af61101">vdop</a> = <a class="code" href="AP__GPS_8h.html#adcf9fb3187691bb28ccf836a46d493ce">GPS_UNKNOWN_DOP</a>;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a13d2ae016510be58fa8054f7d130d944">num_sats</a> = 0;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a583c2c58093b9c2ce6abcb0fa9be2c79">velocity</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0845d4035e6cb36a9e1e31f4a68531f2">speed_accuracy</a> = 1e6f;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#ad0ebe176090d273b59cad3e6d86fd416">horizontal_accuracy</a> = 1e6f;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#af5066cda264f04cf812a5ffdb8248e46">vertical_accuracy</a> = 1e6f;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#ab8bec1358e2740e4d76f60d1f8545130">have_vertical_velocity</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#aef86178057c2197396dfd8836bf8e1b5">have_speed_accuracy</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a67fb5cd3a118c2517a6d1fdc928f9227">have_horizontal_accuracy</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a464226322ab0371a941f490cd1a818d8">have_vertical_accuracy</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a20e1b00d3fc64a8dae7a39c3763cfa08">location</a> = {};</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <a class="code" href="classAP__GPS.html#a09de09009fdec7d5242a04adeb7f842c">_blended_antenna_offset</a>.<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <a class="code" href="classAP__GPS.html#a4463d97bdd728f628ec944f39266376b">_blended_lag_sec</a> = 0;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a196a0fde4a1ac10bc27977eb60d69e4e">last_fix_time_ms</a> = 0;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a6bbf268f8a99e5748b44975d97a5ae00">last_message_time_ms</a> = 0;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    <span class="comment">// combine the states into a blended solution</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        <span class="comment">// use the highest status</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a> &gt; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">status</a>) {</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0a8710bdc386183e8afea11565745c75">status</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0a8710bdc386183e8afea11565745c75">status</a>;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        }</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <span class="comment">// calculate a blended average velocity</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a583c2c58093b9c2ce6abcb0fa9be2c79">velocity</a> += <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a583c2c58093b9c2ce6abcb0fa9be2c79">velocity</a> * <a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i];</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        <span class="comment">// report the best valid accuracies and DOP metrics</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].have_horizontal_accuracy &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#abca09c2218f7fec3eef23679dead41b4">horizontal_accuracy</a> &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#abca09c2218f7fec3eef23679dead41b4">horizontal_accuracy</a> &lt; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="classAP__GPS.html#abca09c2218f7fec3eef23679dead41b4">horizontal_accuracy</a>) {</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a67fb5cd3a118c2517a6d1fdc928f9227">have_horizontal_accuracy</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#ad0ebe176090d273b59cad3e6d86fd416">horizontal_accuracy</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#ad0ebe176090d273b59cad3e6d86fd416">horizontal_accuracy</a>;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        }</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].have_vertical_accuracy &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#afa08eb7c0337c97e2ebab7e7c930423d">vertical_accuracy</a> &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#afa08eb7c0337c97e2ebab7e7c930423d">vertical_accuracy</a> &lt; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="classAP__GPS.html#afa08eb7c0337c97e2ebab7e7c930423d">vertical_accuracy</a>) {</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a464226322ab0371a941f490cd1a818d8">have_vertical_accuracy</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#af5066cda264f04cf812a5ffdb8248e46">vertical_accuracy</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#af5066cda264f04cf812a5ffdb8248e46">vertical_accuracy</a>;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        }</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#adeb2695a00658d267b847fda8d08a5da">have_vertical_velocity</a>) {</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#ab8bec1358e2740e4d76f60d1f8545130">have_vertical_velocity</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        }</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].have_speed_accuracy &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a32634fda14b879872e3434733dac25ba">speed_accuracy</a> &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a32634fda14b879872e3434733dac25ba">speed_accuracy</a> &lt; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="classAP__GPS.html#a32634fda14b879872e3434733dac25ba">speed_accuracy</a>) {</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#aef86178057c2197396dfd8836bf8e1b5">have_speed_accuracy</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0845d4035e6cb36a9e1e31f4a68531f2">speed_accuracy</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a0845d4035e6cb36a9e1e31f4a68531f2">speed_accuracy</a>;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        }</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].hdop &gt; 0 &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].hdop &lt; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].hdop) {</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#ab346404b3a35776ea25982265c346974">hdop</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#ab346404b3a35776ea25982265c346974">hdop</a>;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        }</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].vdop &gt; 0 &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].vdop &lt; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].vdop) {</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#acf132315548c8b639ecdaac75af61101">vdop</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#acf132315548c8b639ecdaac75af61101">vdop</a>;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        }</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#ab97af8b3f61b2c16596fd0617bfe93a0">num_sats</a> &gt; 0 &amp;&amp; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#ab97af8b3f61b2c16596fd0617bfe93a0">num_sats</a> &gt; <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="classAP__GPS.html#ab97af8b3f61b2c16596fd0617bfe93a0">num_sats</a>) {</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a13d2ae016510be58fa8054f7d130d944">num_sats</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a13d2ae016510be58fa8054f7d130d944">num_sats</a>;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;        }</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        <span class="comment">// report a blended average GPS antenna position</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> temp_antenna_offset = <a class="code" href="classAP__GPS.html#a4ff8670878e8371b8be04da456778045">_antenna_offset</a>[i];</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        temp_antenna_offset *= <a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i];</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        <a class="code" href="classAP__GPS.html#a09de09009fdec7d5242a04adeb7f842c">_blended_antenna_offset</a> += temp_antenna_offset;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        <span class="comment">// blend the timing data</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[i].<a class="code" href="classAP__GPS.html#a8501b8d502d21be0e12bfd11db3e7dfe">last_fix_time_ms</a> &gt; <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="classAP__GPS.html#a8501b8d502d21be0e12bfd11db3e7dfe">last_fix_time_ms</a>) {</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;            <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a196a0fde4a1ac10bc27977eb60d69e4e">last_fix_time_ms</a> = <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[i].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a196a0fde4a1ac10bc27977eb60d69e4e">last_fix_time_ms</a>;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        }</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[i].<a class="code" href="classAP__GPS.html#a704e437c25ef2105580fbbfdaa8f9df4">last_message_time_ms</a> &gt; <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="classAP__GPS.html#a704e437c25ef2105580fbbfdaa8f9df4">last_message_time_ms</a>) {</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;            <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a6bbf268f8a99e5748b44975d97a5ae00">last_message_time_ms</a> = <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[i].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a6bbf268f8a99e5748b44975d97a5ae00">last_message_time_ms</a>;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        }</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    }</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="comment">     * Calculate an instantaneous weighted/blended average location from the available GPS instances and store in the _output_state.</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="comment">     * This will be statistically the most likely location, but will be not stable enough for direct use by the autopilot.</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="comment">// Use the GPS with the highest weighting as the reference position</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keywordtype">float</span> best_weight = 0.0f;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    uint8_t best_index = 0;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i] &gt; best_weight) {</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;            best_weight = <a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i];</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;            best_index = i;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;            <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a20e1b00d3fc64a8dae7a39c3763cfa08">location</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a20e1b00d3fc64a8dae7a39c3763cfa08">location</a>;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        }</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    }</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    <span class="comment">// Calculate the weighted sum of horizontal and vertical position offsets relative to the reference position</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <a class="code" href="structVector2.html">Vector2f</a> blended_NE_offset_m;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    <span class="keywordtype">float</span> blended_alt_offset_cm = 0.0f;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    blended_NE_offset_m.<a class="code" href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">zero</a>();</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i] &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> &amp;&amp; i != best_index) {</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;            blended_NE_offset_m += <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a20e1b00d3fc64a8dae7a39c3763cfa08">location</a>.<a class="code" href="classLocation.html#af597420e2ec20fc794ca3d5447fd36ba">get_distance_NE</a>(<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#ae1b0d107cbdc490c1a41a452191952ea">location</a>) * <a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i];</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;            blended_alt_offset_cm += (float)(<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#ae1b0d107cbdc490c1a41a452191952ea">location</a>.<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> - <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a20e1b00d3fc64a8dae7a39c3763cfa08">location</a>.<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>) * <a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i];</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;        }</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    }</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="comment">// Add the sum of weighted offsets to the reference location to obtain the blended location</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a20e1b00d3fc64a8dae7a39c3763cfa08">location</a>.<a class="code" href="classLocation.html#a02afc332b5f374b923aa57ec0a63c1af">offset</a>(blended_NE_offset_m.<a class="code" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>, blended_NE_offset_m.<a class="code" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>);</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a20e1b00d3fc64a8dae7a39c3763cfa08">location</a>.<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> += (int)blended_alt_offset_cm;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="comment">// Calculate ground speed and course from blended velocity vector</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#aa6b54a6f8a46a0418ae505a45480ff45">ground_speed</a> = <a class="code" href="AP__Math_8h.html#a45fe9f81332c93a04d1fdbcf0bc89c29">norm</a>(<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="classAP__GPS.html#a35773018a70f4ded4f2f86b3b513c3a8">velocity</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a583c2c58093b9c2ce6abcb0fa9be2c79">velocity</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a037e16c03fbb1091bec680ef2dfc73c7">ground_course</a> = <a class="code" href="AP__Math_8cpp.html#aac44349f9b159f31fc43fe924d52f7fc">wrap_360</a>(<a class="code" href="moduletest_8c.html#a903c4797a4c2860e3b9a6a978f98a44d">degrees</a>(atan2f(<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="classAP__GPS.html#a35773018a70f4ded4f2f86b3b513c3a8">velocity</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>, <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a583c2c58093b9c2ce6abcb0fa9be2c79">velocity</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>)));</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment">     * The blended location in _output_state.location is not stable enough to be used by the autopilot</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;<span class="comment">     * as it will move around as the relative accuracy changes. To mitigate this effect a low-pass filtered</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="comment">     * offset from each GPS location to the blended location is calculated and the filtered offset is applied</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="comment">     * to each receiver.</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    <span class="comment">// Calculate filter coefficients to be applied to the offsets for each GPS position and height offset</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    <span class="comment">// A weighting of 1 will make the offset adjust the slowest, a weighting of 0 will make it adjust with zero filtering</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    <span class="keywordtype">float</span> alpha[<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>] = {};</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].last_gps_time_ms - <a class="code" href="classAP__GPS.html#a53e85a64eaa33430288a42c82e23f6d0">_last_time_updated</a>[i] &gt; 0) {</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;            <span class="keywordtype">float</span> min_alpha = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__GPS.html#a020a2b10c64f877da888309232e1b3b2">_omega_lpf</a> * 0.001<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> * (<span class="keywordtype">float</span>)(<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].last_gps_time_ms - <a class="code" href="classAP__GPS.html#a53e85a64eaa33430288a42c82e23f6d0">_last_time_updated</a>[i]), 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i] &gt; min_alpha) {</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;                alpha[i] = min_alpha / <a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i];</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;                alpha[i] = 1.0f;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;            }</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;            <a class="code" href="classAP__GPS.html#a53e85a64eaa33430288a42c82e23f6d0">_last_time_updated</a>[i] = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a3fa38b751ea5cb9c140a2fc61ae6f568">last_gps_time_ms</a>;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        }</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    }</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <span class="comment">// Calculate the offset from each GPS solution to the blended solution</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        <a class="code" href="classAP__GPS.html#a3a10458ee4c8a2d393668f1fa67e96c3">_NE_pos_offset_m</a>[i] = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a20e1b00d3fc64a8dae7a39c3763cfa08">location</a>.<a class="code" href="classLocation.html#af597420e2ec20fc794ca3d5447fd36ba">get_distance_NE</a>(<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="classAP__GPS.html#ae1b0d107cbdc490c1a41a452191952ea">location</a>) * alpha[i] + <a class="code" href="classAP__GPS.html#a3a10458ee4c8a2d393668f1fa67e96c3">_NE_pos_offset_m</a>[i] * (1.0f - alpha[i]);</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        <a class="code" href="classAP__GPS.html#a7d16833881d7bb6db5bc84e345cea0ca">_hgt_offset_cm</a>[i] = (float)(<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="classAP__GPS.html#ae1b0d107cbdc490c1a41a452191952ea">location</a>.<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> - <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a20e1b00d3fc64a8dae7a39c3763cfa08">location</a>.<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>) *  alpha[i] + <a class="code" href="classAP__GPS.html#a7d16833881d7bb6db5bc84e345cea0ca">_hgt_offset_cm</a>[i] * (1.0f - alpha[i]);</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    }</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <span class="comment">// Calculate a corrected location for each GPS</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <a class="code" href="classLocation.html">Location</a> corrected_location[<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>];</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        corrected_location[i] = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a20e1b00d3fc64a8dae7a39c3763cfa08">location</a>;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        corrected_location[i].<a class="code" href="classLocation.html#a02afc332b5f374b923aa57ec0a63c1af">offset</a>(<a class="code" href="classAP__GPS.html#a3a10458ee4c8a2d393668f1fa67e96c3">_NE_pos_offset_m</a>[i].<a class="code" href="DerivativeFilter_8cpp.html#a91f27329cbc70a03207bcee33e2b42fd">x</a>, <a class="code" href="classAP__GPS.html#a3a10458ee4c8a2d393668f1fa67e96c3">_NE_pos_offset_m</a>[i].y);</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        corrected_location[i].<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> += (int)(<a class="code" href="classAP__GPS.html#a7d16833881d7bb6db5bc84e345cea0ca">_hgt_offset_cm</a>[i]);</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    }</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <span class="comment">// If the GPS week is the same then use a blended time_week_ms</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="comment">// If week is different, then use time stamp from GPS with largest weighting</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <span class="comment">// detect inconsistent week data</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    uint8_t last_week_instance = 0;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="keywordtype">bool</span> weeks_consistent = <span class="keyword">true</span>;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        <span class="keywordflow">if</span> (last_week_instance == 0 &amp;&amp; <a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i] &gt; 0) {</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;            <span class="comment">// this is our first valid sensor week data</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;            last_week_instance = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="structAP__GPS_1_1GPS__State.html#a1deb41c0495c03263d4a900c09cd5bc8">time_week</a>;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (last_week_instance != 0 &amp;&amp; <a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i] &gt; 0 &amp;&amp; last_week_instance != <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#a1edd7dcbf000c4d7cc4c2848e5ecf088">time_week</a>) {</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;            <span class="comment">// there is valid sensor week data that is inconsistent</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;            weeks_consistent = <span class="keyword">false</span>;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        }</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    }</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    <span class="comment">// calculate output</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="keywordflow">if</span> (!weeks_consistent) {</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;        <span class="comment">// use data from highest weighted sensor</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a1deb41c0495c03263d4a900c09cd5bc8">time_week</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[best_index].<a class="code" href="structAP__GPS_1_1GPS__State.html#a1deb41c0495c03263d4a900c09cd5bc8">time_week</a>;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a7f5493cb75218bca4a13c125f546c8af">time_week_ms</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[best_index].<a class="code" href="structAP__GPS_1_1GPS__State.html#a7f5493cb75218bca4a13c125f546c8af">time_week_ms</a>;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        <span class="comment">// use week number from highest weighting GPS (they should all have the same week number)</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a1deb41c0495c03263d4a900c09cd5bc8">time_week</a> = <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[best_index].<a class="code" href="structAP__GPS_1_1GPS__State.html#a1deb41c0495c03263d4a900c09cd5bc8">time_week</a>;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        <span class="comment">// calculate a blended value for the number of ms lapsed in the week</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        <span class="keywordtype">double</span> temp_time_0 = 0.0;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i] &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;                temp_time_0 += (double)<a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[i].<a class="code" href="classAP__GPS.html#ab6690a9a05471bfb22fc7d171f12b4fc">time_week_ms</a> * (<span class="keywordtype">double</span>)<a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i];</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;            }</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        }</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <a class="code" href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">state</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__State.html#a7f5493cb75218bca4a13c125f546c8af">time_week_ms</a> = (uint32_t)temp_time_0;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    }</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <span class="comment">// calculate a blended value for the timing data and lag</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="keywordtype">double</span> temp_time_1 = 0.0;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    <span class="keywordtype">double</span> temp_time_2 = 0.0;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i] &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;            temp_time_1 += (double)<a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[i].<a class="code" href="classAP__GPS.html#a8501b8d502d21be0e12bfd11db3e7dfe">last_fix_time_ms</a> * (<span class="keywordtype">double</span>) <a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i];</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;            temp_time_2 += (double)<a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[i].<a class="code" href="classAP__GPS.html#a704e437c25ef2105580fbbfdaa8f9df4">last_message_time_ms</a> * (<span class="keywordtype">double</span>)<a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i];</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            <span class="keywordtype">float</span> gps_lag_sec = 0;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;            <a class="code" href="classAP__GPS.html#aaeb8dc7cbdae6534526a00444a53cda1">get_lag</a>(i, gps_lag_sec);</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;            <a class="code" href="classAP__GPS.html#a4463d97bdd728f628ec944f39266376b">_blended_lag_sec</a> += gps_lag_sec * <a class="code" href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">_blend_weights</a>[i];</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;        }</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    }</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a196a0fde4a1ac10bc27977eb60d69e4e">last_fix_time_ms</a> = (uint32_t)temp_time_1;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    <a class="code" href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">timing</a>[<a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>].<a class="code" href="structAP__GPS_1_1GPS__timing.html#a6bbf268f8a99e5748b44975d97a5ae00">last_message_time_ms</a> = (uint32_t)temp_time_2;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;}</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;</div><div class="line"><a name="l01543"></a><span class="lineno"><a class="line" href="classAP__GPS.html#a7c289e343fd9873111accc9bfa75da47"> 1543</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__GPS.html#a48d705a86f6f13cb6fe506c7b93d5262">AP_GPS::is_healthy</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)<span class="keyword"> const</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &gt;= <a class="code" href="AP__GPS_8h.html#a3a734b4d4de7ca88c6563a5a476e3e87">GPS_MAX_INSTANCES</a>) {</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    }</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="keyword">const</span> uint16_t gps_max_delta_ms = 245; <span class="comment">// 200 ms (5Hz) + 45 ms buffer</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="keywordtype">bool</span> last_msg_valid = <a class="code" href="classAP__GPS.html#ab817fb360313c84e12f9ee9bba776e60">last_message_delta_time_ms</a>(<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>) &lt; gps_max_delta_ms;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> == <a class="code" href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a>) {</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        <span class="keywordflow">return</span> last_msg_valid &amp;&amp; <a class="code" href="classAP__GPS.html#a6534cf5404afbe11d4c7edf06813ce4a">blend_health_check</a>();</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    }</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <span class="keywordflow">return</span> last_msg_valid &amp;&amp;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;           <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] != <span class="keyword">nullptr</span> &amp;&amp;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;           <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__GPS__Backend.html#a7fe9c23afd9cb1b88b61ce33bf0dd37c">is_healthy</a>();</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;}</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;</div><div class="line"><a name="l01562"></a><span class="lineno"><a class="line" href="classAP__GPS.html#ac66632e3a213d12c35d56ae65a3dfa08"> 1562</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__GPS.html#ac66632e3a213d12c35d56ae65a3dfa08">AP_GPS::prepare_for_arming</a>(<span class="keywordtype">void</span>) {</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="keywordtype">bool</span> all_passed = <span class="keyword">true</span>;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a>; i++) {</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[i] != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;            all_passed &amp;= <a class="code" href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">drivers</a>[i]-&gt;<a class="code" href="classAP__GPS__Backend.html#a42195424a7f5664b2240133ebc22b2cd">prepare_for_arming</a>();</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        }</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    }</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="keywordflow">return</span> all_passed;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;}</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceAP.html">AP</a> {</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;</div><div class="line"><a name="l01574"></a><span class="lineno"><a class="line" href="namespaceAP.html#ae6eeec356455220f913e47e323057cd5"> 1574</a></span>&#160;<a class="code" href="classAP__GPS.html">AP_GPS</a> &amp;<a class="code" href="namespaceAP.html#ae6eeec356455220f913e47e323057cd5">gps</a>()</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;{</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    <span class="keywordflow">return</span> *<a class="code" href="classAP__GPS.html#a08d0437767d62a318e59b40cf323a31a">AP_GPS::get_singleton</a>();</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;}</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;};</div><div class="ttc" id="AP__Math_8h_html_a45fe9f81332c93a04d1fdbcf0bc89c29"><div class="ttname"><a href="AP__Math_8h.html#a45fe9f81332c93a04d1fdbcf0bc89c29">norm</a></div><div class="ttdeci">float norm(const T first, const U second, const Params... parameters)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00196">AP_Math.h:196</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__timing_html_a6bbf268f8a99e5748b44975d97a5ae00"><div class="ttname"><a href="structAP__GPS_1_1GPS__timing.html#a6bbf268f8a99e5748b44975d97a5ae00">AP_GPS::GPS_timing::last_message_time_ms</a></div><div class="ttdeci">uint32_t last_message_time_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00445">AP_GPS.h:445</a></div></div>
<div class="ttc" id="classAP__GPS_html_ace74b654aa086c9acccf62b71a58d5e8"><div class="ttname"><a href="classAP__GPS.html#ace74b654aa086c9acccf62b71a58d5e8">AP_GPS::_log_gps_bit</a></div><div class="ttdeci">uint32_t _log_gps_bit</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00429">AP_GPS.h:429</a></div></div>
<div class="ttc" id="classAP__GPS_html"><div class="ttname"><a href="classAP__GPS.html">AP_GPS</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00043">AP_GPS.h:43</a></div></div>
<div class="ttc" id="classAP__GPS_html_a88ffa0ff28e2c65d11c8b1ced2c43760"><div class="ttname"><a href="classAP__GPS.html#a88ffa0ff28e2c65d11c8b1ced2c43760">AP_GPS::remaining</a></div><div class="ttdeci">uint16_t remaining</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00482">AP_GPS.h:482</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_a7f5493cb75218bca4a13c125f546c8af"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#a7f5493cb75218bca4a13c125f546c8af">AP_GPS::GPS_State::time_week_ms</a></div><div class="ttdeci">uint32_t time_week_ms</div><div class="ttdoc">GPS time (milliseconds from start of GPS week)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00128">AP_GPS.h:128</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6a9df7e102648dfe6247fc3390099c8e26"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a9df7e102648dfe6247fc3390099c8e26">AP_GPS::GPS_TYPE_ERB</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00085">AP_GPS.h:85</a></div></div>
<div class="ttc" id="classAP__GPS_html_af4b7f50483f14f3af3e561c18ffc7a71"><div class="ttname"><a href="classAP__GPS.html#af4b7f50483f14f3af3e561c18ffc7a71">AP_GPS::_port</a></div><div class="ttdeci">AP_HAL::UARTDriver * _port[GPS_MAX_RECEIVERS]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00454">AP_GPS.h:454</a></div></div>
<div class="ttc" id="classAP__GPS_html_a90b25b2edbb127b22e597a56f2a01e42"><div class="ttname"><a href="classAP__GPS.html#a90b25b2edbb127b22e597a56f2a01e42">AP_GPS::send_blob_start</a></div><div class="ttdeci">void send_blob_start(uint8_t instance, const char *_blob, uint16_t size)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00382">AP_GPS.cpp:382</a></div></div>
<div class="ttc" id="AHRS__Test_8cpp_html_a90ddf96040cbf0429052dafd4fa64c12"><div class="ttname"><a href="AHRS__Test_8cpp.html#a90ddf96040cbf0429052dafd4fa64c12">serial_manager</a></div><div class="ttdeci">static AP_SerialManager serial_manager</div><div class="ttdef"><b>Definition:</b> <a href="AHRS__Test_8cpp_source.html#l00027">AHRS_Test.cpp:27</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6a09943533b34b8f6a3981a11329270230"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a09943533b34b8f6a3981a11329270230">AP_GPS::GPS_TYPE_HIL</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00080">AP_GPS.h:80</a></div></div>
<div class="ttc" id="structAP__GPS_1_1detect__state_html_aff3aa650f857cd70f6a34b8bbab72040"><div class="ttname"><a href="structAP__GPS_1_1detect__state.html#aff3aa650f857cd70f6a34b8bbab72040">AP_GPS::detect_state::auto_detected_baud</a></div><div class="ttdeci">bool auto_detected_baud</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00469">AP_GPS.h:469</a></div></div>
<div class="ttc" id="classAP__GPS_html_ada1df5ba1f9d65426afd5472b73eaeea"><div class="ttname"><a href="classAP__GPS.html#ada1df5ba1f9d65426afd5472b73eaeea">AP_GPS::_blend_weights</a></div><div class="ttdeci">float _blend_weights[GPS_MAX_RECEIVERS]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00526">AP_GPS.h:526</a></div></div>
<div class="ttc" id="classAP__GPS__Backend_html_a8c5b16c4ac289e283effa184eb9df9c8"><div class="ttname"><a href="classAP__GPS__Backend.html#a8c5b16c4ac289e283effa184eb9df9c8">AP_GPS_Backend::highest_supported_status</a></div><div class="ttdeci">virtual AP_GPS::GPS_Status highest_supported_status(void)</div><div class="ttdef"><b>Definition:</b> <a href="GPS__Backend_8h_source.html#l00041">GPS_Backend.h:41</a></div></div>
<div class="ttc" id="classAP__GPS_html_af5f34786e914886cbfe9f47cfcf2220d"><div class="ttname"><a href="classAP__GPS.html#af5f34786e914886cbfe9f47cfcf2220d">AP_GPS::locked_ports</a></div><div class="ttdeci">uint8_t locked_ports</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00463">AP_GPS.h:463</a></div></div>
<div class="ttc" id="structAP__GPS_1_1detect__state_html_ade0e499bceae920fe4d93ad1f9040776"><div class="ttname"><a href="structAP__GPS_1_1detect__state.html#ade0e499bceae920fe4d93ad1f9040776">AP_GPS::detect_state::nmea_detect_state</a></div><div class="ttdeci">struct NMEA_detect_state nmea_detect_state</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00474">AP_GPS.h:474</a></div></div>
<div class="ttc" id="classAP__RTC_html_abb961ded9907a2dbaa1b20de2b3b5ce0"><div class="ttname"><a href="classAP__RTC.html#abb961ded9907a2dbaa1b20de2b3b5ce0">AP_RTC::set_utc_usec</a></div><div class="ttdeci">void set_utc_usec(uint64_t time_utc_usec, source_type type)</div><div class="ttdef"><b>Definition:</b> <a href="AP__RTC_8cpp_source.html#l00034">AP_RTC.cpp:34</a></div></div>
<div class="ttc" id="structAP__GPS_1_1rtcm__buffer_html_a800b67d4b608233efb1eeb1deb73ca15"><div class="ttname"><a href="structAP__GPS_1_1rtcm__buffer.html#a800b67d4b608233efb1eeb1deb73ca15">AP_GPS::rtcm_buffer::fragment_count</a></div><div class="ttdeci">uint8_t fragment_count</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00507">AP_GPS.h:507</a></div></div>
<div class="ttc" id="structAP__GPS_1_1detect__state_html_a2e80a2a45e99a54129c084a0db6ec6e6"><div class="ttname"><a href="structAP__GPS_1_1detect__state.html#a2e80a2a45e99a54129c084a0db6ec6e6">AP_GPS::detect_state::sbp_detect_state</a></div><div class="ttdeci">struct SBP_detect_state sbp_detect_state</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00475">AP_GPS.h:475</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6a76a222d514c32a4bc7cb319b4572bb41"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a76a222d514c32a4bc7cb319b4572bb41">AP_GPS::GPS_TYPE_GSOF</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00084">AP_GPS.h:84</a></div></div>
<div class="ttc" id="classAP__GPS_html_a58a05f48dce64267c71558d39b7917e9"><div class="ttname"><a href="classAP__GPS.html#a58a05f48dce64267c71558d39b7917e9">AP_GPS::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00387">AP_GPS.h:387</a></div></div>
<div class="ttc" id="structAP__GPS_1_1detect__state_html_adc2dd3641c9e227dee48f3851658f63d"><div class="ttname"><a href="structAP__GPS_1_1detect__state.html#adc2dd3641c9e227dee48f3851658f63d">AP_GPS::detect_state::current_baud</a></div><div class="ttdeci">uint8_t current_baud</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00468">AP_GPS.h:468</a></div></div>
<div class="ttc" id="classAP__GPS_html_a46e5d33707cf47859f90bbbdc1bdbfc7"><div class="ttname"><a href="classAP__GPS.html#a46e5d33707cf47859f90bbbdc1bdbfc7">AP_GPS::AP_GPS_UBLOX</a></div><div class="ttdeci">friend class AP_GPS_UBLOX</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00057">AP_GPS.h:57</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_a3fa38b751ea5cb9c140a2fc61ae6f568"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#a3fa38b751ea5cb9c140a2fc61ae6f568">AP_GPS::GPS_State::last_gps_time_ms</a></div><div class="ttdeci">uint32_t last_gps_time_ms</div><div class="ttdoc">the system time we got the last GPS timestamp, milliseconds</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00144">AP_GPS.h:144</a></div></div>
<div class="ttc" id="classAP__GPS_html_a145c5605ca4a49f0ae8a0936706ca221"><div class="ttname"><a href="classAP__GPS.html#a145c5605ca4a49f0ae8a0936706ca221">AP_GPS::_delay_ms</a></div><div class="ttdeci">AP_Int16 _delay_ms[GPS_MAX_RECEIVERS]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00425">AP_GPS.h:425</a></div></div>
<div class="ttc" id="classAP__GPS__Backend_html_a537b2420185215ce22358e93f8c73e62"><div class="ttname"><a href="classAP__GPS__Backend.html#a537b2420185215ce22358e93f8c73e62">AP_GPS_Backend::get_lag</a></div><div class="ttdeci">virtual bool get_lag(float &amp;lag) const</div><div class="ttdef"><b>Definition:</b> <a href="GPS__Backend_8h_source.html#l00056">GPS_Backend.h:56</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6a77521927cbe6149568d69e29b685fbcf"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a77521927cbe6149568d69e29b685fbcf">AP_GPS::GPS_TYPE_NOVA</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00087">AP_GPS.h:87</a></div></div>
<div class="ttc" id="classAP__HAL_1_1UARTDriver_html_acd5e319d580fe14755931d37b5d4deafa67a3cf106c9c7c7d6e454a7a9610a7d8"><div class="ttname"><a href="classAP__HAL_1_1UARTDriver.html#acd5e319d580fe14755931d37b5d4deafa67a3cf106c9c7c7d6e454a7a9610a7d8">AP_HAL::UARTDriver::FLOW_CONTROL_DISABLE</a></div><div class="ttdef"><b>Definition:</b> <a href="UARTDriver_8h_source.html#l00062">UARTDriver.h:62</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae75149bb82042813fcb3fc301a87fe03"><div class="ttname"><a href="classAP__GPS.html#ae75149bb82042813fcb3fc301a87fe03">AP_GPS::AP_GPS_MTK19</a></div><div class="ttdeci">friend class AP_GPS_MTK19</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00049">AP_GPS.h:49</a></div></div>
<div class="ttc" id="classAP__GPS__Backend_html"><div class="ttname"><a href="classAP__GPS__Backend.html">AP_GPS_Backend</a></div><div class="ttdef"><b>Definition:</b> <a href="GPS__Backend_8h_source.html#l00025">GPS_Backend.h:25</a></div></div>
<div class="ttc" id="classAP__GPS_html_ac66632e3a213d12c35d56ae65a3dfa08"><div class="ttname"><a href="classAP__GPS.html#ac66632e3a213d12c35d56ae65a3dfa08">AP_GPS::prepare_for_arming</a></div><div class="ttdeci">bool prepare_for_arming(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l01562">AP_GPS.cpp:1562</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_a95606c520bd395452a6e171828a4988d"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#a95606c520bd395452a6e171828a4988d">AP_GPS::GPS_State::instance</a></div><div class="ttdeci">uint8_t instance</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00124">AP_GPS.h:124</a></div></div>
<div class="ttc" id="classAP__GPS_html_ab6690a9a05471bfb22fc7d171f12b4fc"><div class="ttname"><a href="classAP__GPS.html#ab6690a9a05471bfb22fc7d171f12b4fc">AP_GPS::time_week_ms</a></div><div class="ttdeci">uint32_t time_week_ms() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00270">AP_GPS.h:270</a></div></div>
<div class="ttc" id="classAP__SerialManager_html"><div class="ttname"><a href="classAP__SerialManager.html">AP_SerialManager</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__SerialManager_8h_source.html#l00078">AP_SerialManager.h:78</a></div></div>
<div class="ttc" id="classAP__GPS_html_a4bdd5c70ed358b4147a58c7d09f040dd"><div class="ttname"><a href="classAP__GPS.html#a4bdd5c70ed358b4147a58c7d09f040dd">AP_GPS::detect_instance</a></div><div class="ttdeci">void detect_instance(uint8_t instance)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00419">AP_GPS.cpp:419</a></div></div>
<div class="ttc" id="classAP__GPS_html_a621df669080080ed806ac311331a8b1ba551da4aa8c5d7cd39c532572d289c7ab"><div class="ttname"><a href="classAP__GPS.html#a621df669080080ed806ac311331a8b1ba551da4aa8c5d7cd39c532572d289c7ab">AP_GPS::GPS_ALL_CONFIGURED</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00116">AP_GPS.h:116</a></div></div>
<div class="ttc" id="AP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="classAP__HAL_1_1UARTDriver_html_a2a83124757f6f8f6eb4d25b11c9cb97e"><div class="ttname"><a href="classAP__HAL_1_1UARTDriver.html#a2a83124757f6f8f6eb4d25b11c9cb97e">AP_HAL::UARTDriver::begin</a></div><div class="ttdeci">virtual void begin(uint32_t baud)=0</div></div>
<div class="ttc" id="classAP__GPS_html_a3d0a0e530c963bb5b7ffaf4eb74faef2"><div class="ttname"><a href="classAP__GPS.html#a3d0a0e530c963bb5b7ffaf4eb74faef2">AP_GPS::num_sensors</a></div><div class="ttdeci">uint8_t num_sensors(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00318">AP_GPS.cpp:318</a></div></div>
<div class="ttc" id="classAP__GPS_html_a86e388032563bbd72cca1bce9ec24d17"><div class="ttname"><a href="classAP__GPS.html#a86e388032563bbd72cca1bce9ec24d17">AP_GPS::calc_blended_state</a></div><div class="ttdeci">void calc_blended_state(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l01338">AP_GPS.cpp:1338</a></div></div>
<div class="ttc" id="classAP__GPS_html_a79f121ff20c9d3fe180f19f89150af4f"><div class="ttname"><a href="classAP__GPS.html#a79f121ff20c9d3fe180f19f89150af4f">AP_GPS::ground_speed</a></div><div class="ttdeci">float ground_speed() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00234">AP_GPS.h:234</a></div></div>
<div class="ttc" id="classAP__GPS__Backend_html_a1bbca91e9e762d373c1a4b6c0d958ca1"><div class="ttname"><a href="classAP__GPS__Backend.html#a1bbca91e9e762d373c1a4b6c0d958ca1">AP_GPS_Backend::broadcast_configuration_failure_reason</a></div><div class="ttdeci">virtual void broadcast_configuration_failure_reason(void) const</div><div class="ttdef"><b>Definition:</b> <a href="GPS__Backend_8h_source.html#l00051">GPS_Backend.h:51</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_a0a8710bdc386183e8afea11565745c75"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#a0a8710bdc386183e8afea11565745c75">AP_GPS::GPS_State::status</a></div><div class="ttdeci">GPS_Status status</div><div class="ttdoc">driver fix status</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00127">AP_GPS.h:127</a></div></div>
<div class="ttc" id="AP__UAVCAN_8h_html"><div class="ttname"><a href="AP__UAVCAN_8h.html">AP_UAVCAN.h</a></div></div>
<div class="ttc" id="classAP__GPS_html_a5c43f8a7049939c439960e2d5431b09b"><div class="ttname"><a href="classAP__GPS.html#a5c43f8a7049939c439960e2d5431b09b">AP_GPS::_inject_to</a></div><div class="ttdeci">AP_Int8 _inject_to</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00415">AP_GPS.h:415</a></div></div>
<div class="ttc" id="AP__GPS_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__GPS_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition:</b> <a href="AC__PID__test_8cpp_source.html#l00021">AC_PID_test.cpp:21</a></div></div>
<div class="ttc" id="GCS_8h_html"><div class="ttname"><a href="GCS_8h.html">GCS.h</a></div><div class="ttdoc">Interface definition for the various Ground Control System.</div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_ab8bec1358e2740e4d76f60d1f8545130"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#ab8bec1358e2740e4d76f60d1f8545130">AP_GPS::GPS_State::have_vertical_velocity</a></div><div class="ttdeci">bool have_vertical_velocity</div><div class="ttdoc">does GPS give vertical velocity? Set to true only once available.</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00140">AP_GPS.h:140</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_a583c2c58093b9c2ce6abcb0fa9be2c79"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#a583c2c58093b9c2ce6abcb0fa9be2c79">AP_GPS::GPS_State::velocity</a></div><div class="ttdeci">Vector3f velocity</div><div class="ttdoc">3D velocity in m/s, in NED format</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00136">AP_GPS.h:136</a></div></div>
<div class="ttc" id="AP__GPS__SBP2_8h_html"><div class="ttname"><a href="AP__GPS__SBP2_8h.html">AP_GPS_SBP2.h</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a321a91de43cfb2e95d40cde314d0a80f"><div class="ttname"><a href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a></div><div class="ttdeci">static auto MIN(const A &amp;one, const B &amp;two) -&gt; decltype(one&lt; two ? one :two)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00202">AP_Math.h:202</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html">AP_GPS::GPS_State</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00123">AP_GPS.h:123</a></div></div>
<div class="ttc" id="classAP__GPS_html_adbcf012c3f5dec8af367ee6b5e025573"><div class="ttname"><a href="classAP__GPS.html#adbcf012c3f5dec8af367ee6b5e025573">AP_GPS::primary_instance</a></div><div class="ttdeci">uint8_t primary_instance</div><div class="ttdoc">primary GPS instance</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00457">AP_GPS.h:457</a></div></div>
<div class="ttc" id="classAP__GPS_html_ab56525924639ff734a805b7bce10f5eb"><div class="ttname"><a href="classAP__GPS.html#ab56525924639ff734a805b7bce10f5eb">AP_GPS::AP_GPS_GSOF</a></div><div class="ttdeci">friend class AP_GPS_GSOF</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00046">AP_GPS.h:46</a></div></div>
<div class="ttc" id="classAP__GPS_html_a559c00ff3bbc1232f68e64d29a892128"><div class="ttname"><a href="classAP__GPS.html#a559c00ff3bbc1232f68e64d29a892128">AP_GPS::send_mavlink_gps2_raw</a></div><div class="ttdeci">void send_mavlink_gps2_raw(mavlink_channel_t chan)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00943">AP_GPS.cpp:943</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00100">AP_Param.h:100</a></div></div>
<div class="ttc" id="classAP__GPS_html_a27bb197524818a82bd813d22a6b0c1b5"><div class="ttname"><a href="classAP__GPS.html#a27bb197524818a82bd813d22a6b0c1b5">AP_GPS::lock_port</a></div><div class="ttdeci">void lock_port(uint8_t instance, bool locked)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00867">AP_GPS.cpp:867</a></div></div>
<div class="ttc" id="classAP__GPS_html_ac2c5a58b9aa31a268047ce499f61f96c"><div class="ttname"><a href="classAP__GPS.html#ac2c5a58b9aa31a268047ce499f61f96c">AP_GPS::all_consistent</a></div><div class="ttdeci">bool all_consistent(float &amp;distance) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l01003">AP_GPS.cpp:1003</a></div></div>
<div class="ttc" id="classAP__GPS__Backend_html_a1d0f842ede7aff19b688f948d8d9231b"><div class="ttname"><a href="classAP__GPS__Backend.html#a1d0f842ede7aff19b688f948d8d9231b">AP_GPS_Backend::inject_data</a></div><div class="ttdeci">virtual void inject_data(const uint8_t *data, uint16_t len)</div><div class="ttdef"><b>Definition:</b> <a href="GPS__Backend_8cpp_source.html#l00128">GPS_Backend.cpp:128</a></div></div>
<div class="ttc" id="AP__Logger_8h_html"><div class="ttname"><a href="AP__Logger_8h.html">AP_Logger.h</a></div></div>
<div class="ttc" id="AP__GPS__UBLOX_8h_html_ab01245792ac1376be9de89e35cdc6690"><div class="ttname"><a href="AP__GPS__UBLOX_8h.html#ab01245792ac1376be9de89e35cdc6690">UBLOX_SET_BINARY</a></div><div class="ttdeci">#define UBLOX_SET_BINARY</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS__UBLOX_8h_source.html#l00040">AP_GPS_UBLOX.h:40</a></div></div>
<div class="ttc" id="classAP__HAL_1_1BetterStream_html_ab0193c7791fd95eb2bfbfd6597bdf6d8"><div class="ttname"><a href="classAP__HAL_1_1BetterStream.html#ab0193c7791fd95eb2bfbfd6597bdf6d8">AP_HAL::BetterStream::txspace</a></div><div class="ttdeci">virtual uint32_t txspace()=0</div></div>
<div class="ttc" id="classAP__GPS_html_a53e85a64eaa33430288a42c82e23f6d0"><div class="ttname"><a href="classAP__GPS.html#a53e85a64eaa33430288a42c82e23f6d0">AP_GPS::_last_time_updated</a></div><div class="ttdeci">uint32_t _last_time_updated[GPS_MAX_RECEIVERS]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00527">AP_GPS.h:527</a></div></div>
<div class="ttc" id="classAP__GPS_html_a24ab7def0009b4aa846163e9b9704338"><div class="ttname"><a href="classAP__GPS.html#a24ab7def0009b4aa846163e9b9704338">AP_GPS::broadcast_first_configuration_failure_reason</a></div><div class="ttdeci">void broadcast_first_configuration_failure_reason(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00992">AP_GPS.cpp:992</a></div></div>
<div class="ttc" id="classAP__GPS_html_ab23fbd832b645879b3a7a8db446aef03"><div class="ttname"><a href="classAP__GPS.html#ab23fbd832b645879b3a7a8db446aef03">AP_GPS::handle_gps_inject</a></div><div class="ttdeci">void handle_gps_inject(const mavlink_message_t *msg)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00779">AP_GPS.cpp:779</a></div></div>
<div class="ttc" id="GCS_8h_html_a1d3cc361b864ddf64a44c12ab3bd044e"><div class="ttname"><a href="GCS_8h.html#a1d3cc361b864ddf64a44c12ab3bd044e">gcs</a></div><div class="ttdeci">GCS &amp; gcs()</div><div class="ttdef"><b>Definition:</b> <a href="GCS__Common_8cpp_source.html#l05004">GCS_Common.cpp:5004</a></div></div>
<div class="ttc" id="definitions_8h_html_a7643e40a680579fe07946b46a153d8d0"><div class="ttname"><a href="definitions_8h.html#a7643e40a680579fe07946b46a153d8d0">AP_MSEC_PER_WEEK</a></div><div class="ttdeci">#define AP_MSEC_PER_WEEK</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00103">definitions.h:103</a></div></div>
<div class="ttc" id="structAP__Notify_1_1notify__flags__and__values__type_html_a6bc8e854e9a06270cd01c3b126d07575"><div class="ttname"><a href="structAP__Notify_1_1notify__flags__and__values__type.html#a6bc8e854e9a06270cd01c3b126d07575">AP_Notify::notify_flags_and_values_type::gps_num_sats</a></div><div class="ttdeci">uint8_t gps_num_sats</div><div class="ttdef"><b>Definition:</b> <a href="AP__Notify_8h_source.html#l00079">AP_Notify.h:79</a></div></div>
<div class="ttc" id="classLocation_html_a02afc332b5f374b923aa57ec0a63c1af"><div class="ttname"><a href="classLocation.html#a02afc332b5f374b923aa57ec0a63c1af">Location::offset</a></div><div class="ttdeci">void offset(float ofs_north, float ofs_east)</div><div class="ttdef"><b>Definition:</b> <a href="Location_8cpp_source.html#l00246">Location.cpp:246</a></div></div>
<div class="ttc" id="AP__GPS__MTK__Common_8h_html_a33cc37eaf57637b4b2476d9efcf6611a"><div class="ttname"><a href="AP__GPS__MTK__Common_8h.html#a33cc37eaf57637b4b2476d9efcf6611a">MTK_SET_BINARY</a></div><div class="ttdeci">#define MTK_SET_BINARY</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS__MTK__Common_8h_source.html#l00023">AP_GPS_MTK_Common.h:23</a></div></div>
<div class="ttc" id="classAP__GPS_html_adeb2695a00658d267b847fda8d08a5da"><div class="ttname"><a href="classAP__GPS.html#adeb2695a00658d267b847fda8d08a5da">AP_GPS::have_vertical_velocity</a></div><div class="ttdeci">bool have_vertical_velocity(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00328">AP_GPS.h:328</a></div></div>
<div class="ttc" id="AP__GPS__NOVA_8h_html"><div class="ttname"><a href="AP__GPS__NOVA_8h.html">AP_GPS_NOVA.h</a></div></div>
<div class="ttc" id="classAP__GPS__NMEA_html_a14edc53eb3e6907cba8b59832c69fd33"><div class="ttname"><a href="classAP__GPS__NMEA.html#a14edc53eb3e6907cba8b59832c69fd33">AP_GPS_NMEA::_detect</a></div><div class="ttdeci">static bool _detect(struct NMEA_detect_state &amp;state, uint8_t data)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS__NMEA_8cpp_source.html#l00418">AP_GPS_NMEA.cpp:418</a></div></div>
<div class="ttc" id="classAP__GPS_html_a9deff31eb85227eb57cc66556df03ba0"><div class="ttname"><a href="classAP__GPS.html#a9deff31eb85227eb57cc66556df03ba0">AP_GPS::drivers</a></div><div class="ttdeci">AP_GPS_Backend * drivers[GPS_MAX_RECEIVERS]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00453">AP_GPS.h:453</a></div></div>
<div class="ttc" id="classAP__Logger_html_a8bed25359bc401b7d00def25bd8173b9"><div class="ttname"><a href="classAP__Logger.html#a8bed25359bc401b7d00def25bd8173b9">AP_Logger::should_log</a></div><div class="ttdeci">bool should_log(uint32_t mask) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Logger_8cpp_source.html#l00515">AP_Logger.cpp:515</a></div></div>
<div class="ttc" id="AP__GPS__MTK_8h_html"><div class="ttname"><a href="AP__GPS__MTK_8h.html">AP_GPS_MTK.h</a></div></div>
<div class="ttc" id="Printf_8cpp_html_a5558580ea8d3854253a721ee58cff12d"><div class="ttname"><a href="Printf_8cpp.html#a5558580ea8d3854253a721ee58cff12d">result</a></div><div class="ttdeci">const char * result</div><div class="ttdef"><b>Definition:</b> <a href="Printf_8cpp_source.html#l00016">Printf.cpp:16</a></div></div>
<div class="ttc" id="classAP__GPS_html_a3bf60c1850eb76bcec1416168ad384b3"><div class="ttname"><a href="classAP__GPS.html#a3bf60c1850eb76bcec1416168ad384b3">AP_GPS::highest_supported_status</a></div><div class="ttdeci">GPS_Status highest_supported_status(uint8_t instance) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00559">AP_GPS.cpp:559</a></div></div>
<div class="ttc" id="classAP__GPS__ERB_html_a4ddd7b585ea06578c407d19d6d3964c5"><div class="ttname"><a href="classAP__GPS__ERB.html#a4ddd7b585ea06578c407d19d6d3964c5">AP_GPS_ERB::_detect</a></div><div class="ttdeci">static bool _detect(struct ERB_detect_state &amp;state, uint8_t data)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS__ERB_8cpp_source.html#l00237">AP_GPS_ERB.cpp:237</a></div></div>
<div class="ttc" id="classAP__GPS_html_aa64e78056c0899273bae42ac4874b7e0"><div class="ttname"><a href="classAP__GPS.html#aa64e78056c0899273bae42ac4874b7e0">AP_GPS::AP_GPS</a></div><div class="ttdeci">AP_GPS()</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00276">AP_GPS.cpp:276</a></div></div>
<div class="ttc" id="AP__GPS__UBLOX_8h_html"><div class="ttname"><a href="AP__GPS__UBLOX_8h.html">AP_GPS_UBLOX.h</a></div></div>
<div class="ttc" id="examples_2location_2location_8cpp_html_a06f14a9abd47b91465f895d5259cdc1b"><div class="ttname"><a href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a></div><div class="ttdeci">float distance</div><div class="ttdef"><b>Definition:</b> <a href="examples_2location_2location_8cpp_source.html#l00095">location.cpp:95</a></div></div>
<div class="ttc" id="AP__GPS__MTK19_8h_html"><div class="ttname"><a href="AP__GPS__MTK19_8h.html">AP_GPS_MTK19.h</a></div></div>
<div class="ttc" id="structAP__Notify_1_1notify__flags__and__values__type_html_a804d7278d01f92ef395c3f36e464d5a8"><div class="ttname"><a href="structAP__Notify_1_1notify__flags__and__values__type.html#a804d7278d01f92ef395c3f36e464d5a8">AP_Notify::notify_flags_and_values_type::gps_status</a></div><div class="ttdeci">uint8_t gps_status</div><div class="ttdef"><b>Definition:</b> <a href="AP__Notify_8h_source.html#l00078">AP_Notify.h:78</a></div></div>
<div class="ttc" id="malloc_8c_html_a62b7798461bd461da64c5f9d35feddf7"><div class="ttname"><a href="malloc_8c.html#a62b7798461bd461da64c5f9d35feddf7">calloc</a></div><div class="ttdeci">void * calloc(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="malloc_8c_source.html#l00203">malloc.c:203</a></div></div>
<div class="ttc" id="AP__InternalError_8cpp_html_a02ad7a50d04e0dbf28c6c90a183a0579"><div class="ttname"><a href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a></div><div class="ttdeci">static AP_InternalError instance</div><div class="ttdef"><b>Definition:</b> <a href="AP__InternalError_8cpp_source.html#l00008">AP_InternalError.cpp:8</a></div></div>
<div class="ttc" id="classAP__SerialManager_html_af95280ba50704a8adece62755cb348e7a22d7bc8b55699d3423ceb94263ad982d"><div class="ttname"><a href="classAP__SerialManager.html#af95280ba50704a8adece62755cb348e7a22d7bc8b55699d3423ceb94263ad982d">AP_SerialManager::SerialProtocol_GPS</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__SerialManager_8h_source.html#l00093">AP_SerialManager.h:93</a></div></div>
<div class="ttc" id="classAP__GPS_html_a83302e8b52e5d01ae67375b3542eb460"><div class="ttname"><a href="classAP__GPS.html#a83302e8b52e5d01ae67375b3542eb460">AP_GPS::update_instance</a></div><div class="ttdeci">void update_instance(uint8_t instance)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00586">AP_GPS.cpp:586</a></div></div>
<div class="ttc" id="classAP__GPS__Backend_html_a42195424a7f5664b2240133ebc22b2cd"><div class="ttname"><a href="classAP__GPS__Backend.html#a42195424a7f5664b2240133ebc22b2cd">AP_GPS_Backend::prepare_for_arming</a></div><div class="ttdeci">virtual bool prepare_for_arming(void)</div><div class="ttdef"><b>Definition:</b> <a href="GPS__Backend_8h_source.html#l00066">GPS_Backend.h:66</a></div></div>
<div class="ttc" id="AP__RTC_8h_html"><div class="ttname"><a href="AP__RTC_8h.html">AP_RTC.h</a></div></div>
<div class="ttc" id="AP__GPS__UAVCAN_8h_html"><div class="ttname"><a href="AP__GPS__UAVCAN_8h.html">AP_GPS_UAVCAN.h</a></div></div>
<div class="ttc" id="classAP__GPS_html_a7bcfc49c7498cdd19ee51552d7edf506"><div class="ttname"><a href="classAP__GPS.html#a7bcfc49c7498cdd19ee51552d7edf506">AP_GPS::AP_GPS_MAV</a></div><div class="ttdeci">friend class AP_GPS_MAV</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00047">AP_GPS.h:47</a></div></div>
<div class="ttc" id="GCS__MAVLink_8h_html_aff625e94451bf446bdd56f5d0e081077"><div class="ttname"><a href="GCS__MAVLink_8h.html#aff625e94451bf446bdd56f5d0e081077">MAVLINK_COMM_NUM_BUFFERS</a></div><div class="ttdeci">#define MAVLINK_COMM_NUM_BUFFERS</div><div class="ttdef"><b>Definition:</b> <a href="GCS__MAVLink_8h_source.html#l00020">GCS_MAVLink.h:20</a></div></div>
<div class="ttc" id="AP__GPS_8cpp_html_af2a2b9d86200a37152ed36817f914ac7"><div class="ttname"><a href="AP__GPS_8cpp.html#af2a2b9d86200a37152ed36817f914ac7">BLEND_MASK_USE_HPOS_ACC</a></div><div class="ttdeci">#define BLEND_MASK_USE_HPOS_ACC</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00054">AP_GPS.cpp:54</a></div></div>
<div class="ttc" id="namespaceAP_html_aa35bfac1ea2da16f110e8e72db7b3b20"><div class="ttname"><a href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a></div><div class="ttdeci">AP_Logger &amp; logger()</div><div class="ttdef"><b>Definition:</b> <a href="AP__Logger_8cpp_source.html#l01182">AP_Logger.cpp:1182</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6a316eaa99b513960bd73ffc65f3ce94d3"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a316eaa99b513960bd73ffc65f3ce94d3">AP_GPS::GPS_TYPE_AUTO</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00074">AP_GPS.h:74</a></div></div>
<div class="ttc" id="classAP__GPS_html_a1673a3811b1c622d90db33b223950557"><div class="ttname"><a href="classAP__GPS.html#a1673a3811b1c622d90db33b223950557">AP_GPS::get_vdop</a></div><div class="ttdeci">uint16_t get_vdop() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00294">AP_GPS.h:294</a></div></div>
<div class="ttc" id="structVector2_html_a6cfed8355591aa269f4dba43bd806ef9"><div class="ttname"><a href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">Vector2::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition:</b> <a href="vector2_8h_source.html#l00037">vector2.h:37</a></div></div>
<div class="ttc" id="classAP__GPS_html_a603f934a204d3eb595257a854cb44759"><div class="ttname"><a href="classAP__GPS.html#a603f934a204d3eb595257a854cb44759">AP_GPS::init</a></div><div class="ttdeci">void init(const AP_SerialManager &amp;serial_manager)</div><div class="ttdoc">Startup initialisation.</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00290">AP_GPS.cpp:290</a></div></div>
<div class="ttc" id="classAP__GPS_html_aa712de51140898ff1942d428e2008ee7"><div class="ttname"><a href="classAP__GPS.html#aa712de51140898ff1942d428e2008ee7">AP_GPS::inject_data</a></div><div class="ttdeci">void inject_data(uint8_t *data, uint16_t len)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00881">AP_GPS.cpp:881</a></div></div>
<div class="ttc" id="classAP__GPS_html_a345149947e2742dfde06a095e40e5a9c"><div class="ttname"><a href="classAP__GPS.html#a345149947e2742dfde06a095e40e5a9c">AP_GPS::AP_GPS_SBP2</a></div><div class="ttdeci">friend class AP_GPS_SBP2</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00055">AP_GPS.h:55</a></div></div>
<div class="ttc" id="AP__GPS__GSOF_8h_html"><div class="ttname"><a href="AP__GPS__GSOF_8h.html">AP_GPS_GSOF.h</a></div></div>
<div class="ttc" id="classAP__GPS_html_a7409121ce557236dce2fd541309af5fc"><div class="ttname"><a href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fc">AP_GPS::GPS_Status</a></div><div class="ttdeci">GPS_Status</div><div class="ttdoc">GPS status codes.</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00091">AP_GPS.h:91</a></div></div>
<div class="ttc" id="AP__HAL__Boards_8h_html_a3c0c1b7e4574fd0e968689e687c28dc3"><div class="ttname"><a href="AP__HAL__Boards_8h.html#a3c0c1b7e4574fd0e968689e687c28dc3">HAL_GPS_TYPE_DEFAULT</a></div><div class="ttdeci">#define HAL_GPS_TYPE_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__HAL__Boards_8h_source.html#l00239">AP_HAL_Boards.h:239</a></div></div>
<div class="ttc" id="classAP__GPS_html_ab7d394dafbbd1d9c7d046aa195d49063"><div class="ttname"><a href="classAP__GPS.html#ab7d394dafbbd1d9c7d046aa195d49063">AP_GPS::_singleton</a></div><div class="ttdeci">static AP_GPS * _singleton</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00432">AP_GPS.h:432</a></div></div>
<div class="ttc" id="classAP__GPS__MTK19_html_ae7dd973d7154070da15101cfc9f4a58b"><div class="ttname"><a href="classAP__GPS__MTK19.html#ae7dd973d7154070da15101cfc9f4a58b">AP_GPS_MTK19::_detect</a></div><div class="ttdeci">static bool _detect(struct MTK19_detect_state &amp;state, uint8_t data)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS__MTK19_8cpp_source.html#l00187">AP_GPS_MTK19.cpp:187</a></div></div>
<div class="ttc" id="classAP__GPS_html_a48d705a86f6f13cb6fe506c7b93d5262"><div class="ttname"><a href="classAP__GPS.html#a48d705a86f6f13cb6fe506c7b93d5262">AP_GPS::is_healthy</a></div><div class="ttdeci">bool is_healthy(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00397">AP_GPS.h:397</a></div></div>
<div class="ttc" id="classAP__GPS_html_a42591c1b4bded833142990e8757c9f24"><div class="ttname"><a href="classAP__GPS.html#a42591c1b4bded833142990e8757c9f24">AP_GPS::AP_GPS_SIRF</a></div><div class="ttdeci">friend class AP_GPS_SIRF</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00056">AP_GPS.h:56</a></div></div>
<div class="ttc" id="classAP__GPS_html_a020a2b10c64f877da888309232e1b3b2"><div class="ttname"><a href="classAP__GPS.html#a020a2b10c64f877da888309232e1b3b2">AP_GPS::_omega_lpf</a></div><div class="ttdeci">float _omega_lpf</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00528">AP_GPS.h:528</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6a755a5b90129ac93c5b947fd0430252aa"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a755a5b90129ac93c5b947fd0430252aa">AP_GPS::GPS_TYPE_SBP</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00081">AP_GPS.h:81</a></div></div>
<div class="ttc" id="DerivativeFilter_8cpp_html_a91f27329cbc70a03207bcee33e2b42fd"><div class="ttname"><a href="DerivativeFilter_8cpp.html#a91f27329cbc70a03207bcee33e2b42fd">x</a></div><div class="ttdeci">#define x(i)</div></div>
<div class="ttc" id="AP__GPS_8cpp_html_af3476ae7cb8c401b7d55ab98b86ed292"><div class="ttname"><a href="AP__GPS_8cpp.html#af3476ae7cb8c401b7d55ab98b86ed292">BLEND_MASK_USE_SPD_ACC</a></div><div class="ttdeci">#define BLEND_MASK_USE_SPD_ACC</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00056">AP_GPS.cpp:56</a></div></div>
<div class="ttc" id="classAP__GPS_html_a266ef4a39f7a303fc1905bf7f9e4ed09"><div class="ttname"><a href="classAP__GPS.html#a266ef4a39f7a303fc1905bf7f9e4ed09">AP_GPS::send_mavlink_gps_raw</a></div><div class="ttdeci">void send_mavlink_gps_raw(mavlink_channel_t chan)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00900">AP_GPS.cpp:900</a></div></div>
<div class="ttc" id="classAP__GPS_html_a09de09009fdec7d5242a04adeb7f842c"><div class="ttname"><a href="classAP__GPS.html#a09de09009fdec7d5242a04adeb7f842c">AP_GPS::_blended_antenna_offset</a></div><div class="ttdeci">Vector3f _blended_antenna_offset</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00524">AP_GPS.h:524</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6ae7f79347a000fb1cf52a29057a14c77d"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6ae7f79347a000fb1cf52a29057a14c77d">AP_GPS::GPS_TYPE_NMEA</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00078">AP_GPS.h:78</a></div></div>
<div class="ttc" id="classAP__GPS_html_a13771e63e584a3bca073142b10316c05"><div class="ttname"><a href="classAP__GPS.html#a13771e63e584a3bca073142b10316c05">AP_GPS::time_epoch_usec</a></div><div class="ttdeci">uint64_t time_epoch_usec(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00380">AP_GPS.h:380</a></div></div>
<div class="ttc" id="classAP__GPS_html_ab8cf24c74d281be0f8cc68fcf924a678"><div class="ttname"><a href="classAP__GPS.html#ab8cf24c74d281be0f8cc68fcf924a678">AP_GPS::timing</a></div><div class="ttdeci">GPS_timing timing[GPS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00451">AP_GPS.h:451</a></div></div>
<div class="ttc" id="classAP__GPS_html_a2632887b489c6de665ca309836a443f7"><div class="ttname"><a href="classAP__GPS.html#a2632887b489c6de665ca309836a443f7">AP_GPS::num_instances</a></div><div class="ttdeci">uint8_t num_instances</div><div class="ttdoc">number of GPS instances present</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00460">AP_GPS.h:460</a></div></div>
<div class="ttc" id="classAP__GPS_html_a8d10f943cb245f20b1dc5f8e727f52eb"><div class="ttname"><a href="classAP__GPS.html#a8d10f943cb245f20b1dc5f8e727f52eb">AP_GPS::should_log</a></div><div class="ttdeci">bool should_log() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00567">AP_GPS.cpp:567</a></div></div>
<div class="ttc" id="AP__Math_8cpp_html_aac44349f9b159f31fc43fe924d52f7fc"><div class="ttname"><a href="AP__Math_8cpp.html#aac44349f9b159f31fc43fe924d52f7fc">wrap_360</a></div><div class="ttdeci">float wrap_360(const T angle, float unit_mod)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8cpp_source.html#l00154">AP_Math.cpp:154</a></div></div>
<div class="ttc" id="classAP__GPS_html_a35773018a70f4ded4f2f86b3b513c3a8"><div class="ttname"><a href="classAP__GPS.html#a35773018a70f4ded4f2f86b3b513c3a8">AP_GPS::velocity</a></div><div class="ttdeci">const Vector3f &amp; velocity() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00226">AP_GPS.h:226</a></div></div>
<div class="ttc" id="classAP__Logger_html_ad7ea6c85db8ab8fc74b7e78d3732e01d"><div class="ttname"><a href="classAP__Logger.html#ad7ea6c85db8ab8fc74b7e78d3732e01d">AP_Logger::Write_GPS</a></div><div class="ttdeci">void Write_GPS(uint8_t instance, uint64_t time_us=0)</div><div class="ttdef"><b>Definition:</b> <a href="LogFile_8cpp_source.html#l00134">LogFile.cpp:134</a></div></div>
<div class="ttc" id="classAP__GPS__Backend_html_a7fe9c23afd9cb1b88b61ce33bf0dd37c"><div class="ttname"><a href="classAP__GPS__Backend.html#a7fe9c23afd9cb1b88b61ce33bf0dd37c">AP_GPS_Backend::is_healthy</a></div><div class="ttdeci">virtual bool is_healthy(void) const</div><div class="ttdef"><b>Definition:</b> <a href="GPS__Backend_8h_source.html#l00059">GPS_Backend.h:59</a></div></div>
<div class="ttc" id="classAP__GPS_html_a7647cae1e8f90b75020d3cd6c31470ff"><div class="ttname"><a href="classAP__GPS.html#a7647cae1e8f90b75020d3cd6c31470ff">AP_GPS::get_antenna_offset</a></div><div class="ttdeci">const Vector3f &amp; get_antenna_offset(uint8_t instance) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l01143">AP_GPS.cpp:1143</a></div></div>
<div class="ttc" id="classAP__GPS_html_ab97af8b3f61b2c16596fd0617bfe93a0"><div class="ttname"><a href="classAP__GPS.html#ab97af8b3f61b2c16596fd0617bfe93a0">AP_GPS::num_sats</a></div><div class="ttdeci">uint8_t num_sats() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00262">AP_GPS.h:262</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00021">HAL.h:21</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6a75e6abea4be518c0367016185ac3e53f"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a75e6abea4be518c0367016185ac3e53f">AP_GPS::GPS_TYPE_MTK</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00076">AP_GPS.h:76</a></div></div>
<div class="ttc" id="classAP__GPS_html_a90091852976695c3a8dd7c2311ca5a54"><div class="ttname"><a href="classAP__GPS.html#a90091852976695c3a8dd7c2311ca5a54">AP_GPS::setHIL_Accuracy</a></div><div class="ttdeci">void setHIL_Accuracy(uint8_t instance, float vdop, float hacc, float vacc, float sacc, bool _have_vertical_velocity, uint32_t sample_ms)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00842">AP_GPS.cpp:842</a></div></div>
<div class="ttc" id="namespaceAP_html"><div class="ttname"><a href="namespaceAP.html">AP</a></div><div class="ttdef"><b>Definition:</b> <a href="AC__Avoid_8cpp_source.html#l00655">AC_Avoid.cpp:655</a></div></div>
<div class="ttc" id="AP__GPS_8h_html_a3a734b4d4de7ca88c6563a5a476e3e87"><div class="ttname"><a href="AP__GPS_8h.html#a3a734b4d4de7ca88c6563a5a476e3e87">GPS_MAX_INSTANCES</a></div><div class="ttdeci">#define GPS_MAX_INSTANCES</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00030">AP_GPS.h:30</a></div></div>
<div class="ttc" id="classAP__GPS__Backend_html_a2d73140d3b37b74b167a95deae6c213c"><div class="ttname"><a href="classAP__GPS__Backend.html#a2d73140d3b37b74b167a95deae6c213c">AP_GPS_Backend::Write_AP_Logger_Log_Startup_messages</a></div><div class="ttdeci">virtual void Write_AP_Logger_Log_Startup_messages() const</div><div class="ttdef"><b>Definition:</b> <a href="GPS__Backend_8cpp_source.html#l00167">GPS_Backend.cpp:167</a></div></div>
<div class="ttc" id="GPS__Backend_8h_html"><div class="ttname"><a href="GPS__Backend_8h.html">GPS_Backend.h</a></div></div>
<div class="ttc" id="classAP__GPS_html_a7d16833881d7bb6db5bc84e345cea0ca"><div class="ttname"><a href="classAP__GPS.html#a7d16833881d7bb6db5bc84e345cea0ca">AP_GPS::_hgt_offset_cm</a></div><div class="ttdeci">float _hgt_offset_cm[GPS_MAX_RECEIVERS]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00523">AP_GPS.h:523</a></div></div>
<div class="ttc" id="classAP__GPS_html_acb11fb039b919cc571307c0c6c265d7a"><div class="ttname"><a href="classAP__GPS.html#acb11fb039b919cc571307c0c6c265d7a">AP_GPS::AP_GPS_NOVA</a></div><div class="ttdeci">friend class AP_GPS_NOVA</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00051">AP_GPS.h:51</a></div></div>
<div class="ttc" id="classAP__GPS_html_adb1d7e0cbc5e14f4d80008f5e5db0eed"><div class="ttname"><a href="classAP__GPS.html#adb1d7e0cbc5e14f4d80008f5e5db0eed">AP_GPS::Write_AP_Logger_Log_Startup_messages</a></div><div class="ttdeci">void Write_AP_Logger_Log_Startup_messages()</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l01094">AP_GPS.cpp:1094</a></div></div>
<div class="ttc" id="AP__GPS_8h_html_ac159cf063a7c67cf309fa8939df8f727"><div class="ttname"><a href="AP__GPS_8h.html#ac159cf063a7c67cf309fa8939df8f727">UNIX_OFFSET_MSEC</a></div><div class="ttdeci">#define UNIX_OFFSET_MSEC</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00037">AP_GPS.h:37</a></div></div>
<div class="ttc" id="classAP__GPS_html_aa11fde1563dedb624c0d308b0e542cb6"><div class="ttname"><a href="classAP__GPS.html#aa11fde1563dedb624c0d308b0e542cb6">AP_GPS::_blend_health_counter</a></div><div class="ttdeci">uint8_t _blend_health_counter</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00530">AP_GPS.h:530</a></div></div>
<div class="ttc" id="classAP__GPS_html_a10564ab5cea24ce00f9fd6f641fe339a"><div class="ttname"><a href="classAP__GPS.html#a10564ab5cea24ce00f9fd6f641fe339a">AP_GPS::_blend_mask</a></div><div class="ttdeci">AP_Int8 _blend_mask</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00426">AP_GPS.h:426</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__timing_html_a77d2a7ea1547b32a34ee112f304dbc3b"><div class="ttname"><a href="structAP__GPS_1_1GPS__timing.html#a77d2a7ea1547b32a34ee112f304dbc3b">AP_GPS::GPS_timing::delta_time_ms</a></div><div class="ttdeci">uint16_t delta_time_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00448">AP_GPS.h:448</a></div></div>
<div class="ttc" id="classAP__GPS_html_a32634fda14b879872e3434733dac25ba"><div class="ttname"><a href="classAP__GPS.html#a32634fda14b879872e3434733dac25ba">AP_GPS::speed_accuracy</a></div><div class="ttdeci">bool speed_accuracy(uint8_t instance, float &amp;sacc) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00327">AP_GPS.cpp:327</a></div></div>
<div class="ttc" id="classAP__GPS_html_ac72f28687a306b821da873c6b2145241"><div class="ttname"><a href="classAP__GPS.html#ac72f28687a306b821da873c6b2145241">AP_GPS::_last_instance_swap_ms</a></div><div class="ttdeci">uint32_t _last_instance_swap_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00416">AP_GPS.h:416</a></div></div>
<div class="ttc" id="structAP__GPS_1_1detect__state_html_a6102db4d46470019b42a5809752c82ae"><div class="ttname"><a href="structAP__GPS_1_1detect__state.html#a6102db4d46470019b42a5809752c82ae">AP_GPS::detect_state::mtk19_detect_state</a></div><div class="ttdeci">struct MTK19_detect_state mtk19_detect_state</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00472">AP_GPS.h:472</a></div></div>
<div class="ttc" id="classAP__GPS_html_a08d0437767d62a318e59b40cf323a31a"><div class="ttname"><a href="classAP__GPS.html#a08d0437767d62a318e59b40cf323a31a">AP_GPS::get_singleton</a></div><div class="ttdeci">static AP_GPS * get_singleton()</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00067">AP_GPS.h:67</a></div></div>
<div class="ttc" id="DerivativeFilter_8cpp_html_a357394e0f6f88c8a57bd893ab28dc8f8"><div class="ttname"><a href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a></div><div class="ttdeci">#define f(i)</div></div>
<div class="ttc" id="classLocation_html_af597420e2ec20fc794ca3d5447fd36ba"><div class="ttname"><a href="classLocation.html#af597420e2ec20fc794ca3d5447fd36ba">Location::get_distance_NE</a></div><div class="ttdeci">Vector2f get_distance_NE(const Location &amp;loc2) const</div><div class="ttdef"><b>Definition:</b> <a href="Location_8cpp_source.html#l00231">Location.cpp:231</a></div></div>
<div class="ttc" id="classAP__GPS_html_a6534cf5404afbe11d4c7edf06813ce4a"><div class="ttname"><a href="classAP__GPS.html#a6534cf5404afbe11d4c7edf06813ce4a">AP_GPS::blend_health_check</a></div><div class="ttdeci">bool blend_health_check() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l01019">AP_GPS.cpp:1019</a></div></div>
<div class="ttc" id="structVector2_html"><div class="ttname"><a href="structVector2.html">Vector2&lt; float &gt;</a></div></div>
<div class="ttc" id="classVector3_html_a561df88b28e106e337a25bb86554a569"><div class="ttname"><a href="classVector3.html#a561df88b28e106e337a25bb86554a569">Vector3::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00067">vector3.h:67</a></div></div>
<div class="ttc" id="classAP__GPS_html_af0ca31342e4c693bf1ef3ec174145963"><div class="ttname"><a href="classAP__GPS.html#af0ca31342e4c693bf1ef3ec174145963">AP_GPS::send_mavlink_gps_rtk</a></div><div class="ttdeci">void send_mavlink_gps_rtk(mavlink_channel_t chan, uint8_t inst)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00972">AP_GPS.cpp:972</a></div></div>
<div class="ttc" id="classAP__HAL_1_1BetterStream_html_a915cc01273d4b418c2fb2989fb31a508"><div class="ttname"><a href="classAP__HAL_1_1BetterStream.html#a915cc01273d4b418c2fb2989fb31a508">AP_HAL::BetterStream::write</a></div><div class="ttdeci">virtual size_t write(uint8_t)=0</div></div>
<div class="ttc" id="AP__BoardConfig_8h_html"><div class="ttname"><a href="AP__BoardConfig_8h.html">AP_BoardConfig.h</a></div></div>
<div class="ttc" id="structAP__GPS_1_1detect__state_html_a3a88e9dbec6da9c65c26f0167b7151ff"><div class="ttname"><a href="structAP__GPS_1_1detect__state.html#a3a88e9dbec6da9c65c26f0167b7151ff">AP_GPS::detect_state::last_baud_change_ms</a></div><div class="ttdeci">uint32_t last_baud_change_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00467">AP_GPS.h:467</a></div></div>
<div class="ttc" id="classAP__GPS_html_a704e437c25ef2105580fbbfdaa8f9df4"><div class="ttname"><a href="classAP__GPS.html#a704e437c25ef2105580fbbfdaa8f9df4">AP_GPS::last_message_time_ms</a></div><div class="ttdeci">uint32_t last_message_time_ms(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00312">AP_GPS.h:312</a></div></div>
<div class="ttc" id="namespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition:</b> <a href="ChibiOS_2system_8cpp_source.html#l00157">system.cpp:157</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6afb53d6f3afb17c9ce056c2ce4dbfad79"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6afb53d6f3afb17c9ce056c2ce4dbfad79">AP_GPS::GPS_TYPE_UBLOX</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00075">AP_GPS.h:75</a></div></div>
<div class="ttc" id="classAP__GPS_html_a9cc00433bd94933f1259dc8bfe859fe1"><div class="ttname"><a href="classAP__GPS.html#a9cc00433bd94933f1259dc8bfe859fe1">AP_GPS::blob</a></div><div class="ttdeci">const char * blob</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00481">AP_GPS.h:481</a></div></div>
<div class="ttc" id="classAP__GPS__Backend_html_a9156c8c353af70a675e4972d98f757cb"><div class="ttname"><a href="classAP__GPS__Backend.html#a9156c8c353af70a675e4972d98f757cb">AP_GPS_Backend::send_mavlink_gps_rtk</a></div><div class="ttdeci">virtual void send_mavlink_gps_rtk(mavlink_channel_t chan)</div><div class="ttdef"><b>Definition:</b> <a href="GPS__Backend_8cpp_source.html#l00180">GPS_Backend.cpp:180</a></div></div>
<div class="ttc" id="classAP__Logger_html"><div class="ttname"><a href="classAP__Logger.html">AP_Logger</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Logger_8h_source.html#l00169">AP_Logger.h:169</a></div></div>
<div class="ttc" id="AP__GPS__ERB_8h_html"><div class="ttname"><a href="AP__GPS__ERB_8h.html">AP_GPS_ERB.h</a></div></div>
<div class="ttc" id="classAP__GPS__SBP2_html_aa7c133a66a1d1b717fced68f92dcec14"><div class="ttname"><a href="classAP__GPS__SBP2.html#aa7c133a66a1d1b717fced68f92dcec14">AP_GPS_SBP2::_detect</a></div><div class="ttdeci">static bool _detect(struct SBP2_detect_state &amp;state, uint8_t data)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS__SBP2_8cpp_source.html#l00367">AP_GPS_SBP2.cpp:367</a></div></div>
<div class="ttc" id="classAP__GPS__Backend_html_a3b19a929f00d465fd3aca9c0ae1fcaa7"><div class="ttname"><a href="classAP__GPS__Backend.html#a3b19a929f00d465fd3aca9c0ae1fcaa7">AP_GPS_Backend::broadcast_gps_type</a></div><div class="ttdeci">void broadcast_gps_type() const</div><div class="ttdef"><b>Definition:</b> <a href="GPS__Backend_8cpp_source.html#l00160">GPS_Backend.cpp:160</a></div></div>
<div class="ttc" id="classAP__GPS_html_a1edd7dcbf000c4d7cc4c2848e5ecf088"><div class="ttname"><a href="classAP__GPS.html#a1edd7dcbf000c4d7cc4c2848e5ecf088">AP_GPS::time_week</a></div><div class="ttdeci">uint16_t time_week() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00278">AP_GPS.h:278</a></div></div>
<div class="ttc" id="structAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00142">AP_Param.h:142</a></div></div>
<div class="ttc" id="structAP__GPS_1_1rtcm__buffer_html_a5dfe66bc0c5d4f1e87b06bb36f9dc4db"><div class="ttname"><a href="structAP__GPS_1_1rtcm__buffer.html#a5dfe66bc0c5d4f1e87b06bb36f9dc4db">AP_GPS::rtcm_buffer::total_length</a></div><div class="ttdeci">uint16_t total_length</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00508">AP_GPS.h:508</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6a18e7fef3055b02873f12983bd9c8b350"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a18e7fef3055b02873f12983bd9c8b350">AP_GPS::GPS_TYPE_SBF</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00083">AP_GPS.h:83</a></div></div>
<div class="ttc" id="classAP__RTC_html_af5ed0a2bd918379395e227179c7d6af3a9529f9ffd3c21a3d934042b6976a4a93"><div class="ttname"><a href="classAP__RTC.html#af5ed0a2bd918379395e227179c7d6af3a9529f9ffd3c21a3d934042b6976a4a93">AP_RTC::SOURCE_GPS</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__RTC_8h_source.html#l00021">AP_RTC.h:21</a></div></div>
<div class="ttc" id="structAP__GPS_1_1detect__state_html_a886f135417cf30f4c95540af6e8c90ab"><div class="ttname"><a href="structAP__GPS_1_1detect__state.html#a886f135417cf30f4c95540af6e8c90ab">AP_GPS::detect_state::erb_detect_state</a></div><div class="ttdeci">struct ERB_detect_state erb_detect_state</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00477">AP_GPS.h:477</a></div></div>
<div class="ttc" id="classAP__GPS_html_a8501b8d502d21be0e12bfd11db3e7dfe"><div class="ttname"><a href="classAP__GPS.html#a8501b8d502d21be0e12bfd11db3e7dfe">AP_GPS::last_fix_time_ms</a></div><div class="ttdeci">uint32_t last_fix_time_ms(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00303">AP_GPS.h:303</a></div></div>
<div class="ttc" id="classAP__GPS__UBLOX_html_abd6e355abac6f9d1914591b92298395b"><div class="ttname"><a href="classAP__GPS__UBLOX.html#abd6e355abac6f9d1914591b92298395b">AP_GPS_UBLOX::_detect</a></div><div class="ttdeci">static bool _detect(struct UBLOX_detect_state &amp;state, uint8_t data)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS__UBLOX_8cpp_source.html#l01286">AP_GPS_UBLOX.cpp:1286</a></div></div>
<div class="ttc" id="classAP__GPS__Backend_html_a5c024a64031affcfe0874e92756d3d88"><div class="ttname"><a href="classAP__GPS__Backend.html#a5c024a64031affcfe0874e92756d3d88">AP_GPS_Backend::handle_msg</a></div><div class="ttdeci">virtual void handle_msg(const mavlink_message_t *msg)</div><div class="ttdef"><b>Definition:</b> <a href="GPS__Backend_8h_source.html#l00053">GPS_Backend.h:53</a></div></div>
<div class="ttc" id="classAP__HAL_1_1UARTDriver_html_ae831a0d75f4760267d444c522e1271a1"><div class="ttname"><a href="classAP__HAL_1_1UARTDriver.html#ae831a0d75f4760267d444c522e1271a1">AP_HAL::UARTDriver::set_flow_control</a></div><div class="ttdeci">virtual void set_flow_control(enum flow_control flow_control_setting)</div><div class="ttdef"><b>Definition:</b> <a href="UARTDriver_8h_source.html#l00064">UARTDriver.h:64</a></div></div>
<div class="ttc" id="AP__GPS__SIRF_8h_html"><div class="ttname"><a href="AP__GPS__SIRF_8h.html">AP_GPS_SIRF.h</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6aefdd545e85fc6611b1678e42cef8c0a1"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6aefdd545e85fc6611b1678e42cef8c0a1">AP_GPS::GPS_TYPE_UAVCAN</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00082">AP_GPS.h:82</a></div></div>
<div class="ttc" id="structAP__GPS_1_1detect__state_html"><div class="ttname"><a href="structAP__GPS_1_1detect__state.html">AP_GPS::detect_state</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00466">AP_GPS.h:466</a></div></div>
<div class="ttc" id="classAP__GPS_html_ace81d41034cf6bc7a468ec57baf62bec"><div class="ttname"><a href="classAP__GPS.html#ace81d41034cf6bc7a468ec57baf62bec">AP_GPS::_rate_ms</a></div><div class="ttdeci">AP_Int16 _rate_ms[GPS_MAX_RECEIVERS]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00421">AP_GPS.h:421</a></div></div>
<div class="ttc" id="AP__Math_8h_html"><div class="ttname"><a href="AP__Math_8h.html">AP_Math.h</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_a1deb41c0495c03263d4a900c09cd5bc8"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#a1deb41c0495c03263d4a900c09cd5bc8">AP_GPS::GPS_State::time_week</a></div><div class="ttdeci">uint16_t time_week</div><div class="ttdoc">GPS week number.</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00129">AP_GPS.h:129</a></div></div>
<div class="ttc" id="classAP__GPS_html_a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff"><div class="ttname"><a href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff">AP_GPS::GPS_OK_FIX_2D</a></div><div class="ttdoc">Receiving valid messages and 2D lock.</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00094">AP_GPS.h:94</a></div></div>
<div class="ttc" id="classAP__GPS_html_a883504971ad9fa1a695d2debc078a930"><div class="ttname"><a href="classAP__GPS.html#a883504971ad9fa1a695d2debc078a930">AP_GPS::all_configured</a></div><div class="ttdeci">bool all_configured(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00364">AP_GPS.h:364</a></div></div>
<div class="ttc" id="classGCS_html_a9866f3484283db744409e40719cef765"><div class="ttname"><a href="classGCS.html#a9866f3484283db744409e40719cef765">GCS::send_text</a></div><div class="ttdeci">void send_text(MAV_SEVERITY severity, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="GCS_8cpp_source.html#l00040">GCS.cpp:40</a></div></div>
<div class="ttc" id="AP__GPS_8h_html_adcf9fb3187691bb28ccf836a46d493ce"><div class="ttname"><a href="AP__GPS_8h.html#adcf9fb3187691bb28ccf836a46d493ce">GPS_UNKNOWN_DOP</a></div><div class="ttdeci">#define GPS_UNKNOWN_DOP</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00032">AP_GPS.h:32</a></div></div>
<div class="ttc" id="classAP__GPS_html_a4b84d957422b1eae6170893a306b95cf"><div class="ttname"><a href="classAP__GPS.html#a4b84d957422b1eae6170893a306b95cf">AP_GPS::_blend_tc</a></div><div class="ttdeci">AP_Float _blend_tc</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00427">AP_GPS.h:427</a></div></div>
<div class="ttc" id="classAP__HAL_1_1BetterStream_html_a65082ecb994170fc6d2a7ff2bcc301a7"><div class="ttname"><a href="classAP__HAL_1_1BetterStream.html#a65082ecb994170fc6d2a7ff2bcc301a7">AP_HAL::BetterStream::read</a></div><div class="ttdeci">virtual int16_t read()=0</div></div>
<div class="ttc" id="AP__GPS_8h_html"><div class="ttname"><a href="AP__GPS_8h.html">AP_GPS.h</a></div></div>
<div class="ttc" id="AP__Common_8h_html_a121caf32c5b5d704ef3453f0885a9ea5"><div class="ttname"><a href="AP__Common_8h.html#a121caf32c5b5d704ef3453f0885a9ea5">ARRAY_SIZE</a></div><div class="ttdeci">#define ARRAY_SIZE(_arr)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00082">AP_Common.h:82</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__timing_html_a196a0fde4a1ac10bc27977eb60d69e4e"><div class="ttname"><a href="structAP__GPS_1_1GPS__timing.html#a196a0fde4a1ac10bc27977eb60d69e4e">AP_GPS::GPS_timing::last_fix_time_ms</a></div><div class="ttdeci">uint32_t last_fix_time_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00442">AP_GPS.h:442</a></div></div>
<div class="ttc" id="classAP__GPS_html_a1b88be4642982ed39abefd25e9f38003"><div class="ttname"><a href="classAP__GPS.html#a1b88be4642982ed39abefd25e9f38003">AP_GPS::_initialisation_blob</a></div><div class="ttdeci">static const char _initialisation_blob[]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00486">AP_GPS.h:486</a></div></div>
<div class="ttc" id="structAP__GPS_1_1rtcm__buffer_html_a3ea184c76817cff75e802b9d8ed76f3c"><div class="ttname"><a href="structAP__GPS_1_1rtcm__buffer.html#a3ea184c76817cff75e802b9d8ed76f3c">AP_GPS::rtcm_buffer::sequence</a></div><div class="ttdeci">uint8_t sequence</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00506">AP_GPS.h:506</a></div></div>
<div class="ttc" id="structAP__GPS_1_1detect__state_html_aff6604d92bd10a17ca5fad75f48780d6"><div class="ttname"><a href="structAP__GPS_1_1detect__state.html#aff6604d92bd10a17ca5fad75f48780d6">AP_GPS::detect_state::sbp2_detect_state</a></div><div class="ttdeci">struct SBP2_detect_state sbp2_detect_state</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00476">AP_GPS.h:476</a></div></div>
<div class="ttc" id="AP__Notify_8h_html"><div class="ttname"><a href="AP__Notify_8h.html">AP_Notify.h</a></div></div>
<div class="ttc" id="classVector3_html_afcdfe81173c23d57e4a53a0282cddae7"><div class="ttname"><a href="classVector3.html#afcdfe81173c23d57e4a53a0282cddae7">Vector3::length</a></div><div class="ttdeci">float length(void) const</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8cpp_source.html#l00297">vector3.cpp:297</a></div></div>
<div class="ttc" id="classAP__Logger_html_a7dfeda4dc3df2edc8531110c9d7252dc"><div class="ttname"><a href="classAP__Logger.html#a7dfeda4dc3df2edc8531110c9d7252dc">AP_Logger::get_singleton</a></div><div class="ttdeci">static AP_Logger * get_singleton(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Logger_8h_source.html#l00183">AP_Logger.h:183</a></div></div>
<div class="ttc" id="AP__GPS_8h_html_a2839bf7ed0174a57ff427a229c04e8c6"><div class="ttname"><a href="AP__GPS_8h.html#a2839bf7ed0174a57ff427a229c04e8c6">GPS_BLENDED_INSTANCE</a></div><div class="ttdeci">#define GPS_BLENDED_INSTANCE</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00031">AP_GPS.h:31</a></div></div>
<div class="ttc" id="structAP__GPS_1_1rtcm__buffer_html"><div class="ttname"><a href="structAP__GPS_1_1rtcm__buffer.html">AP_GPS::rtcm_buffer</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00504">AP_GPS.h:504</a></div></div>
<div class="ttc" id="classAP__GPS_html_aa7e3f1447d7a25eebcc5f06d66cbf395"><div class="ttname"><a href="classAP__GPS.html#aa7e3f1447d7a25eebcc5f06d66cbf395">AP_GPS::ground_course</a></div><div class="ttdeci">float ground_course() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00247">AP_GPS.h:247</a></div></div>
<div class="ttc" id="AP__Common_8h_html"><div class="ttname"><a href="AP__Common_8h.html">AP_Common.h</a></div><div class="ttdoc">Common definitions and utility routines for the ArduPilot libraries.</div></div>
<div class="ttc" id="AP__GPS_8cpp_html_af476b309d3827917a4217a393c7bb6ed"><div class="ttname"><a href="AP__GPS_8cpp.html#af476b309d3827917a4217a393c7bb6ed">GPS_RTK_INJECT_TO_ALL</a></div><div class="ttdeci">#define GPS_RTK_INJECT_TO_ALL</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00048">AP_GPS.cpp:48</a></div></div>
<div class="ttc" id="classLocation_html_a5831f0aca9e51a15adb96fad465f72f8"><div class="ttname"><a href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">Location::lng</a></div><div class="ttdeci">int32_t lng</div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00022">Location.h:22</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_acf132315548c8b639ecdaac75af61101"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#acf132315548c8b639ecdaac75af61101">AP_GPS::GPS_State::vdop</a></div><div class="ttdeci">uint16_t vdop</div><div class="ttdoc">vertical dilution of precision in cm</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00134">AP_GPS.h:134</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_a20e1b00d3fc64a8dae7a39c3763cfa08"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#a20e1b00d3fc64a8dae7a39c3763cfa08">AP_GPS::GPS_State::location</a></div><div class="ttdeci">Location location</div><div class="ttdoc">last fix location</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00130">AP_GPS.h:130</a></div></div>
<div class="ttc" id="AP__GPS_8cpp_html_a2d79705911859d95849c965ef469c5fb"><div class="ttname"><a href="AP__GPS_8cpp.html#a2d79705911859d95849c965ef469c5fb">GPS_MAX_RATE_MS</a></div><div class="ttdeci">#define GPS_MAX_RATE_MS</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00049">AP_GPS.cpp:49</a></div></div>
<div class="ttc" id="structAP__GPS_1_1detect__state_html_a1f091c7a044d04d64919d7aadedf1495"><div class="ttname"><a href="structAP__GPS_1_1detect__state.html#a1f091c7a044d04d64919d7aadedf1495">AP_GPS::detect_state::ublox_detect_state</a></div><div class="ttdeci">struct UBLOX_detect_state ublox_detect_state</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00470">AP_GPS.h:470</a></div></div>
<div class="ttc" id="AP__Math_8h_html_ad525609d9dba6ffa556a0fbf08a3f9b4"><div class="ttname"><a href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a></div><div class="ttdeci">float constrain_float(const float amt, const float low, const float high)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00142">AP_Math.h:142</a></div></div>
<div class="ttc" id="structVector2_html_a78fa1f2ed5e261c7fbeb8f3536a1ee34"><div class="ttname"><a href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">Vector2::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition:</b> <a href="vector2_8h_source.html#l00037">vector2.h:37</a></div></div>
<div class="ttc" id="AP__GPS_8cpp_html_a2f89c2cb9e2d16e7cebb42b9e313b05e"><div class="ttname"><a href="AP__GPS_8cpp.html#a2f89c2cb9e2d16e7cebb42b9e313b05e">BLEND_COUNTER_FAILURE_INCREMENT</a></div><div class="ttdeci">#define BLEND_COUNTER_FAILURE_INCREMENT</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00057">AP_GPS.cpp:57</a></div></div>
<div class="ttc" id="namespaceAP_html_a99432cfdb696952c9b7146f155a815aa"><div class="ttname"><a href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a></div><div class="ttdeci">AP_AHRS &amp; ahrs()</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8cpp_source.html#l00526">AP_AHRS.cpp:526</a></div></div>
<div class="ttc" id="classAP__GPS_html_a654d818f4bc4dca13c461daea586bd0b"><div class="ttname"><a href="classAP__GPS.html#a654d818f4bc4dca13c461daea586bd0b">AP_GPS::setHIL</a></div><div class="ttdeci">void setHIL(uint8_t instance, GPS_Status status, uint64_t time_epoch_ms, const Location &amp;location, const Vector3f &amp;velocity, uint8_t num_sats, uint16_t hdop)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00816">AP_GPS.cpp:816</a></div></div>
<div class="ttc" id="AP__GPS__MAV_8h_html"><div class="ttname"><a href="AP__GPS__MAV_8h.html">AP_GPS_MAV.h</a></div></div>
<div class="ttc" id="structAP__GPS_1_1rtcm__buffer_html_ab584acfcd7a44555b85c5df6cd62346f"><div class="ttname"><a href="structAP__GPS_1_1rtcm__buffer.html#ab584acfcd7a44555b85c5df6cd62346f">AP_GPS::rtcm_buffer::fragments_received</a></div><div class="ttdeci">uint8_t fragments_received</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00505">AP_GPS.h:505</a></div></div>
<div class="ttc" id="classAP__GPS__MTK_html_aaaa210f0bb36cd3e6150b617418c3a92"><div class="ttname"><a href="classAP__GPS__MTK.html#aaaa210f0bb36cd3e6150b617418c3a92">AP_GPS_MTK::_detect</a></div><div class="ttdeci">static bool _detect(struct MTK_detect_state &amp;state, uint8_t data)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS__MTK_8cpp_source.html#l00168">AP_GPS_MTK.cpp:168</a></div></div>
<div class="ttc" id="classAP__GPS_html_ac89218621af4ae16bce41e0fbcb8faf1"><div class="ttname"><a href="classAP__GPS.html#ac89218621af4ae16bce41e0fbcb8faf1">AP_GPS::_baudrates</a></div><div class="ttdeci">static const uint32_t _baudrates[]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00485">AP_GPS.h:485</a></div></div>
<div class="ttc" id="classAP__GPS_html_a7409121ce557236dce2fd541309af5fca4166c675325c7b3e3e83c7c3ec1fbafb"><div class="ttname"><a href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca4166c675325c7b3e3e83c7c3ec1fbafb">AP_GPS::NO_FIX</a></div><div class="ttdoc">Receiving valid GPS messages but no lock.</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00093">AP_GPS.h:93</a></div></div>
<div class="ttc" id="AP__GPS_8cpp_html_a5c474882dc169c97221822426d3d48ed"><div class="ttname"><a href="AP__GPS_8cpp.html#a5c474882dc169c97221822426d3d48ed">BLEND_MASK_USE_VPOS_ACC</a></div><div class="ttdeci">#define BLEND_MASK_USE_VPOS_ACC</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00055">AP_GPS.cpp:55</a></div></div>
<div class="ttc" id="classAP__GPS_html_ab817fb360313c84e12f9ee9bba776e60"><div class="ttname"><a href="classAP__GPS.html#ab817fb360313c84e12f9ee9bba776e60">AP_GPS::last_message_delta_time_ms</a></div><div class="ttdeci">uint16_t last_message_delta_time_ms(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00320">AP_GPS.h:320</a></div></div>
<div class="ttc" id="classAP__Notify_html_a724dd074a094de26e17c72c38ac499e9"><div class="ttname"><a href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a></div><div class="ttdeci">static struct notify_flags_and_values_type flags</div><div class="ttdef"><b>Definition:</b> <a href="AP__Notify_8h_source.html#l00128">AP_Notify.h:128</a></div></div>
<div class="ttc" id="structVector2_html_a6b537328ae913e3e7267b539e7a4af92"><div class="ttname"><a href="structVector2.html#a6b537328ae913e3e7267b539e7a4af92">Vector2::zero</a></div><div class="ttdeci">void zero()</div><div class="ttdef"><b>Definition:</b> <a href="vector2_8h_source.html#l00129">vector2.h:129</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6a1f0ab654d6f0fbe978f0f35438c04734"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a1f0ab654d6f0fbe978f0f35438c04734">AP_GPS::GPS_TYPE_SIRF</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00079">AP_GPS.h:79</a></div></div>
<div class="ttc" id="classAP__GPS_html_acef6b2ae0cc95f78e18f5187591cb65f"><div class="ttname"><a href="classAP__GPS.html#acef6b2ae0cc95f78e18f5187591cb65f">AP_GPS::state</a></div><div class="ttdeci">GPS_State state[GPS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00452">AP_GPS.h:452</a></div></div>
<div class="ttc" id="classAP__GPS_html_a1f8530ce124421726e3544893cd05561"><div class="ttname"><a href="classAP__GPS.html#a1f8530ce124421726e3544893cd05561">AP_GPS::time_epoch_convert</a></div><div class="ttdeci">static uint64_t time_epoch_convert(uint16_t gps_week, uint32_t gps_ms)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00358">AP_GPS.cpp:358</a></div></div>
<div class="ttc" id="AP__GPS__SIRF_8h_html_a688aa025e0239993674de15fccc32285"><div class="ttname"><a href="AP__GPS__SIRF_8h.html#a688aa025e0239993674de15fccc32285">SIRF_SET_BINARY</a></div><div class="ttdeci">#define SIRF_SET_BINARY</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS__SIRF_8h_source.html#l00028">AP_GPS_SIRF.h:28</a></div></div>
<div class="ttc" id="classAP__GPS_html_a3074764330bd4dfd9da851b59a6df2ed"><div class="ttname"><a href="classAP__GPS.html#a3074764330bd4dfd9da851b59a6df2ed">AP_GPS::handle_msg</a></div><div class="ttdeci">void handle_msg(const mavlink_message_t *msg)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00791">AP_GPS.cpp:791</a></div></div>
<div class="ttc" id="examples_2AnalogIn_2AnalogIn_8cpp_html_a130f3ebe4c1bb6993e1094760227ad6a"><div class="ttname"><a href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a></div><div class="ttdeci">AP_HAL::AnalogSource * chan</div><div class="ttdef"><b>Definition:</b> <a href="examples_2AnalogIn_2AnalogIn_8cpp_source.html#l00008">AnalogIn.cpp:8</a></div></div>
<div class="ttc" id="classAP__GPS_html_ab61a817d51c7c3a3f1ae0dc36982b437"><div class="ttname"><a href="classAP__GPS.html#ab61a817d51c7c3a3f1ae0dc36982b437">AP_GPS::AP_GPS_SBP</a></div><div class="ttdeci">friend class AP_GPS_SBP</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00054">AP_GPS.h:54</a></div></div>
<div class="ttc" id="AP__GPS__NMEA_8h_html"><div class="ttname"><a href="AP__GPS__NMEA_8h.html">AP_GPS_NMEA.h</a></div><div class="ttdoc">NMEA protocol parser.</div></div>
<div class="ttc" id="classAP__GPS_html_ae1b0d107cbdc490c1a41a452191952ea"><div class="ttname"><a href="classAP__GPS.html#ae1b0d107cbdc490c1a41a452191952ea">AP_GPS::location</a></div><div class="ttdeci">const Location &amp; location() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00202">AP_GPS.h:202</a></div></div>
<div class="ttc" id="structAP__GPS_1_1rtcm__buffer_html_ad226fe9edff09af33d662e581fab2f48"><div class="ttname"><a href="structAP__GPS_1_1rtcm__buffer.html#ad226fe9edff09af33d662e581fab2f48">AP_GPS::rtcm_buffer::buffer</a></div><div class="ttdeci">uint8_t buffer[MAVLINK_MSG_GPS_RTCM_DATA_FIELD_DATA_LEN *4]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00509">AP_GPS.h:509</a></div></div>
<div class="ttc" id="classAP__GPS_html_a23a9fce42abaf8f53d5a3f64c84461e7"><div class="ttname"><a href="classAP__GPS.html#a23a9fce42abaf8f53d5a3f64c84461e7">AP_GPS::status</a></div><div class="ttdeci">GPS_Status status(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00191">AP_GPS.h:191</a></div></div>
<div class="ttc" id="classAP__GPS_html_a4570c56a31686eb4fd74eaee91a00052"><div class="ttname"><a href="classAP__GPS.html#a4570c56a31686eb4fd74eaee91a00052">AP_GPS::_auto_config</a></div><div class="ttdeci">AP_Int8 _auto_config</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00423">AP_GPS.h:423</a></div></div>
<div class="ttc" id="classAP__GPS_html_a68a4f8c7edd5900e2e14029232790cb2"><div class="ttname"><a href="classAP__GPS.html#a68a4f8c7edd5900e2e14029232790cb2">AP_GPS::AP_GPS_MTK</a></div><div class="ttdeci">friend class AP_GPS_MTK</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00048">AP_GPS.h:48</a></div></div>
<div class="ttc" id="structAP__GPS_1_1detect__state_html_a77c207fe0e20e8a532332e3feefe5e1a"><div class="ttname"><a href="structAP__GPS_1_1detect__state.html#a77c207fe0e20e8a532332e3feefe5e1a">AP_GPS::detect_state::sirf_detect_state</a></div><div class="ttdeci">struct SIRF_detect_state sirf_detect_state</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00473">AP_GPS.h:473</a></div></div>
<div class="ttc" id="AP__BoardConfig__CAN_8h_html"><div class="ttname"><a href="AP__BoardConfig__CAN_8h.html">AP_BoardConfig_CAN.h</a></div></div>
<div class="ttc" id="classAP__GPS_html_a7409121ce557236dce2fd541309af5fca5eba95d16dc0519820e356de7be1362d"><div class="ttname"><a href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca5eba95d16dc0519820e356de7be1362d">AP_GPS::NO_GPS</a></div><div class="ttdoc">No GPS connected/detected.</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00092">AP_GPS.h:92</a></div></div>
<div class="ttc" id="classAP__GPS_html_a43a8bf081e4d4415aa9bf6a273bcd0b6"><div class="ttname"><a href="classAP__GPS.html#a43a8bf081e4d4415aa9bf6a273bcd0b6">AP_GPS::AP_GPS_ERB</a></div><div class="ttdeci">friend class AP_GPS_ERB</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00045">AP_GPS.h:45</a></div></div>
<div class="ttc" id="AP__GPS_8cpp_html_aed01677f1b1efe774fa22e838b84f5db"><div class="ttname"><a href="AP__GPS_8cpp.html#aed01677f1b1efe774fa22e838b84f5db">GPS_TIMEOUT_MS</a></div><div class="ttdeci">#define GPS_TIMEOUT_MS</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00051">AP_GPS.cpp:51</a></div></div>
<div class="ttc" id="classAP__GPS_html_ad4512e4952aa41566d6afb110e0fd6a1"><div class="ttname"><a href="classAP__GPS.html#ad4512e4952aa41566d6afb110e0fd6a1">AP_GPS::send_blob_update</a></div><div class="ttdeci">void send_blob_update(uint8_t instance)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00392">AP_GPS.cpp:392</a></div></div>
<div class="ttc" id="classLocation_html_a89e532f5bcc13db2f51ff9eed667c2b6"><div class="ttname"><a href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">Location::alt</a></div><div class="ttdeci">int32_t alt</div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00020">Location.h:20</a></div></div>
<div class="ttc" id="structAP__GPS_1_1detect__state_html_add10334deb707e361ad8d3ddc0eaec36"><div class="ttname"><a href="structAP__GPS_1_1detect__state.html#add10334deb707e361ad8d3ddc0eaec36">AP_GPS::detect_state::mtk_detect_state</a></div><div class="ttdeci">struct MTK_detect_state mtk_detect_state</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00471">AP_GPS.h:471</a></div></div>
<div class="ttc" id="classAP__GPS_html_a7c57cd937a1702a32ea63dc30f271d5b"><div class="ttname"><a href="classAP__GPS.html#a7c57cd937a1702a32ea63dc30f271d5b">AP_GPS::AP_GPS_SBF</a></div><div class="ttdeci">friend class AP_GPS_SBF</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00053">AP_GPS.h:53</a></div></div>
<div class="ttc" id="classAP__GPS__SBP_html_ae1ae391d424ba0cc24b0b8b70a263bcc"><div class="ttname"><a href="classAP__GPS__SBP.html#ae1ae391d424ba0cc24b0b8b70a263bcc">AP_GPS_SBP::_detect</a></div><div class="ttdeci">static bool _detect(struct SBP_detect_state &amp;state, uint8_t data)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS__SBP_8cpp_source.html#l00315">AP_GPS_SBP.cpp:315</a></div></div>
<div class="ttc" id="classAP__GPS_html_ad59f76f7eba6465149870f76442446b1"><div class="ttname"><a href="classAP__GPS.html#ad59f76f7eba6465149870f76442446b1">AP_GPS::initblob_state</a></div><div class="ttdeci">struct AP_GPS::@26 initblob_state[GPS_MAX_RECEIVERS]</div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_a464226322ab0371a941f490cd1a818d8"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#a464226322ab0371a941f490cd1a818d8">AP_GPS::GPS_State::have_vertical_accuracy</a></div><div class="ttdeci">bool have_vertical_accuracy</div><div class="ttdoc">does GPS give vertical position accuracy? Set to true only once available.</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00143">AP_GPS.h:143</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_a794387e866d36d1906864dff89e963a4"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#a794387e866d36d1906864dff89e963a4">AP_GPS::GPS_State::uart_timestamp_ms</a></div><div class="ttdeci">uint32_t uart_timestamp_ms</div><div class="ttdoc">optional timestamp from set_uart_timestamp()</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00145">AP_GPS.h:145</a></div></div>
<div class="ttc" id="classVector3_html"><div class="ttname"><a href="classVector3.html">Vector3&lt; float &gt;</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_a0845d4035e6cb36a9e1e31f4a68531f2"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#a0845d4035e6cb36a9e1e31f4a68531f2">AP_GPS::GPS_State::speed_accuracy</a></div><div class="ttdeci">float speed_accuracy</div><div class="ttdoc">3D velocity RMS accuracy estimate in m/s</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00137">AP_GPS.h:137</a></div></div>
<div class="ttc" id="classAP__GPS_html_a09fc3eb0ae4581f5d34d180431b0295f"><div class="ttname"><a href="classAP__GPS.html#a09fc3eb0ae4581f5d34d180431b0295f">AP_GPS::handle_gps_rtcm_data</a></div><div class="ttdeci">void handle_gps_rtcm_data(const mavlink_message_t *msg)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l01027">AP_GPS.cpp:1027</a></div></div>
<div class="ttc" id="namespaceAP_html_ae6eeec356455220f913e47e323057cd5"><div class="ttname"><a href="namespaceAP.html#ae6eeec356455220f913e47e323057cd5">AP::gps</a></div><div class="ttdeci">AP_GPS &amp; gps()</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l01574">AP_GPS.cpp:1574</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_a67fb5cd3a118c2517a6d1fdc928f9227"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#a67fb5cd3a118c2517a6d1fdc928f9227">AP_GPS::GPS_State::have_horizontal_accuracy</a></div><div class="ttdeci">bool have_horizontal_accuracy</div><div class="ttdoc">does GPS give horizontal position accuracy? Set to true only once available.</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00142">AP_GPS.h:142</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_ad0ebe176090d273b59cad3e6d86fd416"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#ad0ebe176090d273b59cad3e6d86fd416">AP_GPS::GPS_State::horizontal_accuracy</a></div><div class="ttdeci">float horizontal_accuracy</div><div class="ttdoc">horizontal RMS accuracy estimate in m</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00138">AP_GPS.h:138</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_aa6b54a6f8a46a0418ae505a45480ff45"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#aa6b54a6f8a46a0418ae505a45480ff45">AP_GPS::GPS_State::ground_speed</a></div><div class="ttdeci">float ground_speed</div><div class="ttdoc">ground speed in m/sec</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00131">AP_GPS.h:131</a></div></div>
<div class="ttc" id="classAP__GPS_html_ad6736a9d4cbb5352caf3d76e4928a356"><div class="ttname"><a href="classAP__GPS.html#ad6736a9d4cbb5352caf3d76e4928a356">AP_GPS::calc_blend_weights</a></div><div class="ttdeci">bool calc_blend_weights(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l01176">AP_GPS.cpp:1176</a></div></div>
<div class="ttc" id="classAP__GPS_html_abbd67f2b9539b783cc40c5eb18f57077a77aec478494939b825c1105de409acbb"><div class="ttname"><a href="classAP__GPS.html#abbd67f2b9539b783cc40c5eb18f57077a77aec478494939b825c1105de409acbb">AP_GPS::GPS_AUTO_CONFIG_ENABLE</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00543">AP_GPS.h:543</a></div></div>
<div class="ttc" id="classAP__GPS_html_a7ac57480ec01621fe381383e91013716"><div class="ttname"><a href="classAP__GPS.html#a7ac57480ec01621fe381383e91013716">AP_GPS::_type</a></div><div class="ttdeci">AP_Int8 _type[GPS_MAX_RECEIVERS]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00410">AP_GPS.h:410</a></div></div>
<div class="ttc" id="AP__GPS_8cpp_html_a2f6d184a58b49c746340c1139bd6e0ea"><div class="ttname"><a href="AP__GPS_8cpp.html#a2f6d184a58b49c746340c1139bd6e0ea">GPS_BAUD_TIME_MS</a></div><div class="ttdeci">#define GPS_BAUD_TIME_MS</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00050">AP_GPS.cpp:50</a></div></div>
<div class="ttc" id="classAP__GPS_html_afe04427a47ab5e630cb979815abd911e"><div class="ttname"><a href="classAP__GPS.html#afe04427a47ab5e630cb979815abd911e">AP_GPS::update</a></div><div class="ttdeci">void update(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00677">AP_GPS.cpp:677</a></div></div>
<div class="ttc" id="classAP__GPS_html_a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb"><div class="ttname"><a href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a></div><div class="ttdoc">Receiving valid messages and 3D lock.</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00095">AP_GPS.h:95</a></div></div>
<div class="ttc" id="moduletest_8c_html_a903c4797a4c2860e3b9a6a978f98a44d"><div class="ttname"><a href="moduletest_8c.html#a903c4797a4c2860e3b9a6a978f98a44d">degrees</a></div><div class="ttdeci">#define degrees(x)</div><div class="ttdef"><b>Definition:</b> <a href="moduletest_8c_source.html#l00023">moduletest.c:23</a></div></div>
<div class="ttc" id="classLocation_html_a77ca1da10b7da6216bb6cf1253ed3dfc"><div class="ttname"><a href="classLocation.html#a77ca1da10b7da6216bb6cf1253ed3dfc">Location::get_distance_NED</a></div><div class="ttdeci">Vector3f get_distance_NED(const Location &amp;loc2) const</div><div class="ttdef"><b>Definition:</b> <a href="Location_8cpp_source.html#l00238">Location.cpp:238</a></div></div>
<div class="ttc" id="classAP__GPS_html_a9f5e2b62bdd0d4c6c24cba8e9941c1fb"><div class="ttname"><a href="classAP__GPS.html#a9f5e2b62bdd0d4c6c24cba8e9941c1fb">AP_GPS::first_unconfigured_gps</a></div><div class="ttdeci">uint8_t first_unconfigured_gps(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00982">AP_GPS.cpp:982</a></div></div>
<div class="ttc" id="classLocation_html"><div class="ttname"><a href="classLocation.html">Location</a></div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00009">Location.h:9</a></div></div>
<div class="ttc" id="classAP__GPS__Backend_html_a4da5fd4a69edd3a0a393e74cc0ca391a"><div class="ttname"><a href="classAP__GPS__Backend.html#a4da5fd4a69edd3a0a393e74cc0ca391a">AP_GPS_Backend::read</a></div><div class="ttdeci">virtual bool read()=0</div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_af5066cda264f04cf812a5ffdb8248e46"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#af5066cda264f04cf812a5ffdb8248e46">AP_GPS::GPS_State::vertical_accuracy</a></div><div class="ttdeci">float vertical_accuracy</div><div class="ttdoc">vertical RMS accuracy estimate in m</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00139">AP_GPS.h:139</a></div></div>
<div class="ttc" id="namespaceAP__HAL_html_a71832f03d849a0c088f04fc98d3c8143"><div class="ttname"><a href="namespaceAP__HAL.html#a71832f03d849a0c088f04fc98d3c8143">AP_HAL::panic</a></div><div class="ttdeci">void panic(const char *errormsg,...) FMT_PRINTF(1</div><div class="ttdef"><b>Definition:</b> <a href="ChibiOS_2system_8cpp_source.html#l00140">system.cpp:140</a></div></div>
<div class="ttc" id="classAP__GPS_html_ac9f4da4e698ba211f2323a9a6731826c"><div class="ttname"><a href="classAP__GPS.html#ac9f4da4e698ba211f2323a9a6731826c">AP_GPS::get_rate_ms</a></div><div class="ttdeci">uint16_t get_rate_ms(uint8_t instance) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l01164">AP_GPS.cpp:1164</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6ac02030cdc32f8c77fa5d3109f22ff324"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6ac02030cdc32f8c77fa5d3109f22ff324">AP_GPS::GPS_TYPE_MAV</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00086">AP_GPS.h:86</a></div></div>
<div class="ttc" id="classAP__GPS_html_a292dd764eb38dab205786a85e8ee7203"><div class="ttname"><a href="classAP__GPS.html#a292dd764eb38dab205786a85e8ee7203">AP_GPS::AP_GPS_NMEA</a></div><div class="ttdeci">friend class AP_GPS_NMEA</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00050">AP_GPS.h:50</a></div></div>
<div class="ttc" id="classAP__GPS_html_afa08eb7c0337c97e2ebab7e7c930423d"><div class="ttname"><a href="classAP__GPS.html#afa08eb7c0337c97e2ebab7e7c930423d">AP_GPS::vertical_accuracy</a></div><div class="ttdeci">bool vertical_accuracy(uint8_t instance, float &amp;vacc) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00345">AP_GPS.cpp:345</a></div></div>
<div class="ttc" id="classAP__GPS__SIRF_html_a99c1e4f27c9077aaadead6cc6ad031a0"><div class="ttname"><a href="classAP__GPS__SIRF.html#a99c1e4f27c9077aaadead6cc6ad031a0">AP_GPS_SIRF::_detect</a></div><div class="ttdeci">static bool _detect(struct SIRF_detect_state &amp;state, uint8_t data)</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS__SIRF_8cpp_source.html#l00202">AP_GPS_SIRF.cpp:202</a></div></div>
<div class="ttc" id="classAP__GPS__UAVCAN_html_ade4c203985a3afdadb840ea2ea24bfe8"><div class="ttname"><a href="classAP__GPS__UAVCAN.html#ade4c203985a3afdadb840ea2ea24bfe8">AP_GPS_UAVCAN::probe</a></div><div class="ttdeci">static AP_GPS_Backend * probe(AP_GPS &amp;_gps, AP_GPS::GPS_State &amp;_state)</div></div>
<div class="ttc" id="classAP__GPS_html_a4463d97bdd728f628ec944f39266376b"><div class="ttname"><a href="classAP__GPS.html#a4463d97bdd728f628ec944f39266376b">AP_GPS::_blended_lag_sec</a></div><div class="ttdeci">float _blended_lag_sec</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00525">AP_GPS.h:525</a></div></div>
<div class="ttc" id="RCProtocolDecoder_8cpp_html_a24dfbdba9f3f5edd317e77f9b6f9b6f5"><div class="ttname"><a href="RCProtocolDecoder_8cpp.html#a24dfbdba9f3f5edd317e77f9b6f9b6f5">baudrate</a></div><div class="ttdeci">const uint32_t baudrate</div><div class="ttdef"><b>Definition:</b> <a href="RCProtocolDecoder_8cpp_source.html#l00044">RCProtocolDecoder.cpp:44</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_ab346404b3a35776ea25982265c346974"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#ab346404b3a35776ea25982265c346974">AP_GPS::GPS_State::hdop</a></div><div class="ttdeci">uint16_t hdop</div><div class="ttdoc">horizontal dilution of precision in cm</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00133">AP_GPS.h:133</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6a8d6520721ac1203489b975cc09ef815e"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6a8d6520721ac1203489b975cc09ef815e">AP_GPS::GPS_TYPE_MTK19</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00077">AP_GPS.h:77</a></div></div>
<div class="ttc" id="classAP__GPS_html_abca09c2218f7fec3eef23679dead41b4"><div class="ttname"><a href="classAP__GPS.html#abca09c2218f7fec3eef23679dead41b4">AP_GPS::horizontal_accuracy</a></div><div class="ttdeci">bool horizontal_accuracy(uint8_t instance, float &amp;hacc) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l00336">AP_GPS.cpp:336</a></div></div>
<div class="ttc" id="classAP__GPS_html_a3a10458ee4c8a2d393668f1fa67e96c3"><div class="ttname"><a href="classAP__GPS.html#a3a10458ee4c8a2d393668f1fa67e96c3">AP_GPS::_NE_pos_offset_m</a></div><div class="ttdeci">Vector2f _NE_pos_offset_m[GPS_MAX_RECEIVERS]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00522">AP_GPS.h:522</a></div></div>
<div class="ttc" id="AHRS__Test_8cpp_html_a9fede12aaeb5750bcb131cae0430647c"><div class="ttname"><a href="AHRS__Test_8cpp.html#a9fede12aaeb5750bcb131cae0430647c">logger</a></div><div class="ttdeci">static AP_Logger logger</div><div class="ttdef"><b>Definition:</b> <a href="AHRS__Test_8cpp_source.html#l00029">AHRS_Test.cpp:29</a></div></div>
<div class="ttc" id="classAP__GPS_html_a6ea12f82bdeac194c101ce53c5ebf6bd"><div class="ttname"><a href="classAP__GPS.html#a6ea12f82bdeac194c101ce53c5ebf6bd">AP_GPS::_auto_switch</a></div><div class="ttdeci">AP_Int8 _auto_switch</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00412">AP_GPS.h:412</a></div></div>
<div class="ttc" id="AP__GPS__SBP_8h_html"><div class="ttname"><a href="AP__GPS__SBP_8h.html">AP_GPS_SBP.h</a></div></div>
<div class="ttc" id="namespaceAP_html_ac357c38b6638140c5510e6ba566b998b"><div class="ttname"><a href="namespaceAP.html#ac357c38b6638140c5510e6ba566b998b">AP::rtc</a></div><div class="ttdeci">AP_RTC &amp; rtc()</div><div class="ttdef"><b>Definition:</b> <a href="AP__RTC_8cpp_source.html#l00166">AP_RTC.cpp:166</a></div></div>
<div class="ttc" id="classAP__GPS_html_a5ec4e6f4bba7af336c54c75797148a38"><div class="ttname"><a href="classAP__GPS.html#a5ec4e6f4bba7af336c54c75797148a38">AP_GPS::_output_is_blended</a></div><div class="ttdeci">bool _output_is_blended</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00529">AP_GPS.h:529</a></div></div>
<div class="ttc" id="classAP__GPS_html_a4ff8670878e8371b8be04da456778045"><div class="ttname"><a href="classAP__GPS.html#a4ff8670878e8371b8be04da456778045">AP_GPS::_antenna_offset</a></div><div class="ttdeci">AP_Vector3f _antenna_offset[GPS_MAX_RECEIVERS]</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00424">AP_GPS.h:424</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00118">AP_Param.h:118</a></div></div>
<div class="ttc" id="AP__GPS_8h_html_a6012722790893e4ac6b414c0b2fcd2dd"><div class="ttname"><a href="AP__GPS_8h.html#a6012722790893e4ac6b414c0b2fcd2dd">GPS_MAX_RECEIVERS</a></div><div class="ttdeci">#define GPS_MAX_RECEIVERS</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00029">AP_GPS.h:29</a></div></div>
<div class="ttc" id="classLocation_html_ae51548c2cf32311043ca19b94b9a9223"><div class="ttname"><a href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">Location::lat</a></div><div class="ttdeci">int32_t lat</div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00021">Location.h:21</a></div></div>
<div class="ttc" id="classVector3_html_adf1769d5ee5df2f8585df2f540fa5efe"><div class="ttname"><a href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">Vector3::zero</a></div><div class="ttdeci">void zero()</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00188">vector3.h:188</a></div></div>
<div class="ttc" id="classVector3_html_a1a0f7e168c71ca798099f0ba8a444244"><div class="ttname"><a href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">Vector3::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00067">vector3.h:67</a></div></div>
<div class="ttc" id="classAP__SerialManager_html_a58cb32ebb77d9fc18e4756d0270d1970"><div class="ttname"><a href="classAP__SerialManager.html#a58cb32ebb77d9fc18e4756d0270d1970">AP_SerialManager::find_serial</a></div><div class="ttdeci">AP_HAL::UARTDriver * find_serial(enum SerialProtocol protocol, uint8_t instance) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__SerialManager_8cpp_source.html#l00389">AP_SerialManager.cpp:389</a></div></div>
<div class="ttc" id="classAP__GPS_html_aa6e8517c91f43e38d41af7cf338c8d4f"><div class="ttname"><a href="classAP__GPS.html#aa6e8517c91f43e38d41af7cf338c8d4f">AP_GPS::get_hdop</a></div><div class="ttdeci">uint16_t get_hdop() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00286">AP_GPS.h:286</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_a13d2ae016510be58fa8054f7d130d944"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#a13d2ae016510be58fa8054f7d130d944">AP_GPS::GPS_State::num_sats</a></div><div class="ttdeci">uint8_t num_sats</div><div class="ttdoc">Number of visible satellites.</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00135">AP_GPS.h:135</a></div></div>
<div class="ttc" id="classAP__GPS_html_aaeb8dc7cbdae6534526a00444a53cda1"><div class="ttname"><a href="classAP__GPS.html#aaeb8dc7cbdae6534526a00444a53cda1">AP_GPS::get_lag</a></div><div class="ttdeci">bool get_lag(uint8_t instance, float &amp;lag_sec) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8cpp_source.html#l01108">AP_GPS.cpp:1108</a></div></div>
<div class="ttc" id="classAP__Param_html_a5f6dcfce1c0a79cf5bd81283e22f3201"><div class="ttname"><a href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a></div><div class="ttdeci">static void setup_object_defaults(const void *object_pointer, const struct GroupInfo *group_info)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8cpp_source.html#l01265">AP_Param.cpp:1265</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_aef86178057c2197396dfd8836bf8e1b5"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#aef86178057c2197396dfd8836bf8e1b5">AP_GPS::GPS_State::have_speed_accuracy</a></div><div class="ttdeci">bool have_speed_accuracy</div><div class="ttdoc">does GPS give speed accuracy? Set to true only once available.</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00141">AP_GPS.h:141</a></div></div>
<div class="ttc" id="structAP__GPS_1_1GPS__State_html_a037e16c03fbb1091bec680ef2dfc73c7"><div class="ttname"><a href="structAP__GPS_1_1GPS__State.html#a037e16c03fbb1091bec680ef2dfc73c7">AP_GPS::GPS_State::ground_course</a></div><div class="ttdeci">float ground_course</div><div class="ttdoc">ground course in degrees</div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00132">AP_GPS.h:132</a></div></div>
<div class="ttc" id="AP__GPS__SBF_8h_html"><div class="ttname"><a href="AP__GPS__SBF_8h.html">AP_GPS_SBF.h</a></div></div>
<div class="ttc" id="classAP__GPS_html_ae4b5ac77aca03dd3d3f327f016c7e1e6acb925988f6661c9552b576d7078f8ca1"><div class="ttname"><a href="classAP__GPS.html#ae4b5ac77aca03dd3d3f327f016c7e1e6acb925988f6661c9552b576d7078f8ca1">AP_GPS::GPS_TYPE_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__GPS_8h_source.html#l00073">AP_GPS.h:73</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 11 2019 14:17:27 for APM:Libraries by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
