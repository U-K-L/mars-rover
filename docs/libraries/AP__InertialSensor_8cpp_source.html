<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AP_InertialSensor/AP_InertialSensor.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_f8d151dc119ef4d37afa003c944b490a.html">AP_InertialSensor</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AP_InertialSensor.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AP__InertialSensor_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Common_8h.html">AP_Common/AP_Common.h</a>&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL/AP_HAL.h</a>&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="I2CDevice_8h.html">AP_HAL/I2CDevice.h</a>&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="SPIDevice_8h.html">AP_HAL/SPIDevice.h</a>&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Math_8h.html">AP_Math/AP_Math.h</a>&gt;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Notify_8h.html">AP_Notify/AP_Notify.h</a>&gt;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Vehicle_8h.html">AP_Vehicle/AP_Vehicle.h</a>&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__BoardConfig_8h.html">AP_BoardConfig/AP_BoardConfig.h</a>&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__AHRS_8h.html">AP_AHRS/AP_AHRS.h</a>&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__InertialSensor_8h.html">AP_InertialSensor.h</a>&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__InertialSensor__BMI160_8h.html">AP_InertialSensor_BMI160.h</a>&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__InertialSensor__Backend_8h.html">AP_InertialSensor_Backend.h</a>&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__InertialSensor__HIL_8h.html">AP_InertialSensor_HIL.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__InertialSensor__L3G4200D_8h.html">AP_InertialSensor_L3G4200D.h</a>&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__InertialSensor__LSM9DS0_8h.html">AP_InertialSensor_LSM9DS0.h</a>&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__InertialSensor__LSM9DS1_8h.html">AP_InertialSensor_LSM9DS1.h</a>&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__InertialSensor__Invensense_8h.html">AP_InertialSensor_Invensense.h</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__InertialSensor__SITL_8h.html">AP_InertialSensor_SITL.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__InertialSensor__RST_8h.html">AP_InertialSensor_RST.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__InertialSensor__BMI055_8h.html">AP_InertialSensor_BMI055.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__InertialSensor__BMI088_8h.html">AP_InertialSensor_BMI088.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__InertialSensor__Invensensev2_8h.html">AP_InertialSensor_Invensensev2.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/* Define INS_TIMING_DEBUG to track down scheduling issues with the main loop.</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * Output is on the debug console. */</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#ifdef INS_TIMING_DEBUG</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="stdio_8h.html">stdio.h</a>&gt;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#define timing_printf(fmt, args...)      do { printf(&quot;[timing] &quot; fmt, ##args); } while(0)</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="AP__InertialSensor_8cpp.html#ac4110b4ae0e9c8b457c658eb451b609a">   33</a></span>&#160;<span class="preprocessor">#define timing_printf(fmt, args...)</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#ifndef HAL_DEFAULT_INS_FAST_SAMPLE</span></div><div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="AP__InertialSensor_8cpp.html#a8d2276f62dc5754534bdd115338901b9">   37</a></span>&#160;<span class="preprocessor">#define HAL_DEFAULT_INS_FAST_SAMPLE 0</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">extern</span> <span class="keyword">const</span> <a class="code" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#if APM_BUILD_TYPE(APM_BUILD_ArduCopter)</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#define DEFAULT_GYRO_FILTER  20</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#define DEFAULT_ACCEL_FILTER 20</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#define DEFAULT_STILL_THRESH 2.5f</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#elif APM_BUILD_TYPE(APM_BUILD_APMrover2)</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#define DEFAULT_GYRO_FILTER  4</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#define DEFAULT_ACCEL_FILTER 10</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#define DEFAULT_STILL_THRESH 0.1f</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="AP__InertialSensor_8cpp.html#af4a066a134904eedd6821d1ef69cc670">   51</a></span>&#160;<span class="preprocessor">#define DEFAULT_GYRO_FILTER  20</span></div><div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="AP__InertialSensor_8cpp.html#a06321f4a07a1e343662fa804bb402a7e">   52</a></span>&#160;<span class="preprocessor">#define DEFAULT_ACCEL_FILTER 20</span></div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="AP__InertialSensor_8cpp.html#ad6f60bd0f3351db9206a7a2ef7cf32d6">   53</a></span>&#160;<span class="preprocessor">#define DEFAULT_STILL_THRESH 0.1f</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="AP__InertialSensor_8cpp.html#ab77c7f2045f6bfcbee8a26b399308ccc">   56</a></span>&#160;<span class="preprocessor">#define SAMPLE_UNIT 1</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="AP__InertialSensor_8cpp.html#a247ced13b73525611d4dbefe67eb4915">   58</a></span>&#160;<span class="preprocessor">#define GYRO_INIT_MAX_DIFF_DPS 0.1f</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">// Class level parameters</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keyword">const</span> <a class="code" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code" href="classAP__InertialSensor.html#ab35eaddc8ca7c3a67c7b43228f46ead2">AP_InertialSensor::var_info</a>[] = {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// 0 was PRODUCT_ID</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">      The following parameter indexes and reserved from previous use</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">      as accel offsets and scaling from before the 16g change in the</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">      PX4 backend:</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">      ACCSCAL : 1</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">      ACCOFFS : 2</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">      MPU6K_FILTER: 4</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">      ACC2SCAL : 5</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">      ACC2OFFS : 6</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">      ACC3SCAL : 8</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">      ACC3OFFS : 9</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">      CALSENSFRAME : 11</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// @Param: GYROFFS_X</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// @DisplayName: Gyro offsets of X axis</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// @Description: Gyro sensor offsets of X axis. This is setup on each boot during gyro calibrations</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// @Units: rad/s</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// @Param: GYROFFS_Y</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// @DisplayName: Gyro offsets of Y axis</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// @Description: Gyro sensor offsets of Y axis. This is setup on each boot during gyro calibrations</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// @Units: rad/s</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// @Param: GYROFFS_Z</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// @DisplayName: Gyro offsets of Z axis</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">// @Description: Gyro sensor offsets of Z axis. This is setup on each boot during gyro calibrations</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">// @Units: rad/s</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GYROFFS&quot;</span>,     3, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _gyro_offset[0],  0),</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">// @Param: GYR2OFFS_X</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">// @DisplayName: Gyro2 offsets of X axis</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// @Description: Gyro2 sensor offsets of X axis. This is setup on each boot during gyro calibrations</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// @Units: rad/s</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">// @Param: GYR2OFFS_Y</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">// @DisplayName: Gyro2 offsets of Y axis</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">// @Description: Gyro2 sensor offsets of Y axis. This is setup on each boot during gyro calibrations</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// @Units: rad/s</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// @Param: GYR2OFFS_Z</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// @DisplayName: Gyro2 offsets of Z axis</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">// @Description: Gyro2 sensor offsets of Z axis. This is setup on each boot during gyro calibrations</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">// @Units: rad/s</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GYR2OFFS&quot;</span>,    7, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _gyro_offset[1],   0),</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// @Param: GYR3OFFS_X</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// @DisplayName: Gyro3 offsets of X axis</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// @Description: Gyro3 sensor offsets of X axis. This is setup on each boot during gyro calibrations</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// @Units: rad/s</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">// @Param: GYR3OFFS_Y</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">// @DisplayName: Gyro3 offsets of Y axis</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// @Description: Gyro3 sensor offsets of Y axis. This is setup on each boot during gyro calibrations</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">// @Units: rad/s</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// @Param: GYR3OFFS_Z</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">// @DisplayName: Gyro3 offsets of Z axis</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// @Description: Gyro3 sensor offsets of Z axis. This is setup on each boot during gyro calibrations</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// @Units: rad/s</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GYR3OFFS&quot;</span>,   10, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _gyro_offset[2],   0),</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// @Param: ACCSCAL_X</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">// @DisplayName: Accelerometer scaling of X axis</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// @Description: Accelerometer scaling of X axis.  Calculated during acceleration calibration routine</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// @Range: 0.8 1.2</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// @Param: ACCSCAL_Y</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// @DisplayName: Accelerometer scaling of Y axis</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">// @Description: Accelerometer scaling of Y axis  Calculated during acceleration calibration routine</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">// @Range: 0.8 1.2</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">// @Param: ACCSCAL_Z</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="comment">// @DisplayName: Accelerometer scaling of Z axis</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// @Description: Accelerometer scaling of Z axis  Calculated during acceleration calibration routine</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">// @Range: 0.8 1.2</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ACCSCAL&quot;</span>,     12, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _accel_scale[0],  0),</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// @Param: ACCOFFS_X</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">// @DisplayName: Accelerometer offsets of X axis</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// @Description: Accelerometer offsets of X axis. This is setup using the acceleration calibration or level operations</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// @Units: m/s/s</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// @Range: -3.5 3.5</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">// @Param: ACCOFFS_Y</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// @DisplayName: Accelerometer offsets of Y axis</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">// @Description: Accelerometer offsets of Y axis. This is setup using the acceleration calibration or level operations</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// @Units: m/s/s</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// @Range: -3.5 3.5</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">// @Param: ACCOFFS_Z</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">// @DisplayName: Accelerometer offsets of Z axis</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// @Description: Accelerometer offsets of Z axis. This is setup using the acceleration calibration or level operations</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// @Units: m/s/s</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">// @Range: -3.5 3.5</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ACCOFFS&quot;</span>,     13, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _accel_offset[0], 0),</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">// @Param: ACC2SCAL_X</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">// @DisplayName: Accelerometer2 scaling of X axis</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">// @Description: Accelerometer2 scaling of X axis.  Calculated during acceleration calibration routine</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">// @Range: 0.8 1.2</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// @Param: ACC2SCAL_Y</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="comment">// @DisplayName: Accelerometer2 scaling of Y axis</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">// @Description: Accelerometer2 scaling of Y axis  Calculated during acceleration calibration routine</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">// @Range: 0.8 1.2</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">// @Param: ACC2SCAL_Z</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// @DisplayName: Accelerometer2 scaling of Z axis</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// @Description: Accelerometer2 scaling of Z axis  Calculated during acceleration calibration routine</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">// @Range: 0.8 1.2</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ACC2SCAL&quot;</span>,    14, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _accel_scale[1],   0),</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">// @Param: ACC2OFFS_X</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// @DisplayName: Accelerometer2 offsets of X axis</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// @Description: Accelerometer2 offsets of X axis. This is setup using the acceleration calibration or level operations</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">// @Units: m/s/s</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// @Range: -3.5 3.5</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// @Param: ACC2OFFS_Y</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// @DisplayName: Accelerometer2 offsets of Y axis</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// @Description: Accelerometer2 offsets of Y axis. This is setup using the acceleration calibration or level operations</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// @Units: m/s/s</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// @Range: -3.5 3.5</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// @Param: ACC2OFFS_Z</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">// @DisplayName: Accelerometer2 offsets of Z axis</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// @Description: Accelerometer2 offsets of Z axis. This is setup using the acceleration calibration or level operations</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// @Units: m/s/s</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">// @Range: -3.5 3.5</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ACC2OFFS&quot;</span>,    15, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _accel_offset[1],  0),</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// @Param: ACC3SCAL_X</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">// @DisplayName: Accelerometer3 scaling of X axis</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">// @Description: Accelerometer3 scaling of X axis.  Calculated during acceleration calibration routine</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment">// @Range: 0.8 1.2</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">// @Param: ACC3SCAL_Y</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">// @DisplayName: Accelerometer3 scaling of Y axis</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">// @Description: Accelerometer3 scaling of Y axis  Calculated during acceleration calibration routine</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// @Range: 0.8 1.2</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="comment">// @Param: ACC3SCAL_Z</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// @DisplayName: Accelerometer3 scaling of Z axis</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// @Description: Accelerometer3 scaling of Z axis  Calculated during acceleration calibration routine</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// @Range: 0.8 1.2</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ACC3SCAL&quot;</span>,    16, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _accel_scale[2],   0),</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">// @Param: ACC3OFFS_X</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">// @DisplayName: Accelerometer3 offsets of X axis</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">// @Description: Accelerometer3 offsets of X axis. This is setup using the acceleration calibration or level operations</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">// @Units: m/s/s</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">// @Range: -3.5 3.5</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// @Param: ACC3OFFS_Y</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">// @DisplayName: Accelerometer3 offsets of Y axis</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">// @Description: Accelerometer3 offsets of Y axis. This is setup using the acceleration calibration or level operations</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// @Units: m/s/s</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="comment">// @Range: -3.5 3.5</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="comment">// @Param: ACC3OFFS_Z</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">// @DisplayName: Accelerometer3 offsets of Z axis</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="comment">// @Description: Accelerometer3 offsets of Z axis. This is setup using the acceleration calibration or level operations</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// @Units: m/s/s</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="comment">// @Range: -3.5 3.5</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ACC3OFFS&quot;</span>,    17, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _accel_offset[2],  0),</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// @Param: GYRO_FILTER</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">// @DisplayName: Gyro filter cutoff frequency</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">// @Description: Filter cutoff frequency for gyroscopes. This can be set to a lower value to try to cope with very high vibration levels in aircraft. This option takes effect on the next reboot. A value of zero means no filtering (not recommended!)</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">// @Units: Hz</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">// @Range: 0 256</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GYRO_FILTER&quot;</span>, 18, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _gyro_filter_cutoff,  <a class="code" href="AP__InertialSensor_8cpp.html#af4a066a134904eedd6821d1ef69cc670">DEFAULT_GYRO_FILTER</a>),</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">// @Param: ACCEL_FILTER</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">// @DisplayName: Accel filter cutoff frequency</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="comment">// @Description: Filter cutoff frequency for accelerometers. This can be set to a lower value to try to cope with very high vibration levels in aircraft. This option takes effect on the next reboot. A value of zero means no filtering (not recommended!)</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">// @Units: Hz</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// @Range: 0 256</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ACCEL_FILTER&quot;</span>, 19, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _accel_filter_cutoff,  <a class="code" href="AP__InertialSensor_8cpp.html#a06321f4a07a1e343662fa804bb402a7e">DEFAULT_ACCEL_FILTER</a>),</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">// @Param: USE</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="comment">// @DisplayName: Use first IMU for attitude, velocity and position estimates</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="comment">// @Description: Use first IMU for attitude, velocity and position estimates</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">// @Values: 0:Disabled,1:Enabled</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;USE&quot;</span>, 20, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _use[0],  1),</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// @Param: USE2</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// @DisplayName: Use second IMU for attitude, velocity and position estimates</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// @Description: Use second IMU for attitude, velocity and position estimates</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">// @Values: 0:Disabled,1:Enabled</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;USE2&quot;</span>, 21, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _use[1],  1),</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="comment">// @Param: USE3</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">// @DisplayName: Use third IMU for attitude, velocity and position estimates</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment">// @Description: Use third IMU for attitude, velocity and position estimates</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">// @Values: 0:Disabled,1:Enabled</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;USE3&quot;</span>, 22, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _use[2],  0),</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// @Param: STILL_THRESH</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">// @DisplayName: Stillness threshold for detecting if we are moving</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// @Description: Threshold to tolerate vibration to determine if vehicle is motionless. This depends on the frame type and if there is a constant vibration due to motors before launch or after landing. Total motionless is about 0.05. Suggested values: Planes/rover use 0.1, multirotors use 1, tradHeli uses 5</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// @Range: 0.05 50</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;STILL_THRESH&quot;</span>, 23, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _still_threshold,  <a class="code" href="AP__InertialSensor_8cpp.html#ad6f60bd0f3351db9206a7a2ef7cf32d6">DEFAULT_STILL_THRESH</a>),</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">// @Param: GYR_CAL</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// @DisplayName: Gyro Calibration scheme</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">// @Description: Conrols when automatic gyro calibration is performed</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">// @Values: 0:Never, 1:Start-up only</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GYR_CAL&quot;</span>, 24, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _gyro_cal_timing, 1),</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="comment">// @Param: TRIM_OPTION</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">// @DisplayName: Accel cal trim option</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">// @Description: Specifies how the accel cal routine determines the trims</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">// @Values: 0:Don&#39;t adjust the trims,1:Assume first orientation was level,2:Assume ACC_BODYFIX is perfectly aligned to the vehicle</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TRIM_OPTION&quot;</span>, 25, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _trim_option, 1),</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="comment">// @Param: ACC_BODYFIX</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="comment">// @DisplayName: Body-fixed accelerometer</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">// @Description: The body-fixed accelerometer to be used for trim calculation</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// @Values: 1:IMU 1,2:IMU 2,3:IMU 3</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ACC_BODYFIX&quot;</span>, 26, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _acc_body_aligned, 2),</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">// @Param: POS1_X</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="comment">// @DisplayName: IMU accelerometer X position</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">// @Description: X position of the first IMU Accelerometer in body frame. Positive X is forward of the origin. Attention: The IMU should be located as close to the vehicle c.g. as practical so that the value of this parameter is minimised. Failure to do so can result in noisy navigation velocity measurements due to vibration and IMU gyro noise. If the IMU cannot be moved and velocity noise is a problem, a location closer to the IMU can be used as the body frame origin.</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">// @Param: POS1_Y</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// @DisplayName: IMU accelerometer Y position</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="comment">// @Description: Y position of the first IMU accelerometer in body frame. Positive Y is to the right of the origin. Attention: The IMU should be located as close to the vehicle c.g. as practical so that the value of this parameter is minimised. Failure to do so can result in noisy navigation velocity measurements due to vibration and IMU gyro noise. If the IMU cannot be moved and velocity noise is a problem, a location closer to the IMU can be used as the body frame origin.</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">// @Param: POS1_Z</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="comment">// @DisplayName: IMU accelerometer Z position</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">// @Description: Z position of the first IMU accelerometer in body frame. Positive Z is down from the origin. Attention: The IMU should be located as close to the vehicle c.g. as practical so that the value of this parameter is minimised. Failure to do so can result in noisy navigation velocity measurements due to vibration and IMU gyro noise. If the IMU cannot be moved and velocity noise is a problem, a location closer to the IMU can be used as the body frame origin.</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;POS1&quot;</span>, 27, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _accel_pos[0], 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">// @Param: POS2_X</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="comment">// @DisplayName: IMU accelerometer X position</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">// @Description: X position of the second IMU accelerometer in body frame. Positive X is forward of the origin. Attention: The IMU should be located as close to the vehicle c.g. as practical so that the value of this parameter is minimised. Failure to do so can result in noisy navigation velocity measurements due to vibration and IMU gyro noise. If the IMU cannot be moved and velocity noise is a problem, a location closer to the IMU can be used as the body frame origin.</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">// @Param: POS2_Y</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">// @DisplayName: IMU accelerometer Y position</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">// @Description: Y position of the second IMU accelerometer in body frame. Positive Y is to the right of the origin. Attention: The IMU should be located as close to the vehicle c.g. as practical so that the value of this parameter is minimised. Failure to do so can result in noisy navigation velocity measurements due to vibration and IMU gyro noise. If the IMU cannot be moved and velocity noise is a problem, a location closer to the IMU can be used as the body frame origin.</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">// @Param: POS2_Z</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// @DisplayName: IMU accelerometer Z position</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="comment">// @Description: Z position of the second IMU accelerometer in body frame. Positive Z is down from the origin. Attention: The IMU should be located as close to the vehicle c.g. as practical so that the value of this parameter is minimised. Failure to do so can result in noisy navigation velocity measurements due to vibration and IMU gyro noise. If the IMU cannot be moved and velocity noise is a problem, a location closer to the IMU can be used as the body frame origin.</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;POS2&quot;</span>, 28, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _accel_pos[1], 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="comment">// @Param: POS3_X</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="comment">// @DisplayName: IMU accelerometer X position</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">// @Description: X position of the third IMU accelerometer in body frame. Positive X is forward of the origin. Attention: The IMU should be located as close to the vehicle c.g. as practical so that the value of this parameter is minimised. Failure to do so can result in noisy navigation velocity measurements due to vibration and IMU gyro noise. If the IMU cannot be moved and velocity noise is a problem, a location closer to the IMU can be used as the body frame origin.</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="comment">// @Param: POS3_Y</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="comment">// @DisplayName: IMU accelerometer Y position</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment">// @Description: Y position of the third IMU accelerometer in body frame. Positive Y is to the right of the origin. Attention: The IMU should be located as close to the vehicle c.g. as practical so that the value of this parameter is minimised. Failure to do so can result in noisy navigation velocity measurements due to vibration and IMU gyro noise. If the IMU cannot be moved and velocity noise is a problem, a location closer to the IMU can be used as the body frame origin.</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="comment">// @Param: POS3_Z</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="comment">// @DisplayName: IMU accelerometer Z position</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="comment">// @Description: Z position of the third IMU accelerometer in body frame. Positive Z is down from the origin. Attention: The IMU should be located as close to the vehicle c.g. as practical so that the value of this parameter is minimised. Failure to do so can result in noisy navigation velocity measurements due to vibration and IMU gyro noise. If the IMU cannot be moved and velocity noise is a problem, a location closer to the IMU can be used as the body frame origin.</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">// @Units: m</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="comment">// @Range: -10 10</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;POS3&quot;</span>, 29, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _accel_pos[2], 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">// @Param: GYR_ID</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">// @DisplayName: Gyro ID</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">// @Description: Gyro sensor ID, taking into account its type, bus and instance</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="comment">// @ReadOnly: True</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GYR_ID&quot;</span>, 30, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _gyro_id[0], 0),</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="comment">// @Param: GYR2_ID</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="comment">// @DisplayName: Gyro2 ID</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">// @Description: Gyro2 sensor ID, taking into account its type, bus and instance</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">// @ReadOnly: True</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GYR2_ID&quot;</span>, 31, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _gyro_id[1], 0),</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="comment">// @Param: GYR3_ID</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="comment">// @DisplayName: Gyro3 ID</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="comment">// @Description: Gyro3 sensor ID, taking into account its type, bus and instance</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="comment">// @ReadOnly: True</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GYR3_ID&quot;</span>, 32, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _gyro_id[2], 0),</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">// @Param: ACC_ID</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="comment">// @DisplayName: Accelerometer ID</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="comment">// @Description: Accelerometer sensor ID, taking into account its type, bus and instance</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">// @ReadOnly: True</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ACC_ID&quot;</span>, 33, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _accel_id[0], 0),</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="comment">// @Param: ACC2_ID</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="comment">// @DisplayName: Accelerometer2 ID</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">// @Description: Accelerometer2 sensor ID, taking into account its type, bus and instance</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">// @ReadOnly: True</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ACC2_ID&quot;</span>, 34, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _accel_id[1], 0),</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="comment">// @Param: ACC3_ID</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment">// @DisplayName: Accelerometer3 ID</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// @Description: Accelerometer3 sensor ID, taking into account its type, bus and instance</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="comment">// @ReadOnly: True</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ACC3_ID&quot;</span>, 35, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _accel_id[2], 0),</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="comment">// @Param: FAST_SAMPLE</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="comment">// @DisplayName: Fast sampling mask</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="comment">// @Description: Mask of IMUs to enable fast sampling on, if available</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment">// @Values: 1:FirstIMUOnly,3:FirstAndSecondIMU</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// @Bitmask: 0:FirstIMU,1:SecondIMU,2:ThirdIMU</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;FAST_SAMPLE&quot;</span>,  36, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _fast_sampling_mask,   <a class="code" href="AP__InertialSensor_8cpp.html#a8d2276f62dc5754534bdd115338901b9">HAL_DEFAULT_INS_FAST_SAMPLE</a>),</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">// @Group: NOTCH_</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// @Path: ../Filter/NotchFilter.cpp</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <a class="code" href="AP__Param_8h.html#a16c360358c5d6a08d34f60921fd916a9">AP_SUBGROUPINFO</a>(_notch_filter, <span class="stringliteral">&quot;NOTCH_&quot;</span>,  37, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, <a class="code" href="classNotchFilterParams.html">NotchFilterParams</a>),</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">// @Group: LOG_</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">// @Path: ../AP_InertialSensor/BatchSampler.cpp</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="AP__Param_8h.html#a16c360358c5d6a08d34f60921fd916a9">AP_SUBGROUPINFO</a>(batchsampler, <span class="stringliteral">&quot;LOG_&quot;</span>,  39, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, <a class="code" href="classAP__InertialSensor_1_1BatchSampler.html">AP_InertialSensor::BatchSampler</a>),</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// @Param: ENABLE_MASK</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">// @DisplayName: IMU enable mask</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="comment">// @Description: Bitmask of IMUs to enable. It can be used to prevent startup of specific detected IMUs</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="comment">// @Values: 1:FirstIMUOnly,3:FirstAndSecondIMU,7:FirstSecondAndThirdIMU,127:AllIMUs</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">// @Bitmask: 0:FirstIMU,1:SecondIMU,2:ThirdIMU</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ENABLE_MASK&quot;</span>,  40, <a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a>, _enable_mask, 0x7F),</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">      NOTE: parameter indexes have gaps above. When adding new</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">      parameters check for conflicts carefully</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <a class="code" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;};</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a> *<a class="code" href="classAP__InertialSensor.html#a34c168ea29e2735ba19996be7f4157db">AP_InertialSensor::_singleton</a> = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#affc63e7edc9be1b0e128b8da3b8a24a5">  465</a></span>&#160;<a class="code" href="classAP__InertialSensor.html#affc63e7edc9be1b0e128b8da3b8a24a5">AP_InertialSensor::AP_InertialSensor</a>() :</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    _board_orientation(<a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>),</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    _log_raw_bit(-1)</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;{</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a34c168ea29e2735ba19996be7f4157db">_singleton</a>) {</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <a class="code" href="namespaceAP__HAL.html#a71832f03d849a0c088f04fc98d3c8143">AP_HAL::panic</a>(<span class="stringliteral">&quot;Too many inertial sensors&quot;</span>);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a34c168ea29e2735ba19996be7f4157db">_singleton</a> = <span class="keyword">this</span>;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <a class="code" href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a>(<span class="keyword">this</span>, <a class="code" href="classAP__InertialSensor.html#ab35eaddc8ca7c3a67c7b43228f46ead2">var_info</a>);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <a class="code" href="classAP__InertialSensor.html#aa8ac7e294cc5ed4ea30ab1fd5e1b6637">_gyro_cal_ok</a>[i] = <span class="keyword">true</span>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <a class="code" href="classAP__InertialSensor.html#aed30141c5e8d9d5c169767fd22dc41f5">_accel_max_abs_offsets</a>[i] = 3.5f;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    }</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__InertialSensor_8h.html#a04f48700bcfc9677a766c604968798c3">INS_VIBRATION_CHECK_INSTANCES</a>; i++) {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a4510aa7e7f3bac446f03004c9dda84f8">_accel_vibe_floor_filter</a>[i].<a class="code" href="classLowPassFilter.html#a1cc5016de137b01080fa0a6fa7fe53cd">set_cutoff_frequency</a>(<a class="code" href="AP__InertialSensor_8h.html#ae0157c09727f80cd50830cb24bbc8273">AP_INERTIAL_SENSOR_ACCEL_VIBE_FLOOR_FILT_HZ</a>);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ae686d41dc8123df61020bbfabc10901c">_accel_vibe_filter</a>[i].<a class="code" href="classLowPassFilter.html#a1cc5016de137b01080fa0a6fa7fe53cd">set_cutoff_frequency</a>(<a class="code" href="AP__InertialSensor_8h.html#afcd4264ce23e4fa475c75928ed9c598b">AP_INERTIAL_SENSOR_ACCEL_VIBE_FILT_HZ</a>);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <a class="code" href="classAP__AccelCal.html#a6ecd2cc4987ebcec35f59a538a131ace">AP_AccelCal::register_client</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;}</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment"> * Get the AP_InertialSensor singleton</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00489"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a2cf12201d711e4712a62ad10893be06f">  489</a></span>&#160;<a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a> *<a class="code" href="classAP__InertialSensor.html#a2cf12201d711e4712a62ad10893be06f">AP_InertialSensor::get_singleton</a>()</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;{</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__InertialSensor.html#a34c168ea29e2735ba19996be7f4157db">_singleton</a>) {</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a34c168ea29e2735ba19996be7f4157db">_singleton</a> = <span class="keyword">new</span> <a class="code" href="classAP__InertialSensor.html#affc63e7edc9be1b0e128b8da3b8a24a5">AP_InertialSensor</a>();</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    }</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classAP__InertialSensor.html#a34c168ea29e2735ba19996be7f4157db">_singleton</a>;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;}</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">  register a new gyro instance</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#aa112654466199fa7ba51b2471fefdbd7">  500</a></span>&#160;uint8_t <a class="code" href="classAP__InertialSensor.html#aa112654466199fa7ba51b2471fefdbd7">AP_InertialSensor::register_gyro</a>(uint16_t raw_sample_rate_hz,</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                                         uint32_t <span class="keywordtype">id</span>)</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;{</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a> == <a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>) {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <a class="code" href="namespaceAP__HAL.html#a71832f03d849a0c088f04fc98d3c8143">AP_HAL::panic</a>(<span class="stringliteral">&quot;Too many gyros&quot;</span>);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a15ced8f1e0dbe86237e36ca779ad90a3">_gyro_raw_sample_rates</a>[<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a>] = raw_sample_rate_hz;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a5974df880b2e2c6d45d5d12fbbb89438">_gyro_over_sampling</a>[<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a>] = 1;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a3173db0aeafd301342cde164cec5f8f8">_gyro_raw_sampling_multiplier</a>[<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a>] = INT16_MAX/<a class="code" href="AP__Math_8h.html#a37d7c62a8231d9d22826261297b99da4">radians</a>(2000);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordtype">bool</span> saved = <a class="code" href="classAP__InertialSensor.html#a2a90b36730b6afd50a7f335537bd1b17">_gyro_id</a>[<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a>].load();</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">if</span> (saved &amp;&amp; (uint32_t)<a class="code" href="classAP__InertialSensor.html#a2a90b36730b6afd50a7f335537bd1b17">_gyro_id</a>[<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a>] != <span class="keywordtype">id</span>) {</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="comment">// inconsistent gyro id - mark it as needing calibration</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <a class="code" href="classAP__InertialSensor.html#aa8ac7e294cc5ed4ea30ab1fd5e1b6637">_gyro_cal_ok</a>[<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a>] = <span class="keyword">false</span>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    }</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a2a90b36730b6afd50a7f335537bd1b17">_gyro_id</a>[<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a>].set((int32_t) <span class="keywordtype">id</span>);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="preprocessor">#if CONFIG_HAL_BOARD == HAL_BOARD_SITL</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">if</span> (!saved) {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="comment">// assume this is the same sensor and save its ID to allow seamless</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="comment">// transition from when we didn&#39;t have the IDs.</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a2a90b36730b6afd50a7f335537bd1b17">_gyro_id</a>[<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a>].save();</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a>++;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;}</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">  register a new accel instance</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00534"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a17706ae4e3ef55200ee8b1e5c4ead7ec">  534</a></span>&#160;uint8_t <a class="code" href="classAP__InertialSensor.html#a17706ae4e3ef55200ee8b1e5c4ead7ec">AP_InertialSensor::register_accel</a>(uint16_t raw_sample_rate_hz,</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                                          uint32_t <span class="keywordtype">id</span>)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;{</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a> == <a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>) {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <a class="code" href="namespaceAP__HAL.html#a71832f03d849a0c088f04fc98d3c8143">AP_HAL::panic</a>(<span class="stringliteral">&quot;Too many accels&quot;</span>);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    }</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <a class="code" href="classAP__InertialSensor.html#ab8532b92ae038d4f09ee5d9bd7de46aa">_accel_raw_sample_rates</a>[<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>] = raw_sample_rate_hz;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <a class="code" href="classAP__InertialSensor.html#abd23ac7f70eec1af0ab2f43c9dcd3f0d">_accel_over_sampling</a>[<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>] = 1;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <a class="code" href="classAP__InertialSensor.html#abf39b6e98861f769d6c2646ac3a13521">_accel_raw_sampling_multiplier</a>[<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>] = INT16_MAX/(16*<a class="code" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordtype">bool</span> saved = <a class="code" href="classAP__InertialSensor.html#ada31f9669cfd8503daf08aa0a7f3f77f">_accel_id</a>[<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>].load();</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordflow">if</span> (!saved) {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="comment">// inconsistent accel id</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ae840940f433011c353a91fa25ce1e197">_accel_id_ok</a>[<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>] = <span class="keyword">false</span>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((uint32_t)<a class="code" href="classAP__InertialSensor.html#ada31f9669cfd8503daf08aa0a7f3f77f">_accel_id</a>[<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>] != <span class="keywordtype">id</span>) {</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="comment">// inconsistent accel id</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ae840940f433011c353a91fa25ce1e197">_accel_id_ok</a>[<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>] = <span class="keyword">false</span>;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ae840940f433011c353a91fa25ce1e197">_accel_id_ok</a>[<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>] = <span class="keyword">true</span>;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <a class="code" href="classAP__InertialSensor.html#ada31f9669cfd8503daf08aa0a7f3f77f">_accel_id</a>[<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>].set((int32_t) <span class="keywordtype">id</span>);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="preprocessor">#if CONFIG_HAL_BOARD == HAL_BOARD_SITL</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="comment">// assume this is the same sensor and save its ID to allow seamless</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="comment">// transition from when we didn&#39;t have the IDs.</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ae840940f433011c353a91fa25ce1e197">_accel_id_ok</a>[<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>] = <span class="keyword">true</span>;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ada31f9669cfd8503daf08aa0a7f3f77f">_accel_id</a>[<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>].save();</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>++;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;}</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment"> * Start all backends for gyro and accel measurements. It automatically calls</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment"> * detect_backends() if it has not been called already.</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00573"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a9949b7e301b0d7a5f3e59385d2e8d97a">  573</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#a9949b7e301b0d7a5f3e59385d2e8d97a">AP_InertialSensor::_start_backends</a>()</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;{</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a8967734e82a4f472c6d8ddd8db656804">detect_backends</a>();</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="classAP__InertialSensor.html#ab3bcaab30548484fd68e7f7af05f4a86">_backend_count</a>; i++) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a1d9040309bd3ba359b20b90f4a836531">_backends</a>[i]-&gt;<a class="code" href="classAP__InertialSensor__Backend.html#a359c6b8d74c13e735210d3602d793215">start</a>();</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a> == 0 || <a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a> == 0) {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <a class="code" href="namespaceAP__HAL.html#a71832f03d849a0c088f04fc98d3c8143">AP_HAL::panic</a>(<span class="stringliteral">&quot;INS needs at least 1 gyro and 1 accel&quot;</span>);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    }</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="comment">// clear IDs for unused sensor instances</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=<a class="code" href="classAP__InertialSensor.html#a8ca2cbf528de2276d1be01c00243db0d">get_accel_count</a>(); i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ada31f9669cfd8503daf08aa0a7f3f77f">_accel_id</a>[i].set(0);</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=<a class="code" href="classAP__InertialSensor.html#a4a421a821c8e43665a66501624522b9d">get_gyro_count</a>(); i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a2a90b36730b6afd50a7f335537bd1b17">_gyro_id</a>[i].set(0);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    }</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;}</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">/* Find the N instance of the backend that has already been successfully detected */</span></div><div class="line"><a name="l00596"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a3fc473466ffcccef319c4c5e56cd1f9d">  596</a></span>&#160;<a class="code" href="classAP__InertialSensor__Backend.html">AP_InertialSensor_Backend</a> *<a class="code" href="classAP__InertialSensor.html#a3fc473466ffcccef319c4c5e56cd1f9d">AP_InertialSensor::_find_backend</a>(int16_t backend_id, uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;{</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    assert(<a class="code" href="classAP__InertialSensor.html#a9a5846c73bf66f799f0761d7c287f5c7">_backends_detected</a>);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    uint8_t found = 0;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="classAP__InertialSensor.html#ab3bcaab30548484fd68e7f7af05f4a86">_backend_count</a>; i++) {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        int16_t <span class="keywordtype">id</span> = <a class="code" href="classAP__InertialSensor.html#a1d9040309bd3ba359b20b90f4a836531">_backends</a>[i]-&gt;<a class="code" href="classAP__InertialSensor__Backend.html#aff0f84ba798338291f3f6f37ccf3b91e">get_id</a>();</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &lt; 0 || <span class="keywordtype">id</span> != backend_id) {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        }</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> == found) {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classAP__InertialSensor.html#a1d9040309bd3ba359b20b90f4a836531">_backends</a>[i];</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            found++;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        }</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;}</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00619"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a741065b13832b5e4c90bbae17519c0ad">  619</a></span>&#160;<a class="code" href="classAP__InertialSensor.html#a741065b13832b5e4c90bbae17519c0ad">AP_InertialSensor::init</a>(uint16_t sample_rate)</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;{</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="comment">// remember the sample rate</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a08ea8b10ded97a61c91f716effcb85fd">_sample_rate</a> = sample_rate;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <a class="code" href="classAP__InertialSensor.html#afca334b41b757adc31705eec16836721">_loop_delta_t</a> = 1.0f / sample_rate;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="comment">// we don&#39;t allow deltat values greater than 10x the normal loop</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="comment">// time to be exposed outside of INS. Large deltat values can</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="comment">// cause divergence of state estimators</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a8fe1e7429d858b619847e0ae77f3354c">_loop_delta_t_max</a> = 10 * <a class="code" href="classAP__InertialSensor.html#afca334b41b757adc31705eec16836721">_loop_delta_t</a>;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a> == 0 &amp;&amp; <a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a> == 0) {</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a9949b7e301b0d7a5f3e59385d2e8d97a">_start_backends</a>();</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="comment">// initialise accel scale if need be. This is needed as we can&#39;t</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="comment">// give non-zero default values for vectors in AP_Param</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="classAP__InertialSensor.html#a8ca2cbf528de2276d1be01c00243db0d">get_accel_count</a>(); i++) {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#acfa1bbafefac03971538923ffcd1641a">_accel_scale</a>[i].get().is_zero()) {</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <a class="code" href="classAP__InertialSensor.html#acfa1bbafefac03971538923ffcd1641a">_accel_scale</a>[i].set(<a class="code" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>(1,1,1));</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    }</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">// calibrate gyros unless gyro calibration has been disabled</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a100449139236bccfb37e9fec9df8c2a7">gyro_calibration_timing</a>() != <a class="code" href="classAP__InertialSensor.html#a96ea6a28cfba8d662ba2b6f10443af05a34154738ae4be5b007524c4c3bf1bb77">GYRO_CAL_NEVER</a>) {</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a424609d1eb3dc8473040c9e6f87771ad">init_gyro</a>();</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    }</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <a class="code" href="classAP__InertialSensor.html#ab6d1a4fc496f6e2b1c5ca0fdc74f2f9c">_sample_period_usec</a> = 1000*1000UL / <a class="code" href="classAP__InertialSensor.html#a08ea8b10ded97a61c91f716effcb85fd">_sample_rate</a>;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="comment">// establish the baseline time between samples</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <a class="code" href="classAP__InertialSensor.html#aa4ab6d3141cc30a917961efa0c5e7054">_delta_time</a> = 0;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a> = 0;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a5a484543c8865592e07cac290dd40ef4">_last_sample_usec</a> = 0;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a08d15014b321673a9dca76bec82ec482">_have_sample</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="comment">// initialise IMU batch logging</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a78c93eef95585b2ee4595cb373594cd2">batchsampler</a>.<a class="code" href="classAP__InertialSensor_1_1BatchSampler.html#a458393a1681bfd0d37c8c06fbdf628d3">init</a>();</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;}</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a3f4ee8162ce5427946348ca9f5f9dcb7">  659</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#a3f4ee8162ce5427946348ca9f5f9dcb7">AP_InertialSensor::_add_backend</a>(<a class="code" href="classAP__InertialSensor__Backend.html">AP_InertialSensor_Backend</a> *backend)</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;{</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordflow">if</span> (!backend) {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ab3bcaab30548484fd68e7f7af05f4a86">_backend_count</a> == <a class="code" href="AP__InertialSensor_8h.html#ab4bc580ebf1e5a865816031fc00cf8ad">INS_MAX_BACKENDS</a>) {</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <a class="code" href="namespaceAP__HAL.html#a71832f03d849a0c088f04fc98d3c8143">AP_HAL::panic</a>(<span class="stringliteral">&quot;Too many INS backends&quot;</span>);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    }</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a1d9040309bd3ba359b20b90f4a836531">_backends</a>[<a class="code" href="classAP__InertialSensor.html#ab3bcaab30548484fd68e7f7af05f4a86">_backend_count</a>++] = backend;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;}</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">  detect available backends for this board</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00676"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a8967734e82a4f472c6d8ddd8db656804">  676</a></span>&#160;<a class="code" href="classAP__InertialSensor.html#a8967734e82a4f472c6d8ddd8db656804">AP_InertialSensor::detect_backends</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;{</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a9a5846c73bf66f799f0761d7c287f5c7">_backends_detected</a>) {</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a9a5846c73bf66f799f0761d7c287f5c7">_backends_detected</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    uint8_t probe_count = 0;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    uint8_t enable_mask = uint8_t(<a class="code" href="classAP__InertialSensor.html#a35cc4b42b44b242cb7a60963d83ed12b">_enable_mask</a>.get());</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    uint8_t found_mask = 0;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">      use ADD_BACKEND() macro to allow for INS_ENABLE_MASK for enabling/disabling INS backends</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="preprocessor">#define ADD_BACKEND(x) do { \</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="preprocessor">        if (((1U&lt;&lt;probe_count)&amp;enable_mask) &amp;&amp; _add_backend(x)) { \</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="preprocessor">            found_mask |= (1U&lt;&lt;probe_count); \</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="preprocessor">        } \</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="preprocessor">        probe_count++; \</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="preprocessor">} while (0)</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    </div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ad2d086fc49750ab9cdfeb964d874af65">_hil_mode</a>) {</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__HIL.html#abf98ef11debee955ccdc346e87ee520a">AP_InertialSensor_HIL::detect</a>(*<span class="keyword">this</span>));</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    }</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="preprocessor">#if defined(HAL_INS_PROBE_LIST)</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="comment">// IMUs defined by IMU lines in hwdef.dat</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    HAL_INS_PROBE_LIST;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="preprocessor">#elif CONFIG_HAL_BOARD == HAL_BOARD_SITL</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__SITL.html#abc6d58b49a9c2dc04f884f46d948e8ed">AP_InertialSensor_SITL::detect</a>(*<span class="keyword">this</span>));</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_HIL</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__HIL.html#abf98ef11debee955ccdc346e87ee520a">AP_InertialSensor_HIL::detect</a>(*<span class="keyword">this</span>));</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_MPU60XX_SPI &amp;&amp; defined(HAL_INS_DEFAULT_ROTATION)</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a7e7ec91ec2955e149b39f0df332b3325">HAL_INS_MPU60x0_NAME</a>),</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                                                  HAL_INS_DEFAULT_ROTATION));</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_MPU60XX_SPI</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a7e7ec91ec2955e149b39f0df332b3325">HAL_INS_MPU60x0_NAME</a>)));</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_MPU60XX_I2C &amp;&amp; defined(HAL_INS_DEFAULT_ROTATION)</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#adb4f986eb3188358079c4a1aee15674e">i2c_mgr</a>-&gt;<a class="code" href="classAP__HAL_1_1I2CDeviceManager.html#a8153774ecb8d07a14cb0eeac74ce6211">get_device</a>(HAL_INS_MPU60x0_I2C_BUS, HAL_INS_MPU60x0_I2C_ADDR),</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                                                  HAL_INS_DEFAULT_ROTATION));</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_MPU60XX_I2C</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#adb4f986eb3188358079c4a1aee15674e">i2c_mgr</a>-&gt;<a class="code" href="classAP__HAL_1_1I2CDeviceManager.html#a8153774ecb8d07a14cb0eeac74ce6211">get_device</a>(HAL_INS_MPU60x0_I2C_BUS, HAL_INS_MPU60x0_I2C_ADDR)));</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_BH</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#adb4f986eb3188358079c4a1aee15674e">i2c_mgr</a>-&gt;<a class="code" href="classAP__HAL_1_1I2CDeviceManager.html#a8153774ecb8d07a14cb0eeac74ce6211">get_device</a>(HAL_INS_MPU60x0_I2C_BUS, HAL_INS_MPU60x0_I2C_ADDR)));</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a62cb8ec55fbfb126d38b283968fd75a9">HAL_INS_MPU9250_NAME</a>)));</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="preprocessor">#elif AP_FEATURE_BOARD_DETECT</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">switch</span> (<a class="code" href="classAP__BoardConfig.html#a8a3185c191ab40fd95ceeadd8a5b0cf9">AP_BoardConfig::get_board_type</a>()) {</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983acf567833f77e46ce320a961f68611bff">AP_BoardConfig::PX4_BOARD_PX4V1</a>:</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a7e7ec91ec2955e149b39f0df332b3325">HAL_INS_MPU60x0_NAME</a>)));</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aa765b43df6cbdb15f9720f993d79ceb3">AP_BoardConfig::PX4_BOARD_PIXHAWK</a>:</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a7e7ec91ec2955e149b39f0df332b3325">HAL_INS_MPU60x0_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5">ROTATION_ROLL_180</a>));</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__LSM9DS0.html#a47ae2f91f700f8d46b7f6de80ac77eab">AP_InertialSensor_LSM9DS0::probe</a>(*<span class="keyword">this</span>,</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                                                      <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#ac02a529e0a09a6987d26dd1147aceb5b">HAL_INS_LSM9DS0_G_NAME</a>),</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                                                      <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a2c59d23ab6be2e59b18f06e2431e5dbb">HAL_INS_LSM9DS0_A_NAME</a>),</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                                                      <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5">ROTATION_ROLL_180</a>,</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                                                      <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681ab0d62ddde13a7fb88b4f4067872815b4">ROTATION_ROLL_180_YAW_270</a>,</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                                                      <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a16e7696bfbca8f804e76718d5cfa5bef">ROTATION_PITCH_180</a>));</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ad387380811280b3f995f8387ab50264e">AP_BoardConfig::PX4_BOARD_PIXHAWK2</a>:</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="comment">// older Pixhawk2 boards have the MPU6000 instead of MPU9250</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ac2aac5664a4f7c78d5770ba268964001">_fast_sampling_mask</a>.set_default(1);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a0c902a1d58826fe210fa57056d98954e">HAL_INS_MPU9250_EXT_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a16e7696bfbca8f804e76718d5cfa5bef">ROTATION_PITCH_180</a>));</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__LSM9DS0.html#a47ae2f91f700f8d46b7f6de80ac77eab">AP_InertialSensor_LSM9DS0::probe</a>(*<span class="keyword">this</span>,</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                                                      <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a8f046cbd4c6949abf4cf5f7f05d03538">HAL_INS_LSM9DS0_EXT_G_NAME</a>),</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                                                      <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#ae30b37f1f4cd685cec0014ac3a5e00ad">HAL_INS_LSM9DS0_EXT_A_NAME</a>),</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                                                      <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681ab0d62ddde13a7fb88b4f4067872815b4">ROTATION_ROLL_180_YAW_270</a>,</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                                                      <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a>,</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                                                      <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a>));</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a62cb8ec55fbfb126d38b283968fd75a9">HAL_INS_MPU9250_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294">ROTATION_YAW_270</a>));</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="comment">// new cubes have ICM20602, ICM20948, ICM20649</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<span class="stringliteral">&quot;icm20602_ext&quot;</span>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681ab0d62ddde13a7fb88b4f4067872815b4">ROTATION_ROLL_180_YAW_270</a>));</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensensev2.html#ad53b8716bfefc867bfb3d453312708d1">AP_InertialSensor_Invensensev2::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<span class="stringliteral">&quot;icm20948_ext&quot;</span>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a16e7696bfbca8f804e76718d5cfa5bef">ROTATION_PITCH_180</a>));</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensensev2.html#ad53b8716bfefc867bfb3d453312708d1">AP_InertialSensor_Invensensev2::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<span class="stringliteral">&quot;icm20948&quot;</span>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294">ROTATION_YAW_270</a>));</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a6f39405e261af307e647f079d8a6ec56">AP_BoardConfig::PX4_BOARD_FMUV5</a>:</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ae3bc20831e04c6038b9ad40680003eda">AP_BoardConfig::PX4_BOARD_FMUV6</a>:</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ac2aac5664a4f7c78d5770ba268964001">_fast_sampling_mask</a>.set_default(1);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<span class="stringliteral">&quot;icm20689&quot;</span>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<span class="stringliteral">&quot;icm20602&quot;</span>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <span class="comment">// allow for either BMI055 or BMI088</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__BMI055.html#a981c75fe5745e1126b11998f623f35ab">AP_InertialSensor_BMI055::probe</a>(*<span class="keyword">this</span>,</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                                                    <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<span class="stringliteral">&quot;bmi055_a&quot;</span>),</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                                                    <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<span class="stringliteral">&quot;bmi055_g&quot;</span>),</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                                                    <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a>));</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__BMI088.html#ab867cfc35f3c7d2b43dbf2b1b45386b2">AP_InertialSensor_BMI088::probe</a>(*<span class="keyword">this</span>,</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                                                    <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<span class="stringliteral">&quot;bmi055_a&quot;</span>),</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                                                    <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<span class="stringliteral">&quot;bmi055_g&quot;</span>),</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                                                    <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a>));</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        </div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a2548b608826699e872a2de7f4e1ff877">AP_BoardConfig::PX4_BOARD_SP01</a>:</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ac2aac5664a4f7c78d5770ba268964001">_fast_sampling_mask</a>.set_default(1);</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a0c902a1d58826fe210fa57056d98954e">HAL_INS_MPU9250_EXT_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a62cb8ec55fbfb126d38b283968fd75a9">HAL_INS_MPU9250_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        </div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a05ec778f42256d22fbdf58c458707b38">AP_BoardConfig::PX4_BOARD_PIXHAWK_PRO</a>:</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ac2aac5664a4f7c78d5770ba268964001">_fast_sampling_mask</a>.set_default(3);</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a696058af28d7169142b2b7dc64155bf4">HAL_INS_ICM20608_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a>));</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a62cb8ec55fbfb126d38b283968fd75a9">HAL_INS_MPU9250_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a>));</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <span class="keywordflow">break</span>;      </div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aa4b366ff17e0c44076231ae8c51edd42">AP_BoardConfig::PX4_BOARD_PHMINI</a>:</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="comment">// PHMINI uses ICM20608 on the ACCEL_MAG device and a MPU9250 on the old MPU6000 CS line</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ac2aac5664a4f7c78d5770ba268964001">_fast_sampling_mask</a>.set_default(3);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a876031582808a8548348173e7a48736e">HAL_INS_ICM20608_AM_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5">ROTATION_ROLL_180</a>));</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a62cb8ec55fbfb126d38b283968fd75a9">HAL_INS_MPU9250_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5">ROTATION_ROLL_180</a>));</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a922eeb71ccd9862923f68246f86bb667">AP_BoardConfig::PX4_BOARD_AUAV21</a>:</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="comment">// AUAV2.1 uses ICM20608 on the ACCEL_MAG device and a MPU9250 on the old MPU6000 CS line</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ac2aac5664a4f7c78d5770ba268964001">_fast_sampling_mask</a>.set_default(3);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a876031582808a8548348173e7a48736e">HAL_INS_ICM20608_AM_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a>));</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a62cb8ec55fbfb126d38b283968fd75a9">HAL_INS_MPU9250_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a>));</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        </div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a78f917fc079eb5acb3e9623f0bbe0ff9">AP_BoardConfig::PX4_BOARD_PH2SLIM</a>:</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ac2aac5664a4f7c78d5770ba268964001">_fast_sampling_mask</a>.set_default(1);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a62cb8ec55fbfb126d38b283968fd75a9">HAL_INS_MPU9250_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294">ROTATION_YAW_270</a>));</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a97426996f59ed4a7534cfd7bb6a3174a">AP_BoardConfig::PX4_BOARD_AEROFC</a>:</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ac2aac5664a4f7c78d5770ba268964001">_fast_sampling_mask</a>.set_default(1);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a2ea530da3a170b09bb0b629de8464ff5">HAL_INS_MPU6500_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294">ROTATION_YAW_270</a>));</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a6aaf12ce90b5b9586d350af949ab84a0">AP_BoardConfig::PX4_BOARD_MINDPXV2</a>:</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a2ea530da3a170b09bb0b629de8464ff5">HAL_INS_MPU6500_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__LSM9DS0.html#a47ae2f91f700f8d46b7f6de80ac77eab">AP_InertialSensor_LSM9DS0::probe</a>(*<span class="keyword">this</span>,</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                                                      <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#ac02a529e0a09a6987d26dd1147aceb5b">HAL_INS_LSM9DS0_G_NAME</a>),</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                                                      <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a2c59d23ab6be2e59b18f06e2431e5dbb">HAL_INS_LSM9DS0_A_NAME</a>),</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                                                      <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba">ROTATION_YAW_90</a>,</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                                                      <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba">ROTATION_YAW_90</a>,</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                                                      <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba">ROTATION_YAW_90</a>));</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        </div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a3c5386db31b5c706894441bb6279eefc">AP_BoardConfig::VRX_BOARD_BRAIN54</a>:</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ac2aac5664a4f7c78d5770ba268964001">_fast_sampling_mask</a>.set_default(7);</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a7e7ec91ec2955e149b39f0df332b3325">HAL_INS_MPU60x0_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a45b705de2d5cd3bcca329d9e282096ba">ROTATION_YAW_180</a>));</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a1ad903e799080a3eb2f2d33f80d81e20">HAL_INS_MPU60x0_EXT_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a45b705de2d5cd3bcca329d9e282096ba">ROTATION_YAW_180</a>));</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="preprocessor">#ifdef HAL_INS_MPU60x0_IMU_NAME</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(HAL_INS_MPU60x0_IMU_NAME), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a45b705de2d5cd3bcca329d9e282096ba">ROTATION_YAW_180</a>));</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a212c2ff8c6c4ada3668b927ac6728a87">AP_BoardConfig::VRX_BOARD_BRAIN51</a>:</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a939e3484a227aa39019088ac96a9cfd3">AP_BoardConfig::VRX_BOARD_BRAIN52</a>:</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aedbfaade4bc5663cfd73a8652235bb30">AP_BoardConfig::VRX_BOARD_BRAIN52E</a>:</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a2f0a5b6527161d6a622728dfe8fd4023">AP_BoardConfig::VRX_BOARD_CORE10</a>:</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a53e500f8c050e0ae471194b0fca121cb">AP_BoardConfig::VRX_BOARD_UBRAIN51</a>:</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a122ab74c52fd603b79d0b2c0b5651ed5">AP_BoardConfig::VRX_BOARD_UBRAIN52</a>:</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a7e7ec91ec2955e149b39f0df332b3325">HAL_INS_MPU60x0_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a45b705de2d5cd3bcca329d9e282096ba">ROTATION_YAW_180</a>));</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        </div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ac37e0c90b91e19c9b6945baa8b05b278">AP_BoardConfig::PX4_BOARD_PCNC1</a>:</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a3f4ee8162ce5427946348ca9f5f9dcb7">_add_backend</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a7e7ec91ec2955e149b39f0df332b3325">HAL_INS_MPU60x0_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5">ROTATION_ROLL_180</a>));</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    }</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_MPU9250_SPI &amp;&amp; defined(HAL_INS_DEFAULT_ROTATION)</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a62cb8ec55fbfb126d38b283968fd75a9">HAL_INS_MPU9250_NAME</a>), HAL_INS_DEFAULT_ROTATION));</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_MPU9250_SPI</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a62cb8ec55fbfb126d38b283968fd75a9">HAL_INS_MPU9250_NAME</a>)));</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_EDGE</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a7e7ec91ec2955e149b39f0df332b3325">HAL_INS_MPU60x0_NAME</a>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba">ROTATION_YAW_90</a>));</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(HAL_INS_MPU60x0_NAME_EXT), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba">ROTATION_YAW_90</a>));</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_LSM9DS1</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__LSM9DS1.html#a3386e4a8a70178a7fe93f8f7c537d50b">AP_InertialSensor_LSM9DS1::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(HAL_INS_LSM9DS1_NAME)));</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_LSM9DS0</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__LSM9DS0.html#a47ae2f91f700f8d46b7f6de80ac77eab">AP_InertialSensor_LSM9DS0::probe</a>(*<span class="keyword">this</span>,</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                 <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#ac02a529e0a09a6987d26dd1147aceb5b">HAL_INS_LSM9DS0_G_NAME</a>),</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                 <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a2c59d23ab6be2e59b18f06e2431e5dbb">HAL_INS_LSM9DS0_A_NAME</a>)));</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_L3G4200D</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__L3G4200D.html#aa262f132b6aabdab5fda4cb9a730655a">AP_InertialSensor_L3G4200D::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#adb4f986eb3188358079c4a1aee15674e">i2c_mgr</a>-&gt;<a class="code" href="classAP__HAL_1_1I2CDeviceManager.html#a8153774ecb8d07a14cb0eeac74ce6211">get_device</a>(HAL_INS_L3G4200D_I2C_BUS, HAL_INS_L3G4200D_I2C_ADDR)));</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_MPU9250_I2C</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#adb4f986eb3188358079c4a1aee15674e">i2c_mgr</a>-&gt;<a class="code" href="classAP__HAL_1_1I2CDeviceManager.html#a8153774ecb8d07a14cb0eeac74ce6211">get_device</a>(HAL_INS_MPU9250_I2C_BUS, HAL_INS_MPU9250_I2C_ADDR)));</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_BBBMINI</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<a class="code" href="chibios_8h.html#a62cb8ec55fbfb126d38b283968fd75a9">HAL_INS_MPU9250_NAME</a>)));</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(HAL_INS_MPU9250_NAME_EXT)));</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_AERO</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__BMI160.html#a100e98e0955c2b2a9d72fb594aa3e616">AP_InertialSensor_BMI160::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<span class="stringliteral">&quot;bmi160&quot;</span>)));</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_RST</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__RST.html#ac1967b632d7158b081e4bafc66804245">AP_InertialSensor_RST::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(HAL_INS_RST_G_NAME), </div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                                             <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(HAL_INS_RST_A_NAME),</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                                             HAL_INS_DEFAULT_G_ROTATION,</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                                             HAL_INS_DEFAULT_A_ROTATION));</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_ICM20789_SPI</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<span class="stringliteral">&quot;icm20789&quot;</span>)));</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="preprocessor">#elif CONFIG_HAL_BOARD_SUBTYPE == HAL_BOARD_SUBTYPE_CHIBIOS_OMNIBUSF7V2</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<span class="stringliteral">&quot;mpu6000&quot;</span>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a>(<a class="code" href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a>(*<span class="keyword">this</span>, <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code" href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">get_device</a>(<span class="stringliteral">&quot;mpu6500&quot;</span>), <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba">ROTATION_YAW_90</a>));</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="preprocessor">#elif HAL_INS_DEFAULT == HAL_INS_NONE</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="comment">// no INS device</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="preprocessor">    #error Unrecognised HAL_INS_TYPE setting</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ab3bcaab30548484fd68e7f7af05f4a86">_backend_count</a> == 0) {</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <a class="code" href="classAP__BoardConfig.html#ab7d977aecbbe7090266bee755bf2cc32">AP_BoardConfig::sensor_config_error</a>(<span class="stringliteral">&quot;INS: unable to initialise driver&quot;</span>);</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    }</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;}</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">// Armed, Copter, PixHawk:</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">// ins_periodic: 57500 events, 0 overruns, 208754us elapsed, 3us avg, min 1us max 218us 40.662us rms</span></div><div class="line"><a name="l00887"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a58da60a9551851bf27ffefc7035517be">  887</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#a58da60a9551851bf27ffefc7035517be">AP_InertialSensor::periodic</a>()</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;{</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a78c93eef95585b2ee4595cb373594cd2">batchsampler</a>.<a class="code" href="classAP__InertialSensor_1_1BatchSampler.html#a1470373978fedc302caf963f45df3cf0">periodic</a>();</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;}</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">  _calculate_trim - calculates the x and y trim angles. The</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">  accel_sample must be correctly scaled, offset and oriented for the</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">  board</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00898"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#ad85a0f7284984ab4bc7b6309ec61003f">  898</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#ad85a0f7284984ab4bc7b6309ec61003f">AP_InertialSensor::_calculate_trim</a>(<span class="keyword">const</span> <a class="code" href="classVector3.html">Vector3f</a> &amp;<a class="code" href="structaccel__sample.html">accel_sample</a>, <span class="keywordtype">float</span>&amp; trim_roll, <span class="keywordtype">float</span>&amp; trim_pitch)</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;{</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    trim_pitch = atan2f(<a class="code" href="structaccel__sample.html">accel_sample</a>.x, <a class="code" href="AP__Math_8h.html#a45fe9f81332c93a04d1fdbcf0bc89c29">norm</a>(<a class="code" href="structaccel__sample.html">accel_sample</a>.y, <a class="code" href="structaccel__sample.html">accel_sample</a>.z));</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    trim_roll = atan2f(-<a class="code" href="structaccel__sample.html">accel_sample</a>.y, -<a class="code" href="structaccel__sample.html">accel_sample</a>.z);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keywordflow">if</span> (fabsf(trim_roll) &gt; <a class="code" href="AP__Math_8h.html#a37d7c62a8231d9d22826261297b99da4">radians</a>(10) ||</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        fabsf(trim_pitch) &gt; <a class="code" href="AP__Math_8h.html#a37d7c62a8231d9d22826261297b99da4">radians</a>(10)) {</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">console</a>-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">printf</a>(<span class="stringliteral">&quot;trim over maximum of 10 degrees\n&quot;</span>);</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    }</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">console</a>-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">printf</a>(<span class="stringliteral">&quot;Trim OK: roll=%.2f pitch=%.2f\n&quot;</span>,</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                          (<span class="keywordtype">double</span>)<a class="code" href="moduletest_8c.html#a903c4797a4c2860e3b9a6a978f98a44d">degrees</a>(trim_roll),</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                          (<span class="keywordtype">double</span>)<a class="code" href="moduletest_8c.html#a903c4797a4c2860e3b9a6a978f98a44d">degrees</a>(trim_pitch));</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;}</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00914"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a424609d1eb3dc8473040c9e6f87771ad">  914</a></span>&#160;<a class="code" href="classAP__InertialSensor.html#a424609d1eb3dc8473040c9e6f87771ad">AP_InertialSensor::init_gyro</a>()</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;{</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a8744303832541bef0025d9698468938c">_init_gyro</a>();</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="comment">// save calibration</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <a class="code" href="classAP__InertialSensor.html#aa5bb8e95e3d8044619c673b36815125a">_save_gyro_calibration</a>();</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;}</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">// accelerometer clipping reporting</span></div><div class="line"><a name="l00923"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a44b3909c69cbf40dc18fd383e4232cb7">  923</a></span>&#160;uint32_t <a class="code" href="classAP__InertialSensor.html#a44b3909c69cbf40dc18fd383e4232cb7">AP_InertialSensor::get_accel_clip_count</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)<span class="keyword"> const</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &gt;= <a class="code" href="classAP__InertialSensor.html#a8ca2cbf528de2276d1be01c00243db0d">get_accel_count</a>()) {</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    }</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classAP__InertialSensor.html#a681fb041567d15f5d73e9ee647770a97">_accel_clip_count</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>];</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;}</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">// get_gyro_health_all - return true if all gyros are healthy</span></div><div class="line"><a name="l00932"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a8c272873ffbbafcaa90d5a4686c795ca">  932</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#a8c272873ffbbafcaa90d5a4686c795ca">AP_InertialSensor::get_gyro_health_all</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="classAP__InertialSensor.html#a4a421a821c8e43665a66501624522b9d">get_gyro_count</a>(); i++) {</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classAP__InertialSensor.html#adab0e15f297d55a8436b607627db0e5f">get_gyro_health</a>(i)) {</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        }</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    }</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="comment">// return true if we have at least one gyro</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="classAP__InertialSensor.html#a4a421a821c8e43665a66501624522b9d">get_gyro_count</a>() &gt; 0);</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;}</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">// gyro_calibration_ok_all - returns true if all gyros were calibrated successfully</span></div><div class="line"><a name="l00944"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#ab2625e619aa917ed3b1138c9c9c2b747">  944</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#ab2625e619aa917ed3b1138c9c9c2b747">AP_InertialSensor::gyro_calibrated_ok_all</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="classAP__InertialSensor.html#a4a421a821c8e43665a66501624522b9d">get_gyro_count</a>(); i++) {</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classAP__InertialSensor.html#a5df3a0a4fc6f65531ca3078c84d46657">gyro_calibrated_ok</a>(i)) {</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        }</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    }</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=<a class="code" href="classAP__InertialSensor.html#a4a421a821c8e43665a66501624522b9d">get_gyro_count</a>(); i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a2a90b36730b6afd50a7f335537bd1b17">_gyro_id</a>[i] != 0) {</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            <span class="comment">// missing gyro</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        }</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    }</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="classAP__InertialSensor.html#a4a421a821c8e43665a66501624522b9d">get_gyro_count</a>() &gt; 0);</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;}</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">// return true if gyro instance should be used (must be healthy and have it&#39;s use parameter set to 1)</span></div><div class="line"><a name="l00961"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a714dc332f1f664de77df912220525653">  961</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#a714dc332f1f664de77df912220525653">AP_InertialSensor::use_gyro</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)<span class="keyword"> const</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &gt;= <a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>) {</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    }</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="classAP__InertialSensor.html#adab0e15f297d55a8436b607627db0e5f">get_gyro_health</a>(<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>) &amp;&amp; <a class="code" href="classAP__InertialSensor.html#ab08b54ef4cc6d1cb04b57996066a51e2">_use</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;}</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">// get_accel_health_all - return true if all accels are healthy</span></div><div class="line"><a name="l00971"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a8d8b31abadf23ccaec838e223ad678b2">  971</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#a8d8b31abadf23ccaec838e223ad678b2">AP_InertialSensor::get_accel_health_all</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="classAP__InertialSensor.html#a8ca2cbf528de2276d1be01c00243db0d">get_accel_count</a>(); i++) {</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classAP__InertialSensor.html#a5b42199f260d9523973a51debd99146e">get_accel_health</a>(i)) {</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        }</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    }</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="comment">// return true if we have at least one accel</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="classAP__InertialSensor.html#a8ca2cbf528de2276d1be01c00243db0d">get_accel_count</a>() &gt; 0);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;}</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment">  calculate the trim_roll and trim_pitch. This is used for redoing the</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment">  trim without needing a full accel cal</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00987"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#ad87496184e3c6a775a10b3b5eb069cd9">  987</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#ad87496184e3c6a775a10b3b5eb069cd9">AP_InertialSensor::calibrate_trim</a>(<span class="keywordtype">float</span> &amp;trim_roll, <span class="keywordtype">float</span> &amp;trim_pitch)</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;{</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> level_sample;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="comment">// exit immediately if calibration is already in progress</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ae702a0c6ac4e418075f92c09a2631654">_calibrating</a>) {</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    }</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <a class="code" href="classAP__InertialSensor.html#ae702a0c6ac4e418075f92c09a2631654">_calibrating</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keyword">const</span> uint8_t update_dt_milliseconds = (uint8_t)(1000.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>/<a class="code" href="classAP__InertialSensor.html#a9c15eb46fd51722e79e1714b726c08e6">get_sample_rate</a>()+0.5f);</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="comment">// wait 100ms for ins filter to rise</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keywordflow">for</span> (uint8_t k=0; k&lt;100/update_dt_milliseconds; k++) {</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <a class="code" href="classAP__InertialSensor.html#aa4faf114689e827390b5da7bc6fd5f20">wait_for_sample</a>();</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a2ab4e9e49af5ae38f38d3818fde2b675">update</a>();</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#ab3175e2e6223ccfe82f957e41cc12b26">delay</a>(update_dt_milliseconds);</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    }</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    uint32_t num_samples = 0;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="keywordflow">while</span> (num_samples &lt; 400/update_dt_milliseconds) {</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <a class="code" href="classAP__InertialSensor.html#aa4faf114689e827390b5da7bc6fd5f20">wait_for_sample</a>();</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="comment">// read samples from ins</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a2ab4e9e49af5ae38f38d3818fde2b675">update</a>();</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="comment">// capture sample</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> samp;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        samp = <a class="code" href="classAP__InertialSensor.html#ab39d50c9e078ac925746d92af042ba64">get_accel</a>(0);</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        level_sample += samp;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classAP__InertialSensor.html#a5b42199f260d9523973a51debd99146e">get_accel_health</a>(0)) {</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            <span class="keywordflow">goto</span> failed;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        }</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#ab3175e2e6223ccfe82f957e41cc12b26">delay</a>(update_dt_milliseconds);</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        num_samples++;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    }</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    level_sample /= num_samples;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__InertialSensor.html#ad85a0f7284984ab4bc7b6309ec61003f">_calculate_trim</a>(level_sample, trim_roll, trim_pitch)) {</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <span class="keywordflow">goto</span> failed;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    }</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <a class="code" href="classAP__InertialSensor.html#ae702a0c6ac4e418075f92c09a2631654">_calibrating</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;failed:</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <a class="code" href="classAP__InertialSensor.html#ae702a0c6ac4e418075f92c09a2631654">_calibrating</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;}</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">  check if the accelerometers are calibrated in 3D and that current number of accels matched number when calibrated</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01039"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a5ae4308b77385d3e576d29c78e8e3346"> 1039</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#a5ae4308b77385d3e576d29c78e8e3346">AP_InertialSensor::accel_calibrated_ok_all</a>()<span class="keyword"> const</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="comment">// calibration is not applicable for HIL mode</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ad2d086fc49750ab9cdfeb964d874af65">_hil_mode</a>) {</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    }</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="comment">// check each accelerometer has offsets saved</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="classAP__InertialSensor.html#a8ca2cbf528de2276d1be01c00243db0d">get_accel_count</a>(); i++) {</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classAP__InertialSensor.html#ae840940f433011c353a91fa25ce1e197">_accel_id_ok</a>[i]) {</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        }</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="comment">// exactly 0.0 offset is extremely unlikely</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a5096e33c19b3f59a284b241ac7f9b1ad">_accel_offset</a>[i].get().is_zero()) {</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        }</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="comment">// zero scaling also indicates not calibrated</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#acfa1bbafefac03971538923ffcd1641a">_accel_scale</a>[i].get().is_zero()) {</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        }</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    }</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=<a class="code" href="classAP__InertialSensor.html#a8ca2cbf528de2276d1be01c00243db0d">get_accel_count</a>(); i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ada31f9669cfd8503daf08aa0a7f3f77f">_accel_id</a>[i] != 0) {</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;            <span class="comment">// missing accel</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        }</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    }</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    </div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="comment">// check calibrated accels matches number of accels (no unused accels should have offsets or scaling)</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a8ca2cbf528de2276d1be01c00243db0d">get_accel_count</a>() &lt; <a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>) {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=<a class="code" href="classAP__InertialSensor.html#a8ca2cbf528de2276d1be01c00243db0d">get_accel_count</a>(); i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;            <span class="keyword">const</span> <a class="code" href="classVector3.html">Vector3f</a> &amp;scaling = <a class="code" href="classAP__InertialSensor.html#acfa1bbafefac03971538923ffcd1641a">_accel_scale</a>[i].get();</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            <span class="keywordtype">bool</span> have_scaling = (!<a class="code" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(scaling.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>) &amp;&amp; !<a class="code" href="AP__Math_8cpp.html#accbd9f8bbc0adacd51efa66fad490c24">is_equal</a>(scaling.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>,1.0f)) || (!<a class="code" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(scaling.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>) &amp;&amp; !<a class="code" href="AP__Math_8cpp.html#accbd9f8bbc0adacd51efa66fad490c24">is_equal</a>(scaling.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>,1.0f)) || (!<a class="code" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(scaling.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>) &amp;&amp; !<a class="code" href="AP__Math_8cpp.html#accbd9f8bbc0adacd51efa66fad490c24">is_equal</a>(scaling.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>,1.0f));</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            <span class="keywordtype">bool</span> have_offsets = !<a class="code" href="classAP__InertialSensor.html#a5096e33c19b3f59a284b241ac7f9b1ad">_accel_offset</a>[i].get().is_zero();</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;            <span class="keywordflow">if</span> (have_scaling || have_offsets) {</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            }</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        }</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    }</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <span class="comment">// if we got this far the accelerometers must have been calibrated</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;}</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">// return true if accel instance should be used (must be healthy and have it&#39;s use parameter set to 1)</span></div><div class="line"><a name="l01084"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#af8aa055fcbf0bc843ca4914a9cc84013"> 1084</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#af8aa055fcbf0bc843ca4914a9cc84013">AP_InertialSensor::use_accel</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)<span class="keyword"> const</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &gt;= <a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>) {</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    }</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="classAP__InertialSensor.html#a5b42199f260d9523973a51debd99146e">get_accel_health</a>(<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>) &amp;&amp; <a class="code" href="classAP__InertialSensor.html#ab08b54ef4cc6d1cb04b57996066a51e2">_use</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;}</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l01094"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a8744303832541bef0025d9698468938c"> 1094</a></span>&#160;<a class="code" href="classAP__InertialSensor.html#a8744303832541bef0025d9698468938c">AP_InertialSensor::_init_gyro</a>()</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;{</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    uint8_t num_gyros = <a class="code" href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a>(<a class="code" href="classAP__InertialSensor.html#a4a421a821c8e43665a66501624522b9d">get_gyro_count</a>(), <a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>);</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> last_average[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>], best_avg[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> new_gyro_offset[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="keywordtype">float</span> best_diff[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keywordtype">bool</span> converged[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="comment">// exit immediately if calibration is already in progress</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ae702a0c6ac4e418075f92c09a2631654">_calibrating</a>) {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    }</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="comment">// record we are calibrating</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <a class="code" href="classAP__InertialSensor.html#ae702a0c6ac4e418075f92c09a2631654">_calibrating</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="comment">// flash leds to tell user to keep the IMU still</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <a class="code" href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a>.<a class="code" href="structAP__Notify_1_1notify__flags__and__values__type.html#a02b0d4d68e7d24114885e508a73f2b07">initialising</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="comment">// cold start</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">console</a>-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">printf</a>(<span class="stringliteral">&quot;Init Gyro&quot;</span>);</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <a class="code" href="Scheduler_8h.html#a538ef95a13e6bf98cc2e008c2a8b9a44">EXPECT_DELAY_MS</a>(60000);</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment">      we do the gyro calibration with no board rotation. This avoids</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment">      having to rotate readings during the calibration</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="keyword">enum</span> <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681">Rotation</a> saved_orientation = <a class="code" href="classAP__InertialSensor.html#a0553640f772e43284644d89d49ef660c">_board_orientation</a>;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a0553640f772e43284644d89d49ef660c">_board_orientation</a> = <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="comment">// remove existing gyro offsets</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_gyros; k++) {</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a646482451aa12d3124f81e11f96a281e">_gyro_offset</a>[k].set(<a class="code" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>());</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        new_gyro_offset[k].<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        best_diff[k] = -1.f;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        last_average[k].<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        converged[k] = <span class="keyword">false</span>;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    }</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="keywordflow">for</span>(int8_t c = 0; c &lt; 5; c++) {</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#ab3175e2e6223ccfe82f957e41cc12b26">delay</a>(5);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a2ab4e9e49af5ae38f38d3818fde2b675">update</a>();</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    }</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <span class="comment">// the strategy is to average 50 points over 0.5 seconds, then do it</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="comment">// again and see if the 2nd average is within a small margin of</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="comment">// the first</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    uint8_t num_converged = 0;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="comment">// we try to get a good calibration estimate for up to 30 seconds</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <span class="comment">// if the gyros are stable, we should get it in 1 second</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="keywordflow">for</span> (int16_t j = 0; j &lt;= 30*4 &amp;&amp; num_converged &lt; num_gyros; j++) {</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> gyro_sum[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>], gyro_avg[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>], gyro_diff[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> accel_start;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <span class="keywordtype">float</span> diff_norm[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        uint8_t i;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        memset(diff_norm, 0, <span class="keyword">sizeof</span>(diff_norm));</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">console</a>-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">printf</a>(<span class="stringliteral">&quot;*&quot;</span>);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_gyros; k++) {</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;            gyro_sum[k].<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        }</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        accel_start = <a class="code" href="classAP__InertialSensor.html#ab39d50c9e078ac925746d92af042ba64">get_accel</a>(0);</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        <span class="keywordflow">for</span> (i=0; i&lt;50; i++) {</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a2ab4e9e49af5ae38f38d3818fde2b675">update</a>();</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;            <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_gyros; k++) {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;                gyro_sum[k] += <a class="code" href="classAP__InertialSensor.html#a59056c961e7d7d6884366103791d54ee">get_gyro</a>(k);</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            }</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;            <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#ab3175e2e6223ccfe82f957e41cc12b26">delay</a>(5);</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        }</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> accel_diff = <a class="code" href="classAP__InertialSensor.html#ab39d50c9e078ac925746d92af042ba64">get_accel</a>(0) - accel_start;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="keywordflow">if</span> (accel_diff.<a class="code" href="classVector3.html#afcdfe81173c23d57e4a53a0282cddae7">length</a>() &gt; 0.2f) {</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;            <span class="comment">// the accelerometers changed during the gyro sum. Skip</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;            <span class="comment">// this sample. This copes with doing gyro cal on a</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;            <span class="comment">// steadily moving platform. The value 0.2 corresponds</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;            <span class="comment">// with around 5 degrees/second of rotation.</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        }</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_gyros; k++) {</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            gyro_avg[k] = gyro_sum[k] / i;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;            gyro_diff[k] = last_average[k] - gyro_avg[k];</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;            diff_norm[k] = gyro_diff[k].<a class="code" href="classVector3.html#afcdfe81173c23d57e4a53a0282cddae7">length</a>();</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        }</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;        <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_gyros; k++) {</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;            <span class="keywordflow">if</span> (best_diff[k] &lt; 0) {</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                best_diff[k] = diff_norm[k];</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                best_avg[k] = gyro_avg[k];</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gyro_diff[k].length() &lt; <a class="code" href="AP__Common_8h.html#a728f9499baea61e7df3ae70a374f2512">ToRad</a>(<a class="code" href="AP__InertialSensor_8cpp.html#a247ced13b73525611d4dbefe67eb4915">GYRO_INIT_MAX_DIFF_DPS</a>)) {</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                <span class="comment">// we want the average to be within 0.1 bit, which is 0.04 degrees/s</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                last_average[k] = (gyro_avg[k] * 0.5f) + (last_average[k] * 0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                <span class="keywordflow">if</span> (!converged[k] || last_average[k].length() &lt; new_gyro_offset[k].<a class="code" href="classVector3.html#afcdfe81173c23d57e4a53a0282cddae7">length</a>()) {</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                    new_gyro_offset[k] = last_average[k];</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                }</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                <span class="keywordflow">if</span> (!converged[k]) {</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                    converged[k] = <span class="keyword">true</span>;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                    num_converged++;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                }</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (diff_norm[k] &lt; best_diff[k]) {</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                best_diff[k] = diff_norm[k];</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                best_avg[k] = (gyro_avg[k] * 0.5f) + (last_average[k] * 0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;            }</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            last_average[k] = gyro_avg[k];</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        }</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    }</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <span class="comment">// we&#39;ve kept the user waiting long enough - use the best pair we</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="comment">// found so far</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">console</a>-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">printf</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_gyros; k++) {</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <span class="keywordflow">if</span> (!converged[k]) {</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;            <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">console</a>-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">printf</a>(<span class="stringliteral">&quot;gyro[%u] did not converge: diff=%f dps (expected &lt; %f)\n&quot;</span>,</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                                (<span class="keywordtype">unsigned</span>)k,</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                                (<span class="keywordtype">double</span>)<a class="code" href="AP__Common_8h.html#a3c9d151923236c7e8ccccf86f131e550">ToDeg</a>(best_diff[k]),</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                                (<span class="keywordtype">double</span>)<a class="code" href="AP__InertialSensor_8cpp.html#a247ced13b73525611d4dbefe67eb4915">GYRO_INIT_MAX_DIFF_DPS</a>);</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a646482451aa12d3124f81e11f96a281e">_gyro_offset</a>[k] = best_avg[k];</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;            <span class="comment">// flag calibration as failed for this gyro</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;            <a class="code" href="classAP__InertialSensor.html#aa8ac7e294cc5ed4ea30ab1fd5e1b6637">_gyro_cal_ok</a>[k] = <span class="keyword">false</span>;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            <a class="code" href="classAP__InertialSensor.html#aa8ac7e294cc5ed4ea30ab1fd5e1b6637">_gyro_cal_ok</a>[k] = <span class="keyword">true</span>;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a646482451aa12d3124f81e11f96a281e">_gyro_offset</a>[k] = new_gyro_offset[k];</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        }</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    }</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="comment">// restore orientation</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a0553640f772e43284644d89d49ef660c">_board_orientation</a> = saved_orientation;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="comment">// record calibration complete</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <a class="code" href="classAP__InertialSensor.html#ae702a0c6ac4e418075f92c09a2631654">_calibrating</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="comment">// stop flashing leds</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <a class="code" href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a>.<a class="code" href="structAP__Notify_1_1notify__flags__and__values__type.html#a02b0d4d68e7d24114885e508a73f2b07">initialising</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;}</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment">// save parameters to eeprom</span></div><div class="line"><a name="l01235"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#aa5bb8e95e3d8044619c673b36815125a"> 1235</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#aa5bb8e95e3d8044619c673b36815125a">AP_InertialSensor::_save_gyro_calibration</a>()</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;{</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a>; i++) {</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a646482451aa12d3124f81e11f96a281e">_gyro_offset</a>[i].save();</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a2a90b36730b6afd50a7f335537bd1b17">_gyro_id</a>[i].save();</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    }</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a>; i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a646482451aa12d3124f81e11f96a281e">_gyro_offset</a>[i].set_and_save(<a class="code" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>());</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a2a90b36730b6afd50a7f335537bd1b17">_gyro_id</a>[i].set_and_save(0);</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    }</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;}</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment">  update gyro and accel values from backends</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01251"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a2ab4e9e49af5ae38f38d3818fde2b675"> 1251</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#a2ab4e9e49af5ae38f38d3818fde2b675">AP_InertialSensor::update</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;{</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="comment">// during initialisation update() may be called without</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <span class="comment">// wait_for_sample(), and a wait is implied</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <a class="code" href="classAP__InertialSensor.html#aa4faf114689e827390b5da7bc6fd5f20">wait_for_sample</a>();</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__InertialSensor.html#ad2d086fc49750ab9cdfeb964d874af65">_hil_mode</a>) {</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;            <span class="comment">// mark sensors unhealthy and let update() in each backend</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;            <span class="comment">// mark them healthy via _publish_gyro() and</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;            <span class="comment">// _publish_accel()</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;            <a class="code" href="classAP__InertialSensor.html#af2d2bbeee8b5e4188e111f07fa85c638">_gyro_healthy</a>[i] = <span class="keyword">false</span>;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a9139665de768ce3b171adf07191bc081">_accel_healthy</a>[i] = <span class="keyword">false</span>;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a13a4fb11b16bc1cccf146cf8003d5e00">_delta_velocity_valid</a>[i] = <span class="keyword">false</span>;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;            <a class="code" href="classAP__InertialSensor.html#ab88bb0dcef3bc396619e6efe730e8dbd">_delta_angle_valid</a>[i] = <span class="keyword">false</span>;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        }</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="classAP__InertialSensor.html#ab3bcaab30548484fd68e7f7af05f4a86">_backend_count</a>; i++) {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a1d9040309bd3ba359b20b90f4a836531">_backends</a>[i]-&gt;<a class="code" href="classAP__InertialSensor__Backend.html#a7016ddeb343d823f9fe518fd414ba848">update</a>();</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        }</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;        <span class="comment">// clear accumulators</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;        <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a75055b35bd0198fb76d42ada41c5961a">_delta_velocity_acc</a>[i].<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a920ce819aa38247290c545adbb4cd41d">_delta_velocity_acc_dt</a>[i] = 0;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a5bf613395bdc1fe69d0d22496507df4e">_delta_angle_acc</a>[i].<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a57b06a5ccbc1568b1c43537fb6576181">_delta_angle_acc_dt</a>[i] = 0;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        }</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classAP__InertialSensor.html#affe00c695b9c6af44f30bbd8c9709e64">_startup_error_counts_set</a>) {</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;            <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;                <a class="code" href="classAP__InertialSensor.html#a17c6cbc1c5bb9be0c978a2f97ee55960">_accel_startup_error_count</a>[i] = <a class="code" href="classAP__InertialSensor.html#a6bb7a0fd0a70ddb3e5e44670d82620be">_accel_error_count</a>[i];</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                <a class="code" href="classAP__InertialSensor.html#ad56df47a7d5912844ddd6d419cdacc41">_gyro_startup_error_count</a>[i] = <a class="code" href="classAP__InertialSensor.html#a83b163411ab35497224c393df40c30d0">_gyro_error_count</a>[i];</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;            }</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#af34be16f60a79389c14b2e0346b90459">_startup_ms</a> == 0) {</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                <a class="code" href="classAP__InertialSensor.html#af34be16f60a79389c14b2e0346b90459">_startup_ms</a> = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>()-<a class="code" href="classAP__InertialSensor.html#af34be16f60a79389c14b2e0346b90459">_startup_ms</a> &gt; 2000) {</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                <a class="code" href="classAP__InertialSensor.html#affe00c695b9c6af44f30bbd8c9709e64">_startup_error_counts_set</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;            }</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        }</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a6bb7a0fd0a70ddb3e5e44670d82620be">_accel_error_count</a>[i] &lt; <a class="code" href="classAP__InertialSensor.html#a17c6cbc1c5bb9be0c978a2f97ee55960">_accel_startup_error_count</a>[i]) {</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                <a class="code" href="classAP__InertialSensor.html#a17c6cbc1c5bb9be0c978a2f97ee55960">_accel_startup_error_count</a>[i] = <a class="code" href="classAP__InertialSensor.html#a6bb7a0fd0a70ddb3e5e44670d82620be">_accel_error_count</a>[i];</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;            }</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a83b163411ab35497224c393df40c30d0">_gyro_error_count</a>[i] &lt; <a class="code" href="classAP__InertialSensor.html#ad56df47a7d5912844ddd6d419cdacc41">_gyro_startup_error_count</a>[i]) {</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;                <a class="code" href="classAP__InertialSensor.html#ad56df47a7d5912844ddd6d419cdacc41">_gyro_startup_error_count</a>[i] = <a class="code" href="classAP__InertialSensor.html#a83b163411ab35497224c393df40c30d0">_gyro_error_count</a>[i];</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;            }</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        }</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        <span class="comment">// adjust health status if a sensor has a non-zero error count</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        <span class="comment">// but another sensor doesn&#39;t.</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        <span class="keywordtype">bool</span> have_zero_accel_error_count = <span class="keyword">false</span>;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        <span class="keywordtype">bool</span> have_zero_gyro_error_count = <span class="keyword">false</span>;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a9139665de768ce3b171adf07191bc081">_accel_healthy</a>[i] &amp;&amp; <a class="code" href="classAP__InertialSensor.html#a6bb7a0fd0a70ddb3e5e44670d82620be">_accel_error_count</a>[i] &lt;= <a class="code" href="classAP__InertialSensor.html#a17c6cbc1c5bb9be0c978a2f97ee55960">_accel_startup_error_count</a>[i]) {</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                have_zero_accel_error_count = <span class="keyword">true</span>;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            }</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#af2d2bbeee8b5e4188e111f07fa85c638">_gyro_healthy</a>[i] &amp;&amp; <a class="code" href="classAP__InertialSensor.html#a83b163411ab35497224c393df40c30d0">_gyro_error_count</a>[i] &lt;= <a class="code" href="classAP__InertialSensor.html#ad56df47a7d5912844ddd6d419cdacc41">_gyro_startup_error_count</a>[i]) {</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                have_zero_gyro_error_count = <span class="keyword">true</span>;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;            }</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        }</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#af2d2bbeee8b5e4188e111f07fa85c638">_gyro_healthy</a>[i] &amp;&amp; <a class="code" href="classAP__InertialSensor.html#a83b163411ab35497224c393df40c30d0">_gyro_error_count</a>[i] &gt; <a class="code" href="classAP__InertialSensor.html#ad56df47a7d5912844ddd6d419cdacc41">_gyro_startup_error_count</a>[i] &amp;&amp; have_zero_gyro_error_count) {</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;                <span class="comment">// we prefer not to use a gyro that has had errors</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;                <a class="code" href="classAP__InertialSensor.html#af2d2bbeee8b5e4188e111f07fa85c638">_gyro_healthy</a>[i] = <span class="keyword">false</span>;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;            }</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a9139665de768ce3b171adf07191bc081">_accel_healthy</a>[i] &amp;&amp; <a class="code" href="classAP__InertialSensor.html#a6bb7a0fd0a70ddb3e5e44670d82620be">_accel_error_count</a>[i] &gt; <a class="code" href="classAP__InertialSensor.html#a17c6cbc1c5bb9be0c978a2f97ee55960">_accel_startup_error_count</a>[i] &amp;&amp; have_zero_accel_error_count) {</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                <span class="comment">// we prefer not to use a accel that has had errors</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                <a class="code" href="classAP__InertialSensor.html#a9139665de768ce3b171adf07191bc081">_accel_healthy</a>[i] = <span class="keyword">false</span>;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;            }</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        }</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        <span class="comment">// set primary to first healthy accel and gyro</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#af2d2bbeee8b5e4188e111f07fa85c638">_gyro_healthy</a>[i] &amp;&amp; <a class="code" href="classAP__InertialSensor.html#ab08b54ef4cc6d1cb04b57996066a51e2">_use</a>[i]) {</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                <a class="code" href="classAP__InertialSensor.html#affd3646260c7f18a7aa76afd4b0fdd43">_primary_gyro</a> = i;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;            }</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        }</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a9139665de768ce3b171adf07191bc081">_accel_healthy</a>[i] &amp;&amp; <a class="code" href="classAP__InertialSensor.html#ab08b54ef4cc6d1cb04b57996066a51e2">_use</a>[i]) {</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;                <a class="code" href="classAP__InertialSensor.html#af566c6efe39ea6660adab9c68baede28">_primary_accel</a> = i;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;            }</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;        }</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    }</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <a class="code" href="classAP__InertialSensor.html#ae58893789a24a249e7338892d90da51e">_last_update_usec</a> = <a class="code" href="namespaceAP__HAL.html#a8293355e35887733b1fd151aef08a787">AP_HAL::micros</a>();</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    </div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a08d15014b321673a9dca76bec82ec482">_have_sample</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;}</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">  wait for a sample to be available. This is the function that</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">  determines the timing of the main loop in ardupilot.</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="comment">  Ideally this function would return at exactly the rate given by the</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="comment">  sample_rate argument given to AP_InertialSensor::init().</span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="comment">  The key output of this function is _delta_time, which is the time</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment">  over which the gyro and accel integration will happen for this</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment">  sample. We want that to be a constant time if possible, but if</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment">  delays occur we need to cope with them. The long term sum of</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment">  _delta_time should be exactly equal to the wall clock elapsed time</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01358"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#aa4faf114689e827390b5da7bc6fd5f20"> 1358</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#aa4faf114689e827390b5da7bc6fd5f20">AP_InertialSensor::wait_for_sample</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;{</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a08d15014b321673a9dca76bec82ec482">_have_sample</a>) {</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        <span class="comment">// the user has called wait_for_sample() again without</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        <span class="comment">// consuming the sample with update()</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    }</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    uint32_t now = <a class="code" href="namespaceAP__HAL.html#a8293355e35887733b1fd151aef08a787">AP_HAL::micros</a>();</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a> == 0 &amp;&amp; <a class="code" href="classAP__InertialSensor.html#aa4ab6d3141cc30a917961efa0c5e7054">_delta_time</a> &lt;= 0) {</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <span class="comment">// this is the first call to wait_for_sample()</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a5a484543c8865592e07cac290dd40ef4">_last_sample_usec</a> = now - <a class="code" href="classAP__InertialSensor.html#ab6d1a4fc496f6e2b1c5ca0fdc74f2f9c">_sample_period_usec</a>;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a> = now + <a class="code" href="classAP__InertialSensor.html#ab6d1a4fc496f6e2b1c5ca0fdc74f2f9c">_sample_period_usec</a>;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        <span class="keywordflow">goto</span> check_sample;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    }</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <span class="comment">// see how long it is till the next sample is due</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a> - now &lt;=<a class="code" href="classAP__InertialSensor.html#ab6d1a4fc496f6e2b1c5ca0fdc74f2f9c">_sample_period_usec</a>) {</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        <span class="comment">// we&#39;re ahead on time, schedule next sample at expected period</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        uint32_t wait_usec = <a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a> - now;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#aa0beaea3a0ce331569f7617c10a06f53">delay_microseconds_boost</a>(wait_usec);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        uint32_t now2 = <a class="code" href="namespaceAP__HAL.html#a8293355e35887733b1fd151aef08a787">AP_HAL::micros</a>();</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        <span class="keywordflow">if</span> (now2+100 &lt; <a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a>) {</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            <a class="code" href="AP__InertialSensor_8cpp.html#ac4110b4ae0e9c8b457c658eb451b609a">timing_printf</a>(<span class="stringliteral">&quot;shortsleep %u\n&quot;</span>, (<span class="keywordtype">unsigned</span>)(<a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a>-now2));</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;        }</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        <span class="keywordflow">if</span> (now2 &gt; <a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a>+400) {</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;            <a class="code" href="AP__InertialSensor_8cpp.html#ac4110b4ae0e9c8b457c658eb451b609a">timing_printf</a>(<span class="stringliteral">&quot;longsleep %u wait_usec=%u\n&quot;</span>,</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;                          (<span class="keywordtype">unsigned</span>)(now2-<a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a>),</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;                          (<span class="keywordtype">unsigned</span>)wait_usec);</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        }</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a> += <a class="code" href="classAP__InertialSensor.html#ab6d1a4fc496f6e2b1c5ca0fdc74f2f9c">_sample_period_usec</a>;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (now - <a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a> &lt; <a class="code" href="classAP__InertialSensor.html#ab6d1a4fc496f6e2b1c5ca0fdc74f2f9c">_sample_period_usec</a>/8) {</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        <span class="comment">// we&#39;ve overshot, but only by a small amount, keep on</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        <span class="comment">// schedule with no delay</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#ac4110b4ae0e9c8b457c658eb451b609a">timing_printf</a>(<span class="stringliteral">&quot;overshoot1 %u\n&quot;</span>, (<span class="keywordtype">unsigned</span>)(now-<a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a>));</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a> += <a class="code" href="classAP__InertialSensor.html#ab6d1a4fc496f6e2b1c5ca0fdc74f2f9c">_sample_period_usec</a>;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;        <span class="comment">// we&#39;ve overshot by a larger amount, re-zero scheduling with</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <span class="comment">// no delay</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#ac4110b4ae0e9c8b457c658eb451b609a">timing_printf</a>(<span class="stringliteral">&quot;overshoot2 %u\n&quot;</span>, (<span class="keywordtype">unsigned</span>)(now-<a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a>));</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">_next_sample_usec</a> = now + <a class="code" href="classAP__InertialSensor.html#ab6d1a4fc496f6e2b1c5ca0fdc74f2f9c">_sample_period_usec</a>;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    }</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;check_sample:</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__InertialSensor.html#ad2d086fc49750ab9cdfeb964d874af65">_hil_mode</a>) {</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        <span class="comment">// now we wait until we have the gyro and accel samples we need</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        uint8_t gyro_available_mask = 0;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        uint8_t accel_available_mask = 0;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;        uint32_t wait_counter = 0;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;            <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="classAP__InertialSensor.html#ab3bcaab30548484fd68e7f7af05f4a86">_backend_count</a>; i++) {</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;                <span class="comment">// this is normally a nop, but can be used by backends</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                <span class="comment">// that don&#39;t accumulate samples on a timer</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                <a class="code" href="classAP__InertialSensor.html#a1d9040309bd3ba359b20b90f4a836531">_backends</a>[i]-&gt;<a class="code" href="classAP__InertialSensor__Backend.html#af4c09c40d7977ee0406c91134d6c3dca">accumulate</a>();</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;            }</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;            <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a>; i++) {</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ab18eaf3fc2c3b075d95d166032b787bd">_new_gyro_data</a>[i]) {</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;                    <span class="keyword">const</span> uint8_t imask = (1U&lt;&lt;i);</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                    gyro_available_mask |= imask;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ab08b54ef4cc6d1cb04b57996066a51e2">_use</a>[i]) {</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                        <a class="code" href="classAP__InertialSensor.html#aa88c1ceb397cffac32226064f45b1516">_gyro_wait_mask</a> |= imask;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                        <a class="code" href="classAP__InertialSensor.html#aa88c1ceb397cffac32226064f45b1516">_gyro_wait_mask</a> &amp;= ~imask;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;                    }</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                }</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;            }</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;            <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>; i++) {</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a796b4e67bfa9f882fe11fc8e2d867950">_new_accel_data</a>[i]) {</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;                    <span class="keyword">const</span> uint8_t imask = (1U&lt;&lt;i);</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;                    accel_available_mask |= imask;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ab08b54ef4cc6d1cb04b57996066a51e2">_use</a>[i]) {</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;                        <a class="code" href="classAP__InertialSensor.html#ac3baf37d8631bb05df22edc12a99db23">_accel_wait_mask</a> |= imask;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                        <a class="code" href="classAP__InertialSensor.html#ac3baf37d8631bb05df22edc12a99db23">_accel_wait_mask</a> &amp;= ~imask;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                    }</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;                }</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;            }</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;            <span class="comment">// we wait for up to 800us to get all of the required</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;            <span class="comment">// accel and gyro samples. After that we accept at least</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;            <span class="comment">// one of each</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;            <span class="keywordflow">if</span> (wait_counter &lt; 7) {</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;                <span class="keywordflow">if</span> (gyro_available_mask &amp;&amp;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;                    ((gyro_available_mask &amp; <a class="code" href="classAP__InertialSensor.html#aa88c1ceb397cffac32226064f45b1516">_gyro_wait_mask</a>) == <a class="code" href="classAP__InertialSensor.html#aa88c1ceb397cffac32226064f45b1516">_gyro_wait_mask</a>) &amp;&amp;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;                    accel_available_mask &amp;&amp;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;                    ((accel_available_mask &amp; <a class="code" href="classAP__InertialSensor.html#ac3baf37d8631bb05df22edc12a99db23">_accel_wait_mask</a>) == <a class="code" href="classAP__InertialSensor.html#ac3baf37d8631bb05df22edc12a99db23">_accel_wait_mask</a>)) {</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                }</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;                <span class="keywordflow">if</span> (gyro_available_mask &amp;&amp; accel_available_mask) {</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                    <span class="comment">// reset the wait mask so we don&#39;t keep delaying</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;                    <span class="comment">// for a dead IMU on the next loop. As soon as it</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;                    <span class="comment">// comes back we will start waiting on it again</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;                    <a class="code" href="classAP__InertialSensor.html#aa88c1ceb397cffac32226064f45b1516">_gyro_wait_mask</a> &amp;= gyro_available_mask;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                    <a class="code" href="classAP__InertialSensor.html#ac3baf37d8631bb05df22edc12a99db23">_accel_wait_mask</a> &amp;= accel_available_mask;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                }</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;            }</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;            <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#aa0beaea3a0ce331569f7617c10a06f53">delay_microseconds_boost</a>(100);</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;            wait_counter++;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        }</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    }</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    now = <a class="code" href="namespaceAP__HAL.html#a8293355e35887733b1fd151aef08a787">AP_HAL::micros</a>();</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ad2d086fc49750ab9cdfeb964d874af65">_hil_mode</a> &amp;&amp; <a class="code" href="classAP__InertialSensor.html#abbeb2317c4a19ae1c3ee1a31ee960c8e">_hil</a>.delta_time &gt; 0) {</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;        <a class="code" href="classAP__InertialSensor.html#aa4ab6d3141cc30a917961efa0c5e7054">_delta_time</a> = <a class="code" href="classAP__InertialSensor.html#abbeb2317c4a19ae1c3ee1a31ee960c8e">_hil</a>.delta_time;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        <a class="code" href="classAP__InertialSensor.html#abbeb2317c4a19ae1c3ee1a31ee960c8e">_hil</a>.delta_time = 0;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <a class="code" href="classAP__InertialSensor.html#aa4ab6d3141cc30a917961efa0c5e7054">_delta_time</a> = (now - <a class="code" href="classAP__InertialSensor.html#a5a484543c8865592e07cac290dd40ef4">_last_sample_usec</a>) * 1.0e-6<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    }</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a5a484543c8865592e07cac290dd40ef4">_last_sample_usec</a> = now;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    {</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        <span class="keyword">static</span> uint64_t delta_time_sum;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        <span class="keyword">static</span> uint16_t <a class="code" href="BARO__generic_8cpp.html#a0480b812cba9c1d9c71a5fb1071bd0fc">counter</a>;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        <span class="keywordflow">if</span> (delta_time_sum == 0) {</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;            delta_time_sum = <a class="code" href="classAP__InertialSensor.html#ab6d1a4fc496f6e2b1c5ca0fdc74f2f9c">_sample_period_usec</a>;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        }</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        delta_time_sum += <a class="code" href="classAP__InertialSensor.html#aa4ab6d3141cc30a917961efa0c5e7054">_delta_time</a> * 1.0e6f;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="BARO__generic_8cpp.html#a0480b812cba9c1d9c71a5fb1071bd0fc">counter</a>++ == 400) {</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;            <a class="code" href="BARO__generic_8cpp.html#a0480b812cba9c1d9c71a5fb1071bd0fc">counter</a> = 0;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;            <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">console</a>-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">printf</a>(<span class="stringliteral">&quot;now=%lu _delta_time_sum=%lu diff=%ld\n&quot;</span>,</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;                                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)now,</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;                                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)delta_time_sum,</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;                                (<span class="keywordtype">long</span>)(now - delta_time_sum));</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;        }</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    }</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a08d15014b321673a9dca76bec82ec482">_have_sample</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;}</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="comment">  get delta angles</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01499"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#aa083993c3519c16ad9740e4bbaa1691c"> 1499</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#aa083993c3519c16ad9740e4bbaa1691c">AP_InertialSensor::get_delta_angle</a>(uint8_t i, <a class="code" href="classVector3.html">Vector3f</a> &amp;delta_angle)<span class="keyword"> const</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ab88bb0dcef3bc396619e6efe730e8dbd">_delta_angle_valid</a>[i]) {</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        delta_angle = <a class="code" href="classAP__InertialSensor.html#a8069c8ad90f59f285d121dd615f5a93e">_delta_angle</a>[i];</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#adab0e15f297d55a8436b607627db0e5f">get_gyro_health</a>(i)) {</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        <span class="comment">// provide delta angle from raw gyro, so we use the same code</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        <span class="comment">// at higher level</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        delta_angle = <a class="code" href="classAP__InertialSensor.html#a59056c961e7d7d6884366103791d54ee">get_gyro</a>(i) * <a class="code" href="classAP__InertialSensor.html#a4f9e51600bcadecad5830ae56b0771a3">get_delta_time</a>();</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    }</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;}</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="comment">  get delta velocity if available</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01516"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#acf640603eda1929a2487c4fbba73616e"> 1516</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#acf640603eda1929a2487c4fbba73616e">AP_InertialSensor::get_delta_velocity</a>(uint8_t i, <a class="code" href="classVector3.html">Vector3f</a> &amp;delta_velocity)<span class="keyword"> const</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a13a4fb11b16bc1cccf146cf8003d5e00">_delta_velocity_valid</a>[i]) {</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        delta_velocity = <a class="code" href="classAP__InertialSensor.html#a1c1eed3a078805b7647b2a29b612ff26">_delta_velocity</a>[i];</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a5b42199f260d9523973a51debd99146e">get_accel_health</a>(i)) {</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        delta_velocity = <a class="code" href="classAP__InertialSensor.html#ab39d50c9e078ac925746d92af042ba64">get_accel</a>(i) * <a class="code" href="classAP__InertialSensor.html#a4f9e51600bcadecad5830ae56b0771a3">get_delta_time</a>();</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    }</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;}</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="comment">  return delta_time for the delta_velocity</span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01531"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a793f4fda9fbd8a49f15411bc93c9ed5a"> 1531</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classAP__InertialSensor.html#a1a426186787270ddfc7d9e11c0b02697">AP_InertialSensor::get_delta_velocity_dt</a>(uint8_t i)<span class="keyword"> const</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <span class="keywordtype">float</span> ret;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a13a4fb11b16bc1cccf146cf8003d5e00">_delta_velocity_valid</a>[i]) {</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        ret = <a class="code" href="classAP__InertialSensor.html#a5f5f5ff54f65d31d262cf04587cf7ddd">_delta_velocity_dt</a>[i];</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;        ret = <a class="code" href="classAP__InertialSensor.html#a4f9e51600bcadecad5830ae56b0771a3">get_delta_time</a>();</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    }</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    ret = <a class="code" href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a>(ret, <a class="code" href="classAP__InertialSensor.html#a8fe1e7429d858b619847e0ae77f3354c">_loop_delta_t_max</a>);</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;}</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="comment">  return delta_time for the delta_angle</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01546"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#af637913ab040f5235129465a11f7d9cc"> 1546</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classAP__InertialSensor.html#a71227b1d7ac5a8243d4f61a98affaf2a">AP_InertialSensor::get_delta_angle_dt</a>(uint8_t i)<span class="keyword"> const</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="keywordtype">float</span> ret;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ab88bb0dcef3bc396619e6efe730e8dbd">_delta_angle_valid</a>[i] &amp;&amp; <a class="code" href="classAP__InertialSensor.html#a2fc042e6ca2b9116bd8c44c0fe3fe7a6">_delta_angle_dt</a>[i] &gt; 0) {</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;        ret = <a class="code" href="classAP__InertialSensor.html#a2fc042e6ca2b9116bd8c44c0fe3fe7a6">_delta_angle_dt</a>[i];</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        ret = <a class="code" href="classAP__InertialSensor.html#a4f9e51600bcadecad5830ae56b0771a3">get_delta_time</a>();</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    }</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    ret = <a class="code" href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a>(ret, <a class="code" href="classAP__InertialSensor.html#a8fe1e7429d858b619847e0ae77f3354c">_loop_delta_t_max</a>);</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;}</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="comment">  support for setting accel and gyro vectors, for use by HIL</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01562"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#af6c3c7d041de7c89c9afeda319acbf7d"> 1562</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#af6c3c7d041de7c89c9afeda319acbf7d">AP_InertialSensor::set_accel</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <span class="keyword">const</span> <a class="code" href="classVector3.html">Vector3f</a> &amp;accel)</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;{</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a> == 0) {</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;        <span class="comment">// we haven&#39;t initialised yet</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    }</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &lt; <a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>) {</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;        <a class="code" href="classAP__InertialSensor.html#abb556b6d94ee6a7676c8fe5bbc1ec0a8">_accel</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] = accel;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a9139665de768ce3b171adf07191bc081">_accel_healthy</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] = <span class="keyword">true</span>;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a> &lt;= <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>) {</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a> = <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>+1;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;        }</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classAP__InertialSensor.html#a9139665de768ce3b171adf07191bc081">_accel_healthy</a>[<a class="code" href="classAP__InertialSensor.html#af566c6efe39ea6660adab9c68baede28">_primary_accel</a>]) {</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;            <a class="code" href="classAP__InertialSensor.html#af566c6efe39ea6660adab9c68baede28">_primary_accel</a> = <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;        }</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    }</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;}</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div><div class="line"><a name="l01580"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a454e1c877ab24b8623da6432a850a5c5"> 1580</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#a454e1c877ab24b8623da6432a850a5c5">AP_InertialSensor::set_gyro</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <span class="keyword">const</span> <a class="code" href="classVector3.html">Vector3f</a> &amp;gyro)</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;{</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a> == 0) {</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;        <span class="comment">// we haven&#39;t initialised yet</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    }</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &lt; <a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>) {</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        <a class="code" href="classAP__InertialSensor.html#adafd6f05918b4a355baf47cc44e408ef">_gyro</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] = gyro;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        <a class="code" href="classAP__InertialSensor.html#af2d2bbeee8b5e4188e111f07fa85c638">_gyro_healthy</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] = <span class="keyword">true</span>;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a> &lt;= <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>) {</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;            <a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a> = <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>+1;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;            <a class="code" href="classAP__InertialSensor.html#aa8ac7e294cc5ed4ea30ab1fd5e1b6637">_gyro_cal_ok</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] = <span class="keyword">true</span>;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        }</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classAP__InertialSensor.html#a9139665de768ce3b171adf07191bc081">_accel_healthy</a>[<a class="code" href="classAP__InertialSensor.html#af566c6efe39ea6660adab9c68baede28">_primary_accel</a>]) {</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;            <a class="code" href="classAP__InertialSensor.html#af566c6efe39ea6660adab9c68baede28">_primary_accel</a> = <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;        }</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    }</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;}</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="comment">  set delta time for next ins.update()</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01602"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a6dc88d5a47d3e85bf76d05f68873e752"> 1602</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#a6dc88d5a47d3e85bf76d05f68873e752">AP_InertialSensor::set_delta_time</a>(<span class="keywordtype">float</span> delta_time)</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;{</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <a class="code" href="classAP__InertialSensor.html#abbeb2317c4a19ae1c3ee1a31ee960c8e">_hil</a>.delta_time = <a class="code" href="classAP__InertialSensor.html#a17883a4a4ad070fac8d3111e9173aa16">delta_time</a>;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;}</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment">  set delta velocity for next update</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01610"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a5c053dbfad16102ff1183fae2bbbb6b0"> 1610</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#a5c053dbfad16102ff1183fae2bbbb6b0">AP_InertialSensor::set_delta_velocity</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <span class="keywordtype">float</span> deltavt, <span class="keyword">const</span> <a class="code" href="classVector3.html">Vector3f</a> &amp;deltav)</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;{</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &lt; <a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>) {</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a13a4fb11b16bc1cccf146cf8003d5e00">_delta_velocity_valid</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] = <span class="keyword">true</span>;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a1c1eed3a078805b7647b2a29b612ff26">_delta_velocity</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] = deltav;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a5f5f5ff54f65d31d262cf04587cf7ddd">_delta_velocity_dt</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] = deltavt;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    }</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;}</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="comment">  set delta angle for next update</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01622"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a306d1d720c0c1f71965c44d6f4693fce"> 1622</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#a306d1d720c0c1f71965c44d6f4693fce">AP_InertialSensor::set_delta_angle</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <span class="keyword">const</span> <a class="code" href="classVector3.html">Vector3f</a> &amp;deltaa, <span class="keywordtype">float</span> deltaat)</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;{</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &lt; <a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>) {</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ab88bb0dcef3bc396619e6efe730e8dbd">_delta_angle_valid</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] = <span class="keyword">true</span>;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a8069c8ad90f59f285d121dd615f5a93e">_delta_angle</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] = deltaa;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a2fc042e6ca2b9116bd8c44c0fe3fe7a6">_delta_angle_dt</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] = deltaat;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;    }</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;}</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="comment"> * Get an AuxiliaryBus of N @instance of backend identified by @backend_id</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01634"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#ad649def5689aecaebca16cf910d77fd8"> 1634</a></span>&#160;<a class="code" href="classAuxiliaryBus.html">AuxiliaryBus</a> *<a class="code" href="classAP__InertialSensor.html#a98fb28755e41d2e2052c500b7ac3e2b6">AP_InertialSensor::get_auxiliary_bus</a>(int16_t backend_id, uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;{</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a8967734e82a4f472c6d8ddd8db656804">detect_backends</a>();</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <a class="code" href="classAP__InertialSensor__Backend.html">AP_InertialSensor_Backend</a> *backend = <a class="code" href="classAP__InertialSensor.html#a3fc473466ffcccef319c4c5e56cd1f9d">_find_backend</a>(backend_id, <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>);</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    <span class="keywordflow">if</span> (backend == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    }</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <span class="keywordflow">return</span> backend-&gt;<a class="code" href="classAP__InertialSensor__Backend.html#ad82c0f73f041cf67d1470f9fd185f049">get_auxiliary_bus</a>();</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;}</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="comment">// calculate vibration levels and check for accelerometer clipping (called by a backends)</span></div><div class="line"><a name="l01647"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a49643a308463775eb7f7f3d8be13a034"> 1647</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#a49643a308463775eb7f7f3d8be13a034">AP_InertialSensor::calc_vibration_and_clipping</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <span class="keyword">const</span> <a class="code" href="classVector3.html">Vector3f</a> &amp;accel, <span class="keywordtype">float</span> dt)</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;{</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    <span class="comment">// check for clipping</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a1d9040309bd3ba359b20b90f4a836531">_backends</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>] == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    }</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    <span class="keywordflow">if</span> (fabsf(accel.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>) &gt;  <a class="code" href="classAP__InertialSensor.html#a1d9040309bd3ba359b20b90f4a836531">_backends</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__InertialSensor__Backend.html#a86d773e553328d1874cc8bfac1a22b10">get_clip_limit</a>() ||</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;        fabsf(accel.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>) &gt;  <a class="code" href="classAP__InertialSensor.html#a1d9040309bd3ba359b20b90f4a836531">_backends</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__InertialSensor__Backend.html#a86d773e553328d1874cc8bfac1a22b10">get_clip_limit</a>() ||</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        fabsf(accel.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>) &gt; <a class="code" href="classAP__InertialSensor.html#a1d9040309bd3ba359b20b90f4a836531">_backends</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]-&gt;<a class="code" href="classAP__InertialSensor__Backend.html#a86d773e553328d1874cc8bfac1a22b10">get_clip_limit</a>()) {</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a681fb041567d15f5d73e9ee647770a97">_accel_clip_count</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>]++;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    }</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="comment">// calculate vibration levels</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &lt; <a class="code" href="AP__InertialSensor_8h.html#a04f48700bcfc9677a766c604968798c3">INS_VIBRATION_CHECK_INSTANCES</a>) {</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        <span class="comment">// filter accel at 5hz</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> accel_filt = <a class="code" href="classAP__InertialSensor.html#a4510aa7e7f3bac446f03004c9dda84f8">_accel_vibe_floor_filter</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="classLowPassFilter.html#aa390849d2e18ff3287f92b89d8657841">apply</a>(accel, dt);</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="comment">// calc difference from this sample and 5hz filtered value, square and filter at 2hz</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> accel_diff = (accel - accel_filt);</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;        accel_diff.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> *= accel_diff.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        accel_diff.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> *= accel_diff.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        accel_diff.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> *= accel_diff.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ae686d41dc8123df61020bbfabc10901c">_accel_vibe_filter</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="classLowPassFilter.html#aa390849d2e18ff3287f92b89d8657841">apply</a>(accel_diff, dt);</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    }</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;}</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;<span class="comment">// peak hold detector for slower mechanisms to detect spikes</span></div><div class="line"><a name="l01674"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#ab6c1ac320a391b320ddaa5ad27265b53"> 1674</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#ab6c1ac320a391b320ddaa5ad27265b53">AP_InertialSensor::set_accel_peak_hold</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>, <span class="keyword">const</span> <a class="code" href="classVector3.html">Vector3f</a> &amp;accel)</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;{</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> != <a class="code" href="classAP__InertialSensor.html#af566c6efe39ea6660adab9c68baede28">_primary_accel</a>) {</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        <span class="comment">// we only record for primary accel</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    }</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    uint32_t now = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    <span class="comment">// negative x peak(min) hold detector</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <span class="keywordflow">if</span> (accel.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> &lt; <a class="code" href="classAP__InertialSensor.html#a394ea69014613b43fea7f73bfb6f30a1">_peak_hold_state</a>.<a class="code" href="structAP__InertialSensor_1_1PeakHoldState.html#acbeb15dd194d956bf945bc8b785667bf">accel_peak_hold_neg_x</a> ||</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a394ea69014613b43fea7f73bfb6f30a1">_peak_hold_state</a>.<a class="code" href="structAP__InertialSensor_1_1PeakHoldState.html#aa999bcc4cfd0770a4289d57b323cb827">accel_peak_hold_neg_x_age</a> &lt;= now) {</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a394ea69014613b43fea7f73bfb6f30a1">_peak_hold_state</a>.<a class="code" href="structAP__InertialSensor_1_1PeakHoldState.html#acbeb15dd194d956bf945bc8b785667bf">accel_peak_hold_neg_x</a> = accel.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a394ea69014613b43fea7f73bfb6f30a1">_peak_hold_state</a>.<a class="code" href="structAP__InertialSensor_1_1PeakHoldState.html#aa999bcc4cfd0770a4289d57b323cb827">accel_peak_hold_neg_x_age</a> = now + <a class="code" href="AP__InertialSensor_8h.html#a0f6117b20d199660168eef799c1caaa2">AP_INERTIAL_SENSOR_ACCEL_PEAK_DETECT_TIMEOUT_MS</a>;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    }</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;}</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="comment">// retrieve latest calculated vibration levels</span></div><div class="line"><a name="l01691"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#acaa2b0f18761ea6ba45997b7e43b3fec"> 1691</a></span>&#160;<a class="code" href="classVector3.html">Vector3f</a> <a class="code" href="classAP__InertialSensor.html#ae32fc128098640c8a2592f1e377e274b">AP_InertialSensor::get_vibration_levels</a>(uint8_t <a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)<span class="keyword"> const</span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> vibe;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> &lt; <a class="code" href="AP__InertialSensor_8h.html#a04f48700bcfc9677a766c604968798c3">INS_VIBRATION_CHECK_INSTANCES</a>) {</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        vibe = <a class="code" href="classAP__InertialSensor.html#ae686d41dc8123df61020bbfabc10901c">_accel_vibe_filter</a>[<a class="code" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>].<a class="code" href="classLowPassFilter.html#a34bc75aa770bc6cc0facee3b43a05bec">get</a>();</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;        vibe.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = <a class="code" href="AP__Math_8cpp.html#ac89eb1832d8e4d67fcf1ac07e3c25184">safe_sqrt</a>(vibe.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>);</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        vibe.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = <a class="code" href="AP__Math_8cpp.html#ac89eb1832d8e4d67fcf1ac07e3c25184">safe_sqrt</a>(vibe.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        vibe.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = <a class="code" href="AP__Math_8cpp.html#ac89eb1832d8e4d67fcf1ac07e3c25184">safe_sqrt</a>(vibe.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>);</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    }</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    <span class="keywordflow">return</span> vibe;</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;}</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="comment">// check for vibration movement. Return true if all axis show nearly zero movement</span></div><div class="line"><a name="l01704"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a7179321b8fa49dd4f6ef84380faf5f7d"> 1704</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#a7179321b8fa49dd4f6ef84380faf5f7d">AP_InertialSensor::is_still</a>()</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;{</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> vibe = <a class="code" href="classAP__InertialSensor.html#ae32fc128098640c8a2592f1e377e274b">get_vibration_levels</a>();</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="keywordflow">return</span> (vibe.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> &lt; <a class="code" href="classAP__InertialSensor.html#a250520e85a272563a54924f26d18d181">_still_threshold</a>) &amp;&amp;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;           (vibe.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> &lt; <a class="code" href="classAP__InertialSensor.html#a250520e85a272563a54924f26d18d181">_still_threshold</a>) &amp;&amp;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;           (vibe.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> &lt; <a class="code" href="classAP__InertialSensor.html#a250520e85a272563a54924f26d18d181">_still_threshold</a>);</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;}</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;<span class="comment">// initialise and register accel calibrator</span></div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;<span class="comment">// called during the startup of accel cal</span></div><div class="line"><a name="l01714"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#ad04cd1cbcc7c31914e3dbcaf7eb83b19"> 1714</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#ad04cd1cbcc7c31914e3dbcaf7eb83b19">AP_InertialSensor::acal_init</a>()</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;{</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    <span class="comment">// NOTE: these objects are never deallocated because the pre-arm checks force a reboot</span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a0250547290ca2b46966f8ff902cb22bc">_acal</a> == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a0250547290ca2b46966f8ff902cb22bc">_acal</a> = <span class="keyword">new</span> <a class="code" href="classAP__AccelCal__Client.html#a4216923ec8a556736f1edcf39a4d5ff1">AP_AccelCal</a>;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    }</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a2ea473397ac26c55efa8d5e5fd5a9f65">_accel_calibrator</a> == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a2ea473397ac26c55efa8d5e5fd5a9f65">_accel_calibrator</a> = <span class="keyword">new</span> <a class="code" href="classAccelCalibrator.html">AccelCalibrator</a>[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    }</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;}</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;<span class="comment">// update accel calibrator</span></div><div class="line"><a name="l01726"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a9ca5d711a97f4c33fe6a7c31b1329761"> 1726</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#a9ca5d711a97f4c33fe6a7c31b1329761">AP_InertialSensor::acal_update</a>()</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;{</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classAP__InertialSensor.html#a0250547290ca2b46966f8ff902cb22bc">_acal</a> == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    }</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    <a class="code" href="Scheduler_8h.html#a538ef95a13e6bf98cc2e008c2a8b9a44">EXPECT_DELAY_MS</a>(20000);</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a0250547290ca2b46966f8ff902cb22bc">_acal</a>-&gt;<a class="code" href="classAP__AccelCal.html#a5a2c8a471866eff24b340cc9680f9868">update</a>();</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code" href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">get_soft_armed</a>() &amp;&amp; <a class="code" href="classAP__InertialSensor.html#a0250547290ca2b46966f8ff902cb22bc">_acal</a>-&gt;<a class="code" href="classAP__AccelCal.html#ab06f0152811223855531003e5fac5b6e">get_status</a>() != <a class="code" href="AccelCalibrator_8h.html#a03e56e1184d0da13e790f7f21db96044a4fcbc7b305146f3f43f6f4268a69bab9">ACCEL_CAL_NOT_STARTED</a>) {</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a0250547290ca2b46966f8ff902cb22bc">_acal</a>-&gt;<a class="code" href="classAP__AccelCal.html#a43c12755c810581bbbf236bb7fd1c2d0">cancel</a>();</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    }</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;}</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">    set and save accelerometer bias along with trim calculation</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01743"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a11e7c418e9e8f31edf82a74588d5c9de"> 1743</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#a11e7c418e9e8f31edf82a74588d5c9de">AP_InertialSensor::_acal_save_calibrations</a>()</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;{</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> bias, gain;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>; i++) {</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a2ea473397ac26c55efa8d5e5fd5a9f65">_accel_calibrator</a>[i].get_status() == <a class="code" href="AccelCalibrator_8h.html#a03e56e1184d0da13e790f7f21db96044a68d1d9cf45dde19e104f352525b34c8e">ACCEL_CAL_SUCCESS</a>) {</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a2ea473397ac26c55efa8d5e5fd5a9f65">_accel_calibrator</a>[i].<a class="code" href="classAccelCalibrator.html#a3c63e8d4d5c0c7fd7169e9e0aadd9941">get_calibration</a>(bias, gain);</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a5096e33c19b3f59a284b241ac7f9b1ad">_accel_offset</a>[i].set_and_save(bias);</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;            <a class="code" href="classAP__InertialSensor.html#acfa1bbafefac03971538923ffcd1641a">_accel_scale</a>[i].set_and_save(gain);</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;            <a class="code" href="classAP__InertialSensor.html#ada31f9669cfd8503daf08aa0a7f3f77f">_accel_id</a>[i].save();</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;            <a class="code" href="classAP__InertialSensor.html#ae840940f433011c353a91fa25ce1e197">_accel_id_ok</a>[i] = <span class="keyword">true</span>;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a5096e33c19b3f59a284b241ac7f9b1ad">_accel_offset</a>[i].set_and_save(<a class="code" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>());</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;            <a class="code" href="classAP__InertialSensor.html#acfa1bbafefac03971538923ffcd1641a">_accel_scale</a>[i].set_and_save(<a class="code" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>());</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        }</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    }</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="comment">// clear any unused accels</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>; i&lt;<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        <a class="code" href="classAP__InertialSensor.html#ada31f9669cfd8503daf08aa0a7f3f77f">_accel_id</a>[i].set_and_save(0);</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a5096e33c19b3f59a284b241ac7f9b1ad">_accel_offset</a>[i].set_and_save(<a class="code" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>());</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        <a class="code" href="classAP__InertialSensor.html#acfa1bbafefac03971538923ffcd1641a">_accel_scale</a>[i].set_and_save(<a class="code" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>());</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    }</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    </div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> aligned_sample;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> misaligned_sample;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="keywordflow">switch</span>(<a class="code" href="classAP__InertialSensor.html#a2d39b95156b74f51a7f2af62fd7e1021">_trim_option</a>) {</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;        <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;        <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;            <span class="comment">// The first level step of accel cal will be taken as gnd truth,</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;            <span class="comment">// i.e. trim will be set as per the output of primary accel from the level step</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a34fd6b5d563528cc308675bcaedaac04">get_primary_accel_cal_sample_avg</a>(0,aligned_sample);</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a95b97874def2b103e907fd6bbb119726">_trim_pitch</a> = atan2f(aligned_sample.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, <a class="code" href="AP__Math_8h.html#a45fe9f81332c93a04d1fdbcf0bc89c29">norm</a>(aligned_sample.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>, aligned_sample.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>));</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a7a92b7a4048cc317fd15cea483745953">_trim_roll</a> = atan2f(-aligned_sample.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>, -aligned_sample.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>);</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a72885d6d01f968f8744fe51eeec133fd">_new_trim</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;            <span class="comment">// Reference accel is truth, in this scenario there is a reference accel</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            <span class="comment">// as mentioned in ACC_BODY_ALIGNED</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a34fd6b5d563528cc308675bcaedaac04">get_primary_accel_cal_sample_avg</a>(0,misaligned_sample) &amp;&amp; <a class="code" href="classAP__InertialSensor.html#a0057feca5b296de7871d3e524c5f5630">get_fixed_mount_accel_cal_sample</a>(0,aligned_sample)) {</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;                <span class="comment">// determine trim from aligned sample vs misaligned sample</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;                <a class="code" href="classVector3.html">Vector3f</a> cross = (misaligned_sample%aligned_sample);</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;                <span class="keywordtype">float</span> dot = (misaligned_sample*aligned_sample);</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;                <a class="code" href="classQuaternion.html">Quaternion</a> q(<a class="code" href="AP__Math_8cpp.html#ac89eb1832d8e4d67fcf1ac07e3c25184">safe_sqrt</a>(<a class="code" href="AP__Math_8h.html#a0375e3d67fd3911cacee5c3e1408c0f2">sq</a>(misaligned_sample.<a class="code" href="classVector3.html#afcdfe81173c23d57e4a53a0282cddae7">length</a>())*<a class="code" href="AP__Math_8h.html#a0375e3d67fd3911cacee5c3e1408c0f2">sq</a>(aligned_sample.<a class="code" href="classVector3.html#afcdfe81173c23d57e4a53a0282cddae7">length</a>()))+dot, cross.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, cross.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>, cross.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>);</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;                q.<a class="code" href="classQuaternion.html#a48e6bafb249c895ed25f29dc9170e11e">normalize</a>();</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;                <a class="code" href="classAP__InertialSensor.html#a7a92b7a4048cc317fd15cea483745953">_trim_roll</a> = q.get_euler_roll();</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;                <a class="code" href="classAP__InertialSensor.html#a95b97874def2b103e907fd6bbb119726">_trim_pitch</a> = q.get_euler_pitch();</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;                <a class="code" href="classAP__InertialSensor.html#a72885d6d01f968f8744fe51eeec133fd">_new_trim</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;            }</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a72885d6d01f968f8744fe51eeec133fd">_new_trim</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;            <span class="comment">/* no break */</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    }</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    <span class="keywordflow">if</span> (fabsf(<a class="code" href="classAP__InertialSensor.html#a7a92b7a4048cc317fd15cea483745953">_trim_roll</a>) &gt; <a class="code" href="AP__Math_8h.html#a37d7c62a8231d9d22826261297b99da4">radians</a>(10) ||</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;        fabsf(<a class="code" href="classAP__InertialSensor.html#a95b97874def2b103e907fd6bbb119726">_trim_pitch</a>) &gt; <a class="code" href="AP__Math_8h.html#a37d7c62a8231d9d22826261297b99da4">radians</a>(10)) {</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">console</a>-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">printf</a>(<span class="stringliteral">&quot;ERR: Trim over maximum of 10 degrees!!&quot;</span>);</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a72885d6d01f968f8744fe51eeec133fd">_new_trim</a> = <span class="keyword">false</span>;  <span class="comment">//we have either got faulty level during acal or highly misaligned accelerometers</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    }</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a9fe1337ad1ef75304fa59b481eda8744">_accel_cal_requires_reboot</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;}</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;</div><div class="line"><a name="l01807"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a75275eb329f84f1626c5a4bee81be248"> 1807</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#a75275eb329f84f1626c5a4bee81be248">AP_InertialSensor::_acal_event_failure</a>()</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;{</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>; i++) {</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a5096e33c19b3f59a284b241ac7f9b1ad">_accel_offset</a>[i].set_and_notify(<a class="code" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>(0,0,0));</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        <a class="code" href="classAP__InertialSensor.html#acfa1bbafefac03971538923ffcd1641a">_accel_scale</a>[i].set_and_notify(<a class="code" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>(1,1,1));</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    }</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;}</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="comment">    Returns true if new valid trim values are available and passes them to reference vars</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01818"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a5ba61d675f72ea75a9cf851ab3dd7d3c"> 1818</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#a5ba61d675f72ea75a9cf851ab3dd7d3c">AP_InertialSensor::get_new_trim</a>(<span class="keywordtype">float</span>&amp; trim_roll, <span class="keywordtype">float</span> &amp;trim_pitch)</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;{</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a72885d6d01f968f8744fe51eeec133fd">_new_trim</a>) {</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;        trim_roll = <a class="code" href="classAP__InertialSensor.html#a7a92b7a4048cc317fd15cea483745953">_trim_roll</a>;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        trim_pitch = <a class="code" href="classAP__InertialSensor.html#a95b97874def2b103e907fd6bbb119726">_trim_pitch</a>;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a72885d6d01f968f8744fe51eeec133fd">_new_trim</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    }</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;}</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment">    Returns body fixed accelerometer level data averaged during accel calibration&#39;s first step</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01832"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a0057feca5b296de7871d3e524c5f5630"> 1832</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#a0057feca5b296de7871d3e524c5f5630">AP_InertialSensor::get_fixed_mount_accel_cal_sample</a>(uint8_t sample_num, <a class="code" href="classVector3.html">Vector3f</a>&amp; ret)<span class="keyword"> const</span></div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a> &lt;= (<a class="code" href="classAP__InertialSensor.html#a74cafbbddc2421ea0cac67e4911d52b8">_acc_body_aligned</a>-1) || <a class="code" href="classAP__InertialSensor.html#a2ea473397ac26c55efa8d5e5fd5a9f65">_accel_calibrator</a>[2].get_status() != <a class="code" href="AccelCalibrator_8h.html#a03e56e1184d0da13e790f7f21db96044a68d1d9cf45dde19e104f352525b34c8e">ACCEL_CAL_SUCCESS</a> || sample_num&gt;=<a class="code" href="classAP__InertialSensor.html#a2ea473397ac26c55efa8d5e5fd5a9f65">_accel_calibrator</a>[2].get_num_samples_collected()) {</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    }</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a2ea473397ac26c55efa8d5e5fd5a9f65">_accel_calibrator</a>[<a class="code" href="classAP__InertialSensor.html#a74cafbbddc2421ea0cac67e4911d52b8">_acc_body_aligned</a>-1].<a class="code" href="classAccelCalibrator.html#a5edb2c035357c9bec69a6eaadeb95969">get_sample_corrected</a>(sample_num, ret);</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a0553640f772e43284644d89d49ef660c">_board_orientation</a> == <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a621932380092e03bd929b22f6a1945ed">ROTATION_CUSTOM</a> &amp;&amp; <a class="code" href="classAP__InertialSensor.html#af0beb13a9fff7ad446383972154dad71">_custom_rotation</a>) {</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        ret = *<a class="code" href="classAP__InertialSensor.html#af0beb13a9fff7ad446383972154dad71">_custom_rotation</a> * ret;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        ret.<a class="code" href="classVector3.html#a53d5701ae2db9492944550927279b7b8">rotate</a>(<a class="code" href="classAP__InertialSensor.html#a0553640f772e43284644d89d49ef660c">_board_orientation</a>);</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    }</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;}</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="comment">    Returns Primary accelerometer level data averaged during accel calibration&#39;s first step</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01849"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a34fd6b5d563528cc308675bcaedaac04"> 1849</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__InertialSensor.html#a34fd6b5d563528cc308675bcaedaac04">AP_InertialSensor::get_primary_accel_cal_sample_avg</a>(uint8_t sample_num, <a class="code" href="classVector3.html">Vector3f</a>&amp; ret)<span class="keyword"> const</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    uint8_t <a class="code" href="Perf__Lttng__TracePoints_8h.html#ae11b3deb3de3df7dc48e439074023e35">count</a> = 0;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> avg = <a class="code" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>(0,0,0);</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a>(<a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>,2); i++) {</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a2ea473397ac26c55efa8d5e5fd5a9f65">_accel_calibrator</a>[i].get_status() != <a class="code" href="AccelCalibrator_8h.html#a03e56e1184d0da13e790f7f21db96044a68d1d9cf45dde19e104f352525b34c8e">ACCEL_CAL_SUCCESS</a> || sample_num&gt;=<a class="code" href="classAP__InertialSensor.html#a2ea473397ac26c55efa8d5e5fd5a9f65">_accel_calibrator</a>[i].<a class="code" href="classAccelCalibrator.html#a03eda1ab18d906b6b375a45366561b3d">get_num_samples_collected</a>()) {</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        }</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> sample;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a2ea473397ac26c55efa8d5e5fd5a9f65">_accel_calibrator</a>[i].<a class="code" href="classAccelCalibrator.html#a5edb2c035357c9bec69a6eaadeb95969">get_sample_corrected</a>(sample_num, sample);</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;        avg += sample;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        <a class="code" href="Perf__Lttng__TracePoints_8h.html#ae11b3deb3de3df7dc48e439074023e35">count</a>++;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    }</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="Perf__Lttng__TracePoints_8h.html#ae11b3deb3de3df7dc48e439074023e35">count</a> == 0) {</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    }</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    avg /= <a class="code" href="Perf__Lttng__TracePoints_8h.html#ae11b3deb3de3df7dc48e439074023e35">count</a>;</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    ret = avg;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a0553640f772e43284644d89d49ef660c">_board_orientation</a> == <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a621932380092e03bd929b22f6a1945ed">ROTATION_CUSTOM</a> &amp;&amp; <a class="code" href="classAP__InertialSensor.html#af0beb13a9fff7ad446383972154dad71">_custom_rotation</a>) {</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        ret = *<a class="code" href="classAP__InertialSensor.html#af0beb13a9fff7ad446383972154dad71">_custom_rotation</a> * ret;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        ret.<a class="code" href="classVector3.html#a53d5701ae2db9492944550927279b7b8">rotate</a>(<a class="code" href="classAP__InertialSensor.html#a0553640f772e43284644d89d49ef660c">_board_orientation</a>);</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;    }</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;}</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment">  perform a simple 1D accel calibration, returning mavlink result code</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01878"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#abde1abead9e4ff8875808e49ad6e551f"> 1878</a></span>&#160;MAV_RESULT <a class="code" href="classAP__InertialSensor.html#abde1abead9e4ff8875808e49ad6e551f">AP_InertialSensor::simple_accel_cal</a>()</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;{</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    uint8_t num_accels = <a class="code" href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a>(<a class="code" href="classAP__InertialSensor.html#a8ca2cbf528de2276d1be01c00243db0d">get_accel_count</a>(), <a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>);</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> last_average[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> new_accel_offset[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> saved_offsets[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> saved_scaling[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    <span class="keywordtype">bool</span> converged[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> accel_convergence_limit = 0.05;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> rotated_gravity(0, 0, -<a class="code" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>);</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    </div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    <span class="comment">// exit immediately if calibration is already in progress</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#ae702a0c6ac4e418075f92c09a2631654">_calibrating</a>) {</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;        <span class="keywordflow">return</span> MAV_RESULT_TEMPORARILY_REJECTED;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;    }</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    <a class="code" href="Scheduler_8h.html#a538ef95a13e6bf98cc2e008c2a8b9a44">EXPECT_DELAY_MS</a>(20000);</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="comment">// record we are calibrating</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    <a class="code" href="classAP__InertialSensor.html#ae702a0c6ac4e418075f92c09a2631654">_calibrating</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    <span class="comment">// flash leds to tell user to keep the IMU still</span></div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <a class="code" href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a>.<a class="code" href="structAP__Notify_1_1notify__flags__and__values__type.html#a02b0d4d68e7d24114885e508a73f2b07">initialising</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">console</a>-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">printf</a>(<span class="stringliteral">&quot;Simple accel cal&quot;</span>);</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="comment">      we do the accel calibration with no board rotation. This avoids</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;<span class="comment">      having to rotate readings during the calibration</span></div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    <span class="keyword">enum</span> <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681">Rotation</a> saved_orientation = <a class="code" href="classAP__InertialSensor.html#a0553640f772e43284644d89d49ef660c">_board_orientation</a>;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a0553640f772e43284644d89d49ef660c">_board_orientation</a> = <a class="code" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    <span class="comment">// get the rotated gravity vector which will need to be applied to the offsets</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    rotated_gravity.<a class="code" href="classVector3.html#a54af2cdf84d76ad47bdb4f7f43ccb7e8">rotate_inverse</a>(saved_orientation);</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    </div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    <span class="comment">// save existing accel offsets</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_accels; k++) {</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        saved_offsets[k] = <a class="code" href="classAP__InertialSensor.html#a5096e33c19b3f59a284b241ac7f9b1ad">_accel_offset</a>[k];</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;        saved_scaling[k] = <a class="code" href="classAP__InertialSensor.html#acfa1bbafefac03971538923ffcd1641a">_accel_scale</a>[k];</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    }</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    </div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <span class="comment">// remove existing accel offsets and scaling</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_accels; k++) {</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a5096e33c19b3f59a284b241ac7f9b1ad">_accel_offset</a>[k].set(<a class="code" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>());</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        <a class="code" href="classAP__InertialSensor.html#acfa1bbafefac03971538923ffcd1641a">_accel_scale</a>[k].set(<a class="code" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>(1,1,1));</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;        new_accel_offset[k].<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;        last_average[k].<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;        converged[k] = <span class="keyword">false</span>;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    }</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    <span class="keywordflow">for</span> (uint8_t c = 0; c &lt; 5; c++) {</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#ab3175e2e6223ccfe82f957e41cc12b26">delay</a>(5);</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a2ab4e9e49af5ae38f38d3818fde2b675">update</a>();</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    }</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    <span class="comment">// the strategy is to average 50 points over 0.5 seconds, then do it</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    <span class="comment">// again and see if the 2nd average is within a small margin of</span></div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <span class="comment">// the first</span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    uint8_t num_converged = 0;</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    <span class="comment">// we try to get a good calibration estimate for up to 10 seconds</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    <span class="comment">// if the accels are stable, we should get it in 1 second</span></div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="keywordflow">for</span> (int16_t j = 0; j &lt;= 10*4 &amp;&amp; num_converged &lt; num_accels; j++) {</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;        <a class="code" href="classVector3.html">Vector3f</a> accel_sum[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>], accel_avg[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>], accel_diff[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        <span class="keywordtype">float</span> diff_norm[<a class="code" href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a>];</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;        uint8_t i;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;        memset(diff_norm, 0, <span class="keyword">sizeof</span>(diff_norm));</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">console</a>-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">printf</a>(<span class="stringliteral">&quot;*&quot;</span>);</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;        <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_accels; k++) {</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;            accel_sum[k].<a class="code" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;        }</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        <span class="keywordflow">for</span> (i=0; i&lt;50; i++) {</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a2ab4e9e49af5ae38f38d3818fde2b675">update</a>();</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;            <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_accels; k++) {</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;                accel_sum[k] += <a class="code" href="classAP__InertialSensor.html#ab39d50c9e078ac925746d92af042ba64">get_accel</a>(k);</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;            }</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;            <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#ab3175e2e6223ccfe82f957e41cc12b26">delay</a>(5);</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        }</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;        <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_accels; k++) {</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;            accel_avg[k] = accel_sum[k] / i;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;            accel_diff[k] = last_average[k] - accel_avg[k];</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;            diff_norm[k] = accel_diff[k].<a class="code" href="classVector3.html#afcdfe81173c23d57e4a53a0282cddae7">length</a>();</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;        }</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_accels; k++) {</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;            <span class="keywordflow">if</span> (j &gt; 0 &amp;&amp; diff_norm[k] &lt; accel_convergence_limit) {</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                last_average[k] = (accel_avg[k] * 0.5f) + (last_average[k] * 0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;                <span class="keywordflow">if</span> (!converged[k] || last_average[k].length() &lt; new_accel_offset[k].<a class="code" href="classVector3.html#afcdfe81173c23d57e4a53a0282cddae7">length</a>()) {</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;                    new_accel_offset[k] = last_average[k];</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;                }</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                <span class="keywordflow">if</span> (!converged[k]) {</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;                    converged[k] = <span class="keyword">true</span>;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                    num_converged++;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;                }</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                last_average[k] = accel_avg[k];</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;            }</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        }</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    }</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    MAV_RESULT <a class="code" href="Printf_8cpp.html#a5558580ea8d3854253a721ee58cff12d">result</a> = MAV_RESULT_ACCEPTED;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;    <span class="comment">// see if we&#39;ve passed</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_accels; k++) {</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;        <span class="keywordflow">if</span> (!converged[k]) {</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;            <a class="code" href="Printf_8cpp.html#a5558580ea8d3854253a721ee58cff12d">result</a> = MAV_RESULT_FAILED;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        }</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    }</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="comment">// restore orientation</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    <a class="code" href="classAP__InertialSensor.html#a0553640f772e43284644d89d49ef660c">_board_orientation</a> = saved_orientation;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="Printf_8cpp.html#a5558580ea8d3854253a721ee58cff12d">result</a> == MAV_RESULT_ACCEPTED) {</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">console</a>-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">printf</a>(<span class="stringliteral">&quot;\nPASSED\n&quot;</span>);</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;        <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_accels; k++) {</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;            <span class="comment">// remove rotated gravity</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;            new_accel_offset[k] -= rotated_gravity;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a5096e33c19b3f59a284b241ac7f9b1ad">_accel_offset</a>[k].set_and_save(new_accel_offset[k]);</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;            <a class="code" href="classAP__InertialSensor.html#acfa1bbafefac03971538923ffcd1641a">_accel_scale</a>[k].save();</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;            <a class="code" href="classAP__InertialSensor.html#ada31f9669cfd8503daf08aa0a7f3f77f">_accel_id</a>[k].save();</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;            <a class="code" href="classAP__InertialSensor.html#ae840940f433011c353a91fa25ce1e197">_accel_id_ok</a>[k] = <span class="keyword">true</span>;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;        }</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;        <span class="comment">// force trim to zero</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        <a class="code" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a>().<a class="code" href="classAP__AHRS.html#ab45359e5c71751e421577e6a2d85625e">set_trim</a>(<a class="code" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>(0, 0, 0));</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        <a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">console</a>-&gt;<a class="code" href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">printf</a>(<span class="stringliteral">&quot;\nFAILED\n&quot;</span>);</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;        <span class="comment">// restore old values</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;        <span class="keywordflow">for</span> (uint8_t k=0; k&lt;num_accels; k++) {</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;            <a class="code" href="classAP__InertialSensor.html#a5096e33c19b3f59a284b241ac7f9b1ad">_accel_offset</a>[k] = saved_offsets[k];</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;            <a class="code" href="classAP__InertialSensor.html#acfa1bbafefac03971538923ffcd1641a">_accel_scale</a>[k] = saved_scaling[k];</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;        }</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;    }</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    <span class="comment">// record calibration complete</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    <a class="code" href="classAP__InertialSensor.html#ae702a0c6ac4e418075f92c09a2631654">_calibrating</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    <span class="comment">// throw away any existing samples that may have the wrong</span></div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    <span class="comment">// orientation. We do this by throwing samples away for 0.5s,</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    <span class="comment">// which is enough time for the filters to settle</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    uint32_t start_ms = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>() - start_ms &lt; 500) {</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        <a class="code" href="classAP__InertialSensor.html#a2ab4e9e49af5ae38f38d3818fde2b675">update</a>();</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    }</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;    <span class="comment">// and reset state estimators</span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;    <a class="code" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a>().<a class="code" href="classAP__AHRS.html#aa0471406fedfab26daa523f636ef13a7">reset</a>();</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    <span class="comment">// stop flashing leds</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    <a class="code" href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a>.<a class="code" href="structAP__Notify_1_1notify__flags__and__values__type.html#a02b0d4d68e7d24114885e508a73f2b07">initialising</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="Printf_8cpp.html#a5558580ea8d3854253a721ee58cff12d">result</a>;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;}</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="comment">  see if gyro calibration should be performed</span></div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02040"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a100449139236bccfb37e9fec9df8c2a7"> 2040</a></span>&#160;<a class="code" href="classAP__InertialSensor.html#a96ea6a28cfba8d662ba2b6f10443af05">AP_InertialSensor::Gyro_Calibration_Timing</a> <a class="code" href="classAP__InertialSensor.html#a100449139236bccfb37e9fec9df8c2a7">AP_InertialSensor::gyro_calibration_timing</a>()</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;{</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code" href="classAP__HAL_1_1Util.html#a19cbaa06e0e8804d1669deacf5ad6081">was_watchdog_reset</a>()) {</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classAP__InertialSensor.html#a96ea6a28cfba8d662ba2b6f10443af05a34154738ae4be5b007524c4c3bf1bb77">GYRO_CAL_NEVER</a>;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    }</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="classAP__InertialSensor.html#a96ea6a28cfba8d662ba2b6f10443af05">Gyro_Calibration_Timing</a>)<a class="code" href="classAP__InertialSensor.html#a139a638598ff71cf1e9bb9ad15912ad6">_gyro_cal_timing</a>.get();</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;}</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="preprocessor">#if !HAL_MINIMIZE_FEATURES</span></div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="comment">  update IMU kill mask, used for testing IMU failover</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02052"></a><span class="lineno"><a class="line" href="classAP__InertialSensor.html#a38a02931e6daedb5177a6006abcbd0db"> 2052</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__InertialSensor.html#a38a02931e6daedb5177a6006abcbd0db">AP_InertialSensor::kill_imu</a>(uint8_t imu_idx, <span class="keywordtype">bool</span> kill_it)</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;{</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;    <span class="keywordflow">if</span> (kill_it) {</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;        uint8_t new_kill_mask = <a class="code" href="classAP__InertialSensor.html#abff942442a5155c2ea4bc8007d92bd45">imu_kill_mask</a> | (1U&lt;&lt;imu_idx);</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;        <span class="comment">// don&#39;t allow the last IMU to be killed</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;        <span class="keywordtype">bool</span> all_dead = <span class="keyword">true</span>;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code" href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a>(<a class="code" href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">_gyro_count</a>, <a class="code" href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">_accel_count</a>); i++) {</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__InertialSensor.html#a714dc332f1f664de77df912220525653">use_gyro</a>(i) &amp;&amp; <a class="code" href="classAP__InertialSensor.html#af8aa055fcbf0bc843ca4914a9cc84013">use_accel</a>(i) &amp;&amp; !(new_kill_mask &amp; (1U&lt;&lt;i))) {</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;                <span class="comment">// we have at least one healthy IMU left</span></div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;                all_dead = <span class="keyword">false</span>;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;            }</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        }</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        <span class="keywordflow">if</span> (!all_dead) {</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;            <a class="code" href="classAP__InertialSensor.html#abff942442a5155c2ea4bc8007d92bd45">imu_kill_mask</a> = new_kill_mask;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;        }</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;        <a class="code" href="classAP__InertialSensor.html#abff942442a5155c2ea4bc8007d92bd45">imu_kill_mask</a> &amp;= ~(1U&lt;&lt;imu_idx);</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    }</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;}</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="preprocessor">#endif // HAL_MINIMIZE_FEATURES</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceAP.html">AP</a> {</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;</div><div class="line"><a name="l02076"></a><span class="lineno"><a class="line" href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9"> 2076</a></span>&#160;<a class="code" href="classAP__InertialSensor.html">AP_InertialSensor</a> &amp;<a class="code" href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9">ins</a>()</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;{</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;    <span class="keywordflow">return</span> *<a class="code" href="classAP__InertialSensor.html#a2cf12201d711e4712a62ad10893be06f">AP_InertialSensor::get_singleton</a>();</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;}</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;};</div><div class="ttc" id="classQuaternion_html"><div class="ttname"><a href="classQuaternion.html">Quaternion</a></div><div class="ttdef"><b>Definition:</b> <a href="quaternion_8h_source.html#l00026">quaternion.h:26</a></div></div>
<div class="ttc" id="rotations_8h_html_a67a250c97139a5466814a54c4aa4a681ab0d62ddde13a7fb88b4f4067872815b4"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681ab0d62ddde13a7fb88b4f4067872815b4">ROTATION_ROLL_180_YAW_270</a></div><div class="ttdef"><b>Definition:</b> <a href="rotations_8h_source.html#l00042">rotations.h:42</a></div></div>
<div class="ttc" id="classAP__HAL_1_1Util_html_a19cbaa06e0e8804d1669deacf5ad6081"><div class="ttname"><a href="classAP__HAL_1_1Util.html#a19cbaa06e0e8804d1669deacf5ad6081">AP_HAL::Util::was_watchdog_reset</a></div><div class="ttdeci">virtual bool was_watchdog_reset() const</div><div class="ttdef"><b>Definition:</b> <a href="Util_8h_source.html#l00021">Util.h:21</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a45fe9f81332c93a04d1fdbcf0bc89c29"><div class="ttname"><a href="AP__Math_8h.html#a45fe9f81332c93a04d1fdbcf0bc89c29">norm</a></div><div class="ttdeci">float norm(const T first, const U second, const Params... parameters)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00196">AP_Math.h:196</a></div></div>
<div class="ttc" id="classAccelCalibrator_html_a5edb2c035357c9bec69a6eaadeb95969"><div class="ttname"><a href="classAccelCalibrator.html#a5edb2c035357c9bec69a6eaadeb95969">AccelCalibrator::get_sample_corrected</a></div><div class="ttdeci">bool get_sample_corrected(uint8_t i, Vector3f &amp;s) const</div><div class="ttdef"><b>Definition:</b> <a href="AccelCalibrator_8cpp_source.html#l00178">AccelCalibrator.cpp:178</a></div></div>
<div class="ttc" id="classAP__HAL_1_1Util_html_a287a2b82fa30b92c8d52aad61d4d27b7"><div class="ttname"><a href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">AP_HAL::Util::get_soft_armed</a></div><div class="ttdeci">bool get_soft_armed() const</div><div class="ttdef"><b>Definition:</b> <a href="Util_8h_source.html#l00015">Util.h:15</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a100449139236bccfb37e9fec9df8c2a7"><div class="ttname"><a href="classAP__InertialSensor.html#a100449139236bccfb37e9fec9df8c2a7">AP_InertialSensor::gyro_calibration_timing</a></div><div class="ttdeci">Gyro_Calibration_Timing gyro_calibration_timing()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l02040">AP_InertialSensor.cpp:2040</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983aa765b43df6cbdb15f9720f993d79ceb3"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aa765b43df6cbdb15f9720f993d79ceb3">AP_BoardConfig::PX4_BOARD_PIXHAWK</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00068">AP_BoardConfig.h:68</a></div></div>
<div class="ttc" id="SPIDevice_8h_html"><div class="ttname"><a href="SPIDevice_8h.html">SPIDevice.h</a></div></div>
<div class="ttc" id="Scheduler_8h_html_a538ef95a13e6bf98cc2e008c2a8b9a44"><div class="ttname"><a href="Scheduler_8h.html#a538ef95a13e6bf98cc2e008c2a8b9a44">EXPECT_DELAY_MS</a></div><div class="ttdeci">#define EXPECT_DELAY_MS(ms)</div><div class="ttdef"><b>Definition:</b> <a href="Scheduler_8h_source.html#l00134">Scheduler.h:134</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ac3baf37d8631bb05df22edc12a99db23"><div class="ttname"><a href="classAP__InertialSensor.html#ac3baf37d8631bb05df22edc12a99db23">AP_InertialSensor::_accel_wait_mask</a></div><div class="ttdeci">uint8_t _accel_wait_mask</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00504">AP_InertialSensor.h:504</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a95b97874def2b103e907fd6bbb119726"><div class="ttname"><a href="classAP__InertialSensor.html#a95b97874def2b103e907fd6bbb119726">AP_InertialSensor::_trim_pitch</a></div><div class="ttdeci">float _trim_pitch</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00579">AP_InertialSensor.h:579</a></div></div>
<div class="ttc" id="AccelCalibrator_8h_html_a03e56e1184d0da13e790f7f21db96044a68d1d9cf45dde19e104f352525b34c8e"><div class="ttname"><a href="AccelCalibrator_8h.html#a03e56e1184d0da13e790f7f21db96044a68d1d9cf45dde19e104f352525b34c8e">ACCEL_CAL_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="AccelCalibrator_8h_source.html#l00025">AccelCalibrator.h:25</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a5c053dbfad16102ff1183fae2bbbb6b0"><div class="ttname"><a href="classAP__InertialSensor.html#a5c053dbfad16102ff1183fae2bbbb6b0">AP_InertialSensor::set_delta_velocity</a></div><div class="ttdeci">void set_delta_velocity(uint8_t instance, float deltavt, const Vector3f &amp;deltav)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01610">AP_InertialSensor.cpp:1610</a></div></div>
<div class="ttc" id="AP__InertialSensor__BMI055_8h_html"><div class="ttname"><a href="AP__InertialSensor__BMI055_8h.html">AP_InertialSensor_BMI055.h</a></div></div>
<div class="ttc" id="classAccelCalibrator_html"><div class="ttname"><a href="classAccelCalibrator.html">AccelCalibrator</a></div><div class="ttdef"><b>Definition:</b> <a href="AccelCalibrator_8h_source.html#l00034">AccelCalibrator.h:34</a></div></div>
<div class="ttc" id="chibios_8h_html_a0c902a1d58826fe210fa57056d98954e"><div class="ttname"><a href="chibios_8h.html#a0c902a1d58826fe210fa57056d98954e">HAL_INS_MPU9250_EXT_NAME</a></div><div class="ttdeci">#define HAL_INS_MPU9250_EXT_NAME</div><div class="ttdef"><b>Definition:</b> <a href="chibios_8h_source.html#l00070">chibios.h:70</a></div></div>
<div class="ttc" id="AP__InertialSensor__SITL_8h_html"><div class="ttname"><a href="AP__InertialSensor__SITL_8h.html">AP_InertialSensor_SITL.h</a></div></div>
<div class="ttc" id="BARO__generic_8cpp_html_a0480b812cba9c1d9c71a5fb1071bd0fc"><div class="ttname"><a href="BARO__generic_8cpp.html#a0480b812cba9c1d9c71a5fb1071bd0fc">counter</a></div><div class="ttdeci">static uint8_t counter</div><div class="ttdef"><b>Definition:</b> <a href="BARO__generic_8cpp_source.html#l00032">BARO_generic.cpp:32</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a17c6cbc1c5bb9be0c978a2f97ee55960"><div class="ttname"><a href="classAP__InertialSensor.html#a17c6cbc1c5bb9be0c978a2f97ee55960">AP_InertialSensor::_accel_startup_error_count</a></div><div class="ttdeci">uint32_t _accel_startup_error_count[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00586">AP_InertialSensor.h:586</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a6dc88d5a47d3e85bf76d05f68873e752"><div class="ttname"><a href="classAP__InertialSensor.html#a6dc88d5a47d3e85bf76d05f68873e752">AP_InertialSensor::set_delta_time</a></div><div class="ttdeci">void set_delta_time(float delta_time)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01602">AP_InertialSensor.cpp:1602</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a4fba5a12f7b84a64e8425296e26b6613"><div class="ttname"><a href="classAP__InertialSensor.html#a4fba5a12f7b84a64e8425296e26b6613">AP_InertialSensor::_next_sample_usec</a></div><div class="ttdeci">uint32_t _next_sample_usec</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00527">AP_InertialSensor.h:527</a></div></div>
<div class="ttc" id="AP__InertialSensor_8h_html_a0f6117b20d199660168eef799c1caaa2"><div class="ttname"><a href="AP__InertialSensor_8h.html#a0f6117b20d199660168eef799c1caaa2">AP_INERTIAL_SENSOR_ACCEL_PEAK_DETECT_TIMEOUT_MS</a></div><div class="ttdeci">#define AP_INERTIAL_SENSOR_ACCEL_PEAK_DETECT_TIMEOUT_MS</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00008">AP_InertialSensor.h:8</a></div></div>
<div class="ttc" id="vector3_8h_html_af345ad77ba5e240c7ab72b4b2077e754"><div class="ttname"><a href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a></div><div class="ttdeci">Vector3&lt; float &gt; Vector3f</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00252">vector3.h:252</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a6bb7a0fd0a70ddb3e5e44670d82620be"><div class="ttname"><a href="classAP__InertialSensor.html#a6bb7a0fd0a70ddb3e5e44670d82620be">AP_InertialSensor::_accel_error_count</a></div><div class="ttdeci">uint32_t _accel_error_count[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00539">AP_InertialSensor.h:539</a></div></div>
<div class="ttc" id="rotations_8h_html_a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5">ROTATION_ROLL_180</a></div><div class="ttdef"><b>Definition:</b> <a href="rotations_8h_source.html#l00036">rotations.h:36</a></div></div>
<div class="ttc" id="classAP__InertialSensor__Backend_html_a86d773e553328d1874cc8bfac1a22b10"><div class="ttname"><a href="classAP__InertialSensor__Backend.html#a86d773e553328d1874cc8bfac1a22b10">AP_InertialSensor_Backend::get_clip_limit</a></div><div class="ttdeci">float get_clip_limit() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__Backend_8h_source.html#l00074">AP_InertialSensor_Backend.h:74</a></div></div>
<div class="ttc" id="classNotchFilterParams_html"><div class="ttname"><a href="classNotchFilterParams.html">NotchFilterParams</a></div><div class="ttdef"><b>Definition:</b> <a href="NotchFilter_8h_source.html#l00046">NotchFilter.h:46</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a35cc4b42b44b242cb7a60963d83ed12b"><div class="ttname"><a href="classAP__InertialSensor.html#a35cc4b42b44b242cb7a60963d83ed12b">AP_InertialSensor::_enable_mask</a></div><div class="ttdeci">AP_Int8 _enable_mask</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00483">AP_InertialSensor.h:483</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a2ab4e9e49af5ae38f38d3818fde2b675"><div class="ttname"><a href="classAP__InertialSensor.html#a2ab4e9e49af5ae38f38d3818fde2b675">AP_InertialSensor::update</a></div><div class="ttdeci">void update(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01251">AP_InertialSensor.cpp:1251</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a8a3185c191ab40fd95ceeadd8a5b0cf9"><div class="ttname"><a href="classAP__BoardConfig.html#a8a3185c191ab40fd95ceeadd8a5b0cf9">AP_BoardConfig::get_board_type</a></div><div class="ttdeci">static enum px4_board_type get_board_type(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00094">AP_BoardConfig.h:94</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ab39d50c9e078ac925746d92af042ba64"><div class="ttname"><a href="classAP__InertialSensor.html#ab39d50c9e078ac925746d92af042ba64">AP_InertialSensor::get_accel</a></div><div class="ttdeci">const Vector3f &amp; get_accel(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00124">AP_InertialSensor.h:124</a></div></div>
<div class="ttc" id="AP__Math_8cpp_html_ac89eb1832d8e4d67fcf1ac07e3c25184"><div class="ttname"><a href="AP__Math_8cpp.html#ac89eb1832d8e4d67fcf1ac07e3c25184">safe_sqrt</a></div><div class="ttdeci">float safe_sqrt(const T v)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8cpp_source.html#l00066">AP_Math.cpp:66</a></div></div>
<div class="ttc" id="classAP__InertialSensor__Invensense_html_a8097ce7e76464929d323cfc339ed4ac4"><div class="ttname"><a href="classAP__InertialSensor__Invensense.html#a8097ce7e76464929d323cfc339ed4ac4">AP_InertialSensor_Invensense::probe</a></div><div class="ttdeci">static AP_InertialSensor_Backend * probe(AP_InertialSensor &amp;imu, AP_HAL::OwnPtr&lt; AP_HAL::I2CDevice &gt; dev, enum Rotation rotation=ROTATION_NONE)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__Invensense_8cpp_source.html#l00088">AP_InertialSensor_Invensense.cpp:88</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_af2d2bbeee8b5e4188e111f07fa85c638"><div class="ttname"><a href="classAP__InertialSensor.html#af2d2bbeee8b5e4188e111f07fa85c638">AP_InertialSensor::_gyro_healthy</a></div><div class="ttdeci">bool _gyro_healthy[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00536">AP_InertialSensor.h:536</a></div></div>
<div class="ttc" id="AP__InertialSensor_8cpp_html_a247ced13b73525611d4dbefe67eb4915"><div class="ttname"><a href="AP__InertialSensor_8cpp.html#a247ced13b73525611d4dbefe67eb4915">GYRO_INIT_MAX_DIFF_DPS</a></div><div class="ttdeci">#define GYRO_INIT_MAX_DIFF_DPS</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00058">AP_InertialSensor.cpp:58</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ab18eaf3fc2c3b075d95d166032b787bd"><div class="ttname"><a href="classAP__InertialSensor.html#ab18eaf3fc2c3b075d95d166032b787bd">AP_InertialSensor::_new_gyro_data</a></div><div class="ttdeci">bool _new_gyro_data[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00408">AP_InertialSensor.h:408</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a08ea8b10ded97a61c91f716effcb85fd"><div class="ttname"><a href="classAP__InertialSensor.html#a08ea8b10ded97a61c91f716effcb85fd">AP_InertialSensor::_sample_rate</a></div><div class="ttdeci">uint16_t _sample_rate</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00388">AP_InertialSensor.h:388</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_abbeb2317c4a19ae1c3ee1a31ee960c8e"><div class="ttname"><a href="classAP__InertialSensor.html#abbeb2317c4a19ae1c3ee1a31ee960c8e">AP_InertialSensor::_hil</a></div><div class="ttdeci">struct AP_InertialSensor::@55 _hil</div></div>
<div class="ttc" id="AP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_a92168462febe0f5ab9556dc9ea4ddb7a"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a92168462febe0f5ab9556dc9ea4ddb7a">AP_HAL::HAL::console</a></div><div class="ttdeci">AP_HAL::UARTDriver * console</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00110">HAL.h:110</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a139a638598ff71cf1e9bb9ad15912ad6"><div class="ttname"><a href="classAP__InertialSensor.html#a139a638598ff71cf1e9bb9ad15912ad6">AP_InertialSensor::_gyro_cal_timing</a></div><div class="ttdeci">AP_Int8 _gyro_cal_timing</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00474">AP_InertialSensor.h:474</a></div></div>
<div class="ttc" id="rotations_8h_html_a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="rotations_8h_source.html#l00028">rotations.h:28</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a250520e85a272563a54924f26d18d181"><div class="ttname"><a href="classAP__InertialSensor.html#a250520e85a272563a54924f26d18d181">AP_InertialSensor::_still_threshold</a></div><div class="ttdeci">AP_Float _still_threshold</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00554">AP_InertialSensor.h:554</a></div></div>
<div class="ttc" id="AP__Common_8h_html_a728f9499baea61e7df3ae70a374f2512"><div class="ttname"><a href="AP__Common_8h.html#a728f9499baea61e7df3ae70a374f2512">ToRad</a></div><div class="ttdeci">#define ToRad(x)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00063">AP_Common.h:63</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a424609d1eb3dc8473040c9e6f87771ad"><div class="ttname"><a href="classAP__InertialSensor.html#a424609d1eb3dc8473040c9e6f87771ad">AP_InertialSensor::init_gyro</a></div><div class="ttdeci">void init_gyro(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00914">AP_InertialSensor.cpp:914</a></div></div>
<div class="ttc" id="classVector3_html_a54af2cdf84d76ad47bdb4f7f43ccb7e8"><div class="ttname"><a href="classVector3.html#a54af2cdf84d76ad47bdb4f7f43ccb7e8">Vector3::rotate_inverse</a></div><div class="ttdeci">void rotate_inverse(enum Rotation rotation)</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8cpp_source.html#l00262">vector3.cpp:262</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ad04cd1cbcc7c31914e3dbcaf7eb83b19"><div class="ttname"><a href="classAP__InertialSensor.html#ad04cd1cbcc7c31914e3dbcaf7eb83b19">AP_InertialSensor::acal_init</a></div><div class="ttdeci">void acal_init()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01714">AP_InertialSensor.cpp:1714</a></div></div>
<div class="ttc" id="chibios_8h_html_a2c59d23ab6be2e59b18f06e2431e5dbb"><div class="ttname"><a href="chibios_8h.html#a2c59d23ab6be2e59b18f06e2431e5dbb">HAL_INS_LSM9DS0_A_NAME</a></div><div class="ttdeci">#define HAL_INS_LSM9DS0_A_NAME</div><div class="ttdef"><b>Definition:</b> <a href="chibios_8h_source.html#l00064">chibios.h:64</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ae58893789a24a249e7338892d90da51e"><div class="ttname"><a href="classAP__InertialSensor.html#ae58893789a24a249e7338892d90da51e">AP_InertialSensor::_last_update_usec</a></div><div class="ttdeci">uint32_t _last_update_usec</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00533">AP_InertialSensor.h:533</a></div></div>
<div class="ttc" id="classAP__InertialSensor_1_1BatchSampler_html_a1470373978fedc302caf963f45df3cf0"><div class="ttname"><a href="classAP__InertialSensor_1_1BatchSampler.html#a1470373978fedc302caf963f45df3cf0">AP_InertialSensor::BatchSampler::periodic</a></div><div class="ttdeci">void periodic()</div><div class="ttdef"><b>Definition:</b> <a href="BatchSampler_8cpp_source.html#l00080">BatchSampler.cpp:80</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983aa4b366ff17e0c44076231ae8c51edd42"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aa4b366ff17e0c44076231ae8c51edd42">AP_BoardConfig::PX4_BOARD_PHMINI</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00071">AP_BoardConfig.h:71</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a321a91de43cfb2e95d40cde314d0a80f"><div class="ttname"><a href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a></div><div class="ttdeci">static auto MIN(const A &amp;one, const B &amp;two) -&gt; decltype(one&lt; two ? one :two)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00202">AP_Math.h:202</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ab08b54ef4cc6d1cb04b57996066a51e2"><div class="ttname"><a href="classAP__InertialSensor.html#ab08b54ef4cc6d1cb04b57996066a51e2">AP_InertialSensor::_use</a></div><div class="ttdeci">AP_Int8 _use[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00477">AP_InertialSensor.h:477</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_aa112654466199fa7ba51b2471fefdbd7"><div class="ttname"><a href="classAP__InertialSensor.html#aa112654466199fa7ba51b2471fefdbd7">AP_InertialSensor::register_gyro</a></div><div class="ttdeci">uint8_t register_gyro(uint16_t raw_sample_rate_hz, uint32_t id)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00500">AP_InertialSensor.cpp:500</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00100">AP_Param.h:100</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ab8532b92ae038d4f09ee5d9bd7de46aa"><div class="ttname"><a href="classAP__InertialSensor.html#ab8532b92ae038d4f09ee5d9bd7de46aa">AP_InertialSensor::_accel_raw_sample_rates</a></div><div class="ttdeci">float _accel_raw_sample_rates[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00450">AP_InertialSensor.h:450</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a306d1d720c0c1f71965c44d6f4693fce"><div class="ttname"><a href="classAP__InertialSensor.html#a306d1d720c0c1f71965c44d6f4693fce">AP_InertialSensor::set_delta_angle</a></div><div class="ttdeci">void set_delta_angle(uint8_t instance, const Vector3f &amp;deltaa, float deltaat)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01622">AP_InertialSensor.cpp:1622</a></div></div>
<div class="ttc" id="AP__InertialSensor__HIL_8h_html"><div class="ttname"><a href="AP__InertialSensor__HIL_8h.html">AP_InertialSensor_HIL.h</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a1d9040309bd3ba359b20b90f4a836531"><div class="ttname"><a href="classAP__InertialSensor.html#a1d9040309bd3ba359b20b90f4a836531">AP_InertialSensor::_backends</a></div><div class="ttdeci">AP_InertialSensor_Backend * _backends[INS_MAX_BACKENDS]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00378">AP_InertialSensor.h:378</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_a9337a60383f4264fa96a20dbe43a4e2e"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">AP_HAL::HAL::util</a></div><div class="ttdeci">AP_HAL::Util * util</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00115">HAL.h:115</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a78f917fc079eb5acb3e9623f0bbe0ff9"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a78f917fc079eb5acb3e9623f0bbe0ff9">AP_BoardConfig::PX4_BOARD_PH2SLIM</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00072">AP_BoardConfig.h:72</a></div></div>
<div class="ttc" id="I2CDevice_8h_html"><div class="ttname"><a href="I2CDevice_8h.html">I2CDevice.h</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a4510aa7e7f3bac446f03004c9dda84f8"><div class="ttname"><a href="classAP__InertialSensor.html#a4510aa7e7f3bac446f03004c9dda84f8">AP_InertialSensor::_accel_vibe_floor_filter</a></div><div class="ttdeci">LowPassFilterVector3f _accel_vibe_floor_filter[INS_VIBRATION_CHECK_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00544">AP_InertialSensor.h:544</a></div></div>
<div class="ttc" id="classAP__InertialSensor_1_1BatchSampler_html_a458393a1681bfd0d37c8c06fbdf628d3"><div class="ttname"><a href="classAP__InertialSensor_1_1BatchSampler.html#a458393a1681bfd0d37c8c06fbdf628d3">AP_InertialSensor::BatchSampler::init</a></div><div class="ttdeci">void init()</div><div class="ttdef"><b>Definition:</b> <a href="BatchSampler_8cpp_source.html#l00047">BatchSampler.cpp:47</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_aa5bb8e95e3d8044619c673b36815125a"><div class="ttname"><a href="classAP__InertialSensor.html#aa5bb8e95e3d8044619c673b36815125a">AP_InertialSensor::_save_gyro_calibration</a></div><div class="ttdeci">void _save_gyro_calibration()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01235">AP_InertialSensor.cpp:1235</a></div></div>
<div class="ttc" id="classAP__AHRS_html_aa0471406fedfab26daa523f636ef13a7"><div class="ttname"><a href="classAP__AHRS.html#aa0471406fedfab26daa523f636ef13a7">AP_AHRS::reset</a></div><div class="ttdeci">virtual void reset(bool recover_eulers=false)=0</div></div>
<div class="ttc" id="classAP__InertialSensor_html_ab35eaddc8ca7c3a67c7b43228f46ead2"><div class="ttname"><a href="classAP__InertialSensor.html#ab35eaddc8ca7c3a67c7b43228f46ead2">AP_InertialSensor::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00186">AP_InertialSensor.h:186</a></div></div>
<div class="ttc" id="classAP__InertialSensor__LSM9DS1_html_a3386e4a8a70178a7fe93f8f7c537d50b"><div class="ttname"><a href="classAP__InertialSensor__LSM9DS1.html#a3386e4a8a70178a7fe93f8f7c537d50b">AP_InertialSensor_LSM9DS1::probe</a></div><div class="ttdeci">static AP_InertialSensor_Backend * probe(AP_InertialSensor &amp;imu, AP_HAL::OwnPtr&lt; AP_HAL::SPIDevice &gt; dev, enum Rotation rotation=ROTATION_NONE)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__LSM9DS1_8cpp_source.html#l00208">AP_InertialSensor_LSM9DS1.cpp:208</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a5df3a0a4fc6f65531ca3078c84d46657"><div class="ttname"><a href="classAP__InertialSensor.html#a5df3a0a4fc6f65531ca3078c84d46657">AP_InertialSensor::gyro_calibrated_ok</a></div><div class="ttdeci">bool gyro_calibrated_ok(uint8_t instance) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00134">AP_InertialSensor.h:134</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a3c5386db31b5c706894441bb6279eefc"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a3c5386db31b5c706894441bb6279eefc">AP_BoardConfig::VRX_BOARD_BRAIN54</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00086">AP_BoardConfig.h:86</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983ac37e0c90b91e19c9b6945baa8b05b278"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ac37e0c90b91e19c9b6945baa8b05b278">AP_BoardConfig::PX4_BOARD_PCNC1</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00076">AP_BoardConfig.h:76</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ab88bb0dcef3bc396619e6efe730e8dbd"><div class="ttname"><a href="classAP__InertialSensor.html#ab88bb0dcef3bc396619e6efe730e8dbd">AP_InertialSensor::_delta_angle_valid</a></div><div class="ttdeci">bool _delta_angle_valid[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00418">AP_InertialSensor.h:418</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a212c2ff8c6c4ada3668b927ac6728a87"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a212c2ff8c6c4ada3668b927ac6728a87">AP_BoardConfig::VRX_BOARD_BRAIN51</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00080">AP_BoardConfig.h:80</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a5f5f5ff54f65d31d262cf04587cf7ddd"><div class="ttname"><a href="classAP__InertialSensor.html#a5f5f5ff54f65d31d262cf04587cf7ddd">AP_InertialSensor::_delta_velocity_dt</a></div><div class="ttdeci">float _delta_velocity_dt[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00395">AP_InertialSensor.h:395</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_acf640603eda1929a2487c4fbba73616e"><div class="ttname"><a href="classAP__InertialSensor.html#acf640603eda1929a2487c4fbba73616e">AP_InertialSensor::get_delta_velocity</a></div><div class="ttdeci">bool get_delta_velocity(uint8_t i, Vector3f &amp;delta_velocity) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01516">AP_InertialSensor.cpp:1516</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a59056c961e7d7d6884366103791d54ee"><div class="ttname"><a href="classAP__InertialSensor.html#a59056c961e7d7d6884366103791d54ee">AP_InertialSensor::get_gyro</a></div><div class="ttdeci">const Vector3f &amp; get_gyro(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00099">AP_InertialSensor.h:99</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983aedbfaade4bc5663cfd73a8652235bb30"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aedbfaade4bc5663cfd73a8652235bb30">AP_BoardConfig::VRX_BOARD_BRAIN52E</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00082">AP_BoardConfig.h:82</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a920ce819aa38247290c545adbb4cd41d"><div class="ttname"><a href="classAP__InertialSensor.html#a920ce819aa38247290c545adbb4cd41d">AP_InertialSensor::_delta_velocity_acc_dt</a></div><div class="ttdeci">float _delta_velocity_acc_dt[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00400">AP_InertialSensor.h:400</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a3f4ee8162ce5427946348ca9f5f9dcb7"><div class="ttname"><a href="classAP__InertialSensor.html#a3f4ee8162ce5427946348ca9f5f9dcb7">AP_InertialSensor::_add_backend</a></div><div class="ttdeci">bool _add_backend(AP_InertialSensor_Backend *backend)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00659">AP_InertialSensor.cpp:659</a></div></div>
<div class="ttc" id="chibios_8h_html_a1ad903e799080a3eb2f2d33f80d81e20"><div class="ttname"><a href="chibios_8h.html#a1ad903e799080a3eb2f2d33f80d81e20">HAL_INS_MPU60x0_EXT_NAME</a></div><div class="ttdeci">#define HAL_INS_MPU60x0_EXT_NAME</div><div class="ttdef"><b>Definition:</b> <a href="chibios_8h_source.html#l00061">chibios.h:61</a></div></div>
<div class="ttc" id="classAP__InertialSensor__BMI088_html_ab867cfc35f3c7d2b43dbf2b1b45386b2"><div class="ttname"><a href="classAP__InertialSensor__BMI088.html#ab867cfc35f3c7d2b43dbf2b1b45386b2">AP_InertialSensor_BMI088::probe</a></div><div class="ttdeci">static AP_InertialSensor_Backend * probe(AP_InertialSensor &amp;imu, AP_HAL::OwnPtr&lt; AP_HAL::Device &gt; dev_accel, AP_HAL::OwnPtr&lt; AP_HAL::Device &gt; dev_gyro, enum Rotation rotation=ROTATION_NONE)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__BMI088_8cpp_source.html#l00073">AP_InertialSensor_BMI088.cpp:73</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_af8aa055fcbf0bc843ca4914a9cc84013"><div class="ttname"><a href="classAP__InertialSensor.html#af8aa055fcbf0bc843ca4914a9cc84013">AP_InertialSensor::use_accel</a></div><div class="ttdeci">bool use_accel(uint8_t instance) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01084">AP_InertialSensor.cpp:1084</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983ad387380811280b3f995f8387ab50264e"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ad387380811280b3f995f8387ab50264e">AP_BoardConfig::PX4_BOARD_PIXHAWK2</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00069">AP_BoardConfig.h:69</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a7179321b8fa49dd4f6ef84380faf5f7d"><div class="ttname"><a href="classAP__InertialSensor.html#a7179321b8fa49dd4f6ef84380faf5f7d">AP_InertialSensor::is_still</a></div><div class="ttdeci">bool is_still()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01704">AP_InertialSensor.cpp:1704</a></div></div>
<div class="ttc" id="AP__InertialSensor_8cpp_html_ad6f60bd0f3351db9206a7a2ef7cf32d6"><div class="ttname"><a href="AP__InertialSensor_8cpp.html#ad6f60bd0f3351db9206a7a2ef7cf32d6">DEFAULT_STILL_THRESH</a></div><div class="ttdeci">#define DEFAULT_STILL_THRESH</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00053">AP_InertialSensor.cpp:53</a></div></div>
<div class="ttc" id="Printf_8cpp_html_a5558580ea8d3854253a721ee58cff12d"><div class="ttname"><a href="Printf_8cpp.html#a5558580ea8d3854253a721ee58cff12d">result</a></div><div class="ttdeci">const char * result</div><div class="ttdef"><b>Definition:</b> <a href="Printf_8cpp_source.html#l00016">Printf.cpp:16</a></div></div>
<div class="ttc" id="AP__InertialSensor_8h_html_ae0157c09727f80cd50830cb24bbc8273"><div class="ttname"><a href="AP__InertialSensor_8h.html#ae0157c09727f80cd50830cb24bbc8273">AP_INERTIAL_SENSOR_ACCEL_VIBE_FLOOR_FILT_HZ</a></div><div class="ttdeci">#define AP_INERTIAL_SENSOR_ACCEL_VIBE_FLOOR_FILT_HZ</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00006">AP_InertialSensor.h:6</a></div></div>
<div class="ttc" id="classAP__AccelCal__Client_html_a4216923ec8a556736f1edcf39a4d5ff1"><div class="ttname"><a href="classAP__AccelCal__Client.html#a4216923ec8a556736f1edcf39a4d5ff1">AP_AccelCal_Client::AP_AccelCal</a></div><div class="ttdeci">friend class AP_AccelCal</div><div class="ttdef"><b>Definition:</b> <a href="AP__AccelCal_8h_source.html#l00081">AP_AccelCal.h:81</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_af0beb13a9fff7ad446383972154dad71"><div class="ttname"><a href="classAP__InertialSensor.html#af0beb13a9fff7ad446383972154dad71">AP_InertialSensor::_custom_rotation</a></div><div class="ttdeci">Matrix3f * _custom_rotation</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00487">AP_InertialSensor.h:487</a></div></div>
<div class="ttc" id="AP__InertialSensor__L3G4200D_8h_html"><div class="ttname"><a href="AP__InertialSensor__L3G4200D_8h.html">AP_InertialSensor_L3G4200D.h</a></div></div>
<div class="ttc" id="rotations_8h_html_a67a250c97139a5466814a54c4aa4a681"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681">Rotation</a></div><div class="ttdeci">Rotation</div><div class="ttdef"><b>Definition:</b> <a href="rotations_8h_source.html#l00027">rotations.h:27</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_aed30141c5e8d9d5c169767fd22dc41f5"><div class="ttname"><a href="classAP__InertialSensor.html#aed30141c5e8d9d5c169767fd22dc41f5">AP_InertialSensor::_accel_max_abs_offsets</a></div><div class="ttdeci">float _accel_max_abs_offsets[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00447">AP_InertialSensor.h:447</a></div></div>
<div class="ttc" id="AP__InertialSensor__LSM9DS1_8h_html"><div class="ttname"><a href="AP__InertialSensor__LSM9DS1_8h.html">AP_InertialSensor_LSM9DS1.h</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a8744303832541bef0025d9698468938c"><div class="ttname"><a href="classAP__InertialSensor.html#a8744303832541bef0025d9698468938c">AP_InertialSensor::_init_gyro</a></div><div class="ttdeci">void _init_gyro()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01094">AP_InertialSensor.cpp:1094</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ac2aac5664a4f7c78d5770ba268964001"><div class="ttname"><a href="classAP__InertialSensor.html#ac2aac5664a4f7c78d5770ba268964001">AP_InertialSensor::_fast_sampling_mask</a></div><div class="ttdeci">AP_Int8 _fast_sampling_mask</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00480">AP_InertialSensor.h:480</a></div></div>
<div class="ttc" id="classAccelCalibrator_html_a3c63e8d4d5c0c7fd7169e9e0aadd9941"><div class="ttname"><a href="classAccelCalibrator.html#a3c63e8d4d5c0c7fd7169e9e0aadd9941">AccelCalibrator::get_calibration</a></div><div class="ttdeci">void get_calibration(Vector3f &amp;offset) const</div><div class="ttdef"><b>Definition:</b> <a href="AccelCalibrator_8cpp_source.html#l00203">AccelCalibrator.cpp:203</a></div></div>
<div class="ttc" id="AP__InternalError_8cpp_html_a02ad7a50d04e0dbf28c6c90a183a0579"><div class="ttname"><a href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a></div><div class="ttdeci">static AP_InternalError instance</div><div class="ttdef"><b>Definition:</b> <a href="AP__InternalError_8cpp_source.html#l00008">AP_InternalError.cpp:8</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_abf39b6e98861f769d6c2646ac3a13521"><div class="ttname"><a href="classAP__InertialSensor.html#abf39b6e98861f769d6c2646ac3a13521">AP_InertialSensor::_accel_raw_sampling_multiplier</a></div><div class="ttdeci">uint16_t _accel_raw_sampling_multiplier[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00430">AP_InertialSensor.h:430</a></div></div>
<div class="ttc" id="classAP__AccelCal_html_a6ecd2cc4987ebcec35f59a538a131ace"><div class="ttname"><a href="classAP__AccelCal.html#a6ecd2cc4987ebcec35f59a538a131ace">AP_AccelCal::register_client</a></div><div class="ttdeci">static void register_client(AP_AccelCal_Client *client)</div><div class="ttdef"><b>Definition:</b> <a href="AP__AccelCal_8cpp_source.html#l00282">AP_AccelCal.cpp:282</a></div></div>
<div class="ttc" id="classLowPassFilter_html_a1cc5016de137b01080fa0a6fa7fe53cd"><div class="ttname"><a href="classLowPassFilter.html#a1cc5016de137b01080fa0a6fa7fe53cd">LowPassFilter::set_cutoff_frequency</a></div><div class="ttdeci">void set_cutoff_frequency(float cutoff_freq)</div><div class="ttdef"><b>Definition:</b> <a href="LowPassFilter_8cpp_source.html#l00082">LowPassFilter.cpp:82</a></div></div>
<div class="ttc" id="AP__InertialSensor__LSM9DS0_8h_html"><div class="ttname"><a href="AP__InertialSensor__LSM9DS0_8h.html">AP_InertialSensor_LSM9DS0.h</a></div></div>
<div class="ttc" id="AP__Common_8h_html_a3c9d151923236c7e8ccccf86f131e550"><div class="ttname"><a href="AP__Common_8h.html#a3c9d151923236c7e8ccccf86f131e550">ToDeg</a></div><div class="ttdeci">#define ToDeg(x)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00064">AP_Common.h:64</a></div></div>
<div class="ttc" id="AP__InertialSensor_8cpp_html_af4a066a134904eedd6821d1ef69cc670"><div class="ttname"><a href="AP__InertialSensor_8cpp.html#af4a066a134904eedd6821d1ef69cc670">DEFAULT_GYRO_FILTER</a></div><div class="ttdeci">#define DEFAULT_GYRO_FILTER</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00051">AP_InertialSensor.cpp:51</a></div></div>
<div class="ttc" id="chibios_8h_html_a876031582808a8548348173e7a48736e"><div class="ttname"><a href="chibios_8h.html#a876031582808a8548348173e7a48736e">HAL_INS_ICM20608_AM_NAME</a></div><div class="ttdeci">#define HAL_INS_ICM20608_AM_NAME</div><div class="ttdef"><b>Definition:</b> <a href="chibios_8h_source.html#l00075">chibios.h:75</a></div></div>
<div class="ttc" id="AP__InertialSensor_8h_html"><div class="ttname"><a href="AP__InertialSensor_8h.html">AP_InertialSensor.h</a></div></div>
<div class="ttc" id="classAccelCalibrator_html_a03eda1ab18d906b6b375a45366561b3d"><div class="ttname"><a href="classAccelCalibrator.html#a03eda1ab18d906b6b375a45366561b3d">AccelCalibrator::get_num_samples_collected</a></div><div class="ttdeci">uint8_t get_num_samples_collected() const</div><div class="ttdef"><b>Definition:</b> <a href="AccelCalibrator_8h_source.html#l00078">AccelCalibrator.h:78</a></div></div>
<div class="ttc" id="classAP__InertialSensor__LSM9DS0_html_a47ae2f91f700f8d46b7f6de80ac77eab"><div class="ttname"><a href="classAP__InertialSensor__LSM9DS0.html#a47ae2f91f700f8d46b7f6de80ac77eab">AP_InertialSensor_LSM9DS0::probe</a></div><div class="ttdeci">static AP_InertialSensor_Backend * probe(AP_InertialSensor &amp;imu, AP_HAL::OwnPtr&lt; AP_HAL::Device &gt; dev_gyro, AP_HAL::OwnPtr&lt; AP_HAL::Device &gt; dev_accel, enum Rotation rotation_a=ROTATION_NONE, enum Rotation rotation_g=ROTATION_NONE, enum Rotation rotation_gH=ROTATION_NONE)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__LSM9DS0_8cpp_source.html#l00393">AP_InertialSensor_LSM9DS0.cpp:393</a></div></div>
<div class="ttc" id="structAP__Notify_1_1notify__flags__and__values__type_html_a02b0d4d68e7d24114885e508a73f2b07"><div class="ttname"><a href="structAP__Notify_1_1notify__flags__and__values__type.html#a02b0d4d68e7d24114885e508a73f2b07">AP_Notify::notify_flags_and_values_type::initialising</a></div><div class="ttdeci">bool initialising</div><div class="ttdef"><b>Definition:</b> <a href="AP__Notify_8h_source.html#l00077">AP_Notify.h:77</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a5bf613395bdc1fe69d0d22496507df4e"><div class="ttname"><a href="classAP__InertialSensor.html#a5bf613395bdc1fe69d0d22496507df4e">AP_InertialSensor::_delta_angle_acc</a></div><div class="ttdeci">Vector3f _delta_angle_acc[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00421">AP_InertialSensor.h:421</a></div></div>
<div class="ttc" id="classAP__InertialSensor__Backend_html_a359c6b8d74c13e735210d3602d793215"><div class="ttname"><a href="classAP__InertialSensor__Backend.html#a359c6b8d74c13e735210d3602d793215">AP_InertialSensor_Backend::start</a></div><div class="ttdeci">virtual void start()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__Backend_8h_source.html#l00060">AP_InertialSensor_Backend.h:60</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a15ced8f1e0dbe86237e36ca779ad90a3"><div class="ttname"><a href="classAP__InertialSensor.html#a15ced8f1e0dbe86237e36ca779ad90a3">AP_InertialSensor::_gyro_raw_sample_rates</a></div><div class="ttdeci">float _gyro_raw_sample_rates[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00451">AP_InertialSensor.h:451</a></div></div>
<div class="ttc" id="AP__InertialSensor_8h_html_a04f48700bcfc9677a766c604968798c3"><div class="ttname"><a href="AP__InertialSensor_8h.html#a04f48700bcfc9677a766c604968798c3">INS_VIBRATION_CHECK_INSTANCES</a></div><div class="ttdeci">#define INS_VIBRATION_CHECK_INSTANCES</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00016">AP_InertialSensor.h:16</a></div></div>
<div class="ttc" id="classAP__HAL_1_1Scheduler_html_ab3175e2e6223ccfe82f957e41cc12b26"><div class="ttname"><a href="classAP__HAL_1_1Scheduler.html#ab3175e2e6223ccfe82f957e41cc12b26">AP_HAL::Scheduler::delay</a></div><div class="ttdeci">virtual void delay(uint16_t ms)=0</div></div>
<div class="ttc" id="classAP__InertialSensor__Backend_html"><div class="ttname"><a href="classAP__InertialSensor__Backend.html">AP_InertialSensor_Backend</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__Backend_8h_source.html#l00034">AP_InertialSensor_Backend.h:34</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ae840940f433011c353a91fa25ce1e197"><div class="ttname"><a href="classAP__InertialSensor.html#ae840940f433011c353a91fa25ce1e197">AP_InertialSensor::_accel_id_ok</a></div><div class="ttdeci">bool _accel_id_ok[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00495">AP_InertialSensor.h:495</a></div></div>
<div class="ttc" id="rotations_8h_html_a67a250c97139a5466814a54c4aa4a681a621932380092e03bd929b22f6a1945ed"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a621932380092e03bd929b22f6a1945ed">ROTATION_CUSTOM</a></div><div class="ttdef"><b>Definition:</b> <a href="rotations_8h_source.html#l00077">rotations.h:77</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_acfa1bbafefac03971538923ffcd1641a"><div class="ttname"><a href="classAP__InertialSensor.html#acfa1bbafefac03971538923ffcd1641a">AP_InertialSensor::_accel_scale</a></div><div class="ttdeci">AP_Vector3f _accel_scale[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00439">AP_InertialSensor.h:439</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_aa083993c3519c16ad9740e4bbaa1691c"><div class="ttname"><a href="classAP__InertialSensor.html#aa083993c3519c16ad9740e4bbaa1691c">AP_InertialSensor::get_delta_angle</a></div><div class="ttdeci">bool get_delta_angle(uint8_t i, Vector3f &amp;delta_angle) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01499">AP_InertialSensor.cpp:1499</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a8069c8ad90f59f285d121dd615f5a93e"><div class="ttname"><a href="classAP__InertialSensor.html#a8069c8ad90f59f285d121dd615f5a93e">AP_InertialSensor::_delta_angle</a></div><div class="ttdeci">Vector3f _delta_angle[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00416">AP_InertialSensor.h:416</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983ae3bc20831e04c6038b9ad40680003eda"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ae3bc20831e04c6038b9ad40680003eda">AP_BoardConfig::PX4_BOARD_FMUV6</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00088">AP_BoardConfig.h:88</a></div></div>
<div class="ttc" id="AP__InertialSensor_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__InertialSensor_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition:</b> <a href="AC__PID__test_8cpp_source.html#l00021">AC_PID_test.cpp:21</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a3fc473466ffcccef319c4c5e56cd1f9d"><div class="ttname"><a href="classAP__InertialSensor.html#a3fc473466ffcccef319c4c5e56cd1f9d">AP_InertialSensor::_find_backend</a></div><div class="ttdeci">AP_InertialSensor_Backend * _find_backend(int16_t backend_id, uint8_t instance)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00596">AP_InertialSensor.cpp:596</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a2a90b36730b6afd50a7f335537bd1b17"><div class="ttname"><a href="classAP__InertialSensor.html#a2a90b36730b6afd50a7f335537bd1b17">AP_InertialSensor::_gyro_id</a></div><div class="ttdeci">AP_Int32 _gyro_id[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00436">AP_InertialSensor.h:436</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a05ec778f42256d22fbdf58c458707b38"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a05ec778f42256d22fbdf58c458707b38">AP_BoardConfig::PX4_BOARD_PIXHAWK_PRO</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00074">AP_BoardConfig.h:74</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a53e500f8c050e0ae471194b0fca121cb"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a53e500f8c050e0ae471194b0fca121cb">AP_BoardConfig::VRX_BOARD_UBRAIN51</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00083">AP_BoardConfig.h:83</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_af566c6efe39ea6660adab9c68baede28"><div class="ttname"><a href="classAP__InertialSensor.html#af566c6efe39ea6660adab9c68baede28">AP_InertialSensor::_primary_accel</a></div><div class="ttdeci">uint8_t _primary_accel</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00499">AP_InertialSensor.h:499</a></div></div>
<div class="ttc" id="classAP__InertialSensor__Backend_html_aff0f84ba798338291f3f6f37ccf3b91e"><div class="ttname"><a href="classAP__InertialSensor__Backend.html#aff0f84ba798338291f3f6f37ccf3b91e">AP_InertialSensor_Backend::get_id</a></div><div class="ttdeci">int16_t get_id() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__Backend_8h_source.html#l00071">AP_InertialSensor_Backend.h:71</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a796b4e67bfa9f882fe11fc8e2d867950"><div class="ttname"><a href="classAP__InertialSensor.html#a796b4e67bfa9f882fe11fc8e2d867950">AP_InertialSensor::_new_accel_data</a></div><div class="ttdeci">bool _new_accel_data[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00407">AP_InertialSensor.h:407</a></div></div>
<div class="ttc" id="classAP__HAL_1_1BetterStream_html_a8534aa004599bb81ad60f3e762791032"><div class="ttname"><a href="classAP__HAL_1_1BetterStream.html#a8534aa004599bb81ad60f3e762791032">AP_HAL::BetterStream::printf</a></div><div class="ttdeci">virtual void printf(const char *,...) FMT_PRINTF(2</div><div class="ttdef"><b>Definition:</b> <a href="BetterStream_8cpp_source.html#l00005">BetterStream.cpp:5</a></div></div>
<div class="ttc" id="AP__InertialSensor__Invensensev2_8h_html"><div class="ttname"><a href="AP__InertialSensor__Invensensev2_8h.html">AP_InertialSensor_Invensensev2.h</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a17706ae4e3ef55200ee8b1e5c4ead7ec"><div class="ttname"><a href="classAP__InertialSensor.html#a17706ae4e3ef55200ee8b1e5c4ead7ec">AP_InertialSensor::register_accel</a></div><div class="ttdeci">uint8_t register_accel(uint16_t raw_sample_rate_hz, uint32_t id)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00534">AP_InertialSensor.cpp:534</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_aa88c1ceb397cffac32226064f45b1516"><div class="ttname"><a href="classAP__InertialSensor.html#aa88c1ceb397cffac32226064f45b1516">AP_InertialSensor::_gyro_wait_mask</a></div><div class="ttdeci">uint8_t _gyro_wait_mask</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00503">AP_InertialSensor.h:503</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a0250547290ca2b46966f8ff902cb22bc"><div class="ttname"><a href="classAP__InertialSensor.html#a0250547290ca2b46966f8ff902cb22bc">AP_InertialSensor::_acal</a></div><div class="ttdeci">AP_AccelCal * _acal</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00568">AP_InertialSensor.h:568</a></div></div>
<div class="ttc" id="rotations_8h_html_a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a></div><div class="ttdef"><b>Definition:</b> <a href="rotations_8h_source.html#l00038">rotations.h:38</a></div></div>
<div class="ttc" id="AP__InertialSensor_8cpp_html_adc03e2598df2538fae6b5a59299f8103"><div class="ttname"><a href="AP__InertialSensor_8cpp.html#adc03e2598df2538fae6b5a59299f8103">ADD_BACKEND</a></div><div class="ttdeci">#define ADD_BACKEND(x)</div></div>
<div class="ttc" id="classAP__HAL_1_1SPIDeviceManager_html_a84c4a9ff2ae0cdaa9a0bc8a3f0939893"><div class="ttname"><a href="classAP__HAL_1_1SPIDeviceManager.html#a84c4a9ff2ae0cdaa9a0bc8a3f0939893">AP_HAL::SPIDeviceManager::get_device</a></div><div class="ttdeci">virtual OwnPtr&lt; SPIDevice &gt; get_device(const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="SPIDevice_8h_source.html#l00071">SPIDevice.h:71</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a5974df880b2e2c6d45d5d12fbbb89438"><div class="ttname"><a href="classAP__InertialSensor.html#a5974df880b2e2c6d45d5d12fbbb89438">AP_InertialSensor::_gyro_over_sampling</a></div><div class="ttdeci">uint8_t _gyro_over_sampling[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00455">AP_InertialSensor.h:455</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00021">HAL.h:21</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html"><div class="ttname"><a href="classAP__InertialSensor.html">AP_InertialSensor</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00046">AP_InertialSensor.h:46</a></div></div>
<div class="ttc" id="namespaceAP_html"><div class="ttname"><a href="namespaceAP.html">AP</a></div><div class="ttdef"><b>Definition:</b> <a href="AC__Avoid_8cpp_source.html#l00655">AC_Avoid.cpp:655</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a75275eb329f84f1626c5a4bee81be248"><div class="ttname"><a href="classAP__InertialSensor.html#a75275eb329f84f1626c5a4bee81be248">AP_InertialSensor::_acal_event_failure</a></div><div class="ttdeci">void _acal_event_failure() override</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01807">AP_InertialSensor.cpp:1807</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a8d8b31abadf23ccaec838e223ad678b2"><div class="ttname"><a href="classAP__InertialSensor.html#a8d8b31abadf23ccaec838e223ad678b2">AP_InertialSensor::get_accel_health_all</a></div><div class="ttdeci">bool get_accel_health_all(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00971">AP_InertialSensor.cpp:971</a></div></div>
<div class="ttc" id="classAP__AccelCal_html_ab06f0152811223855531003e5fac5b6e"><div class="ttname"><a href="classAP__AccelCal.html#ab06f0152811223855531003e5fac5b6e">AP_AccelCal::get_status</a></div><div class="ttdeci">accel_cal_status_t get_status()</div><div class="ttdef"><b>Definition:</b> <a href="AP__AccelCal_8h_source.html#l00028">AP_AccelCal.h:28</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a97426996f59ed4a7534cfd7bb6a3174a"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a97426996f59ed4a7534cfd7bb6a3174a">AP_BoardConfig::PX4_BOARD_AEROFC</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00073">AP_BoardConfig.h:73</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ad85a0f7284984ab4bc7b6309ec61003f"><div class="ttname"><a href="classAP__InertialSensor.html#ad85a0f7284984ab4bc7b6309ec61003f">AP_InertialSensor::_calculate_trim</a></div><div class="ttdeci">bool _calculate_trim(const Vector3f &amp;accel_sample, float &amp;trim_roll, float &amp;trim_pitch)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00898">AP_InertialSensor.cpp:898</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a122ab74c52fd603b79d0b2c0b5651ed5"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a122ab74c52fd603b79d0b2c0b5651ed5">AP_BoardConfig::VRX_BOARD_UBRAIN52</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00084">AP_BoardConfig.h:84</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a9a5846c73bf66f799f0761d7c287f5c7"><div class="ttname"><a href="classAP__InertialSensor.html#a9a5846c73bf66f799f0761d7c287f5c7">AP_InertialSensor::_backends_detected</a></div><div class="ttdeci">bool _backends_detected</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00518">AP_InertialSensor.h:518</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a714dc332f1f664de77df912220525653"><div class="ttname"><a href="classAP__InertialSensor.html#a714dc332f1f664de77df912220525653">AP_InertialSensor::use_gyro</a></div><div class="ttdeci">bool use_gyro(uint8_t instance) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00961">AP_InertialSensor.cpp:961</a></div></div>
<div class="ttc" id="definitions_8h_html_aea8758bf61b23b46507902b46060ebfd"><div class="ttname"><a href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a></div><div class="ttdeci">#define GRAVITY_MSS</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00047">definitions.h:47</a></div></div>
<div class="ttc" id="chibios_8h_html_a7e7ec91ec2955e149b39f0df332b3325"><div class="ttname"><a href="chibios_8h.html#a7e7ec91ec2955e149b39f0df332b3325">HAL_INS_MPU60x0_NAME</a></div><div class="ttdeci">#define HAL_INS_MPU60x0_NAME</div><div class="ttdef"><b>Definition:</b> <a href="chibios_8h_source.html#l00060">chibios.h:60</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_affe00c695b9c6af44f30bbd8c9709e64"><div class="ttname"><a href="classAP__InertialSensor.html#affe00c695b9c6af44f30bbd8c9709e64">AP_InertialSensor::_startup_error_counts_set</a></div><div class="ttdeci">bool _startup_error_counts_set</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00588">AP_InertialSensor.h:588</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a2a12cce483e9b870da70d30406d82c60"><div class="ttname"><a href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a></div><div class="ttdeci">bool is_zero(const T fVal1)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00040">AP_Math.h:40</a></div></div>
<div class="ttc" id="DerivativeFilter_8cpp_html_a357394e0f6f88c8a57bd893ab28dc8f8"><div class="ttname"><a href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a></div><div class="ttdeci">#define f(i)</div></div>
<div class="ttc" id="classAP__InertialSensor_html_a83b163411ab35497224c393df40c30d0"><div class="ttname"><a href="classAP__InertialSensor.html#a83b163411ab35497224c393df40c30d0">AP_InertialSensor::_gyro_error_count</a></div><div class="ttdeci">uint32_t _gyro_error_count[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00540">AP_InertialSensor.h:540</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ab6d1a4fc496f6e2b1c5ca0fdc74f2f9c"><div class="ttname"><a href="classAP__InertialSensor.html#ab6d1a4fc496f6e2b1c5ca0fdc74f2f9c">AP_InertialSensor::_sample_period_usec</a></div><div class="ttdeci">uint32_t _sample_period_usec</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00530">AP_InertialSensor.h:530</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a939e3484a227aa39019088ac96a9cfd3"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a939e3484a227aa39019088ac96a9cfd3">AP_BoardConfig::VRX_BOARD_BRAIN52</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00081">AP_BoardConfig.h:81</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a9fe1337ad1ef75304fa59b481eda8744"><div class="ttname"><a href="classAP__InertialSensor.html#a9fe1337ad1ef75304fa59b481eda8744">AP_InertialSensor::_accel_cal_requires_reboot</a></div><div class="ttdeci">bool _accel_cal_requires_reboot</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00583">AP_InertialSensor.h:583</a></div></div>
<div class="ttc" id="classVector3_html_a561df88b28e106e337a25bb86554a569"><div class="ttname"><a href="classVector3.html#a561df88b28e106e337a25bb86554a569">Vector3::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00067">vector3.h:67</a></div></div>
<div class="ttc" id="AP__BoardConfig_8h_html"><div class="ttname"><a href="AP__BoardConfig_8h.html">AP_BoardConfig.h</a></div></div>
<div class="ttc" id="AP__InertialSensor_8cpp_html_ac4110b4ae0e9c8b457c658eb451b609a"><div class="ttname"><a href="AP__InertialSensor_8cpp.html#ac4110b4ae0e9c8b457c658eb451b609a">timing_printf</a></div><div class="ttdeci">#define timing_printf(fmt, args...)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00033">AP_InertialSensor.cpp:33</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_af6c3c7d041de7c89c9afeda319acbf7d"><div class="ttname"><a href="classAP__InertialSensor.html#af6c3c7d041de7c89c9afeda319acbf7d">AP_InertialSensor::set_accel</a></div><div class="ttdeci">void set_accel(uint8_t instance, const Vector3f &amp;accel)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01562">AP_InertialSensor.cpp:1562</a></div></div>
<div class="ttc" id="classAP__InertialSensor__Backend_html_ad82c0f73f041cf67d1470f9fd185f049"><div class="ttname"><a href="classAP__InertialSensor__Backend.html#ad82c0f73f041cf67d1470f9fd185f049">AP_InertialSensor_Backend::get_auxiliary_bus</a></div><div class="ttdeci">virtual AuxiliaryBus * get_auxiliary_bus()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__Backend_8h_source.html#l00065">AP_InertialSensor_Backend.h:65</a></div></div>
<div class="ttc" id="namespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition:</b> <a href="ChibiOS_2system_8cpp_source.html#l00157">system.cpp:157</a></div></div>
<div class="ttc" id="classAP__InertialSensor__SITL_html_abc6d58b49a9c2dc04f884f46d948e8ed"><div class="ttname"><a href="classAP__InertialSensor__SITL.html#abc6d58b49a9c2dc04f884f46d948e8ed">AP_InertialSensor_SITL::detect</a></div><div class="ttdeci">static AP_InertialSensor_Backend * detect(AP_InertialSensor &amp;imu)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__SITL_8cpp_source.html#l00018">AP_InertialSensor_SITL.cpp:18</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a11e7c418e9e8f31edf82a74588d5c9de"><div class="ttname"><a href="classAP__InertialSensor.html#a11e7c418e9e8f31edf82a74588d5c9de">AP_InertialSensor::_acal_save_calibrations</a></div><div class="ttdeci">void _acal_save_calibrations() override</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01743">AP_InertialSensor.cpp:1743</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ada31f9669cfd8503daf08aa0a7f3f77f"><div class="ttname"><a href="classAP__InertialSensor.html#ada31f9669cfd8503daf08aa0a7f3f77f">AP_InertialSensor::_accel_id</a></div><div class="ttdeci">AP_Int32 _accel_id[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00435">AP_InertialSensor.h:435</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ae686d41dc8123df61020bbfabc10901c"><div class="ttname"><a href="classAP__InertialSensor.html#ae686d41dc8123df61020bbfabc10901c">AP_InertialSensor::_accel_vibe_filter</a></div><div class="ttdeci">LowPassFilterVector3f _accel_vibe_filter[INS_VIBRATION_CHECK_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00545">AP_InertialSensor.h:545</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ae702a0c6ac4e418075f92c09a2631654"><div class="ttname"><a href="classAP__InertialSensor.html#ae702a0c6ac4e418075f92c09a2631654">AP_InertialSensor::_calibrating</a></div><div class="ttdeci">bool _calibrating</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00516">AP_InertialSensor.h:516</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a57b06a5ccbc1568b1c43537fb6576181"><div class="ttname"><a href="classAP__InertialSensor.html#a57b06a5ccbc1568b1c43537fb6576181">AP_InertialSensor::_delta_angle_acc_dt</a></div><div class="ttdeci">float _delta_angle_acc_dt[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00420">AP_InertialSensor.h:420</a></div></div>
<div class="ttc" id="AP__InertialSensor__BMI160_8h_html"><div class="ttname"><a href="AP__InertialSensor__BMI160_8h.html">AP_InertialSensor_BMI160.h</a></div></div>
<div class="ttc" id="classVector3_html_ab3e7f5401dd6e951978bfa746809f74f"><div class="ttname"><a href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">Vector3::z</a></div><div class="ttdeci">T z</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00067">vector3.h:67</a></div></div>
<div class="ttc" id="rotations_8h_html_a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba">ROTATION_YAW_90</a></div><div class="ttdef"><b>Definition:</b> <a href="rotations_8h_source.html#l00030">rotations.h:30</a></div></div>
<div class="ttc" id="structAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00142">AP_Param.h:142</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a2548b608826699e872a2de7f4e1ff877"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a2548b608826699e872a2de7f4e1ff877">AP_BoardConfig::PX4_BOARD_SP01</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00078">AP_BoardConfig.h:78</a></div></div>
<div class="ttc" id="chibios_8h_html_ae30b37f1f4cd685cec0014ac3a5e00ad"><div class="ttname"><a href="chibios_8h.html#ae30b37f1f4cd685cec0014ac3a5e00ad">HAL_INS_LSM9DS0_EXT_A_NAME</a></div><div class="ttdeci">#define HAL_INS_LSM9DS0_EXT_A_NAME</div><div class="ttdef"><b>Definition:</b> <a href="chibios_8h_source.html#l00067">chibios.h:67</a></div></div>
<div class="ttc" id="AP__InertialSensor_8cpp_html_a06321f4a07a1e343662fa804bb402a7e"><div class="ttname"><a href="AP__InertialSensor_8cpp.html#a06321f4a07a1e343662fa804bb402a7e">DEFAULT_ACCEL_FILTER</a></div><div class="ttdeci">#define DEFAULT_ACCEL_FILTER</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00052">AP_InertialSensor.cpp:52</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a6aaf12ce90b5b9586d350af949ab84a0"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a6aaf12ce90b5b9586d350af949ab84a0">AP_BoardConfig::PX4_BOARD_MINDPXV2</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00077">AP_BoardConfig.h:77</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_aa8ac7e294cc5ed4ea30ab1fd5e1b6637"><div class="ttname"><a href="classAP__InertialSensor.html#aa8ac7e294cc5ed4ea30ab1fd5e1b6637">AP_InertialSensor::_gyro_cal_ok</a></div><div class="ttdeci">bool _gyro_cal_ok[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00494">AP_InertialSensor.h:494</a></div></div>
<div class="ttc" id="AP__Math_8h_html"><div class="ttname"><a href="AP__Math_8h.html">AP_Math.h</a></div></div>
<div class="ttc" id="AP__InertialSensor__RST_8h_html"><div class="ttname"><a href="AP__InertialSensor__RST_8h.html">AP_InertialSensor_RST.h</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a44b3909c69cbf40dc18fd383e4232cb7"><div class="ttname"><a href="classAP__InertialSensor.html#a44b3909c69cbf40dc18fd383e4232cb7">AP_InertialSensor::get_accel_clip_count</a></div><div class="ttdeci">uint32_t get_accel_clip_count(uint8_t instance) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00923">AP_InertialSensor.cpp:923</a></div></div>
<div class="ttc" id="Perf__Lttng__TracePoints_8h_html_ae11b3deb3de3df7dc48e439074023e35"><div class="ttname"><a href="Perf__Lttng__TracePoints_8h.html#ae11b3deb3de3df7dc48e439074023e35">count</a></div><div class="ttdeci">count</div><div class="ttdef"><b>Definition:</b> <a href="Perf__Lttng__TracePoints_8h_source.html#l00051">Perf_Lttng_TracePoints.h:51</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a13a4fb11b16bc1cccf146cf8003d5e00"><div class="ttname"><a href="classAP__InertialSensor.html#a13a4fb11b16bc1cccf146cf8003d5e00">AP_InertialSensor::_delta_velocity_valid</a></div><div class="ttdeci">bool _delta_velocity_valid[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00396">AP_InertialSensor.h:396</a></div></div>
<div class="ttc" id="chibios_8h_html_a696058af28d7169142b2b7dc64155bf4"><div class="ttname"><a href="chibios_8h.html#a696058af28d7169142b2b7dc64155bf4">HAL_INS_ICM20608_NAME</a></div><div class="ttdeci">#define HAL_INS_ICM20608_NAME</div><div class="ttdef"><b>Definition:</b> <a href="chibios_8h_source.html#l00074">chibios.h:74</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983acf567833f77e46ce320a961f68611bff"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983acf567833f77e46ce320a961f68611bff">AP_BoardConfig::PX4_BOARD_PX4V1</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00067">AP_BoardConfig.h:67</a></div></div>
<div class="ttc" id="AccelCalibrator_8h_html_a03e56e1184d0da13e790f7f21db96044a4fcbc7b305146f3f43f6f4268a69bab9"><div class="ttname"><a href="AccelCalibrator_8h.html#a03e56e1184d0da13e790f7f21db96044a4fcbc7b305146f3f43f6f4268a69bab9">ACCEL_CAL_NOT_STARTED</a></div><div class="ttdef"><b>Definition:</b> <a href="AccelCalibrator_8h_source.html#l00022">AccelCalibrator.h:22</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_af8c602bce948527aa20ec7a32562010d"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">AP_HAL::HAL::spi</a></div><div class="ttdeci">AP_HAL::SPIDeviceManager * spi</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00107">HAL.h:107</a></div></div>
<div class="ttc" id="chibios_8h_html_a62cb8ec55fbfb126d38b283968fd75a9"><div class="ttname"><a href="chibios_8h.html#a62cb8ec55fbfb126d38b283968fd75a9">HAL_INS_MPU9250_NAME</a></div><div class="ttdeci">#define HAL_INS_MPU9250_NAME</div><div class="ttdef"><b>Definition:</b> <a href="chibios_8h_source.html#l00069">chibios.h:69</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_adafd6f05918b4a355baf47cc44e408ef"><div class="ttname"><a href="classAP__InertialSensor.html#adafd6f05918b4a355baf47cc44e408ef">AP_InertialSensor::_gyro</a></div><div class="ttdeci">Vector3f _gyro[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00415">AP_InertialSensor.h:415</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a9c15eb46fd51722e79e1714b726c08e6"><div class="ttname"><a href="classAP__InertialSensor.html#a9c15eb46fd51722e79e1714b726c08e6">AP_InertialSensor::get_sample_rate</a></div><div class="ttdeci">uint16_t get_sample_rate(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00195">AP_InertialSensor.h:195</a></div></div>
<div class="ttc" id="classAP__AHRS_html_ab45359e5c71751e421577e6a2d85625e"><div class="ttname"><a href="classAP__AHRS.html#ab45359e5c71751e421577e6a2d85625e">AP_AHRS::set_trim</a></div><div class="ttdeci">void set_trim(const Vector3f &amp;new_trim)</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8cpp_source.html#l00203">AP_AHRS.cpp:203</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a17883a4a4ad070fac8d3111e9173aa16"><div class="ttname"><a href="classAP__InertialSensor.html#a17883a4a4ad070fac8d3111e9173aa16">AP_InertialSensor::delta_time</a></div><div class="ttdeci">float delta_time</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00560">AP_InertialSensor.h:560</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_abde1abead9e4ff8875808e49ad6e551f"><div class="ttname"><a href="classAP__InertialSensor.html#abde1abead9e4ff8875808e49ad6e551f">AP_InertialSensor::simple_accel_cal</a></div><div class="ttdeci">MAV_RESULT simple_accel_cal()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01878">AP_InertialSensor.cpp:1878</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a1c1eed3a078805b7647b2a29b612ff26"><div class="ttname"><a href="classAP__InertialSensor.html#a1c1eed3a078805b7647b2a29b612ff26">AP_InertialSensor::_delta_velocity</a></div><div class="ttdeci">Vector3f _delta_velocity[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00394">AP_InertialSensor.h:394</a></div></div>
<div class="ttc" id="classAP__InertialSensor__BMI055_html_a981c75fe5745e1126b11998f623f35ab"><div class="ttname"><a href="classAP__InertialSensor__BMI055.html#a981c75fe5745e1126b11998f623f35ab">AP_InertialSensor_BMI055::probe</a></div><div class="ttdeci">static AP_InertialSensor_Backend * probe(AP_InertialSensor &amp;imu, AP_HAL::OwnPtr&lt; AP_HAL::SPIDevice &gt; dev_accel, AP_HAL::OwnPtr&lt; AP_HAL::SPIDevice &gt; dev_gyro, enum Rotation rotation=ROTATION_NONE)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__BMI055_8cpp_source.html#l00077">AP_InertialSensor_BMI055.cpp:77</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a9949b7e301b0d7a5f3e59385d2e8d97a"><div class="ttname"><a href="classAP__InertialSensor.html#a9949b7e301b0d7a5f3e59385d2e8d97a">AP_InertialSensor::_start_backends</a></div><div class="ttdeci">void _start_backends()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00573">AP_InertialSensor.cpp:573</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ab6c1ac320a391b320ddaa5ad27265b53"><div class="ttname"><a href="classAP__InertialSensor.html#ab6c1ac320a391b320ddaa5ad27265b53">AP_InertialSensor::set_accel_peak_hold</a></div><div class="ttdeci">void set_accel_peak_hold(uint8_t instance, const Vector3f &amp;accel)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01674">AP_InertialSensor.cpp:1674</a></div></div>
<div class="ttc" id="AP__Notify_8h_html"><div class="ttname"><a href="AP__Notify_8h.html">AP_Notify.h</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a9ca5d711a97f4c33fe6a7c31b1329761"><div class="ttname"><a href="classAP__InertialSensor.html#a9ca5d711a97f4c33fe6a7c31b1329761">AP_InertialSensor::acal_update</a></div><div class="ttdeci">void acal_update()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01726">AP_InertialSensor.cpp:1726</a></div></div>
<div class="ttc" id="AP__AHRS_8h_html"><div class="ttname"><a href="AP__AHRS_8h.html">AP_AHRS.h</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_adab0e15f297d55a8436b607627db0e5f"><div class="ttname"><a href="classAP__InertialSensor.html#adab0e15f297d55a8436b607627db0e5f">AP_InertialSensor::get_gyro_health</a></div><div class="ttdeci">bool get_gyro_health(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00131">AP_InertialSensor.h:131</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a4f9e51600bcadecad5830ae56b0771a3"><div class="ttname"><a href="classAP__InertialSensor.html#a4f9e51600bcadecad5830ae56b0771a3">AP_InertialSensor::get_delta_time</a></div><div class="ttdeci">float get_delta_time() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00173">AP_InertialSensor.h:173</a></div></div>
<div class="ttc" id="AP__Vehicle_8h_html"><div class="ttname"><a href="AP__Vehicle_8h.html">AP_Vehicle.h</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a34fd6b5d563528cc308675bcaedaac04"><div class="ttname"><a href="classAP__InertialSensor.html#a34fd6b5d563528cc308675bcaedaac04">AP_InertialSensor::get_primary_accel_cal_sample_avg</a></div><div class="ttdeci">bool get_primary_accel_cal_sample_avg(uint8_t sample_num, Vector3f &amp;ret) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01849">AP_InertialSensor.cpp:1849</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a96ea6a28cfba8d662ba2b6f10443af05a34154738ae4be5b007524c4c3bf1bb77"><div class="ttname"><a href="classAP__InertialSensor.html#a96ea6a28cfba8d662ba2b6f10443af05a34154738ae4be5b007524c4c3bf1bb77">AP_InertialSensor::GYRO_CAL_NEVER</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00060">AP_InertialSensor.h:60</a></div></div>
<div class="ttc" id="classLowPassFilter_html_a34bc75aa770bc6cc0facee3b43a05bec"><div class="ttname"><a href="classLowPassFilter.html#a34bc75aa770bc6cc0facee3b43a05bec">LowPassFilter::get</a></div><div class="ttdeci">const T &amp; get() const</div><div class="ttdef"><b>Definition:</b> <a href="LowPassFilter_8cpp_source.html#l00109">LowPassFilter.cpp:109</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a58da60a9551851bf27ffefc7035517be"><div class="ttname"><a href="classAP__InertialSensor.html#a58da60a9551851bf27ffefc7035517be">AP_InertialSensor::periodic</a></div><div class="ttdeci">void periodic()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00887">AP_InertialSensor.cpp:887</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a3173db0aeafd301342cde164cec5f8f8"><div class="ttname"><a href="classAP__InertialSensor.html#a3173db0aeafd301342cde164cec5f8f8">AP_InertialSensor::_gyro_raw_sampling_multiplier</a></div><div class="ttdeci">uint16_t _gyro_raw_sampling_multiplier[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00431">AP_InertialSensor.h:431</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ad87496184e3c6a775a10b3b5eb069cd9"><div class="ttname"><a href="classAP__InertialSensor.html#ad87496184e3c6a775a10b3b5eb069cd9">AP_InertialSensor::calibrate_trim</a></div><div class="ttdeci">bool calibrate_trim(float &amp;trim_roll, float &amp;trim_pitch)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00987">AP_InertialSensor.cpp:987</a></div></div>
<div class="ttc" id="classVector3_html_afcdfe81173c23d57e4a53a0282cddae7"><div class="ttname"><a href="classVector3.html#afcdfe81173c23d57e4a53a0282cddae7">Vector3::length</a></div><div class="ttdeci">float length(void) const</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8cpp_source.html#l00297">vector3.cpp:297</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_adb4f986eb3188358079c4a1aee15674e"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#adb4f986eb3188358079c4a1aee15674e">AP_HAL::HAL::i2c_mgr</a></div><div class="ttdeci">AP_HAL::I2CDeviceManager * i2c_mgr</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00106">HAL.h:106</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a5b42199f260d9523973a51debd99146e"><div class="ttname"><a href="classAP__InertialSensor.html#a5b42199f260d9523973a51debd99146e">AP_InertialSensor::get_accel_health</a></div><div class="ttdeci">bool get_accel_health(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00140">AP_InertialSensor.h:140</a></div></div>
<div class="ttc" id="classVector3_html_a53d5701ae2db9492944550927279b7b8"><div class="ttname"><a href="classVector3.html#a53d5701ae2db9492944550927279b7b8">Vector3::rotate</a></div><div class="ttdeci">void rotate(enum Rotation rotation)</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8cpp_source.html#l00028">vector3.cpp:28</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a08d15014b321673a9dca76bec82ec482"><div class="ttname"><a href="classAP__InertialSensor.html#a08d15014b321673a9dca76bec82ec482">AP_InertialSensor::_have_sample</a></div><div class="ttdeci">bool _have_sample</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00510">AP_InertialSensor.h:510</a></div></div>
<div class="ttc" id="classAP__AccelCal_html_a5a2c8a471866eff24b340cc9680f9868"><div class="ttname"><a href="classAP__AccelCal.html#a5a2c8a471866eff24b340cc9680f9868">AP_AccelCal::update</a></div><div class="ttdeci">void update()</div><div class="ttdef"><b>Definition:</b> <a href="AP__AccelCal_8cpp_source.html#l00028">AP_AccelCal.cpp:28</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_affc63e7edc9be1b0e128b8da3b8a24a5"><div class="ttname"><a href="classAP__InertialSensor.html#affc63e7edc9be1b0e128b8da3b8a24a5">AP_InertialSensor::AP_InertialSensor</a></div><div class="ttdeci">AP_InertialSensor()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00465">AP_InertialSensor.cpp:465</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a0553640f772e43284644d89d49ef660c"><div class="ttname"><a href="classAP__InertialSensor.html#a0553640f772e43284644d89d49ef660c">AP_InertialSensor::_board_orientation</a></div><div class="ttdeci">enum Rotation _board_orientation</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00486">AP_InertialSensor.h:486</a></div></div>
<div class="ttc" id="AP__Common_8h_html"><div class="ttname"><a href="AP__Common_8h.html">AP_Common.h</a></div><div class="ttdoc">Common definitions and utility routines for the ArduPilot libraries.</div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a6f39405e261af307e647f079d8a6ec56"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a6f39405e261af307e647f079d8a6ec56">AP_BoardConfig::PX4_BOARD_FMUV5</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00079">AP_BoardConfig.h:79</a></div></div>
<div class="ttc" id="classAP__InertialSensor__Backend_html_a7016ddeb343d823f9fe518fd414ba848"><div class="ttname"><a href="classAP__InertialSensor__Backend.html#a7016ddeb343d823f9fe518fd414ba848">AP_InertialSensor_Backend::update</a></div><div class="ttdeci">virtual bool update()=0</div></div>
<div class="ttc" id="classAP__InertialSensor_html_a454e1c877ab24b8623da6432a850a5c5"><div class="ttname"><a href="classAP__InertialSensor.html#a454e1c877ab24b8623da6432a850a5c5">AP_InertialSensor::set_gyro</a></div><div class="ttdeci">void set_gyro(uint8_t instance, const Vector3f &amp;gyro)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01580">AP_InertialSensor.cpp:1580</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a8967734e82a4f472c6d8ddd8db656804"><div class="ttname"><a href="classAP__InertialSensor.html#a8967734e82a4f472c6d8ddd8db656804">AP_InertialSensor::detect_backends</a></div><div class="ttdeci">void detect_backends(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00676">AP_InertialSensor.cpp:676</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a72885d6d01f968f8744fe51eeec133fd"><div class="ttname"><a href="classAP__InertialSensor.html#a72885d6d01f968f8744fe51eeec133fd">AP_InertialSensor::_new_trim</a></div><div class="ttdeci">bool _new_trim</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00581">AP_InertialSensor.h:581</a></div></div>
<div class="ttc" id="stdio_8h_html"><div class="ttname"><a href="stdio_8h.html">stdio.h</a></div></div>
<div class="ttc" id="AP__InertialSensor__Invensense_8h_html"><div class="ttname"><a href="AP__InertialSensor__Invensense_8h.html">AP_InertialSensor_Invensense.h</a></div></div>
<div class="ttc" id="classQuaternion_html_a48e6bafb249c895ed25f29dc9170e11e"><div class="ttname"><a href="classQuaternion.html#a48e6bafb249c895ed25f29dc9170e11e">Quaternion::normalize</a></div><div class="ttdeci">void normalize()</div><div class="ttdef"><b>Definition:</b> <a href="quaternion_8cpp_source.html#l00297">quaternion.cpp:297</a></div></div>
<div class="ttc" id="namespaceAP_html_a99432cfdb696952c9b7146f155a815aa"><div class="ttname"><a href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a></div><div class="ttdeci">AP_AHRS &amp; ahrs()</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8cpp_source.html#l00526">AP_AHRS.cpp:526</a></div></div>
<div class="ttc" id="classAP__HAL_1_1Scheduler_html_aa0beaea3a0ce331569f7617c10a06f53"><div class="ttname"><a href="classAP__HAL_1_1Scheduler.html#aa0beaea3a0ce331569f7617c10a06f53">AP_HAL::Scheduler::delay_microseconds_boost</a></div><div class="ttdeci">virtual void delay_microseconds_boost(uint16_t us)</div><div class="ttdef"><b>Definition:</b> <a href="Scheduler_8h_source.html#l00030">Scheduler.h:30</a></div></div>
<div class="ttc" id="AP__InertialSensor_8cpp_html_a8d2276f62dc5754534bdd115338901b9"><div class="ttname"><a href="AP__InertialSensor_8cpp.html#a8d2276f62dc5754534bdd115338901b9">HAL_DEFAULT_INS_FAST_SAMPLE</a></div><div class="ttdeci">#define HAL_DEFAULT_INS_FAST_SAMPLE</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00037">AP_InertialSensor.cpp:37</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a74cafbbddc2421ea0cac67e4911d52b8"><div class="ttname"><a href="classAP__InertialSensor.html#a74cafbbddc2421ea0cac67e4911d52b8">AP_InertialSensor::_acc_body_aligned</a></div><div class="ttdeci">AP_Int8 _acc_body_aligned</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00564">AP_InertialSensor.h:564</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a2d39b95156b74f51a7f2af62fd7e1021"><div class="ttname"><a href="classAP__InertialSensor.html#a2d39b95156b74f51a7f2af62fd7e1021">AP_InertialSensor::_trim_option</a></div><div class="ttdeci">AP_Int8 _trim_option</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00565">AP_InertialSensor.h:565</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a7a92b7a4048cc317fd15cea483745953"><div class="ttname"><a href="classAP__InertialSensor.html#a7a92b7a4048cc317fd15cea483745953">AP_InertialSensor::_trim_roll</a></div><div class="ttdeci">float _trim_roll</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00580">AP_InertialSensor.h:580</a></div></div>
<div class="ttc" id="AP__Math_8cpp_html_accbd9f8bbc0adacd51efa66fad490c24"><div class="ttname"><a href="AP__Math_8cpp.html#accbd9f8bbc0adacd51efa66fad490c24">is_equal</a></div><div class="ttdeci">std::enable_if&lt; std::is_integral&lt; typename std::common_type&lt; Arithmetic1, Arithmetic2 &gt;::type &gt;::value,bool &gt;::type is_equal(const Arithmetic1 v_1, const Arithmetic2 v_2)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8cpp_source.html#l00014">AP_Math.cpp:14</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a37d7c62a8231d9d22826261297b99da4"><div class="ttname"><a href="AP__Math_8h.html#a37d7c62a8231d9d22826261297b99da4">radians</a></div><div class="ttdeci">static constexpr float radians(float deg)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00163">AP_Math.h:163</a></div></div>
<div class="ttc" id="classAP__Notify_html_a724dd074a094de26e17c72c38ac499e9"><div class="ttname"><a href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a></div><div class="ttdeci">static struct notify_flags_and_values_type flags</div><div class="ttdef"><b>Definition:</b> <a href="AP__Notify_8h_source.html#l00128">AP_Notify.h:128</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a8fe1e7429d858b619847e0ae77f3354c"><div class="ttname"><a href="classAP__InertialSensor.html#a8fe1e7429d858b619847e0ae77f3354c">AP_InertialSensor::_loop_delta_t_max</a></div><div class="ttdeci">float _loop_delta_t_max</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00390">AP_InertialSensor.h:390</a></div></div>
<div class="ttc" id="structAP__InertialSensor_1_1PeakHoldState_html_acbeb15dd194d956bf945bc8b785667bf"><div class="ttname"><a href="structAP__InertialSensor_1_1PeakHoldState.html#acbeb15dd194d956bf945bc8b785667bf">AP_InertialSensor::PeakHoldState::accel_peak_hold_neg_x</a></div><div class="ttdeci">float accel_peak_hold_neg_x</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00549">AP_InertialSensor.h:549</a></div></div>
<div class="ttc" id="classAP__InertialSensor__Backend_html_af4c09c40d7977ee0406c91134d6c3dca"><div class="ttname"><a href="classAP__InertialSensor__Backend.html#af4c09c40d7977ee0406c91134d6c3dca">AP_InertialSensor_Backend::accumulate</a></div><div class="ttdeci">virtual void accumulate()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__Backend_8h_source.html#l00054">AP_InertialSensor_Backend.h:54</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a2f0a5b6527161d6a622728dfe8fd4023"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a2f0a5b6527161d6a622728dfe8fd4023">AP_BoardConfig::VRX_BOARD_CORE10</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00085">AP_BoardConfig.h:85</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a741065b13832b5e4c90bbae17519c0ad"><div class="ttname"><a href="classAP__InertialSensor.html#a741065b13832b5e4c90bbae17519c0ad">AP_InertialSensor::init</a></div><div class="ttdeci">void init(uint16_t sample_rate_hz)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00619">AP_InertialSensor.cpp:619</a></div></div>
<div class="ttc" id="AP__InertialSensor__Backend_8h_html"><div class="ttname"><a href="AP__InertialSensor__Backend_8h.html">AP_InertialSensor_Backend.h</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a78c93eef95585b2ee4595cb373594cd2"><div class="ttname"><a href="classAP__InertialSensor.html#a78c93eef95585b2ee4595cb373594cd2">AP_InertialSensor::batchsampler</a></div><div class="ttdeci">BatchSampler batchsampler</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00357">AP_InertialSensor.h:357</a></div></div>
<div class="ttc" id="rotations_8h_html_a67a250c97139a5466814a54c4aa4a681a16e7696bfbca8f804e76718d5cfa5bef"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a16e7696bfbca8f804e76718d5cfa5bef">ROTATION_PITCH_180</a></div><div class="ttdef"><b>Definition:</b> <a href="rotations_8h_source.html#l00040">rotations.h:40</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a394ea69014613b43fea7f73bfb6f30a1"><div class="ttname"><a href="classAP__InertialSensor.html#a394ea69014613b43fea7f73bfb6f30a1">AP_InertialSensor::_peak_hold_state</a></div><div class="ttdeci">struct AP_InertialSensor::PeakHoldState _peak_hold_state</div></div>
<div class="ttc" id="classAP__InertialSensor_html_aa4faf114689e827390b5da7bc6fd5f20"><div class="ttname"><a href="classAP__InertialSensor.html#aa4faf114689e827390b5da7bc6fd5f20">AP_InertialSensor::wait_for_sample</a></div><div class="ttdeci">void wait_for_sample(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01358">AP_InertialSensor.cpp:1358</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a98fb28755e41d2e2052c500b7ac3e2b6"><div class="ttname"><a href="classAP__InertialSensor.html#a98fb28755e41d2e2052c500b7ac3e2b6">AP_InertialSensor::get_auxiliary_bus</a></div><div class="ttdeci">AuxiliaryBus * get_auxiliary_bus(int16_t backend_id)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00241">AP_InertialSensor.h:241</a></div></div>
<div class="ttc" id="AP__InertialSensor_8h_html_ab4bc580ebf1e5a865816031fc00cf8ad"><div class="ttname"><a href="AP__InertialSensor_8h.html#ab4bc580ebf1e5a865816031fc00cf8ad">INS_MAX_BACKENDS</a></div><div class="ttdeci">#define INS_MAX_BACKENDS</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00015">AP_InertialSensor.h:15</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_abff942442a5155c2ea4bc8007d92bd45"><div class="ttname"><a href="classAP__InertialSensor.html#abff942442a5155c2ea4bc8007d92bd45">AP_InertialSensor::imu_kill_mask</a></div><div class="ttdeci">uint8_t imu_kill_mask</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00591">AP_InertialSensor.h:591</a></div></div>
<div class="ttc" id="AP__InertialSensor__BMI088_8h_html"><div class="ttname"><a href="AP__InertialSensor__BMI088_8h.html">AP_InertialSensor_BMI088.h</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_affd3646260c7f18a7aa76afd4b0fdd43"><div class="ttname"><a href="classAP__InertialSensor.html#affd3646260c7f18a7aa76afd4b0fdd43">AP_InertialSensor::_primary_gyro</a></div><div class="ttdeci">uint8_t _primary_gyro</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00498">AP_InertialSensor.h:498</a></div></div>
<div class="ttc" id="classAP__InertialSensor_1_1BatchSampler_html"><div class="ttname"><a href="classAP__InertialSensor_1_1BatchSampler.html">AP_InertialSensor::BatchSampler</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00285">AP_InertialSensor.h:285</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ab2625e619aa917ed3b1138c9c9c2b747"><div class="ttname"><a href="classAP__InertialSensor.html#ab2625e619aa917ed3b1138c9c9c2b747">AP_InertialSensor::gyro_calibrated_ok_all</a></div><div class="ttdeci">bool gyro_calibrated_ok_all() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00944">AP_InertialSensor.cpp:944</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a0375e3d67fd3911cacee5c3e1408c0f2"><div class="ttname"><a href="AP__Math_8h.html#a0375e3d67fd3911cacee5c3e1408c0f2">sq</a></div><div class="ttdeci">float sq(const T val)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00175">AP_Math.h:175</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a2fc042e6ca2b9116bd8c44c0fe3fe7a6"><div class="ttname"><a href="classAP__InertialSensor.html#a2fc042e6ca2b9116bd8c44c0fe3fe7a6">AP_InertialSensor::_delta_angle_dt</a></div><div class="ttdeci">float _delta_angle_dt[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00417">AP_InertialSensor.h:417</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a646482451aa12d3124f81e11f96a281e"><div class="ttname"><a href="classAP__InertialSensor.html#a646482451aa12d3124f81e11f96a281e">AP_InertialSensor::_gyro_offset</a></div><div class="ttdeci">AP_Vector3f _gyro_offset[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00441">AP_InertialSensor.h:441</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a5ba61d675f72ea75a9cf851ab3dd7d3c"><div class="ttname"><a href="classAP__InertialSensor.html#a5ba61d675f72ea75a9cf851ab3dd7d3c">AP_InertialSensor::get_new_trim</a></div><div class="ttdeci">bool get_new_trim(float &amp;trim_roll, float &amp;trim_pitch)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01818">AP_InertialSensor.cpp:1818</a></div></div>
<div class="ttc" id="classAP__InertialSensor__L3G4200D_html_aa262f132b6aabdab5fda4cb9a730655a"><div class="ttname"><a href="classAP__InertialSensor__L3G4200D.html#aa262f132b6aabdab5fda4cb9a730655a">AP_InertialSensor_L3G4200D::probe</a></div><div class="ttdeci">static AP_InertialSensor_Backend * probe(AP_InertialSensor &amp;imu, AP_HAL::OwnPtr&lt; AP_HAL::I2CDevice &gt; dev)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__L3G4200D_8cpp_source.html#l00107">AP_InertialSensor_L3G4200D.cpp:107</a></div></div>
<div class="ttc" id="classVector3_html"><div class="ttname"><a href="classVector3.html">Vector3&lt; float &gt;</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a75055b35bd0198fb76d42ada41c5961a"><div class="ttname"><a href="classAP__InertialSensor.html#a75055b35bd0198fb76d42ada41c5961a">AP_InertialSensor::_delta_velocity_acc</a></div><div class="ttdeci">Vector3f _delta_velocity_acc[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00398">AP_InertialSensor.h:398</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a4a421a821c8e43665a66501624522b9d"><div class="ttname"><a href="classAP__InertialSensor.html#a4a421a821c8e43665a66501624522b9d">AP_InertialSensor::get_gyro_count</a></div><div class="ttdeci">uint8_t get_gyro_count(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00133">AP_InertialSensor.h:133</a></div></div>
<div class="ttc" id="classAP__InertialSensor__RST_html_ac1967b632d7158b081e4bafc66804245"><div class="ttname"><a href="classAP__InertialSensor__RST.html#ac1967b632d7158b081e4bafc66804245">AP_InertialSensor_RST::probe</a></div><div class="ttdeci">static AP_InertialSensor_Backend * probe(AP_InertialSensor &amp;imu, AP_HAL::OwnPtr&lt; AP_HAL::SPIDevice &gt; dev_gyro, AP_HAL::OwnPtr&lt; AP_HAL::SPIDevice &gt; dev_accel, enum Rotation rotation_a, enum Rotation rotation_g)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__RST_8cpp_source.html#l00199">AP_InertialSensor_RST.cpp:199</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ae8b31f91250c4b29e26bc5492ec1eb0b"><div class="ttname"><a href="classAP__InertialSensor.html#ae8b31f91250c4b29e26bc5492ec1eb0b">AP_InertialSensor::_gyro_count</a></div><div class="ttdeci">uint8_t _gyro_count</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00383">AP_InertialSensor.h:383</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a38a02931e6daedb5177a6006abcbd0db"><div class="ttname"><a href="classAP__InertialSensor.html#a38a02931e6daedb5177a6006abcbd0db">AP_InertialSensor::kill_imu</a></div><div class="ttdeci">void kill_imu(uint8_t imu_idx, bool kill_it)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l02052">AP_InertialSensor.cpp:2052</a></div></div>
<div class="ttc" id="namespaceAP_html_ac571aa5a2ef71b7f4b4b2bfa09143fb9"><div class="ttname"><a href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9">AP::ins</a></div><div class="ttdeci">AP_InertialSensor &amp; ins()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l02076">AP_InertialSensor.cpp:2076</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a34c168ea29e2735ba19996be7f4157db"><div class="ttname"><a href="classAP__InertialSensor.html#a34c168ea29e2735ba19996be7f4157db">AP_InertialSensor::_singleton</a></div><div class="ttdeci">static AP_InertialSensor * _singleton</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00567">AP_InertialSensor.h:567</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_aa4ab6d3141cc30a917961efa0c5e7054"><div class="ttname"><a href="classAP__InertialSensor.html#aa4ab6d3141cc30a917961efa0c5e7054">AP_InertialSensor::_delta_time</a></div><div class="ttdeci">float _delta_time</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00521">AP_InertialSensor.h:521</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a49643a308463775eb7f7f3d8be13a034"><div class="ttname"><a href="classAP__InertialSensor.html#a49643a308463775eb7f7f3d8be13a034">AP_InertialSensor::calc_vibration_and_clipping</a></div><div class="ttdeci">void calc_vibration_and_clipping(uint8_t instance, const Vector3f &amp;accel, float dt)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01647">AP_InertialSensor.cpp:1647</a></div></div>
<div class="ttc" id="chibios_8h_html_a8f046cbd4c6949abf4cf5f7f05d03538"><div class="ttname"><a href="chibios_8h.html#a8f046cbd4c6949abf4cf5f7f05d03538">HAL_INS_LSM9DS0_EXT_G_NAME</a></div><div class="ttdeci">#define HAL_INS_LSM9DS0_EXT_G_NAME</div><div class="ttdef"><b>Definition:</b> <a href="chibios_8h_source.html#l00066">chibios.h:66</a></div></div>
<div class="ttc" id="structAP__InertialSensor_1_1PeakHoldState_html_aa999bcc4cfd0770a4289d57b323cb827"><div class="ttname"><a href="structAP__InertialSensor_1_1PeakHoldState.html#aa999bcc4cfd0770a4289d57b323cb827">AP_InertialSensor::PeakHoldState::accel_peak_hold_neg_x_age</a></div><div class="ttdeci">uint32_t accel_peak_hold_neg_x_age</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00550">AP_InertialSensor.h:550</a></div></div>
<div class="ttc" id="rotations_8h_html_a67a250c97139a5466814a54c4aa4a681a45b705de2d5cd3bcca329d9e282096ba"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a45b705de2d5cd3bcca329d9e282096ba">ROTATION_YAW_180</a></div><div class="ttdef"><b>Definition:</b> <a href="rotations_8h_source.html#l00032">rotations.h:32</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_abd23ac7f70eec1af0ab2f43c9dcd3f0d"><div class="ttname"><a href="classAP__InertialSensor.html#abd23ac7f70eec1af0ab2f43c9dcd3f0d">AP_InertialSensor::_accel_over_sampling</a></div><div class="ttdeci">uint8_t _accel_over_sampling[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00454">AP_InertialSensor.h:454</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a681fb041567d15f5d73e9ee647770a97"><div class="ttname"><a href="classAP__InertialSensor.html#a681fb041567d15f5d73e9ee647770a97">AP_InertialSensor::_accel_clip_count</a></div><div class="ttdeci">uint32_t _accel_clip_count[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00543">AP_InertialSensor.h:543</a></div></div>
<div class="ttc" id="moduletest_8c_html_a903c4797a4c2860e3b9a6a978f98a44d"><div class="ttname"><a href="moduletest_8c.html#a903c4797a4c2860e3b9a6a978f98a44d">degrees</a></div><div class="ttdeci">#define degrees(x)</div><div class="ttdef"><b>Definition:</b> <a href="moduletest_8c_source.html#l00023">moduletest.c:23</a></div></div>
<div class="ttc" id="classAP__AccelCal_html_a43c12755c810581bbbf236bb7fd1c2d0"><div class="ttname"><a href="classAP__AccelCal.html#a43c12755c810581bbbf236bb7fd1c2d0">AP_AccelCal::cancel</a></div><div class="ttdeci">void cancel()</div><div class="ttdef"><b>Definition:</b> <a href="AP__AccelCal_8cpp_source.html#l00217">AP_AccelCal.cpp:217</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a9139665de768ce3b171adf07191bc081"><div class="ttname"><a href="classAP__InertialSensor.html#a9139665de768ce3b171adf07191bc081">AP_InertialSensor::_accel_healthy</a></div><div class="ttdeci">bool _accel_healthy[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00537">AP_InertialSensor.h:537</a></div></div>
<div class="ttc" id="namespaceAP__HAL_html_a71832f03d849a0c088f04fc98d3c8143"><div class="ttname"><a href="namespaceAP__HAL.html#a71832f03d849a0c088f04fc98d3c8143">AP_HAL::panic</a></div><div class="ttdeci">void panic(const char *errormsg,...) FMT_PRINTF(1</div><div class="ttdef"><b>Definition:</b> <a href="ChibiOS_2system_8cpp_source.html#l00140">system.cpp:140</a></div></div>
<div class="ttc" id="classAP__HAL_1_1I2CDeviceManager_html_a8153774ecb8d07a14cb0eeac74ce6211"><div class="ttname"><a href="classAP__HAL_1_1I2CDeviceManager.html#a8153774ecb8d07a14cb0eeac74ce6211">AP_HAL::I2CDeviceManager::get_device</a></div><div class="ttdeci">virtual OwnPtr&lt; AP_HAL::I2CDevice &gt; get_device(uint8_t bus, uint8_t address, uint32_t bus_clock=400000, bool use_smbus=false, uint32_t timeout_ms=4)=0</div></div>
<div class="ttc" id="classAP__InertialSensor_html_a1a426186787270ddfc7d9e11c0b02697"><div class="ttname"><a href="classAP__InertialSensor.html#a1a426186787270ddfc7d9e11c0b02697">AP_InertialSensor::get_delta_velocity_dt</a></div><div class="ttdeci">float get_delta_velocity_dt() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00117">AP_InertialSensor.h:117</a></div></div>
<div class="ttc" id="chibios_8h_html_a2ea530da3a170b09bb0b629de8464ff5"><div class="ttname"><a href="chibios_8h.html#a2ea530da3a170b09bb0b629de8464ff5">HAL_INS_MPU6500_NAME</a></div><div class="ttdeci">#define HAL_INS_MPU6500_NAME</div><div class="ttdef"><b>Definition:</b> <a href="chibios_8h_source.html#l00072">chibios.h:72</a></div></div>
<div class="ttc" id="AP__InertialSensor_8h_html_a2247b51f4c9a78d7d1f06d7dda78a82e"><div class="ttname"><a href="AP__InertialSensor_8h.html#a2247b51f4c9a78d7d1f06d7dda78a82e">INS_MAX_INSTANCES</a></div><div class="ttdeci">#define INS_MAX_INSTANCES</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00014">AP_InertialSensor.h:14</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a5096e33c19b3f59a284b241ac7f9b1ad"><div class="ttname"><a href="classAP__InertialSensor.html#a5096e33c19b3f59a284b241ac7f9b1ad">AP_InertialSensor::_accel_offset</a></div><div class="ttdeci">AP_Vector3f _accel_offset[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00440">AP_InertialSensor.h:440</a></div></div>
<div class="ttc" id="AP__InertialSensor_8h_html_afcd4264ce23e4fa475c75928ed9c598b"><div class="ttname"><a href="AP__InertialSensor_8h.html#afcd4264ce23e4fa475c75928ed9c598b">AP_INERTIAL_SENSOR_ACCEL_VIBE_FILT_HZ</a></div><div class="ttdeci">#define AP_INERTIAL_SENSOR_ACCEL_VIBE_FILT_HZ</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00007">AP_InertialSensor.h:7</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a16c360358c5d6a08d34f60921fd916a9"><div class="ttname"><a href="AP__Param_8h.html#a16c360358c5d6a08d34f60921fd916a9">AP_SUBGROUPINFO</a></div><div class="ttdeci">#define AP_SUBGROUPINFO(element, name, idx, thisclazz, elclazz)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00107">AP_Param.h:107</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a71227b1d7ac5a8243d4f61a98affaf2a"><div class="ttname"><a href="classAP__InertialSensor.html#a71227b1d7ac5a8243d4f61a98affaf2a">AP_InertialSensor::get_delta_angle_dt</a></div><div class="ttdeci">float get_delta_angle_dt() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00110">AP_InertialSensor.h:110</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a5ae4308b77385d3e576d29c78e8e3346"><div class="ttname"><a href="classAP__InertialSensor.html#a5ae4308b77385d3e576d29c78e8e3346">AP_InertialSensor::accel_calibrated_ok_all</a></div><div class="ttdeci">bool accel_calibrated_ok_all() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01039">AP_InertialSensor.cpp:1039</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ae32fc128098640c8a2592f1e377e274b"><div class="ttname"><a href="classAP__InertialSensor.html#ae32fc128098640c8a2592f1e377e274b">AP_InertialSensor::get_vibration_levels</a></div><div class="ttdeci">Vector3f get_vibration_levels() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00221">AP_InertialSensor.h:221</a></div></div>
<div class="ttc" id="classAP__InertialSensor__BMI160_html_a100e98e0955c2b2a9d72fb594aa3e616"><div class="ttname"><a href="classAP__InertialSensor__BMI160.html#a100e98e0955c2b2a9d72fb594aa3e616">AP_InertialSensor_BMI160::probe</a></div><div class="ttdeci">static AP_InertialSensor_Backend * probe(AP_InertialSensor &amp;imu, AP_HAL::OwnPtr&lt; AP_HAL::SPIDevice &gt; dev)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__BMI160_8cpp_source.html#l00131">AP_InertialSensor_BMI160.cpp:131</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ab3bcaab30548484fd68e7f7af05f4a86"><div class="ttname"><a href="classAP__InertialSensor.html#ab3bcaab30548484fd68e7f7af05f4a86">AP_InertialSensor::_backend_count</a></div><div class="ttdeci">uint8_t _backend_count</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00385">AP_InertialSensor.h:385</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_abb556b6d94ee6a7676c8fe5bbc1ec0a8"><div class="ttname"><a href="classAP__InertialSensor.html#abb556b6d94ee6a7676c8fe5bbc1ec0a8">AP_InertialSensor::_accel</a></div><div class="ttdeci">Vector3f _accel[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00393">AP_InertialSensor.h:393</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a922eeb71ccd9862923f68246f86bb667"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a922eeb71ccd9862923f68246f86bb667">AP_BoardConfig::PX4_BOARD_AUAV21</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8h_source.html#l00075">AP_BoardConfig.h:75</a></div></div>
<div class="ttc" id="structaccel__sample_html"><div class="ttname"><a href="structaccel__sample.html">accel_sample</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Module__Structures_8h_source.html#l00123">AP_Module_Structures.h:123</a></div></div>
<div class="ttc" id="classAP__InertialSensor__Invensensev2_html_ad53b8716bfefc867bfb3d453312708d1"><div class="ttname"><a href="classAP__InertialSensor__Invensensev2.html#ad53b8716bfefc867bfb3d453312708d1">AP_InertialSensor_Invensensev2::probe</a></div><div class="ttdeci">static AP_InertialSensor_Backend * probe(AP_InertialSensor &amp;imu, AP_HAL::OwnPtr&lt; AP_HAL::I2CDevice &gt; dev, enum Rotation rotation=ROTATION_NONE)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__Invensensev2_8cpp_source.html#l00078">AP_InertialSensor_Invensensev2.cpp:78</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ad56df47a7d5912844ddd6d419cdacc41"><div class="ttname"><a href="classAP__InertialSensor.html#ad56df47a7d5912844ddd6d419cdacc41">AP_InertialSensor::_gyro_startup_error_count</a></div><div class="ttdeci">uint32_t _gyro_startup_error_count[INS_MAX_INSTANCES]</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00587">AP_InertialSensor.h:587</a></div></div>
<div class="ttc" id="classAuxiliaryBus_html"><div class="ttname"><a href="classAuxiliaryBus.html">AuxiliaryBus</a></div><div class="ttdef"><b>Definition:</b> <a href="AuxiliaryBus_8h_source.html#l00095">AuxiliaryBus.h:95</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_af34be16f60a79389c14b2e0346b90459"><div class="ttname"><a href="classAP__InertialSensor.html#af34be16f60a79389c14b2e0346b90459">AP_InertialSensor::_startup_ms</a></div><div class="ttdeci">uint32_t _startup_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00589">AP_InertialSensor.h:589</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a2ea473397ac26c55efa8d5e5fd5a9f65"><div class="ttname"><a href="classAP__InertialSensor.html#a2ea473397ac26c55efa8d5e5fd5a9f65">AP_InertialSensor::_accel_calibrator</a></div><div class="ttdeci">AccelCalibrator * _accel_calibrator</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00570">AP_InertialSensor.h:570</a></div></div>
<div class="ttc" id="namespaceAP__HAL_html_a8293355e35887733b1fd151aef08a787"><div class="ttname"><a href="namespaceAP__HAL.html#a8293355e35887733b1fd151aef08a787">AP_HAL::micros</a></div><div class="ttdeci">uint32_t micros()</div><div class="ttdef"><b>Definition:</b> <a href="ChibiOS_2system_8cpp_source.html#l00152">system.cpp:152</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_ad2d086fc49750ab9cdfeb964d874af65"><div class="ttname"><a href="classAP__InertialSensor.html#ad2d086fc49750ab9cdfeb964d874af65">AP_InertialSensor::_hil_mode</a></div><div class="ttdeci">bool _hil_mode</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00513">AP_InertialSensor.h:513</a></div></div>
<div class="ttc" id="chibios_8h_html_ac02a529e0a09a6987d26dd1147aceb5b"><div class="ttname"><a href="chibios_8h.html#ac02a529e0a09a6987d26dd1147aceb5b">HAL_INS_LSM9DS0_G_NAME</a></div><div class="ttdeci">#define HAL_INS_LSM9DS0_G_NAME</div><div class="ttdef"><b>Definition:</b> <a href="chibios_8h_source.html#l00063">chibios.h:63</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a96ea6a28cfba8d662ba2b6f10443af05"><div class="ttname"><a href="classAP__InertialSensor.html#a96ea6a28cfba8d662ba2b6f10443af05">AP_InertialSensor::Gyro_Calibration_Timing</a></div><div class="ttdeci">Gyro_Calibration_Timing</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00059">AP_InertialSensor.h:59</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a8c272873ffbbafcaa90d5a4686c795ca"><div class="ttname"><a href="classAP__InertialSensor.html#a8c272873ffbbafcaa90d5a4686c795ca">AP_InertialSensor::get_gyro_health_all</a></div><div class="ttdeci">bool get_gyro_health_all(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00932">AP_InertialSensor.cpp:932</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00118">AP_Param.h:118</a></div></div>
<div class="ttc" id="classAP__InertialSensor__HIL_html_abf98ef11debee955ccdc346e87ee520a"><div class="ttname"><a href="classAP__InertialSensor__HIL.html#abf98ef11debee955ccdc346e87ee520a">AP_InertialSensor_HIL::detect</a></div><div class="ttdeci">static AP_InertialSensor_Backend * detect(AP_InertialSensor &amp;imu)</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor__HIL_8cpp_source.html#l00014">AP_InertialSensor_HIL.cpp:14</a></div></div>
<div class="ttc" id="classVector3_html_adf1769d5ee5df2f8585df2f540fa5efe"><div class="ttname"><a href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">Vector3::zero</a></div><div class="ttdeci">void zero()</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00188">vector3.h:188</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_a94ab41309b1ff10b8b862b826e59c882"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">AP_HAL::HAL::scheduler</a></div><div class="ttdeci">AP_HAL::Scheduler * scheduler</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00114">HAL.h:114</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a0057feca5b296de7871d3e524c5f5630"><div class="ttname"><a href="classAP__InertialSensor.html#a0057feca5b296de7871d3e524c5f5630">AP_InertialSensor::get_fixed_mount_accel_cal_sample</a></div><div class="ttdeci">bool get_fixed_mount_accel_cal_sample(uint8_t sample_num, Vector3f &amp;ret) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l01832">AP_InertialSensor.cpp:1832</a></div></div>
<div class="ttc" id="classVector3_html_a1a0f7e168c71ca798099f0ba8a444244"><div class="ttname"><a href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">Vector3::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00067">vector3.h:67</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a8ca2cbf528de2276d1be01c00243db0d"><div class="ttname"><a href="classAP__InertialSensor.html#a8ca2cbf528de2276d1be01c00243db0d">AP_InertialSensor::get_accel_count</a></div><div class="ttdeci">uint8_t get_accel_count(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00142">AP_InertialSensor.h:142</a></div></div>
<div class="ttc" id="classLowPassFilter_html_aa390849d2e18ff3287f92b89d8657841"><div class="ttname"><a href="classLowPassFilter.html#aa390849d2e18ff3287f92b89d8657841">LowPassFilter::apply</a></div><div class="ttdeci">T apply(T sample, float dt)</div><div class="ttdef"><b>Definition:</b> <a href="LowPassFilter_8cpp_source.html#l00099">LowPassFilter.cpp:99</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a0e7fd9cbb4e5f0b440c2b2183bbde6b8"><div class="ttname"><a href="classAP__InertialSensor.html#a0e7fd9cbb4e5f0b440c2b2183bbde6b8">AP_InertialSensor::_accel_count</a></div><div class="ttdeci">uint8_t _accel_count</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00384">AP_InertialSensor.h:384</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a5a484543c8865592e07cac290dd40ef4"><div class="ttname"><a href="classAP__InertialSensor.html#a5a484543c8865592e07cac290dd40ef4">AP_InertialSensor::_last_sample_usec</a></div><div class="ttdeci">uint32_t _last_sample_usec</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00524">AP_InertialSensor.h:524</a></div></div>
<div class="ttc" id="rotations_8h_html_a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294">ROTATION_YAW_270</a></div><div class="ttdef"><b>Definition:</b> <a href="rotations_8h_source.html#l00034">rotations.h:34</a></div></div>
<div class="ttc" id="classAP__Param_html_a5f6dcfce1c0a79cf5bd81283e22f3201"><div class="ttname"><a href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a></div><div class="ttdeci">static void setup_object_defaults(const void *object_pointer, const struct GroupInfo *group_info)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8cpp_source.html#l01265">AP_Param.cpp:1265</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_afca334b41b757adc31705eec16836721"><div class="ttname"><a href="classAP__InertialSensor.html#afca334b41b757adc31705eec16836721">AP_InertialSensor::_loop_delta_t</a></div><div class="ttdeci">float _loop_delta_t</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00389">AP_InertialSensor.h:389</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a2cf12201d711e4712a62ad10893be06f"><div class="ttname"><a href="classAP__InertialSensor.html#a2cf12201d711e4712a62ad10893be06f">AP_InertialSensor::get_singleton</a></div><div class="ttdeci">static AP_InertialSensor * get_singleton()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l00489">AP_InertialSensor.cpp:489</a></div></div>
<div class="ttc" id="classAP__BoardConfig_html_ab7d977aecbbe7090266bee755bf2cc32"><div class="ttname"><a href="classAP__BoardConfig.html#ab7d977aecbbe7090266bee755bf2cc32">AP_BoardConfig::sensor_config_error</a></div><div class="ttdeci">static void sensor_config_error(const char *reason)</div><div class="ttdef"><b>Definition:</b> <a href="AP__BoardConfig_8cpp_source.html#l00300">AP_BoardConfig.cpp:300</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 11 2019 14:17:29 for APM:Libraries by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
