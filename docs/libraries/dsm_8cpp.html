<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AP_HAL/utility/dsm.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_1cbc10423b2512b31103883361e0123b.html">AP_HAL</a></li><li class="navelem"><a class="el" href="dir_a697c6c5999ea8f00a7bd1c4d780a058.html">utility</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">dsm.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;<a class="el" href="stdio_8h_source.html">stdio.h</a>&gt;</code><br />
<code>#include &quot;<a class="el" href="dsm_8h_source.html">dsm.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for dsm.cpp:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="dsm_8cpp__incl.svg" width="348" height="366"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="dsm_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a682d40d6084be7baeeb65088d8876a66"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsm_8cpp.html#a682d40d6084be7baeeb65088d8876a66">DSM_FRAME_SIZE</a>&#160;&#160;&#160;16</td></tr>
<tr class="separator:a682d40d6084be7baeeb65088d8876a66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c4d5fa876fdfb4f8f7941a3b043e949"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsm_8cpp.html#a7c4d5fa876fdfb4f8f7941a3b043e949">DSM_FRAME_CHANNELS</a>&#160;&#160;&#160;7</td></tr>
<tr class="separator:a7c4d5fa876fdfb4f8f7941a3b043e949"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6342d87e4f91ba01444a8783f2fbc08c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsm_8cpp.html#a6342d87e4f91ba01444a8783f2fbc08c">debug</a>(<a class="el" href="Printf_8cpp.html#a381d684d94e6e91dee650357e8f02fa8">fmt</a>,  args...)&#160;&#160;&#160;do {} while(0)</td></tr>
<tr class="separator:a6342d87e4f91ba01444a8783f2fbc08c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a155e9a9889d2e342ea3bf13aaaa4458d"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsm_8cpp.html#a155e9a9889d2e342ea3bf13aaaa4458d">dsm_decode_channel</a> (uint16_t raw, unsigned shift, unsigned *channel, unsigned *<a class="el" href="SIM__SilentWings_8cpp.html#a17956fe0129d3d4c94ebc06cfef2ad82">value</a>)</td></tr>
<tr class="separator:a155e9a9889d2e342ea3bf13aaaa4458d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4b7f20336ae87e6426bfd94be23bb37"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsm_8cpp.html#ac4b7f20336ae87e6426bfd94be23bb37">dsm_guess_format</a> (bool <a class="el" href="SmartRTL__test_8cpp.html#ad20897c5c8bd47f5d4005989bead0e55">reset</a>, const uint8_t dsm_frame[16])</td></tr>
<tr class="separator:ac4b7f20336ae87e6426bfd94be23bb37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b7c65c600dd4eacc1eb714df3621192"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsm_8cpp.html#a7b7c65c600dd4eacc1eb714df3621192">dsm_decode</a> (uint64_t frame_time, const uint8_t dsm_frame[16], uint16_t *values, uint16_t *num_values, uint16_t max_values)</td></tr>
<tr class="separator:a7b7c65c600dd4eacc1eb714df3621192"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aa4e9a43b7fab2021406c58660e9d6ef4"><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsm_8cpp.html#aa4e9a43b7fab2021406c58660e9d6ef4">dsm_last_frame_time</a></td></tr>
<tr class="separator:aa4e9a43b7fab2021406c58660e9d6ef4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5af53247466d85ca900387e62c22c1bd"><td class="memItemLeft" align="right" valign="top">static unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dsm_8cpp.html#a5af53247466d85ca900387e62c22c1bd">dsm_channel_shift</a></td></tr>
<tr class="separator:a5af53247466d85ca900387e62c22c1bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a6342d87e4f91ba01444a8783f2fbc08c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6342d87e4f91ba01444a8783f2fbc08c">&#9670;&nbsp;</a></span>debug</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define debug</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="Printf_8cpp.html#a381d684d94e6e91dee650357e8f02fa8">fmt</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">args...&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;do {} while(0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="dsm_8cpp_source.html#l00054">54</a> of file <a class="el" href="dsm_8cpp_source.html">dsm.cpp</a>.</p>

</div>
</div>
<a id="a7c4d5fa876fdfb4f8f7941a3b043e949"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c4d5fa876fdfb4f8f7941a3b043e949">&#9670;&nbsp;</a></span>DSM_FRAME_CHANNELS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DSM_FRAME_CHANNELS&#160;&#160;&#160;7</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Max supported DSM channels </p>

<p class="definition">Definition at line <a class="el" href="dsm_8cpp_source.html#l00044">44</a> of file <a class="el" href="dsm_8cpp_source.html">dsm.cpp</a>.</p>

</div>
</div>
<a id="a682d40d6084be7baeeb65088d8876a66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a682d40d6084be7baeeb65088d8876a66">&#9670;&nbsp;</a></span>DSM_FRAME_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DSM_FRAME_SIZE&#160;&#160;&#160;16</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>DSM frame size in bytes </p>

<p class="definition">Definition at line <a class="el" href="dsm_8cpp_source.html#l00043">43</a> of file <a class="el" href="dsm_8cpp_source.html">dsm.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a7b7c65c600dd4eacc1eb714df3621192"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b7c65c600dd4eacc1eb714df3621192">&#9670;&nbsp;</a></span>dsm_decode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool dsm_decode </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>frame_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>dsm_frame</em>[16], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>num_values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>max_values</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Decode the entire dsm frame (all contained channels) </p>

<p class="definition">Definition at line <a class="el" href="dsm_8cpp_source.html#l00195">195</a> of file <a class="el" href="dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="Linux_2RCInput_8cpp_source.html#l00208">Linux::RCInput::_process_dsm_pulse()</a>, and <a class="el" href="Linux_2RCInput_8cpp_source.html#l00338">Linux::RCInput::add_dsm_input()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dsm_8cpp_a7b7c65c600dd4eacc1eb714df3621192_cgraph.svg" width="100%" height="423"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a155e9a9889d2e342ea3bf13aaaa4458d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a155e9a9889d2e342ea3bf13aaaa4458d">&#9670;&nbsp;</a></span>dsm_decode_channel()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool dsm_decode_channel </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>raw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned *&#160;</td>
          <td class="paramname"><em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Attempt to decode a single channel raw channel datum</p>
<p>The DSM* protocol doesn't provide any explicit framing, so we detect dsm frame boundaries by the inter-dsm frame delay.</p>
<p>The minimum dsm frame spacing is 11ms; with 16 bytes at 115200bps dsm frame transmission time is ~1.4ms.</p>
<p>We expect to only be called when bytes arrive for processing, and if an interval of more than 5ms passes between calls, the first byte we read will be the first byte of a dsm frame.</p>
<p>In the case where byte(s) are dropped from a dsm frame, this also provides a degree of protection. Of course, it would be better if we didn't drop bytes...</p>
<p>Upon receiving a full dsm frame we attempt to decode it</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">raw</td><td>16 bit raw channel value from dsm frame </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">shift</td><td>position of channel number in raw data </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">channel</td><td>pointer to returned channel number </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">value</td><td>pointer to returned channel value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true=raw value successfully decoded </dd></dl>

<p class="definition">Definition at line <a class="el" href="dsm_8cpp_source.html#l00083">83</a> of file <a class="el" href="dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="dsm_8cpp_source.html#l00195">dsm_decode()</a>, and <a class="el" href="dsm_8cpp_source.html#l00105">dsm_guess_format()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dsm_8cpp_a155e9a9889d2e342ea3bf13aaaa4458d_icgraph.svg" width="100%" height="493"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ac4b7f20336ae87e6426bfd94be23bb37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4b7f20336ae87e6426bfd94be23bb37">&#9670;&nbsp;</a></span>dsm_guess_format()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void dsm_guess_format </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>reset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>dsm_frame</em>[16]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Attempt to guess if receiving 10 or 11 bit channel values</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">reset</td><td>true=reset the 10/11 bit state to unknown </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="dsm_8cpp_source.html#l00105">105</a> of file <a class="el" href="dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="dsm_8cpp_source.html#l00195">dsm_decode()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dsm_8cpp_ac4b7f20336ae87e6426bfd94be23bb37_cgraph.svg" width="100%" height="422"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="dsm_8cpp_ac4b7f20336ae87e6426bfd94be23bb37_icgraph.svg" width="100%" height="494"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a5af53247466d85ca900387e62c22c1bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5af53247466d85ca900387e62c22c1bd">&#9670;&nbsp;</a></span>dsm_channel_shift</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned dsm_channel_shift</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Channel resolution, 0=unknown, 10=10 bit, 11=11 bit </p>

<p class="definition">Definition at line <a class="el" href="dsm_8cpp_source.html#l00047">47</a> of file <a class="el" href="dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="dsm_8cpp_source.html#l00195">dsm_decode()</a>, and <a class="el" href="dsm_8cpp_source.html#l00105">dsm_guess_format()</a>.</p>

</div>
</div>
<a id="aa4e9a43b7fab2021406c58660e9d6ef4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4e9a43b7fab2021406c58660e9d6ef4">&#9670;&nbsp;</a></span>dsm_last_frame_time</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t dsm_last_frame_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Timestamp for start of last dsm frame </p>

<p class="definition">Definition at line <a class="el" href="dsm_8cpp_source.html#l00046">46</a> of file <a class="el" href="dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="dsm_8cpp_source.html#l00195">dsm_decode()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 11 2019 14:17:42 for APM:Libraries by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
