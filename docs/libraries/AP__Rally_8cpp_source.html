<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AP_Rally/AP_Rally.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_a13c6ed4fd97de966b0386f9b4eb86c6.html">AP_Rally</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AP_Rally.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AP__Rally_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__Rally_8h.html">AP_Rally.h</a>&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__AHRS_8h.html">AP_AHRS/AP_AHRS.h</a>&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Logger_8h.html">AP_Logger/AP_Logger.h</a>&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="StorageManager_8h.html">StorageManager/StorageManager.h</a>&gt;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// storage object</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<a class="code" href="classStorageAccess.html">StorageAccess</a> <a class="code" href="classAP__Rally.html#a1712d3afc63c3815dfc08543d07c24ad">AP_Rally::_storage</a>(<a class="code" href="classStorageManager.html#a8a47a036f4478b1631984c9577d73a46a42e46109d6193f717d28cbc3c5f40c14">StorageManager::StorageRally</a>);</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno"><a class="line" href="AP__Rally_8cpp.html#a7fcd15b3772a156c70621a779ab23e51">   12</a></span>&#160;<a class="code" href="structassert__storage__size.html">assert_storage_size&lt;RallyLocation, 15&gt;</a> <a class="code" href="AP__Rally_8cpp.html#a7fcd15b3772a156c70621a779ab23e51">_assert_storage_size_RallyLocation</a>;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#if APM_BUILD_TYPE(APM_BUILD_ArduCopter)</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">  #define RALLY_LIMIT_KM_DEFAULT 0.3f</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">  #define RALLY_INCLUDE_HOME_DEFAULT 1</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#elif APM_BUILD_TYPE(APM_BUILD_ArduPlane)</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">  #define RALLY_LIMIT_KM_DEFAULT 5.0f</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">  #define RALLY_INCLUDE_HOME_DEFAULT 0</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#elif APM_BUILD_TYPE(APM_BUILD_APMrover2)</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">  #define RALLY_LIMIT_KM_DEFAULT 0.5f</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">  #define RALLY_INCLUDE_HOME_DEFAULT 1</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="AP__Rally_8cpp.html#a9090efafdd1cacb7aa5646da3ef2bee0">   24</a></span>&#160;<span class="preprocessor">  #define RALLY_LIMIT_KM_DEFAULT 1.0f</span></div><div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="AP__Rally_8cpp.html#a6cf8535f6d897b3dadefb50cf2d61e8a">   25</a></span>&#160;<span class="preprocessor">  #define RALLY_INCLUDE_HOME_DEFAULT 0</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">const</span> <a class="code" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code" href="classAP__Rally.html#a906e63c18a936240cb1f85563e9ee9df">AP_Rally::var_info</a>[] = {</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// @Param: TOTAL</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment">// @DisplayName: Rally Total</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">// @Description: Number of rally points currently loaded</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TOTAL&quot;</span>, 0, <a class="code" href="classAP__Rally.html">AP_Rally</a>, _rally_point_total_count, 0),</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">// @Param: LIMIT_KM</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">// @DisplayName: Rally Limit</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="comment">// @Description: Maximum distance to rally point. If the closest rally point is more than this number of kilometers from the current position and the home location is closer than any of the rally points from the current position then do RTL to home rather than to the closest rally point. This prevents a leftover rally point from a different airfield being used accidentally. If this is set to 0 then the closest rally point is always used.</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// @Units: km</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LIMIT_KM&quot;</span>, 1, <a class="code" href="classAP__Rally.html">AP_Rally</a>, _rally_limit_km, <a class="code" href="AP__Rally_8cpp.html#a9090efafdd1cacb7aa5646da3ef2bee0">RALLY_LIMIT_KM_DEFAULT</a>),</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">// @Param: INCL_HOME</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment">// @DisplayName: Rally Include Home</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// @Description: Controls if Home is included as a Rally point (i.e. as a safe landing place) for RTL</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// @Values: 0:DoNotIncludeHome,1:IncludeHome</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;INCL_HOME&quot;</span>, 2, <a class="code" href="classAP__Rally.html">AP_Rally</a>, _rally_incl_home, <a class="code" href="AP__Rally_8cpp.html#a6cf8535f6d897b3dadefb50cf2d61e8a">RALLY_INCLUDE_HOME_DEFAULT</a>),</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;};</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">// constructor</span></div><div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="classAP__Rally.html#a2b1d9a21a9c805031bafda8957a78c89">   54</a></span>&#160;<a class="code" href="classAP__Rally.html#a2b1d9a21a9c805031bafda8957a78c89">AP_Rally::AP_Rally</a>()</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;{</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#if CONFIG_HAL_BOARD == HAL_BOARD_SITL</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__Rally.html#a0cb8f360c5561331a0300dc01142a065">_singleton</a> != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <a class="code" href="namespaceAP__HAL.html#a71832f03d849a0c088f04fc98d3c8143">AP_HAL::panic</a>(<span class="stringliteral">&quot;Rally must be singleton&quot;</span>);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    }</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="classAP__Rally.html#a0cb8f360c5561331a0300dc01142a065">_singleton</a> = <span class="keyword">this</span>;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a>(<span class="keyword">this</span>, <a class="code" href="classAP__Rally.html#a906e63c18a936240cb1f85563e9ee9df">var_info</a>);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;}</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">// get a rally point from EEPROM</span></div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="classAP__Rally.html#a728713781ee97d3d18aa3e6a798e21e6">   66</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__Rally.html#a728713781ee97d3d18aa3e6a798e21e6">AP_Rally::get_rally_point_with_index</a>(uint8_t i, <a class="code" href="structRallyLocation.html">RallyLocation</a> &amp;ret)<span class="keyword"> const</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">if</span> (i &gt;= (uint8_t) <a class="code" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>) {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    }</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="classAP__Rally.html#a1712d3afc63c3815dfc08543d07c24ad">_storage</a>.<a class="code" href="classStorageAccess.html#abb169f592c849f2158a48615c8dee90a">read_block</a>(&amp;ret, i * <span class="keyword">sizeof</span>(<a class="code" href="structRallyLocation.html">RallyLocation</a>), <span class="keyword">sizeof</span>(<a class="code" href="structRallyLocation.html">RallyLocation</a>));</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">if</span> (ret.<a class="code" href="structRallyLocation.html#aaaabfdf90e21cefd9dbeb234c7a5e251">lat</a> == 0 &amp;&amp; ret.<a class="code" href="structRallyLocation.html#a8227727c3c6fa6ef6739525c0a14bfb1">lng</a> == 0) {</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// sanity check</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    }</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>; </div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;}</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="classAP__Rally.html#af9320c7dfb7d74a430cc6b00962981ed">   81</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__Rally.html#af9320c7dfb7d74a430cc6b00962981ed">AP_Rally::truncate</a>(uint8_t num)</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;{</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">if</span> (num &gt; <a class="code" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>) {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="comment">// we never make the space larger this way</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>.set_and_save_ifchanged(num);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;}</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="classAP__Rally.html#a4659da1b7d085328ace76c58135d4795">   90</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__Rally.html#a4659da1b7d085328ace76c58135d4795">AP_Rally::append</a>(<span class="keyword">const</span> <a class="code" href="structRallyLocation.html">RallyLocation</a> &amp;loc)</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;{</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keyword">const</span> uint8_t current_total = <a class="code" href="classAP__Rally.html#ae6419c289bb0f42d3db189f415d7d9d6">get_rally_total</a>();</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>.set_and_save_ifchanged(current_total + 1);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__Rally.html#a7d931e38aad349dec7ef42965f8d6a60">set_rally_point_with_index</a>(current_total, loc)) {</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <a class="code" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>.set_and_save_ifchanged(current_total);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;}</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">// save a rally point to EEPROM - this assumes that the RALLY_TOTAL param has been incremented beforehand, which is the case in Mission Planner</span></div><div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="classAP__Rally.html#a7d931e38aad349dec7ef42965f8d6a60">  102</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__Rally.html#a7d931e38aad349dec7ef42965f8d6a60">AP_Rally::set_rally_point_with_index</a>(uint8_t i, <span class="keyword">const</span> <a class="code" href="structRallyLocation.html">RallyLocation</a> &amp;rallyLoc)</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;{</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">if</span> (i &gt;= (uint8_t) <a class="code" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>) {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">if</span> (i &gt;= <a class="code" href="classAP__Rally.html#aa75859b78d62d8bf981337ee7baadd3f">get_rally_max</a>()) {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    }</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="classAP__Rally.html#a1712d3afc63c3815dfc08543d07c24ad">_storage</a>.<a class="code" href="classStorageAccess.html#a926243785eeb37f394e3abb352715186">write_block</a>(i * <span class="keyword">sizeof</span>(<a class="code" href="structRallyLocation.html">RallyLocation</a>), &amp;rallyLoc, <span class="keyword">sizeof</span>(<a class="code" href="structRallyLocation.html">RallyLocation</a>));</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="code" href="classAP__Rally.html#a44f72c79ead390458f8dee9d0d4ca458">_last_change_time_ms</a> = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().<a class="code" href="classAP__Logger.html#af2b4490454ef4ae790ddb3496d948e47">Write_RallyPoint</a>(<a class="code" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>, i, rallyLoc);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;}</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">// helper function to translate a RallyLocation to a Location</span></div><div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="classAP__Rally.html#ad0fa2bf50adadcd2c32aa2da3a08d2ef">  122</a></span>&#160;<a class="code" href="classLocation.html">Location</a> <a class="code" href="classAP__Rally.html#ad0fa2bf50adadcd2c32aa2da3a08d2ef">AP_Rally::rally_location_to_location</a>(<span class="keyword">const</span> <a class="code" href="structRallyLocation.html">RallyLocation</a> &amp;rally_loc)<span class="keyword"> const</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="classLocation.html">Location</a> ret = {};</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">// we return an absolute altitude, as we add homeloc.alt below</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    ret.<a class="code" href="classLocation.html#a673a4a1dc069ceaede1fc7df0322c7a6">relative_alt</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">//Currently can&#39;t do true AGL on the APM.  Relative altitudes are</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">//relative to HOME point&#39;s altitude.  Terrain on the board is inbound</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">//for the PX4, though.  This line will need to be updated when that happens:</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    ret.<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> = (rally_loc.<a class="code" href="structRallyLocation.html#adfdbf88bff5056e7c569909ba7ff67f5">alt</a>*100UL) + <a class="code" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a>().<a class="code" href="classAP__AHRS.html#a8ebd6624062d91ec1d19fc3306513e9a">get_home</a>().<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    ret.<a class="code" href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> = rally_loc.<a class="code" href="structRallyLocation.html#aaaabfdf90e21cefd9dbeb234c7a5e251">lat</a>;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    ret.<a class="code" href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a> = rally_loc.<a class="code" href="structRallyLocation.html#a8227727c3c6fa6ef6739525c0a14bfb1">lng</a>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;}</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">// returns true if a valid rally point is found, otherwise returns false to indicate home position should be used</span></div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="classAP__Rally.html#a599a1cba7da15f1be6178ea19ee47541">  141</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classAP__Rally.html#a599a1cba7da15f1be6178ea19ee47541">AP_Rally::find_nearest_rally_point</a>(<span class="keyword">const</span> <a class="code" href="classLocation.html">Location</a> &amp;current_loc, <a class="code" href="structRallyLocation.html">RallyLocation</a> &amp;return_loc)<span class="keyword"> const</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordtype">float</span> min_dis = -1;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; (uint8_t) <a class="code" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>; i++) {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <a class="code" href="structRallyLocation.html">RallyLocation</a> next_rally;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classAP__Rally.html#a728713781ee97d3d18aa3e6a798e21e6">get_rally_point_with_index</a>(i, next_rally)) {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        }</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <a class="code" href="classLocation.html">Location</a> rally_loc = <a class="code" href="classAP__Rally.html#ad0fa2bf50adadcd2c32aa2da3a08d2ef">rally_location_to_location</a>(next_rally);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordtype">float</span> dis = current_loc.<a class="code" href="classLocation.html#a9e973101205763fabc1c9e65ec3ae41d">get_distance</a>(rally_loc);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__Rally.html#a1663d1947b69eb467541366951385ef9">is_valid</a>(rally_loc) &amp;&amp; (dis &lt; min_dis || min_dis &lt; 0)) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            min_dis = dis;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            return_loc = next_rally;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// if a limit is defined and all rally points are beyond that limit, use home if it is closer</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classAP__Rally.html#a4c33c19632fe49df12ed4cfdf55e35e9">_rally_limit_km</a> &gt; 0) &amp;&amp; (min_dis &gt; <a class="code" href="classAP__Rally.html#a4c33c19632fe49df12ed4cfdf55e35e9">_rally_limit_km</a>*1000.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)) {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// use home position</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">// use home if no rally points found</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">return</span> min_dis &gt;= 0;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;}</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">// return best RTL location from current position</span></div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="classAP__Rally.html#a2f79c1af4c3115a2d2cdcceb0dc04043">  169</a></span>&#160;<a class="code" href="classLocation.html">Location</a> <a class="code" href="classAP__Rally.html#a2f79c1af4c3115a2d2cdcceb0dc04043">AP_Rally::calc_best_rally_or_home_location</a>(<span class="keyword">const</span> <a class="code" href="classLocation.html">Location</a> &amp;current_loc, <span class="keywordtype">float</span> rtl_home_alt)<span class="keyword"> const</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <a class="code" href="structRallyLocation.html">RallyLocation</a> ral_loc = {};</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="classLocation.html">Location</a> return_loc = {};</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="classLocation.html">Location</a> &amp;home_loc = <a class="code" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a>().<a class="code" href="classAP__AHRS.html#a8ebd6624062d91ec1d19fc3306513e9a">get_home</a>();</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    </div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">// no valid rally point, return home position</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    return_loc = home_loc;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    return_loc.<a class="code" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> = rtl_home_alt;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    return_loc.<a class="code" href="classLocation.html#a673a4a1dc069ceaede1fc7df0322c7a6">relative_alt</a> = <span class="keyword">false</span>; <span class="comment">// read_alt_to_hold returns an absolute altitude</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__Rally.html#a599a1cba7da15f1be6178ea19ee47541">find_nearest_rally_point</a>(current_loc, ral_loc)) {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <a class="code" href="classLocation.html">Location</a> loc = <a class="code" href="classAP__Rally.html#ad0fa2bf50adadcd2c32aa2da3a08d2ef">rally_location_to_location</a>(ral_loc);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="comment">// use the rally point if it&#39;s closer then home, or we aren&#39;t generally considering home as acceptable</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classAP__Rally.html#a254081bd2be797fea7ce7308503d9d88">_rally_incl_home</a>  || (current_loc.<a class="code" href="classLocation.html#a9e973101205763fabc1c9e65ec3ae41d">get_distance</a>(loc) &lt; current_loc.<a class="code" href="classLocation.html#a9e973101205763fabc1c9e65ec3ae41d">get_distance</a>(return_loc))) {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            return_loc = <a class="code" href="classAP__Rally.html#ad0fa2bf50adadcd2c32aa2da3a08d2ef">rally_location_to_location</a>(ral_loc);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">return</span> return_loc;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">// singleton instance</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<a class="code" href="classAP__Rally.html">AP_Rally</a> *<a class="code" href="classAP__Rally.html#a0cb8f360c5561331a0300dc01142a065">AP_Rally::_singleton</a>;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceAP.html">AP</a> {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="namespaceAP.html#ae87744fcd7073579dee4ddbf9d32239e">  196</a></span>&#160;<a class="code" href="classAP__Rally.html">AP_Rally</a> *<a class="code" href="namespaceAP.html#ae87744fcd7073579dee4ddbf9d32239e">rally</a>()</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;{</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classAP__Rally.html#a65322fc251296376f6d07ac772afffbe">AP_Rally::get_singleton</a>();</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;}</div><div class="ttc" id="classLocation_html_a673a4a1dc069ceaede1fc7df0322c7a6"><div class="ttname"><a href="classLocation.html#a673a4a1dc069ceaede1fc7df0322c7a6">Location::relative_alt</a></div><div class="ttdeci">uint8_t relative_alt</div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00013">Location.h:13</a></div></div>
<div class="ttc" id="classAP__Rally_html_a906e63c18a936240cb1f85563e9ee9df"><div class="ttname"><a href="classAP__Rally.html#a906e63c18a936240cb1f85563e9ee9df">AP_Rally::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00072">AP_Rally.h:72</a></div></div>
<div class="ttc" id="structRallyLocation_html_a8227727c3c6fa6ef6739525c0a14bfb1"><div class="ttname"><a href="structRallyLocation.html#a8227727c3c6fa6ef6739525c0a14bfb1">RallyLocation::lng</a></div><div class="ttdeci">int32_t lng</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00023">AP_Rally.h:23</a></div></div>
<div class="ttc" id="classAP__Rally_html_ae6419c289bb0f42d3db189f415d7d9d6"><div class="ttname"><a href="classAP__Rally.html#ae6419c289bb0f42d3db189f415d7d9d6">AP_Rally::get_rally_total</a></div><div class="ttdeci">uint8_t get_rally_total() const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00045">AP_Rally.h:45</a></div></div>
<div class="ttc" id="classAP__Rally_html"><div class="ttname"><a href="classAP__Rally.html">AP_Rally</a></div><div class="ttdoc">Object managing Rally Points.</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00034">AP_Rally.h:34</a></div></div>
<div class="ttc" id="structRallyLocation_html"><div class="ttname"><a href="structRallyLocation.html">RallyLocation</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00021">AP_Rally.h:21</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a8ebd6624062d91ec1d19fc3306513e9a"><div class="ttname"><a href="classAP__AHRS.html#a8ebd6624062d91ec1d19fc3306513e9a">AP_AHRS::get_home</a></div><div class="ttdeci">const struct Location &amp; get_home(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00440">AP_AHRS.h:440</a></div></div>
<div class="ttc" id="classAP__Rally_html_a4c33c19632fe49df12ed4cfdf55e35e9"><div class="ttname"><a href="classAP__Rally.html#a4c33c19632fe49df12ed4cfdf55e35e9">AP_Rally::_rally_limit_km</a></div><div class="ttdeci">AP_Float _rally_limit_km</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00087">AP_Rally.h:87</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00100">AP_Param.h:100</a></div></div>
<div class="ttc" id="classAP__Rally_html_aa75859b78d62d8bf981337ee7baadd3f"><div class="ttname"><a href="classAP__Rally.html#aa75859b78d62d8bf981337ee7baadd3f">AP_Rally::get_rally_max</a></div><div class="ttdeci">uint8_t get_rally_max(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00048">AP_Rally.h:48</a></div></div>
<div class="ttc" id="AP__Logger_8h_html"><div class="ttname"><a href="AP__Logger_8h.html">AP_Logger.h</a></div></div>
<div class="ttc" id="classAP__Rally_html_a2f79c1af4c3115a2d2cdcceb0dc04043"><div class="ttname"><a href="classAP__Rally.html#a2f79c1af4c3115a2d2cdcceb0dc04043">AP_Rally::calc_best_rally_or_home_location</a></div><div class="ttdeci">Location calc_best_rally_or_home_location(const Location &amp;current_loc, float rtl_home_alt) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8cpp_source.html#l00169">AP_Rally.cpp:169</a></div></div>
<div class="ttc" id="classAP__Rally_html_a44f72c79ead390458f8dee9d0d4ca458"><div class="ttname"><a href="classAP__Rally.html#a44f72c79ead390458f8dee9d0d4ca458">AP_Rally::_last_change_time_ms</a></div><div class="ttdeci">uint32_t _last_change_time_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00090">AP_Rally.h:90</a></div></div>
<div class="ttc" id="AP__Rally_8cpp_html_a9090efafdd1cacb7aa5646da3ef2bee0"><div class="ttname"><a href="AP__Rally_8cpp.html#a9090efafdd1cacb7aa5646da3ef2bee0">RALLY_LIMIT_KM_DEFAULT</a></div><div class="ttdeci">#define RALLY_LIMIT_KM_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8cpp_source.html#l00024">AP_Rally.cpp:24</a></div></div>
<div class="ttc" id="classAP__Rally_html_a7d931e38aad349dec7ef42965f8d6a60"><div class="ttname"><a href="classAP__Rally.html#a7d931e38aad349dec7ef42965f8d6a60">AP_Rally::set_rally_point_with_index</a></div><div class="ttdeci">bool set_rally_point_with_index(uint8_t i, const RallyLocation &amp;rallyLoc)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8cpp_source.html#l00102">AP_Rally.cpp:102</a></div></div>
<div class="ttc" id="structRallyLocation_html_adfdbf88bff5056e7c569909ba7ff67f5"><div class="ttname"><a href="structRallyLocation.html#adfdbf88bff5056e7c569909ba7ff67f5">RallyLocation::alt</a></div><div class="ttdeci">int16_t alt</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00024">AP_Rally.h:24</a></div></div>
<div class="ttc" id="classAP__Rally_html_a599a1cba7da15f1be6178ea19ee47541"><div class="ttname"><a href="classAP__Rally.html#a599a1cba7da15f1be6178ea19ee47541">AP_Rally::find_nearest_rally_point</a></div><div class="ttdeci">bool find_nearest_rally_point(const Location &amp;myloc, RallyLocation &amp;ret) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8cpp_source.html#l00141">AP_Rally.cpp:141</a></div></div>
<div class="ttc" id="classAP__Rally_html_ad0fa2bf50adadcd2c32aa2da3a08d2ef"><div class="ttname"><a href="classAP__Rally.html#ad0fa2bf50adadcd2c32aa2da3a08d2ef">AP_Rally::rally_location_to_location</a></div><div class="ttdeci">Location rally_location_to_location(const RallyLocation &amp;ret) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8cpp_source.html#l00122">AP_Rally.cpp:122</a></div></div>
<div class="ttc" id="namespaceAP_html_aa35bfac1ea2da16f110e8e72db7b3b20"><div class="ttname"><a href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a></div><div class="ttdeci">AP_Logger &amp; logger()</div><div class="ttdef"><b>Definition:</b> <a href="AP__Logger_8cpp_source.html#l01182">AP_Logger.cpp:1182</a></div></div>
<div class="ttc" id="AP__Rally_8h_html"><div class="ttname"><a href="AP__Rally_8h.html">AP_Rally.h</a></div><div class="ttdoc">Handles rally point storage and retrieval.</div></div>
<div class="ttc" id="classAP__Rally_html_a4659da1b7d085328ace76c58135d4795"><div class="ttname"><a href="classAP__Rally.html#a4659da1b7d085328ace76c58135d4795">AP_Rally::append</a></div><div class="ttdeci">bool append(const RallyLocation &amp;loc) WARN_IF_UNUSED</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8cpp_source.html#l00090">AP_Rally.cpp:90</a></div></div>
<div class="ttc" id="namespaceAP_html"><div class="ttname"><a href="namespaceAP.html">AP</a></div><div class="ttdef"><b>Definition:</b> <a href="AC__Avoid_8cpp_source.html#l00655">AC_Avoid.cpp:655</a></div></div>
<div class="ttc" id="DerivativeFilter_8cpp_html_a357394e0f6f88c8a57bd893ab28dc8f8"><div class="ttname"><a href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a></div><div class="ttdeci">#define f(i)</div></div>
<div class="ttc" id="namespaceAP_html_ae87744fcd7073579dee4ddbf9d32239e"><div class="ttname"><a href="namespaceAP.html#ae87744fcd7073579dee4ddbf9d32239e">AP::rally</a></div><div class="ttdeci">AP_Rally * rally()</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8cpp_source.html#l00196">AP_Rally.cpp:196</a></div></div>
<div class="ttc" id="namespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition:</b> <a href="ChibiOS_2system_8cpp_source.html#l00157">system.cpp:157</a></div></div>
<div class="ttc" id="structAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00142">AP_Param.h:142</a></div></div>
<div class="ttc" id="classAP__Rally_html_af9320c7dfb7d74a430cc6b00962981ed"><div class="ttname"><a href="classAP__Rally.html#af9320c7dfb7d74a430cc6b00962981ed">AP_Rally::truncate</a></div><div class="ttdeci">void truncate(uint8_t num)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8cpp_source.html#l00081">AP_Rally.cpp:81</a></div></div>
<div class="ttc" id="classAP__Rally_html_a1663d1947b69eb467541366951385ef9"><div class="ttname"><a href="classAP__Rally.html#a1663d1947b69eb467541366951385ef9">AP_Rally::is_valid</a></div><div class="ttdeci">virtual bool is_valid(const Location &amp;rally_point) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00081">AP_Rally.h:81</a></div></div>
<div class="ttc" id="classAP__Rally_html_a65322fc251296376f6d07ac772afffbe"><div class="ttname"><a href="classAP__Rally.html#a65322fc251296376f6d07ac772afffbe">AP_Rally::get_singleton</a></div><div class="ttdeci">static AP_Rally * get_singleton()</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00075">AP_Rally.h:75</a></div></div>
<div class="ttc" id="classStorageAccess_html_abb169f592c849f2158a48615c8dee90a"><div class="ttname"><a href="classStorageAccess.html#abb169f592c849f2158a48615c8dee90a">StorageAccess::read_block</a></div><div class="ttdeci">bool read_block(void *dst, uint16_t src, size_t n) const</div><div class="ttdef"><b>Definition:</b> <a href="StorageManager_8cpp_source.html#l00139">StorageManager.cpp:139</a></div></div>
<div class="ttc" id="AP__AHRS_8h_html"><div class="ttname"><a href="AP__AHRS_8h.html">AP_AHRS.h</a></div></div>
<div class="ttc" id="AP__Rally_8cpp_html_a7fcd15b3772a156c70621a779ab23e51"><div class="ttname"><a href="AP__Rally_8cpp.html#a7fcd15b3772a156c70621a779ab23e51">_assert_storage_size_RallyLocation</a></div><div class="ttdeci">assert_storage_size&lt; RallyLocation, 15 &gt; _assert_storage_size_RallyLocation</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8cpp_source.html#l00012">AP_Rally.cpp:12</a></div></div>
<div class="ttc" id="classLocation_html_a5831f0aca9e51a15adb96fad465f72f8"><div class="ttname"><a href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">Location::lng</a></div><div class="ttdeci">int32_t lng</div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00022">Location.h:22</a></div></div>
<div class="ttc" id="classAP__Rally_html_a1712d3afc63c3815dfc08543d07c24ad"><div class="ttname"><a href="classAP__Rally.html#a1712d3afc63c3815dfc08543d07c24ad">AP_Rally::_storage</a></div><div class="ttdeci">static StorageAccess _storage</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00083">AP_Rally.h:83</a></div></div>
<div class="ttc" id="classAP__Rally_html_a728713781ee97d3d18aa3e6a798e21e6"><div class="ttname"><a href="classAP__Rally.html#a728713781ee97d3d18aa3e6a798e21e6">AP_Rally::get_rally_point_with_index</a></div><div class="ttdeci">bool get_rally_point_with_index(uint8_t i, RallyLocation &amp;ret) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8cpp_source.html#l00066">AP_Rally.cpp:66</a></div></div>
<div class="ttc" id="namespaceAP_html_a99432cfdb696952c9b7146f155a815aa"><div class="ttname"><a href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a></div><div class="ttdeci">AP_AHRS &amp; ahrs()</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8cpp_source.html#l00526">AP_AHRS.cpp:526</a></div></div>
<div class="ttc" id="classStorageAccess_html_a926243785eeb37f394e3abb352715186"><div class="ttname"><a href="classStorageAccess.html#a926243785eeb37f394e3abb352715186">StorageAccess::write_block</a></div><div class="ttdeci">bool write_block(uint16_t dst, const void *src, size_t n) const</div><div class="ttdef"><b>Definition:</b> <a href="StorageManager_8cpp_source.html#l00179">StorageManager.cpp:179</a></div></div>
<div class="ttc" id="classStorageAccess_html"><div class="ttname"><a href="classStorageAccess.html">StorageAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="StorageManager_8h_source.html#l00078">StorageManager.h:78</a></div></div>
<div class="ttc" id="classAP__Rally_html_a254081bd2be797fea7ce7308503d9d88"><div class="ttname"><a href="classAP__Rally.html#a254081bd2be797fea7ce7308503d9d88">AP_Rally::_rally_incl_home</a></div><div class="ttdeci">AP_Int8 _rally_incl_home</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00088">AP_Rally.h:88</a></div></div>
<div class="ttc" id="classLocation_html_a89e532f5bcc13db2f51ff9eed667c2b6"><div class="ttname"><a href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">Location::alt</a></div><div class="ttdeci">int32_t alt</div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00020">Location.h:20</a></div></div>
<div class="ttc" id="StorageManager_8h_html"><div class="ttname"><a href="StorageManager_8h.html">StorageManager.h</a></div></div>
<div class="ttc" id="classAP__Rally_html_a0cb8f360c5561331a0300dc01142a065"><div class="ttname"><a href="classAP__Rally.html#a0cb8f360c5561331a0300dc01142a065">AP_Rally::_singleton</a></div><div class="ttdeci">static AP_Rally * _singleton</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00079">AP_Rally.h:79</a></div></div>
<div class="ttc" id="classAP__Rally_html_a2b1d9a21a9c805031bafda8957a78c89"><div class="ttname"><a href="classAP__Rally.html#a2b1d9a21a9c805031bafda8957a78c89">AP_Rally::AP_Rally</a></div><div class="ttdeci">AP_Rally()</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8cpp_source.html#l00054">AP_Rally.cpp:54</a></div></div>
<div class="ttc" id="classAP__Rally_html_a7df46c782c4d221590d48b720b9f6457"><div class="ttname"><a href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">AP_Rally::_rally_point_total_count</a></div><div class="ttdeci">AP_Int8 _rally_point_total_count</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00086">AP_Rally.h:86</a></div></div>
<div class="ttc" id="structRallyLocation_html_aaaabfdf90e21cefd9dbeb234c7a5e251"><div class="ttname"><a href="structRallyLocation.html#aaaabfdf90e21cefd9dbeb234c7a5e251">RallyLocation::lat</a></div><div class="ttdeci">int32_t lat</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00022">AP_Rally.h:22</a></div></div>
<div class="ttc" id="classLocation_html"><div class="ttname"><a href="classLocation.html">Location</a></div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00009">Location.h:9</a></div></div>
<div class="ttc" id="namespaceAP__HAL_html_a71832f03d849a0c088f04fc98d3c8143"><div class="ttname"><a href="namespaceAP__HAL.html#a71832f03d849a0c088f04fc98d3c8143">AP_HAL::panic</a></div><div class="ttdeci">void panic(const char *errormsg,...) FMT_PRINTF(1</div><div class="ttdef"><b>Definition:</b> <a href="ChibiOS_2system_8cpp_source.html#l00140">system.cpp:140</a></div></div>
<div class="ttc" id="structassert__storage__size_html"><div class="ttname"><a href="structassert__storage__size.html">assert_storage_size</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00120">AP_Common.h:120</a></div></div>
<div class="ttc" id="classAP__Logger_html_af2b4490454ef4ae790ddb3496d948e47"><div class="ttname"><a href="classAP__Logger.html#af2b4490454ef4ae790ddb3496d948e47">AP_Logger::Write_RallyPoint</a></div><div class="ttdeci">void Write_RallyPoint(uint8_t total, uint8_t sequence, const RallyLocation &amp;rally_point)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Logger_8cpp_source.html#l00711">AP_Logger.cpp:711</a></div></div>
<div class="ttc" id="classLocation_html_a9e973101205763fabc1c9e65ec3ae41d"><div class="ttname"><a href="classLocation.html#a9e973101205763fabc1c9e65ec3ae41d">Location::get_distance</a></div><div class="ttdeci">float get_distance(const struct Location &amp;loc2) const</div><div class="ttdef"><b>Definition:</b> <a href="Location_8cpp_source.html#l00219">Location.cpp:219</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00118">AP_Param.h:118</a></div></div>
<div class="ttc" id="classLocation_html_ae51548c2cf32311043ca19b94b9a9223"><div class="ttname"><a href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">Location::lat</a></div><div class="ttdeci">int32_t lat</div><div class="ttdef"><b>Definition:</b> <a href="Location_8h_source.html#l00021">Location.h:21</a></div></div>
<div class="ttc" id="AP__Rally_8cpp_html_a6cf8535f6d897b3dadefb50cf2d61e8a"><div class="ttname"><a href="AP__Rally_8cpp.html#a6cf8535f6d897b3dadefb50cf2d61e8a">RALLY_INCLUDE_HOME_DEFAULT</a></div><div class="ttdeci">#define RALLY_INCLUDE_HOME_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8cpp_source.html#l00025">AP_Rally.cpp:25</a></div></div>
<div class="ttc" id="classStorageManager_html_a8a47a036f4478b1631984c9577d73a46a42e46109d6193f717d28cbc3c5f40c14"><div class="ttname"><a href="classStorageManager.html#a8a47a036f4478b1631984c9577d73a46a42e46109d6193f717d28cbc3c5f40c14">StorageManager::StorageRally</a></div><div class="ttdef"><b>Definition:</b> <a href="StorageManager_8h_source.html#l00050">StorageManager.h:50</a></div></div>
<div class="ttc" id="classAP__Param_html_a5f6dcfce1c0a79cf5bd81283e22f3201"><div class="ttname"><a href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a></div><div class="ttdeci">static void setup_object_defaults(const void *object_pointer, const struct GroupInfo *group_info)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8cpp_source.html#l01265">AP_Param.cpp:1265</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 11 2019 14:17:35 for APM:Libraries by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
