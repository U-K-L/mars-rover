<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AP_TECS/AP_TECS.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_060ebec8bce34c75ed52fa2fa80763b7.html">AP_TECS</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AP_TECS.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AP__TECS_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__TECS_8h.html">AP_TECS.h</a>&quot;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL/AP_HAL.h</a>&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Baro_8h.html">AP_Baro/AP_Baro.h</a>&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Logger_8h.html">AP_Logger/AP_Logger.h</a>&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">extern</span> <span class="keyword">const</span> <a class="code" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code" href="AP__TECS_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#if CONFIG_HAL_BOARD == HAL_BOARD_SITL</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="stdio_8h.html">stdio.h</a>&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno"><a class="line" href="AP__TECS_8cpp.html#a323c80a92fab4037fe4440664139c522">   11</a></span>&#160;<span class="preprocessor"># define Debug(fmt, args ...)  do {printf(&quot;%s:%d: &quot; fmt &quot;\n&quot;, __FUNCTION__, __LINE__, ## args); hal.scheduler-&gt;delay(1); } while(0)</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor"># define Debug(fmt, args ...)</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//Debug(&quot;%.2f %.2f %.2f %.2f \n&quot;, var1, var2, var3, var4);</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// table of user settable parameters</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">const</span> <a class="code" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code" href="classAP__TECS.html#ae12cafab2952c95615de86f723fc0d61">AP_TECS::var_info</a>[] = {</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="comment">// @Param: CLMB_MAX</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="comment">// @DisplayName: Maximum Climb Rate (metres/sec)</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="comment">// @Description: Maximum demanded climb rate. Do not set higher than the climb speed at THR_MAX at TRIM_ARSPD_CM when the battery is at low voltage. Reduce value if airspeed cannot be maintained on ascent. Increase value if throttle does not increase significantly to ascend.</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="comment">// @Range: 0.1 20.0</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;CLMB_MAX&quot;</span>,    0, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _maxClimbRate, 5.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="comment">// @Param: SINK_MIN</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// @DisplayName: Minimum Sink Rate (metres/sec)</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment">// @Description: Minimum sink rate when at THR_MIN and TRIM_ARSPD_CM.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment">// @Range: 0.1 10.0</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment">// @User: Standard</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SINK_MIN&quot;</span>,    1, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _minSinkRate, 2.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">// @Param: TIME_CONST</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="comment">// @DisplayName: Controller time constant (sec)</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// @Description: Time constant of the TECS control algorithm. Small values make faster altitude corrections but can cause overshoot and aggressive behavior.</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// @Range: 3.0 10.0</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// @Increment: 0.2</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TIME_CONST&quot;</span>,  2, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _timeConst, 5.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment">// @Param: THR_DAMP</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// @DisplayName: Controller throttle damping</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// @Description: Damping gain for throttle demand loop. Slows the throttle response to correct for speed and height oscillations.</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// @Range: 0.1 1.0</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;THR_DAMP&quot;</span>,    3, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _thrDamp, 0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// @Param: INTEG_GAIN</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">// @DisplayName: Controller integrator</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// @Description: Integrator gain to trim out long-term speed and height errors.</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// @Range: 0.0 0.5</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">// @Increment: 0.02</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;INTEG_GAIN&quot;</span>, 4, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _integGain, 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// @Param: VERT_ACC</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// @DisplayName: Vertical Acceleration Limit (metres/sec^2)</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// @Description: Maximum vertical acceleration used to correct speed or height errors.</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// @Range: 1.0 10.0</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// @Increment: 0.5</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;VERT_ACC&quot;</span>,  5, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _vertAccLim, 7.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// @Param: HGT_OMEGA</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// @DisplayName: Height complementary filter frequency (radians/sec)</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">// @Description: This is the cross-over frequency of the complementary filter used to fuse vertical acceleration and baro alt to obtain an estimate of height rate and height.</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// @Range: 1.0 5.0</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// @Increment: 0.05</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;HGT_OMEGA&quot;</span>, 6, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _hgtCompFiltOmega, 3.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// @Param: SPD_OMEGA</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// @DisplayName: Speed complementary filter frequency (radians/sec)</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// @Description: This is the cross-over frequency of the complementary filter used to fuse longitudinal acceleration and airspeed to obtain a lower noise and lag estimate of airspeed.</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// @Range: 0.5 2.0</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// @Increment: 0.05</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SPD_OMEGA&quot;</span>, 7, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _spdCompFiltOmega, 2.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// @Param: RLL2THR</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// @DisplayName: Bank angle compensation gain</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// @Description: Gain from bank angle to throttle to compensate for loss of airspeed from drag in turns. Set to approximately 10x the sink rate in m/s caused by a 45-degree turn. High efficiency models may need less while less efficient aircraft may need more. Should be tuned in an automatic mission with waypoints and turns greater than 90 degrees. Tune with PTCH2SV_RLL and KFF_RDDRMIX to achieve constant airspeed, constant altitude turns.</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// @Range: 5.0 30.0</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// @Increment: 1.0</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RLL2THR&quot;</span>,  8, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _rollComp, 10.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// @Param: SPDWEIGHT</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">// @DisplayName: Weighting applied to speed control</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">// @Description: Mixing of pitch and throttle correction for height and airspeed errors. Pitch controls altitude and throttle controls airspeed if set to 0. Pitch controls airspeed and throttle controls altitude if set to 2 (good for gliders). Blended if set to 1.</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">// @Range: 0.0 2.0</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SPDWEIGHT&quot;</span>, 9, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _spdWeight, 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// @Param: PTCH_DAMP</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// @DisplayName: Controller pitch damping</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// @Description: Damping gain for pitch control from TECS control.  Increasing may correct for oscillations in speed and height, but too much may cause additional oscillation and degraded control.</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// @Range: 0.1 1.0</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PTCH_DAMP&quot;</span>, 10, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _ptchDamp, 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">// @Param: SINK_MAX</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// @DisplayName: Maximum Descent Rate (metres/sec)</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// @Description: Maximum demanded descent rate. Do not set higher than the vertical speed the aircraft can maintain at THR_MIN, TECS_PITCH_MIN, and ARSPD_FBW_MAX.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">// @Range: 0.0 20.0</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">// @User: User</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SINK_MAX&quot;</span>,  11, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _maxSinkRate, 5.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// @Param: LAND_ARSPD</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// @DisplayName: Airspeed during landing approach (m/s)</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">// @Description: When performing an autonomus landing, this value is used as the goal airspeed during approach.  Note that this parameter is not useful if your platform does not have an airspeed sensor (use TECS_LAND_THR instead).  If negative then this value is not used during landing.</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// @Range: -1 127</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// @Increment: 1</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">// @User: User</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_ARSPD&quot;</span>, 12, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _landAirspeed, -1),</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">// @Param: LAND_THR</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// @DisplayName: Cruise throttle during landing approach (percentage)</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">// @Description: Use this parameter instead of LAND_ARSPD if your platform does not have an airspeed sensor.  It is the cruise throttle during landing approach.  If this value is negative then it is disabled and TECS_LAND_ARSPD is used instead.</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// @Range: -1 100</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// @User: User</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_THR&quot;</span>, 13, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _landThrottle, -1),</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// @Param: LAND_SPDWGT</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">// @DisplayName: Weighting applied to speed control during landing.</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">// @Description: Same as SPDWEIGHT parameter, with the exception that this parameter is applied during landing flight stages.  A value closer to 2 will result in the plane ignoring height error during landing and our experience has been that the plane will therefore keep the nose up -- sometimes good for a glider landing (with the side effect that you will likely glide a ways past the landing point).  A value closer to 0 results in the plane ignoring speed error -- use caution when lowering the value below 1 -- ignoring speed could result in a stall. Values between 0 and 2 are valid values for a fixed landing weight. When using -1 the weight will be scaled during the landing. At the start of the landing approach it starts with TECS_SPDWEIGHT and scales down to 0 by the time you reach the land point. Example: Halfway down the landing approach you&#39;ll effectively have a weight of TECS_SPDWEIGHT/2.</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// @Range: -1.0 2.0</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_SPDWGT&quot;</span>, 14, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _spdWeightLand, -1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// @Param: PITCH_MAX</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">// @DisplayName: Maximum pitch in auto flight</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// @Description: Overrides LIM_PITCH_MAX in automatic throttle modes to reduce climb rates. Uses LIM_PITCH_MAX if set to 0. For proper TECS tuning, set to the angle that the aircraft can climb at TRIM_ARSPD_CM and THR_MAX.</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// @Range: 0 45</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">// @Increment: 1</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PITCH_MAX&quot;</span>, 15, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _pitch_max, 15),</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">// @Param: PITCH_MIN</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="comment">// @DisplayName: Minimum pitch in auto flight</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// @Description: Overrides LIM_PITCH_MIN in automatic throttle modes to reduce descent rates. Uses LIM_PITCH_MIN if set to 0. For proper TECS tuning, set to the angle that the aircraft can descend at without overspeeding.</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">// @Range: -45 0</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// @Increment: 1</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PITCH_MIN&quot;</span>, 16, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _pitch_min, 0),</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">// @Param: LAND_SINK</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// @DisplayName: Sink rate for final landing stage</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// @Description: The sink rate in meters/second for the final stage of landing.</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// @Range: 0.0 2.0</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_SINK&quot;</span>, 17, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _land_sink, 0.25<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">// @Param: LAND_TCONST</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// @DisplayName: Land controller time constant (sec)</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">// @Description: This is the time constant of the TECS control algorithm when in final landing stage of flight. It should be smaller than TECS_TIME_CONST to allow for faster flare</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">// @Range: 1.0 5.0</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// @Increment: 0.2</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_TCONST&quot;</span>, 18, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _landTimeConst, 2.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// @Param: LAND_DAMP</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">// @DisplayName: Controller sink rate to pitch gain during flare</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// @Description: This is the sink rate gain for the pitch demand loop when in final landing stage of flight. It should be larger than TECS_PTCH_DAMP to allow for better sink rate control during flare.</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">// @Range: 0.1 1.0</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_DAMP&quot;</span>, 19, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _landDamp, 0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">// @Param: LAND_PMAX</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// @DisplayName: Maximum pitch during final stage of landing</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// @Description: This limits the pitch used during the final stage of automatic landing. During the final landing stage most planes need to keep their pitch small to avoid stalling. A maximum of 10 degrees is usually good. A value of zero means to use the normal pitch limits.</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// @Range: -5 40</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="comment">// @Increment: 1</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_PMAX&quot;</span>, 20, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _land_pitch_max, 10),</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">// @Param: APPR_SMAX</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">// @DisplayName: Sink rate max for landing approach stage</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// @Description: The sink rate max for the landing approach stage of landing. This will need to be large for steep landing approaches especially when using reverse thrust. If 0, then use TECS_SINK_MAX.</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// @Range: 0.0 20.0</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">// @Units: m/s</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;APPR_SMAX&quot;</span>, 21, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _maxSinkRate_approach, 0),</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// @Param: LAND_SRC</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// @DisplayName: Land sink rate change</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">// @Description: When zero, the flare sink rate (TECS_LAND_SINK) is a fixed sink demand. With this enabled the flare sinkrate will increase/decrease the flare sink demand as you get further beyond the LAND waypoint. Has no effect before the waypoint. This value is added to TECS_LAND_SINK proportional to distance traveled after wp. With an increasing sink rate you can still land in a given distance if you&#39;re traveling too fast and cruise passed the land point. A positive value will force the plane to land sooner proportional to distance passed land point. A negative number will tell the plane to slowly climb allowing for a pitched-up stall landing. Recommend 0.2 as initial value.</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// @Range: -2.0 2.0</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// @Units: m/s/m</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_SRC&quot;</span>, 22, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _land_sink_rate_change, 0),</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">// @Param: LAND_TDAMP</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">// @DisplayName: Controller throttle damping when landing</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">// @Description: This is the damping gain for the throttle demand loop during and auto-landing. Same as TECS_THR_DAMP but only in effect during an auto-land. Increase to add damping to correct for oscillations in speed and height. When set to 0 landing throttle damp is controlled by TECS_THR_DAMP.</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// @Range: 0.1 1.0</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_TDAMP&quot;</span>, 23, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _land_throttle_damp, 0),</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">// @Param: LAND_IGAIN</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// @DisplayName: Controller integrator during landing</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">// @Description: This is the integrator gain on the control loop during landing. When set to 0 then TECS_INTEG_GAIN is used. Increase to increase the rate at which speed and height offsets are trimmed out. Typically values lower than TECS_INTEG_GAIN work best</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// @Range: 0.0 0.5</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// @Increment: 0.02</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_IGAIN&quot;</span>, 24, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _integGain_land, 0),</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">// @Param: TKOFF_IGAIN</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// @DisplayName: Controller integrator during takeoff</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">// @Description: This is the integrator gain on the control loop during takeoff. When set to 0 then TECS_INTEG_GAIN is used. Increase to increase the rate at which speed and height offsets are trimmed out. Typically values higher than TECS_INTEG_GAIN work best</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">// @Range: 0.0 0.5</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">// @Increment: 0.02</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TKOFF_IGAIN&quot;</span>, 25, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _integGain_takeoff, 0),</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="comment">// @Param: LAND_PDAMP</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// @DisplayName: Pitch damping gain when landing</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// @Description: This is the damping gain for the pitch demand loop during landing. Increase to add damping  to correct for oscillations in speed and height. If set to 0 then TECS_PTCH_DAMP will be used instead.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// @Range: 0.1 1.0</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">// @Increment: 0.1</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_PDAMP&quot;</span>, 26, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _land_pitch_damp, 0),</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">// @Param: SYNAIRSPEED</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">// @DisplayName: Enable the use of synthetic airspeed</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">// @Description: This enable the use of synthetic airspeed for aircraft that don&#39;t have a real airspeed sensor. This is useful for development testing where the user is aware of the considerable limitations of the synthetic airspeed system, such as very poor estimates when a wind estimate is not accurate. Do not enable this option unless you fully understand the limitations of a synthetic airspeed estimate.</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">// @Values: 0:Disable,1:Enable</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">// @User: Advanced</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SYNAIRSPEED&quot;</span>, 27, <a class="code" href="classAP__TECS.html">AP_TECS</a>, _use_synthetic_airspeed, 0),</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    </div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;};</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment"> *  Written by Paul Riseborough 2013 to provide:</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment"> *  - Combined control of speed and height using throttle to control</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"> *    total energy and pitch angle to control exchange of energy between</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"> *    potential and kinetic.</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment"> *    Selectable speed or height priority modes when calculating pitch angle</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment"> *  - Fallback mode when no airspeed measurement is available that</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment"> *    sets throttle based on height rate demand and switches pitch angle control to</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment"> *    height priority</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment"> *  - Underspeed protection that demands maximum throttle and switches pitch angle control</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment"> *    to speed priority mode</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment"> *  - Relative ease of tuning through use of intuitive time constant, integrator and damping gains and the use</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment"> *    of easy to measure aircraft performance data</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a3031b248e419021c7ccc83bd0cddb387">  264</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__TECS.html#a3031b248e419021c7ccc83bd0cddb387">AP_TECS::update_50hz</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;{</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">// Implement third order complementary filter for height and height rate</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">// estimated height rate = _climb_rate</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">// estimated height above field elevation  = _height</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="comment">// Reference Paper :</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">// Optimizing the Gains of the Baro-Inertial Vertical Channel</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// Widnall W.S, Sinha P.K,</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">// AIAA Journal of Guidance and Control, 78-1307R</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">      if we have a vertical position estimate from the EKF then use</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">      it, otherwise use barometric altitude</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <a class="code" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a6573f5db06887fb66661ecb18e03ec3f">get_relative_position_D_home</a>(<a class="code" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a>);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <a class="code" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a> *= -1.0f;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">// Calculate time in seconds since last update</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    uint64_t now = <a class="code" href="namespaceAP__HAL.html#a7aa0ce7625c9680e30ff4a99940907a5">AP_HAL::micros64</a>();</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordtype">float</span> DT = (now - <a class="code" href="classAP__TECS.html#ab4e43605acf8d36a5837334710d9c104">_update_50hz_last_usec</a>) * 1.0e-6<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span> (DT &gt; 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <a class="code" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a> = 0.0f;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <a class="code" href="classAP__TECS.html#ae14918501a123045d9d73dd3e501e57d">_height_filter</a>.dd_height = 0.0f;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        DT            = 0.02f; <span class="comment">// when first starting TECS, use a</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="comment">// small time constant</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="classAP__TECS.html#ab4e43605acf8d36a5837334710d9c104">_update_50hz_last_usec</a> = now;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">// Use inertial nav verical velocity and height if available</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="classVector3.html">Vector3f</a> velned;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a69b21caefc3aab8edc889cb7a181a756">get_velocity_NED</a>(velned)) {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="comment">// if possible use the EKF vertical velocity</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <a class="code" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a> = -velned.<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">          use a complimentary filter to calculate climb_rate. This is</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">          designed to minimise lag</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> baro_alt = <a class="code" href="namespaceAP.html#a8aec57eb0b7a79044cbc1f0ca4b75bcf">AP::baro</a>().<a class="code" href="classAP__Baro.html#a50ae73cce1699d88638e3dfab4ffd330">get_altitude</a>();</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="comment">// Get height acceleration</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordtype">float</span> hgt_ddot_mea = -(<a class="code" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code" href="classAP__AHRS.html#ac9a14475fecfad99bfac9372b1a4e9bd">get_accel_ef</a>().<a class="code" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> + <a class="code" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="comment">// Perform filter calculation using backwards Euler integration</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="comment">// Coefficients selected to place all three filter poles at omega</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordtype">float</span> omega2 = <a class="code" href="classAP__TECS.html#a44a3b1b7342744ddb5a9fc88af0b73e5">_hgtCompFiltOmega</a>*<a class="code" href="classAP__TECS.html#a44a3b1b7342744ddb5a9fc88af0b73e5">_hgtCompFiltOmega</a>;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordtype">float</span> hgt_err = baro_alt - <a class="code" href="classAP__TECS.html#ae14918501a123045d9d73dd3e501e57d">_height_filter</a>.height;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordtype">float</span> integ1_input = hgt_err * omega2 * <a class="code" href="classAP__TECS.html#a44a3b1b7342744ddb5a9fc88af0b73e5">_hgtCompFiltOmega</a>;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <a class="code" href="classAP__TECS.html#ae14918501a123045d9d73dd3e501e57d">_height_filter</a>.dd_height += integ1_input * DT;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="keywordtype">float</span> integ2_input = <a class="code" href="classAP__TECS.html#ae14918501a123045d9d73dd3e501e57d">_height_filter</a>.dd_height + hgt_ddot_mea + hgt_err * omega2 * 3.0f;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <a class="code" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a> += integ2_input * DT;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="keywordtype">float</span> integ3_input = <a class="code" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a> + hgt_err * <a class="code" href="classAP__TECS.html#a44a3b1b7342744ddb5a9fc88af0b73e5">_hgtCompFiltOmega</a> * 3.0f;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="comment">// If more than 1 second has elapsed since last update then reset the integrator state</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="comment">// to the measured height</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">if</span> (DT &gt; 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <a class="code" href="classAP__TECS.html#ae14918501a123045d9d73dd3e501e57d">_height_filter</a>.height = <a class="code" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <a class="code" href="classAP__TECS.html#ae14918501a123045d9d73dd3e501e57d">_height_filter</a>.height += integ3_input*DT;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    }</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">// Update and average speed rate of change</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">// Get DCM</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keyword">const</span> <a class="code" href="classMatrix3.html">Matrix3f</a> &amp;rotMat = <a class="code" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a8a1988bb283c488c86b329be18271fbf">get_rotation_body_to_ned</a>();</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">// Calculate speed rate of change</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordtype">float</span> temp = rotMat.<a class="code" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> * <a class="code" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a> + <a class="code" href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9">AP::ins</a>().<a class="code" href="classAP__InertialSensor.html#a7a848d0332acb5b39d8e47fca5a1e77f">get_accel</a>().<a class="code" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// take 5 point moving average</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="classAP__TECS.html#a4da8b5a68fcf0769d2200f4038ddebd8">_vel_dot</a> = <a class="code" href="classAP__TECS.html#abdc88637f15f20df5e282bf2052940c2">_vdot_filter</a>.<a class="code" href="classAverageFilter.html#a58f3da49063db38d512b15b8a0fc0995">apply</a>(temp);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;}</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno"><a class="line" href="classAP__TECS.html#ac3a90f55264799a5482b76abfe5b9a68">  337</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__TECS.html#ac3a90f55264799a5482b76abfe5b9a68">AP_TECS::_update_speed</a>(<span class="keywordtype">float</span> load_factor)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;{</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="comment">// Calculate time in seconds since last update</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    uint64_t now = <a class="code" href="namespaceAP__HAL.html#a7aa0ce7625c9680e30ff4a99940907a5">AP_HAL::micros64</a>();</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordtype">float</span> DT = (now - <a class="code" href="classAP__TECS.html#a815bf2048b92487ff8ee539b57beecf0">_update_speed_last_usec</a>) * 1.0e-6<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <a class="code" href="classAP__TECS.html#a815bf2048b92487ff8ee539b57beecf0">_update_speed_last_usec</a> = now;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="comment">// Convert equivalent airspeeds to true airspeeds</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordtype">float</span> EAS2TAS = <a class="code" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a64786b58a1607ee420ed4f0696c755b6">get_EAS2TAS</a>();</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a> = <a class="code" href="classAP__TECS.html#ae52e17111e872c29d269209efb7d5989">_EAS_dem</a> * EAS2TAS;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a>   = <a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#ab774cbd438b0d68da5250de61dca6262">airspeed_max</a> * EAS2TAS;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a>   = <a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a88300cf5dda0e0f3cb5669c564756039">airspeed_min</a> * EAS2TAS;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#aafe6b1cf37e37cff0792496dd2c414ea">stall_prevention</a>) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="comment">// when stall prevention is active we raise the mimimum</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="comment">// airspeed based on aerodynamic load factor</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a> *= load_factor;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a> &lt; <a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a>) {</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <a class="code" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a> = <a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a>;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    }</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a> &gt; <a class="code" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a>) {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a> = <a class="code" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a>;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">// Reset states of time since last update is too large</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">if</span> (DT &gt; 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> = (<a class="code" href="classAP__TECS.html#abef22d8ca912f65ae8abdff6e54d8d3c">_EAS</a> * EAS2TAS);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <a class="code" href="classAP__TECS.html#ae4afaa108f4629b08efb5c19d3119233">_integDTAS_state</a> = 0.0f;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        DT            = 0.1f; <span class="comment">// when first starting TECS, use a</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="comment">// small time constant</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">// Get airspeed or default to halfway between min and max if</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">// airspeed is not being used and set speed rate to zero</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordtype">bool</span> use_airspeed = <a class="code" href="classAP__TECS.html#a07f643564d913cf9020cd4a1b68f139d">_use_synthetic_airspeed_once</a> || <a class="code" href="classAP__TECS.html#ada65aa88ad9ecd6db58d55dd783b7a1f">_use_synthetic_airspeed</a>.get() || <a class="code" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a47ea335b3b317f0c5e54320f59d5ca8a">airspeed_sensor_enabled</a>();</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">if</span> (!use_airspeed || !<a class="code" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code" href="classAP__AHRS.html#aba88eab2ab7bb6f525934fb06d30e780">airspeed_estimate</a>(&amp;<a class="code" href="classAP__TECS.html#abef22d8ca912f65ae8abdff6e54d8d3c">_EAS</a>)) {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="comment">// If no airspeed available use average of min and max</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <a class="code" href="classAP__TECS.html#abef22d8ca912f65ae8abdff6e54d8d3c">_EAS</a> = 0.5f * (<a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a88300cf5dda0e0f3cb5669c564756039">airspeed_min</a>.get() + (float)<a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#ab774cbd438b0d68da5250de61dca6262">airspeed_max</a>.get());</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">// Implement a second order complementary filter to obtain a</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="comment">// smoothed airspeed estimate</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="comment">// airspeed estimate is held in _TAS_state</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordtype">float</span> aspdErr = (<a class="code" href="classAP__TECS.html#abef22d8ca912f65ae8abdff6e54d8d3c">_EAS</a> * EAS2TAS) - <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordtype">float</span> integDTAS_input = aspdErr * <a class="code" href="classAP__TECS.html#a7cd6a7f15461a776d453aebdbc1ba39f">_spdCompFiltOmega</a> * <a class="code" href="classAP__TECS.html#a7cd6a7f15461a776d453aebdbc1ba39f">_spdCompFiltOmega</a>;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">// Prevent state from winding up</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> &lt; 3.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        integDTAS_input = <a class="code" href="AP__Math_8h.html#a5abc8871f1e7781a55afe9bf299f0a39">MAX</a>(integDTAS_input , 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="classAP__TECS.html#ae4afaa108f4629b08efb5c19d3119233">_integDTAS_state</a> = <a class="code" href="classAP__TECS.html#ae4afaa108f4629b08efb5c19d3119233">_integDTAS_state</a> + integDTAS_input * DT;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordtype">float</span> TAS_input = <a class="code" href="classAP__TECS.html#ae4afaa108f4629b08efb5c19d3119233">_integDTAS_state</a> + <a class="code" href="classAP__TECS.html#a4da8b5a68fcf0769d2200f4038ddebd8">_vel_dot</a> + aspdErr * <a class="code" href="classAP__TECS.html#a7cd6a7f15461a776d453aebdbc1ba39f">_spdCompFiltOmega</a> * 1.4142f;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> = <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> + TAS_input * DT;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">// limit the airspeed to a minimum of 3 m/s</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> = <a class="code" href="AP__Math_8h.html#a5abc8871f1e7781a55afe9bf299f0a39">MAX</a>(<a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>, 3.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;}</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a376593eecc4ab66559947a144106bdd5">  397</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__TECS.html#a376593eecc4ab66559947a144106bdd5">AP_TECS::_update_speed_demand</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;{</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">// Set the airspeed demand to the minimum value if an underspeed condition exists</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">// or a bad descent condition exists</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">// This will minimise the rate of descent resulting from an engine failure,</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="comment">// enable the maximum climb rate to be achieved and prevent continued full power descent</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="comment">// into the ground due to an unachievable airspeed value</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a>) || (<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a>))</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    {</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <a class="code" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a>     = <a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a>;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">// Constrain speed demand, taking into account the load factor</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <a class="code" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a>, <a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a>, <a class="code" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a>);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="comment">// calculate velocity rate limits based on physical performance limits</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="comment">// provision to use a different rate limit if bad descent or underspeed condition exists</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">// Use 50% of maximum energy rate to allow margin for total energy contgroller</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> velRateMax = 0.5f * <a class="code" href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">_STEdot_max</a> / <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> velRateMin = 0.5f * <a class="code" href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">_STEdot_min</a> / <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> TAS_dem_previous = <a class="code" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="comment">// assume fixed 10Hz call rate</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> dt = 0.1;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">// Apply rate limit</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a> - TAS_dem_previous) &gt; (velRateMax * dt))</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <a class="code" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a> = TAS_dem_previous + velRateMax * dt;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <a class="code" href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">_TAS_rate_dem</a> = velRateMax;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    }</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a> - TAS_dem_previous) &lt; (velRateMin * dt))</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    {</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <a class="code" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a> = TAS_dem_previous + velRateMin * dt;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <a class="code" href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">_TAS_rate_dem</a> = velRateMin;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    }</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <a class="code" href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">_TAS_rate_dem</a> = (<a class="code" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a> - TAS_dem_previous) / dt;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <a class="code" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a> = <a class="code" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a>;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">// Constrain speed demand again to protect against bad values on initialisation.</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <a class="code" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>, <a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a>, <a class="code" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a>);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;}</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a91aeb22f68e2957bfad6285ec41182cf">  442</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__TECS.html#a91aeb22f68e2957bfad6285ec41182cf">AP_TECS::_update_height_demand</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;{</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="comment">// Apply 2 point moving average to demanded height</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <a class="code" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> = 0.5f * (<a class="code" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> + <a class="code" href="classAP__TECS.html#a960b22fb125a25cb7ad6d63438e14622">_hgt_dem_in_old</a>);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="classAP__TECS.html#a960b22fb125a25cb7ad6d63438e14622">_hgt_dem_in_old</a> = <a class="code" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a>;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordtype">float</span> max_sink_rate = <a class="code" href="classAP__TECS.html#a7c97ba3776836f5760b4b79f4926e452">_maxSinkRate</a>;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a96bc0e6fadbf3202c5e5fc9ee2c01cec">_maxSinkRate_approach</a> &gt; 0 &amp;&amp; <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a>) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="comment">// special sink rate for approach to accommodate steep slopes and reverse thrust.</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="comment">// A special check must be done to see if we&#39;re LANDing on approach but also if</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="comment">// we&#39;re in that tiny window just starting NAV_LAND but still in NORMAL mode. If</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="comment">// we have a steep slope with a short approach we&#39;ll want to allow acquiring the</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="comment">// glide slope right away.</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        max_sink_rate = <a class="code" href="classAP__TECS.html#a96bc0e6fadbf3202c5e5fc9ee2c01cec">_maxSinkRate_approach</a>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    }</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment">// Limit height rate of change</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> - <a class="code" href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">_hgt_dem_prev</a>) &gt; (<a class="code" href="classAP__TECS.html#aea68f106f8f04f199c8470e52532e6a5">_maxClimbRate</a> * 0.1f))</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <a class="code" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> = <a class="code" href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">_hgt_dem_prev</a> + <a class="code" href="classAP__TECS.html#aea68f106f8f04f199c8470e52532e6a5">_maxClimbRate</a> * 0.1f;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    }</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> - <a class="code" href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">_hgt_dem_prev</a>) &lt; (-max_sink_rate * 0.1f))</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <a class="code" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> = <a class="code" href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">_hgt_dem_prev</a> - max_sink_rate * 0.1f;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    }</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <a class="code" href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">_hgt_dem_prev</a> = <a class="code" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a>;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">// Apply first order lag to height demand</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a> = 0.05f * <a class="code" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> + 0.95f * <a class="code" href="classAP__TECS.html#a344eb89d0ffbaf1ec9c06044451f56f2">_hgt_dem_adj_last</a>;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">// when flaring force height rate demand to the</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">// configured sink rate and adjust the demanded height to</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">// be kinematically consistent with the height rate.</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code" href="classAP__Landing.html#a5ff74bf65eb1a4083cc783af22276828">is_flaring</a>()) {</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <a class="code" href="classAP__TECS.html#a161190aceb1f074b27be3c46607a9220">_integSEB_state</a> = 0;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a75a17f39fa8b643cc3352f8bbf3fec90">_flare_counter</a> == 0) {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <a class="code" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a> = <a class="code" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a>;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            <a class="code" href="classAP__TECS.html#a840180012d3976350258d370025b728d">_land_hgt_dem</a> = <a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a>;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        }</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="comment">// adjust the flare sink rate to increase/decrease as your travel further beyond the land wp</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordtype">float</span> land_sink_rate_adj = <a class="code" href="classAP__TECS.html#a8d23075cf7fd1752877a893bd689a2ab">_land_sink</a> + <a class="code" href="classAP__TECS.html#ab1d7e52ac8d8c6aa305275a30ba72a93">_land_sink_rate_change</a>*<a class="code" href="classAP__TECS.html#a4dc0dac47faf337837f8c47c21494d67">_distance_beyond_land_wp</a>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="comment">// bring it in over 1s to prevent overshoot</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a75a17f39fa8b643cc3352f8bbf3fec90">_flare_counter</a> &lt; 10) {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            <a class="code" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a> = <a class="code" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a> * 0.8f - 0.2f * land_sink_rate_adj;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <a class="code" href="classAP__TECS.html#a75a17f39fa8b643cc3352f8bbf3fec90">_flare_counter</a>++;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            <a class="code" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a> = - land_sink_rate_adj;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <a class="code" href="classAP__TECS.html#a840180012d3976350258d370025b728d">_land_hgt_dem</a> += 0.1f * <a class="code" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a> = <a class="code" href="classAP__TECS.html#a840180012d3976350258d370025b728d">_land_hgt_dem</a>;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <a class="code" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a> = (<a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a> - <a class="code" href="classAP__TECS.html#a344eb89d0ffbaf1ec9c06044451f56f2">_hgt_dem_adj_last</a>) / 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <a class="code" href="classAP__TECS.html#a75a17f39fa8b643cc3352f8bbf3fec90">_flare_counter</a> = 0;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">// for landing approach we will predict ahead by the time constant</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">// plus the lag produced by the first order filter. This avoids a</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="comment">// lagged height demand while constantly descending which causes</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">// us to consistently be above the desired glide slope. This will</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="comment">// be replaced with a better zero-lag filter in the future.</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordtype">float</span> new_hgt_dem = <a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a>) {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a239be6d923951e7ebabb52ec498806da">hgt_dem_lag_filter_slew</a> &lt; 1) {</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <a class="code" href="classAP__TECS.html#a239be6d923951e7ebabb52ec498806da">hgt_dem_lag_filter_slew</a> += 0.1f; <span class="comment">// increment at 10Hz to gradually apply the compensation at first</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            <a class="code" href="classAP__TECS.html#a239be6d923951e7ebabb52ec498806da">hgt_dem_lag_filter_slew</a> = 1;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        }</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        new_hgt_dem += <a class="code" href="classAP__TECS.html#a239be6d923951e7ebabb52ec498806da">hgt_dem_lag_filter_slew</a>*(<a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a> - <a class="code" href="classAP__TECS.html#a344eb89d0ffbaf1ec9c06044451f56f2">_hgt_dem_adj_last</a>)*10.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>*(<a class="code" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">timeConstant</a>()+1);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <a class="code" href="classAP__TECS.html#a239be6d923951e7ebabb52ec498806da">hgt_dem_lag_filter_slew</a> = 0;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    }</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <a class="code" href="classAP__TECS.html#a344eb89d0ffbaf1ec9c06044451f56f2">_hgt_dem_adj_last</a> = <a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a> = new_hgt_dem;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;}</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a7318e1b5998b99f4febe0d53040c5744">  519</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__TECS.html#a7318e1b5998b99f4febe0d53040c5744">AP_TECS::_detect_underspeed</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;{</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">// see if we can clear a previous underspeed condition. We clear</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="comment">// it if we are now more than 15% above min speed, and haven&#39;t</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="comment">// been below min speed for at least 3 seconds.</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> &amp;&amp;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> &gt;= <a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a> * 1.15f &amp;&amp;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>() - <a class="code" href="classAP__TECS.html#aa7b382d5c5f219be2fe639173654fbda">_underspeed_start_ms</a> &gt; 3000U) {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    }</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa74a40af6a4a23b6ae3d38c842044dba0">AP_Vehicle::FixedWing::FLIGHT_VTOL</a>) {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> &lt; <a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a> * 0.9<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) &amp;&amp;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            (<a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> &gt;= <a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> * 0.95<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) &amp;&amp;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            !<a class="code" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code" href="classAP__Landing.html#a5ff74bf65eb1a4083cc783af22276828">is_flaring</a>()) ||</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            ((<a class="code" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a> &lt; <a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a>) &amp;&amp; <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a>))</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> &lt; <a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a> * 0.9<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            <span class="comment">// reset start time as we are still underspeed</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            <a class="code" href="classAP__TECS.html#aa7b382d5c5f219be2fe639173654fbda">_underspeed_start_ms</a> = <a class="code" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="comment">// this clears underspeed if we reach our demanded height and</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="comment">// we are either below 95% throttle or we above 90% of min</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="comment">// airspeed</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    }</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;}</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno"><a class="line" href="classAP__TECS.html#acf4aed1a469a3bce5d1f68ee8a73fed6">  552</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__TECS.html#acf4aed1a469a3bce5d1f68ee8a73fed6">AP_TECS::_update_energies</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;{</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="comment">// Calculate specific energy demands</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <a class="code" href="classAP__TECS.html#ae23c577644577aaabc247ea3c42da36a">_SPE_dem</a> = <a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a> * <a class="code" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="classAP__TECS.html#aeebe79e85106c8096f2902bad5478cc5">_SKE_dem</a> = 0.5f * <a class="code" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a> * <a class="code" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">// Calculate specific energy rate demands</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <a class="code" href="classAP__TECS.html#aceeb5b086fc333e84f45afea2a9fbe0c">_SPEdot_dem</a> = <a class="code" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a> * <a class="code" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <a class="code" href="classAP__TECS.html#a002c46ae3fbbd31dd4e110d13dfb9c08">_SKEdot_dem</a> = <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> * <a class="code" href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">_TAS_rate_dem</a>;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="comment">// Calculate specific energy</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="classAP__TECS.html#ac4c57b27adc7dc7e2edc7bcfc3e59de0">_SPE_est</a> = <a class="code" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a> * <a class="code" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <a class="code" href="classAP__TECS.html#a8cf182de07003d0734293f16cb554cae">_SKE_est</a> = 0.5f * <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> * <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="comment">// Calculate specific energy rate</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <a class="code" href="classAP__TECS.html#ae8327f2367078272adce7f8f25c605f4">_SPEdot</a> = <a class="code" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a> * <a class="code" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <a class="code" href="classAP__TECS.html#a41c98d353390a6bb386e5596c5d5a843">_SKEdot</a> = <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> * <a class="code" href="classAP__TECS.html#a4da8b5a68fcf0769d2200f4038ddebd8">_vel_dot</a>;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;}</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">  current time constant. It is lower in landing to try to give a precise approach</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00575"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">  575</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">AP_TECS::timeConstant</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a>) {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#aa6b37a801da411b61ba0a9fee93940cb">_landTimeConst</a> &lt; 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <span class="keywordflow">return</span> 0.1f;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classAP__TECS.html#aa6b37a801da411b61ba0a9fee93940cb">_landTimeConst</a>;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a372aa3467ce5ffef5b34a1046f6c1392">_timeConst</a> &lt; 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">return</span> 0.1f;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classAP__TECS.html#a372aa3467ce5ffef5b34a1046f6c1392">_timeConst</a>;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;}</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">  calculate throttle demand - airspeed enabled case</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00592"></a><span class="lineno"><a class="line" href="classAP__TECS.html#ab8413b71612f09140b6ce14120ca740b">  592</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__TECS.html#ab8413b71612f09140b6ce14120ca740b">AP_TECS::_update_throttle_with_airspeed</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;{</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="comment">// Calculate limits to be applied to potential energy error to prevent over or underspeed occurring due to large height errors</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordtype">float</span> SPE_err_max = 0.5f * <a class="code" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a> * <a class="code" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a> - <a class="code" href="classAP__TECS.html#aeebe79e85106c8096f2902bad5478cc5">_SKE_dem</a>;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keywordtype">float</span> SPE_err_min = 0.5f * <a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a> * <a class="code" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a> - <a class="code" href="classAP__TECS.html#aeebe79e85106c8096f2902bad5478cc5">_SKE_dem</a>;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa74a40af6a4a23b6ae3d38c842044dba0">AP_Vehicle::FixedWing::FLIGHT_VTOL</a>) {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">          when we are in a VTOL state then we ignore potential energy</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">          errors as we have vertical motors that interfere with the</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">          total energy calculation.</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        SPE_err_max = SPE_err_min = 0;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    </div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="comment">// Calculate total energy error</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <a class="code" href="classAP__TECS.html#abcf8efaf10d02b61998c9fbdc4b83d0b">_STE_error</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>((<a class="code" href="classAP__TECS.html#ae23c577644577aaabc247ea3c42da36a">_SPE_dem</a> - <a class="code" href="classAP__TECS.html#ac4c57b27adc7dc7e2edc7bcfc3e59de0">_SPE_est</a>), SPE_err_min, SPE_err_max) + <a class="code" href="classAP__TECS.html#aeebe79e85106c8096f2902bad5478cc5">_SKE_dem</a> - <a class="code" href="classAP__TECS.html#a8cf182de07003d0734293f16cb554cae">_SKE_est</a>;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordtype">float</span> STEdot_dem = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>((<a class="code" href="classAP__TECS.html#aceeb5b086fc333e84f45afea2a9fbe0c">_SPEdot_dem</a> + <a class="code" href="classAP__TECS.html#a002c46ae3fbbd31dd4e110d13dfb9c08">_SKEdot_dem</a>), <a class="code" href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">_STEdot_min</a>, <a class="code" href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">_STEdot_max</a>);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordtype">float</span> STEdot_error = STEdot_dem - <a class="code" href="classAP__TECS.html#ae8327f2367078272adce7f8f25c605f4">_SPEdot</a> - <a class="code" href="classAP__TECS.html#a41c98d353390a6bb386e5596c5d5a843">_SKEdot</a>;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="comment">// Apply 0.5 second first order filter to STEdot_error</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="comment">// This is required to remove accelerometer noise from the  measurement</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    STEdot_error = 0.2f*STEdot_error + 0.8f*<a class="code" href="classAP__TECS.html#a1a3a014f36ba7b9fe2cc3d9c4cb75777">_STEdotErrLast</a>;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <a class="code" href="classAP__TECS.html#a1a3a014f36ba7b9fe2cc3d9c4cb75777">_STEdotErrLast</a> = STEdot_error;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="comment">// Calculate throttle demand</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="comment">// If underspeed condition is set, then demand full throttle</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a>)</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    {</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = 1.0f;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    }</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    {</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="comment">// Calculate gain scaler from specific energy error to throttle</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="comment">// (_STEdot_max - _STEdot_min) / (_THRmaxf - _THRminf) is the derivative of STEdot wrt throttle measured across the max allowed throttle range.</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <span class="keywordtype">float</span> K_STE2Thr = 1 / (<a class="code" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">timeConstant</a>() * (<a class="code" href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">_STEdot_max</a> - <a class="code" href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">_STEdot_min</a>) / (<a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - <a class="code" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>));</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="comment">// Calculate feed-forward throttle</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordtype">float</span> ff_throttle = 0;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="keywordtype">float</span> nomThr = <a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a9aa0578c8a97b6bb874e5a01c2dc2c7d">throttle_cruise</a> * 0.01f;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keyword">const</span> <a class="code" href="classMatrix3.html">Matrix3f</a> &amp;rotMat = <a class="code" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a8a1988bb283c488c86b329be18271fbf">get_rotation_body_to_ned</a>();</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="comment">// Use the demanded rate of change of total energy as the feed-forward demand, but add</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="comment">// additional component which scales with (1/cos(bank angle) - 1) to compensate for induced</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="comment">// drag increase during turns.</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordtype">float</span> cosPhi = sqrtf((rotMat.<a class="code" href="classMatrix3.html#acd7bf3421047fa155168a9c8e5164a2b">a</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>*rotMat.<a class="code" href="classMatrix3.html#acd7bf3421047fa155168a9c8e5164a2b">a</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>) + (rotMat.<a class="code" href="classMatrix3.html#ae16bed039ad87c3337f15837c33fe2fb">b</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>*rotMat.<a class="code" href="classMatrix3.html#ae16bed039ad87c3337f15837c33fe2fb">b</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>));</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        STEdot_dem = STEdot_dem + <a class="code" href="classAP__TECS.html#aabf43104f81a4de93b6b21dff03fce37">_rollComp</a> * (1.0f/<a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(cosPhi * cosPhi , 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) - 1.0f);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        ff_throttle = nomThr + STEdot_dem / (<a class="code" href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">_STEdot_max</a> - <a class="code" href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">_STEdot_min</a>) * (<a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - <a class="code" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>);</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <span class="comment">// Calculate PD + FF throttle</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="keywordtype">float</span> throttle_damp = <a class="code" href="classAP__TECS.html#a1a46eb22cdadf76b7fab1cbc307e6d81">_thrDamp</a>;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a> &amp;&amp; !<a class="code" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(<a class="code" href="classAP__TECS.html#a620dd7d52dc60fd6914dbd7d98e1b9cd">_land_throttle_damp</a>)) {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            throttle_damp = <a class="code" href="classAP__TECS.html#a620dd7d52dc60fd6914dbd7d98e1b9cd">_land_throttle_damp</a>;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        }</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = (<a class="code" href="classAP__TECS.html#abcf8efaf10d02b61998c9fbdc4b83d0b">_STE_error</a> + STEdot_error * throttle_damp) * K_STE2Thr + ff_throttle;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="comment">// Constrain throttle demand</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a>, <a class="code" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>, <a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a>);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="keywordtype">float</span> THRminf_clipped_to_zero = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>, 0, <a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a>);</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="comment">// Rate limit PD + FF throttle</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <span class="comment">// Calculate the throttle increment from the specified slew time</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#ac1ac1710d4fcc246fb070eda0ec873ef">throttle_slewrate</a> != 0) {</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <span class="keywordtype">float</span> thrRateIncr = <a class="code" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> * (<a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - THRminf_clipped_to_zero) * <a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#ac1ac1710d4fcc246fb070eda0ec873ef">throttle_slewrate</a> * 0.01f;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a>,</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                                            <a class="code" href="classAP__TECS.html#ab09e31937002d75d0bb3c2b487cd6351">_last_throttle_dem</a> - thrRateIncr,</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                                            <a class="code" href="classAP__TECS.html#ab09e31937002d75d0bb3c2b487cd6351">_last_throttle_dem</a> + thrRateIncr);</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            <a class="code" href="classAP__TECS.html#ab09e31937002d75d0bb3c2b487cd6351">_last_throttle_dem</a> = <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a>;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <span class="comment">// Calculate integrator state upper and lower limits</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="comment">// Set to a value that will allow 0.1 (10%) throttle saturation to allow for noise on the demand</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="comment">// Additionally constrain the integrator state amplitude so that the integrator comes off limits faster.</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="keywordtype">float</span> maxAmp = 0.5f*(<a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - THRminf_clipped_to_zero);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordtype">float</span> integ_max = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>((<a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> + 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),-maxAmp,maxAmp);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="keywordtype">float</span> integ_min = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>((<a class="code" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a> - <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> - 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),-maxAmp,maxAmp);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="comment">// Calculate integrator state, constraining state</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="comment">// Set integrator to a max throttle value during climbout</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <a class="code" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a> = <a class="code" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a> + (<a class="code" href="classAP__TECS.html#abcf8efaf10d02b61998c9fbdc4b83d0b">_STE_error</a> * <a class="code" href="classAP__TECS.html#a95645382d976d27216d75bf47a623d32">_get_i_gain</a>()) * <a class="code" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> * K_STE2Thr;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8ed28908fa8b9c9aa4d6a3b4145fce39">AP_Vehicle::FixedWing::FLIGHT_TAKEOFF</a> || <a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8e59dbdfb0a9e837f6b86e4aea4a1c1f">AP_Vehicle::FixedWing::FLIGHT_ABORT_LAND</a>)</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        {</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a83fb08f23acbfcfae39d614c5030eb78">reached_speed_takeoff</a>) {</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                <span class="comment">// ensure we run at full throttle until we reach the target airspeed</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = <a class="code" href="AP__Math_8h.html#a5abc8871f1e7781a55afe9bf299f0a39">MAX</a>(<a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a>, <a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - <a class="code" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a>);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            }</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            <a class="code" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a> = integ_max;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        {</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <a class="code" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a>, integ_min, integ_max);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        }</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="comment">// Sum the components.</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> + <a class="code" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a>;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="comment">// Constrain throttle demand</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a>, <a class="code" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>, <a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a>);</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;}</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a95645382d976d27216d75bf47a623d32">  694</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classAP__TECS.html#a95645382d976d27216d75bf47a623d32">AP_TECS::_get_i_gain</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;{</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keywordtype">float</span> i_gain = <a class="code" href="classAP__TECS.html#a03df83679af5e791ca881cfe7bb1a024">_integGain</a>;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8ed28908fa8b9c9aa4d6a3b4145fce39">AP_Vehicle::FixedWing::FLIGHT_TAKEOFF</a> || <a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8e59dbdfb0a9e837f6b86e4aea4a1c1f">AP_Vehicle::FixedWing::FLIGHT_ABORT_LAND</a>) {</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(<a class="code" href="classAP__TECS.html#af345f0190f5c67d2b0bfb46613e4893d">_integGain_takeoff</a>)) {</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            i_gain = <a class="code" href="classAP__TECS.html#af345f0190f5c67d2b0bfb46613e4893d">_integGain_takeoff</a>;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        }</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a>) {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(<a class="code" href="classAP__TECS.html#a6bc6c5cdb2dbeae5abe4091f50646fde">_integGain_land</a>)) {</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            i_gain = <a class="code" href="classAP__TECS.html#a6bc6c5cdb2dbeae5abe4091f50646fde">_integGain_land</a>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        }</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keywordflow">return</span> i_gain;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;}</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">  calculate throttle, non-airspeed case</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00712"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a758b6923067d18f52a0157f0e1af7737">  712</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__TECS.html#a758b6923067d18f52a0157f0e1af7737">AP_TECS::_update_throttle_without_airspeed</a>(int16_t throttle_nudge)</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;{</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="comment">// Calculate throttle demand by interpolating between pitch and throttle limits</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordtype">float</span> nomThr;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="comment">//If landing and we don&#39;t have an airspeed sensor and we have a non-zero</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="comment">//TECS_LAND_THR param then use it</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a> &amp;&amp; <a class="code" href="classAP__TECS.html#a08f575ea9d3b0a609fc3c359335c5d4a">_landThrottle</a> &gt;= 0) {</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        nomThr = (<a class="code" href="classAP__TECS.html#a08f575ea9d3b0a609fc3c359335c5d4a">_landThrottle</a> + throttle_nudge) * 0.01<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">//not landing or not using TECS_LAND_THR parameter</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        nomThr = (<a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a9aa0578c8a97b6bb874e5a01c2dc2c7d">throttle_cruise</a> + throttle_nudge)* 0.01<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    }</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> &amp;&amp; <a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = nomThr + (<a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - nomThr) * <a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> / <a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    }</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> &lt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a> &amp;&amp; <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> &lt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    {</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = nomThr + (<a class="code" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a> - nomThr) * <a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> / <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    }</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = nomThr;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    }</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="comment">// Calculate additional throttle for turn drag compensation including throttle nudging</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="keyword">const</span> <a class="code" href="classMatrix3.html">Matrix3f</a> &amp;rotMat = <a class="code" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a8a1988bb283c488c86b329be18271fbf">get_rotation_body_to_ned</a>();</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="comment">// Use the demanded rate of change of total energy as the feed-forward demand, but add</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="comment">// additional component which scales with (1/cos(bank angle) - 1) to compensate for induced</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="comment">// drag increase during turns.</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keywordtype">float</span> cosPhi = sqrtf((rotMat.<a class="code" href="classMatrix3.html#acd7bf3421047fa155168a9c8e5164a2b">a</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>*rotMat.<a class="code" href="classMatrix3.html#acd7bf3421047fa155168a9c8e5164a2b">a</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>) + (rotMat.<a class="code" href="classMatrix3.html#ae16bed039ad87c3337f15837c33fe2fb">b</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>*rotMat.<a class="code" href="classMatrix3.html#ae16bed039ad87c3337f15837c33fe2fb">b</a>.<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>));</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="keywordtype">float</span> STEdot_dem = <a class="code" href="classAP__TECS.html#aabf43104f81a4de93b6b21dff03fce37">_rollComp</a> * (1.0f/<a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(cosPhi * cosPhi , 0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) - 1.0f);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = <a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> + STEdot_dem / (<a class="code" href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">_STEdot_max</a> - <a class="code" href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">_STEdot_min</a>) * (<a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - <a class="code" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;}</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno"><a class="line" href="classAP__TECS.html#ab5ab1cc93f631786bb0c9df8596eef44">  747</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__TECS.html#ab5ab1cc93f631786bb0c9df8596eef44">AP_TECS::_detect_bad_descent</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;{</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="comment">// Detect a demanded airspeed too high for the aircraft to achieve. This will be</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="comment">// evident by the the following conditions:</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="comment">// 1) Underspeed protection not active</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="comment">// 2) Specific total energy error &gt; 200 (greater than ~20m height error)</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="comment">// 3) Specific total energy reducing</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">// 4) throttle demand &gt; 90%</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="comment">// If these four conditions exist simultaneously, then the protection</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="comment">// mode will be activated.</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="comment">// Once active, the following condition are required to stay in the mode</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="comment">// 1) Underspeed protection not active</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="comment">// 2) Specific total energy error &gt; 0</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="comment">// This mode will produce an undulating speed and height response as it cuts in and out but will prevent the aircraft from descending into the ground if an unachievable speed demand is set</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordtype">float</span> STEdot = <a class="code" href="classAP__TECS.html#ae8327f2367078272adce7f8f25c605f4">_SPEdot</a> + <a class="code" href="classAP__TECS.html#a41c98d353390a6bb386e5596c5d5a843">_SKEdot</a>;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">if</span> ((!<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> &amp;&amp; (<a class="code" href="classAP__TECS.html#abcf8efaf10d02b61998c9fbdc4b83d0b">_STE_error</a> &gt; 200.0f) &amp;&amp; (STEdot &lt; 0.0f) &amp;&amp; (<a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> &gt;= <a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> * 0.9f)) || (<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a> &amp;&amp; !<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> &amp;&amp; (<a class="code" href="classAP__TECS.html#abcf8efaf10d02b61998c9fbdc4b83d0b">_STE_error</a> &gt; 0.0f)))</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    {</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    }</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    }</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;}</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;</div><div class="line"><a name="l00772"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a7854ecaf0d95d9da406568583f6e287f">  772</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__TECS.html#a7854ecaf0d95d9da406568583f6e287f">AP_TECS::_update_pitch</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;{</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="comment">// Calculate Speed/Height Control Weighting</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="comment">// This is used to determine how the pitch control prioritises speed and height control</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="comment">// A weighting of 1 provides equal priority (this is the normal mode of operation)</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="comment">// A SKE_weighting of 0 provides 100% priority to height control. This is used when no airspeed measurement is available</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="comment">// A SKE_weighting of 2 provides 100% priority to speed control. This is used when an underspeed condition is detected. In this instance, if airspeed</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="comment">// rises above the demanded value, the pitch angle will be increased by the TECS controller.</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classAP__TECS.html#a8beca0265536eb28905f01223c0fe9aa">SKE_weighting</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#af56a4ac86036ce9aad7063d5838eff6d">_spdWeight</a>, 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 2.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a47ea335b3b317f0c5e54320f59d5ca8a">airspeed_sensor_enabled</a>()) {</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <a class="code" href="classAP__TECS.html#a8beca0265536eb28905f01223c0fe9aa">SKE_weighting</a> = 0.0f;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa74a40af6a4a23b6ae3d38c842044dba0">AP_Vehicle::FixedWing::FLIGHT_VTOL</a>) {</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="comment">// if we are in VTOL mode then control pitch without regard to</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <span class="comment">// speed. Speed is also taken care of independently of</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="comment">// height. This is needed as the usual relationship of speed</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="comment">// and height is broken by the VTOL motors</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <a class="code" href="classAP__TECS.html#a8beca0265536eb28905f01223c0fe9aa">SKE_weighting</a> = 0.0f;        </div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> || <a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8ed28908fa8b9c9aa4d6a3b4145fce39">AP_Vehicle::FixedWing::FLIGHT_TAKEOFF</a> || <a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8e59dbdfb0a9e837f6b86e4aea4a1c1f">AP_Vehicle::FixedWing::FLIGHT_ABORT_LAND</a>) {</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <a class="code" href="classAP__TECS.html#a8beca0265536eb28905f01223c0fe9aa">SKE_weighting</a> = 2.0f;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a>) {</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ae160176b8170eb74b19b37db1413c70c">_spdWeightLand</a> &lt; 0) {</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            <span class="comment">// use sliding scale from normal weight down to zero at landing</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            <span class="keywordtype">float</span> scaled_weight = <a class="code" href="classAP__TECS.html#af56a4ac86036ce9aad7063d5838eff6d">_spdWeight</a> * (1.0f - <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#ac94ec1f860105c16d714eeb2f62fade7">_path_proportion</a>,0,1));</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            <a class="code" href="classAP__TECS.html#a8beca0265536eb28905f01223c0fe9aa">SKE_weighting</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(scaled_weight, 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 2.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            <a class="code" href="classAP__TECS.html#a8beca0265536eb28905f01223c0fe9aa">SKE_weighting</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#ae160176b8170eb74b19b37db1413c70c">_spdWeightLand</a>, 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, 2.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        }</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    }</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <a class="code" href="classAP__TECS.html#a4dccc15d0ea23bded1c8a48aa1591f8e">logging</a>.SKE_weighting = <a class="code" href="classAP__TECS.html#a8beca0265536eb28905f01223c0fe9aa">SKE_weighting</a>;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    </div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordtype">float</span> SPE_weighting = 2.0f - <a class="code" href="classAP__TECS.html#a8beca0265536eb28905f01223c0fe9aa">SKE_weighting</a>;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="comment">// Calculate Specific Energy Balance demand, and error</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordtype">float</span> SEB_dem      = <a class="code" href="classAP__TECS.html#ae23c577644577aaabc247ea3c42da36a">_SPE_dem</a> * SPE_weighting - <a class="code" href="classAP__TECS.html#aeebe79e85106c8096f2902bad5478cc5">_SKE_dem</a> * <a class="code" href="classAP__TECS.html#a8beca0265536eb28905f01223c0fe9aa">SKE_weighting</a>;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordtype">float</span> SEBdot_dem   = <a class="code" href="classAP__TECS.html#aceeb5b086fc333e84f45afea2a9fbe0c">_SPEdot_dem</a> * SPE_weighting - <a class="code" href="classAP__TECS.html#a002c46ae3fbbd31dd4e110d13dfb9c08">_SKEdot_dem</a> * <a class="code" href="classAP__TECS.html#a8beca0265536eb28905f01223c0fe9aa">SKE_weighting</a>;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordtype">float</span> SEB_error    = SEB_dem - (<a class="code" href="classAP__TECS.html#ac4c57b27adc7dc7e2edc7bcfc3e59de0">_SPE_est</a> * SPE_weighting - <a class="code" href="classAP__TECS.html#a8cf182de07003d0734293f16cb554cae">_SKE_est</a> * <a class="code" href="classAP__TECS.html#a8beca0265536eb28905f01223c0fe9aa">SKE_weighting</a>);</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordtype">float</span> SEBdot_error = SEBdot_dem - (<a class="code" href="classAP__TECS.html#ae8327f2367078272adce7f8f25c605f4">_SPEdot</a> * SPE_weighting - <a class="code" href="classAP__TECS.html#a41c98d353390a6bb386e5596c5d5a843">_SKEdot</a> * <a class="code" href="classAP__TECS.html#a8beca0265536eb28905f01223c0fe9aa">SKE_weighting</a>);</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <a class="code" href="classAP__TECS.html#a4dccc15d0ea23bded1c8a48aa1591f8e">logging</a>.SKE_error = <a class="code" href="classAP__TECS.html#aeebe79e85106c8096f2902bad5478cc5">_SKE_dem</a> - <a class="code" href="classAP__TECS.html#a8cf182de07003d0734293f16cb554cae">_SKE_est</a>;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <a class="code" href="classAP__TECS.html#a4dccc15d0ea23bded1c8a48aa1591f8e">logging</a>.SPE_error = <a class="code" href="classAP__TECS.html#ae23c577644577aaabc247ea3c42da36a">_SPE_dem</a> - <a class="code" href="classAP__TECS.html#ac4c57b27adc7dc7e2edc7bcfc3e59de0">_SPE_est</a>;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    </div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="comment">// Calculate integrator state, constraining input if pitch limits are exceeded</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordtype">float</span> integSEB_input = SEB_error * <a class="code" href="classAP__TECS.html#a95645382d976d27216d75bf47a623d32">_get_i_gain</a>();</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> &gt; <a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>)</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    {</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        integSEB_input = <a class="code" href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a>(integSEB_input, <a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> - <a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a>);</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    }</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> &lt; <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>)</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    {</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        integSEB_input = <a class="code" href="AP__Math_8h.html#a5abc8871f1e7781a55afe9bf299f0a39">MAX</a>(integSEB_input, <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> - <a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a>);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    }</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordtype">float</span> integSEB_delta = integSEB_input * <a class="code" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code" href="classAP__Landing.html#a5ff74bf65eb1a4083cc783af22276828">is_flaring</a>() &amp;&amp; fabsf(<a class="code" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a>) &gt; 0.2f) {</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <a class="code" href="stdio_8h.html#a55f3d956bb2ba20b5059e9e25484a47f">::printf</a>(<span class="stringliteral">&quot;_hgt_rate_dem=%.1f _hgt_dem_adj=%.1f climb=%.1f _flare_counter=%u _pitch_dem=%.1f SEB_dem=%.2f SEBdot_dem=%.2f SEB_error=%.2f SEBdot_error=%.2f\n&quot;</span>,</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                 <a class="code" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a>, <a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a>, <a class="code" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a>, <a class="code" href="classAP__TECS.html#a75a17f39fa8b643cc3352f8bbf3fec90">_flare_counter</a>, <a class="code" href="moduletest_8c.html#a903c4797a4c2860e3b9a6a978f98a44d">degrees</a>(<a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a>),</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                 SEB_dem, SEBdot_dem, SEB_error, SEBdot_error);</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    }</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="comment">// Apply max and min values for integrator state that will allow for no more than</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="comment">// 5deg of saturation. This allows for some pitch variation due to gusts before the</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="comment">// integrator is clipped. Otherwise the effectiveness of the integrator will be reduced in turbulence</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="comment">// During climbout/takeoff, bias the demanded pitch angle so that zero speed error produces a pitch angle</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="comment">// demand equal to the minimum value (which is )set by the mission plan during this mode). Otherwise the</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="comment">// integrator has to catch up before the nose can be raised to reduce speed during climbout.</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="comment">// During flare a different damping gain is used</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordtype">float</span> gainInv = (<a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> * <a class="code" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">timeConstant</a>() * <a class="code" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>);</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keywordtype">float</span> temp = SEB_error + SEBdot_dem * <a class="code" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">timeConstant</a>();</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keywordtype">float</span> pitch_damp = <a class="code" href="classAP__TECS.html#a425d214dcedbca7ea37929cc32eaf58c">_ptchDamp</a>;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code" href="classAP__Landing.html#a5ff74bf65eb1a4083cc783af22276828">is_flaring</a>()) {</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        pitch_damp = <a class="code" href="classAP__TECS.html#a9f94dc1aaf643448d9f0f056bb10137c">_landDamp</a>;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(<a class="code" href="classAP__TECS.html#ac4ef736b39412013b47c62b8fbd65668">_land_pitch_damp</a>) &amp;&amp; <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a>) {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        pitch_damp = <a class="code" href="classAP__TECS.html#ac4ef736b39412013b47c62b8fbd65668">_land_pitch_damp</a>;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    }</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    temp += SEBdot_error * pitch_damp;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8ed28908fa8b9c9aa4d6a3b4145fce39">AP_Vehicle::FixedWing::FLIGHT_TAKEOFF</a> || <a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8e59dbdfb0a9e837f6b86e4aea4a1c1f">AP_Vehicle::FixedWing::FLIGHT_ABORT_LAND</a>) {</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        temp += <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> * gainInv;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    }</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordtype">float</span> integSEB_min = (gainInv * (<a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> - 0.0783f)) - temp;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="keywordtype">float</span> integSEB_max = (gainInv * (<a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> + 0.0783f)) - temp;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordtype">float</span> integSEB_range = integSEB_max - integSEB_min;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <a class="code" href="classAP__TECS.html#a4dccc15d0ea23bded1c8a48aa1591f8e">logging</a>.SEB_delta = integSEB_delta;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    </div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="comment">// don&#39;t allow the integrator to rise by more than 20% of its full</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="comment">// range in one step. This prevents single value glitches from</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="comment">// causing massive integrator changes. See Issue#4066</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    integSEB_delta = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(integSEB_delta, -integSEB_range*0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, integSEB_range*0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <span class="comment">// prevent the constraint on pitch integrator _integSEB_state from</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="comment">// itself injecting step changes in the variable. We only want the</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="comment">// constraint to prevent large changes due to integSEB_delta, not</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="comment">// to cause step changes due to a change in the constrain</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="comment">// limits. Large steps in _integSEB_state can cause long term</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="comment">// pitch changes</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    integSEB_min = <a class="code" href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a>(integSEB_min, <a class="code" href="classAP__TECS.html#a161190aceb1f074b27be3c46607a9220">_integSEB_state</a>);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    integSEB_max = <a class="code" href="AP__Math_8h.html#a5abc8871f1e7781a55afe9bf299f0a39">MAX</a>(integSEB_max, <a class="code" href="classAP__TECS.html#a161190aceb1f074b27be3c46607a9220">_integSEB_state</a>);</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="comment">// integrate</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <a class="code" href="classAP__TECS.html#a161190aceb1f074b27be3c46607a9220">_integSEB_state</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#a161190aceb1f074b27be3c46607a9220">_integSEB_state</a> + integSEB_delta, integSEB_min, integSEB_max);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="comment">// Calculate pitch demand from specific energy balance signals</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <a class="code" href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">_pitch_dem_unc</a> = (temp + <a class="code" href="classAP__TECS.html#a161190aceb1f074b27be3c46607a9220">_integSEB_state</a>) / gainInv;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="comment">// Constrain pitch demand</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">_pitch_dem_unc</a>, <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>, <a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="comment">// Rate limit the pitch demand to comply with specified vertical</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="comment">// acceleration limit</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keywordtype">float</span> ptchRateIncr = <a class="code" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> * <a class="code" href="classAP__TECS.html#aea6abce622dc2d63d55351a2bc4a03de">_vertAccLim</a> / <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> - <a class="code" href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">_last_pitch_dem</a>) &gt; ptchRateIncr)</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    {</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> = <a class="code" href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">_last_pitch_dem</a> + ptchRateIncr;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    }</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> - <a class="code" href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">_last_pitch_dem</a>) &lt; -ptchRateIncr)</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    {</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> = <a class="code" href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">_last_pitch_dem</a> - ptchRateIncr;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    }</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="comment">// re-constrain pitch demand</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a>, <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>, <a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>);</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <a class="code" href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">_last_pitch_dem</a> = <a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a>;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;}</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a2ecab25bceacdfb0c15694ff8428608f">  904</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__TECS.html#a2ecab25bceacdfb0c15694ff8428608f">AP_TECS::_initialise_states</a>(int32_t ptchMinCO_cd, <span class="keywordtype">float</span> hgt_afe)</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;{</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="comment">// Initialise states and variables if DT &gt; 1 second or in climbout</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> &gt; 1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>)</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    {</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <a class="code" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a>      = 0.0f;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <a class="code" href="classAP__TECS.html#a161190aceb1f074b27be3c46607a9220">_integSEB_state</a>      = 0.0f;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <a class="code" href="classAP__TECS.html#ab09e31937002d75d0bb3c2b487cd6351">_last_throttle_dem</a> = <a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a9aa0578c8a97b6bb874e5a01c2dc2c7d">throttle_cruise</a> * 0.01f;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <a class="code" href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">_last_pitch_dem</a>    = <a class="code" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a2aa61744614d8e0ef64803583359a56e">pitch</a>;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <a class="code" href="classAP__TECS.html#a344eb89d0ffbaf1ec9c06044451f56f2">_hgt_dem_adj_last</a>  = hgt_afe;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a>       = <a class="code" href="classAP__TECS.html#a344eb89d0ffbaf1ec9c06044451f56f2">_hgt_dem_adj_last</a>;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <a class="code" href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">_hgt_dem_prev</a>      = <a class="code" href="classAP__TECS.html#a344eb89d0ffbaf1ec9c06044451f56f2">_hgt_dem_adj_last</a>;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <a class="code" href="classAP__TECS.html#a960b22fb125a25cb7ad6d63438e14622">_hgt_dem_in_old</a>    = <a class="code" href="classAP__TECS.html#a344eb89d0ffbaf1ec9c06044451f56f2">_hgt_dem_adj_last</a>;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <a class="code" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>       = <a class="code" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a>;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a>        = <span class="keyword">false</span>;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a>        = <span class="keyword">false</span>;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a83fb08f23acbfcfae39d614c5030eb78">reached_speed_takeoff</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        <a class="code" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>                = 0.1f; <span class="comment">// when first starting TECS, use a</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="comment">// small time constant</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    }</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8ed28908fa8b9c9aa4d6a3b4145fce39">AP_Vehicle::FixedWing::FLIGHT_TAKEOFF</a> || <a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8e59dbdfb0a9e837f6b86e4aea4a1c1f">AP_Vehicle::FixedWing::FLIGHT_ABORT_LAND</a>)</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    {</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>          = 0.000174533f * ptchMinCO_cd;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <a class="code" href="classAP__TECS.html#a344eb89d0ffbaf1ec9c06044451f56f2">_hgt_dem_adj_last</a>  = hgt_afe;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a>       = <a class="code" href="classAP__TECS.html#a344eb89d0ffbaf1ec9c06044451f56f2">_hgt_dem_adj_last</a>;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <a class="code" href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">_hgt_dem_prev</a>      = <a class="code" href="classAP__TECS.html#a344eb89d0ffbaf1ec9c06044451f56f2">_hgt_dem_adj_last</a>;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        <a class="code" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>       = <a class="code" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a>;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a>        = <span class="keyword">false</span>;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a>  = <span class="keyword">false</span>;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    }</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    </div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> != <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8ed28908fa8b9c9aa4d6a3b4145fce39">AP_Vehicle::FixedWing::FLIGHT_TAKEOFF</a> &amp;&amp; <a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> != <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8e59dbdfb0a9e837f6b86e4aea4a1c1f">AP_Vehicle::FixedWing::FLIGHT_ABORT_LAND</a>) {</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        <span class="comment">// reset takeoff speed flag when not in takeoff</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a83fb08f23acbfcfae39d614c5030eb78">reached_speed_takeoff</a> = <span class="keyword">false</span>;        </div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    }</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;}</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div><div class="line"><a name="l00941"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a6eab6d44faa6a51fbdd7a59279e17035">  941</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__TECS.html#a6eab6d44faa6a51fbdd7a59279e17035">AP_TECS::_update_STE_rate_lim</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;{</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="comment">// Calculate Specific Total Energy Rate Limits</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="comment">// This is a trivial calculation at the moment but will get bigger once we start adding altitude effects</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <a class="code" href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">_STEdot_max</a> = <a class="code" href="classAP__TECS.html#aea68f106f8f04f199c8470e52532e6a5">_maxClimbRate</a> * <a class="code" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <a class="code" href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">_STEdot_min</a> = - <a class="code" href="classAP__TECS.html#ac5836e7e185100808a4bb2ba8c18e8b5">_minSinkRate</a> * <a class="code" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;}</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno"><a class="line" href="classAP__TECS.html#aa8bb2218960edb71526d380f752b411e">  950</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__TECS.html#aa8bb2218960edb71526d380f752b411e">AP_TECS::update_pitch_throttle</a>(int32_t hgt_dem_cm,</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                                    int32_t EAS_dem_cm,</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                                    <span class="keyword">enum</span> <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5f">AP_Vehicle::FixedWing::FlightStage</a> flight_stage,</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                                    <span class="keywordtype">float</span> distance_beyond_land_wp,</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                                    int32_t ptchMinCO_cd,</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                                    int16_t throttle_nudge,</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                                    <span class="keywordtype">float</span> hgt_afe,</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                                    <span class="keywordtype">float</span> load_factor,</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                                    <span class="keywordtype">bool</span> soaring_active)</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;{</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="comment">// Calculate time in seconds since last update</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    uint64_t now = <a class="code" href="namespaceAP__HAL.html#a7aa0ce7625c9680e30ff4a99940907a5">AP_HAL::micros64</a>();</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <a class="code" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> = (now - <a class="code" href="classAP__TECS.html#a8db124836a733bfcee48843fb0ff28db">_update_pitch_throttle_last_usec</a>) * 1.0e-6<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <a class="code" href="classAP__TECS.html#a8db124836a733bfcee48843fb0ff28db">_update_pitch_throttle_last_usec</a> = now;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a> = (flight_stage == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fad1825ed29ce7997edb9a9222e70fd8ad">AP_Vehicle::FixedWing::FLIGHT_LAND</a>);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <a class="code" href="classAP__TECS.html#a4dc0dac47faf337837f8c47c21494d67">_distance_beyond_land_wp</a> = distance_beyond_land_wp;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> = flight_stage;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="comment">// Convert inputs</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <a class="code" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> = hgt_dem_cm * 0.01f;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <a class="code" href="classAP__TECS.html#ae52e17111e872c29d269209efb7d5989">_EAS_dem</a> = EAS_dem_cm * 0.01f;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="comment">// Update the speed estimate using a 2nd order complementary filter</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <a class="code" href="classAP__TECS.html#ac3a90f55264799a5482b76abfe5b9a68">_update_speed</a>(load_factor);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a4a9f5384cb498939d92a930436e43e12">takeoff_throttle_max</a> != 0 &amp;&amp;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            (<a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8ed28908fa8b9c9aa4d6a3b4145fce39">AP_Vehicle::FixedWing::FLIGHT_TAKEOFF</a> || <a class="code" href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">_flight_stage</a> == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8e59dbdfb0a9e837f6b86e4aea4a1c1f">AP_Vehicle::FixedWing::FLIGHT_ABORT_LAND</a>)) {</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        <a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a>  = <a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a4a9f5384cb498939d92a930436e43e12">takeoff_throttle_max</a> * 0.01f;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        <a class="code" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a>  = <a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a45cdd563349ec5d4e135fed322b379b3">throttle_max</a> * 0.01f;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    }</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <a class="code" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>  = <a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a849296d0681be75aa7002fbb5edc5963">throttle_min</a> * 0.01f;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="comment">// work out the maximum and minimum pitch</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="comment">// if TECS_PITCH_{MAX,MIN} isn&#39;t set then use</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="comment">// LIM_PITCH_{MAX,MIN}. Don&#39;t allow TECS_PITCH_{MAX,MIN} to be</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="comment">// larger than LIM_PITCH_{MAX,MIN}</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a55b1f4cfa9b6cb2beb622316c0089d70">_pitch_max</a> &lt;= 0) {</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> = <a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#aeadf80d1d293b170933185bbefcf9534">pitch_limit_max_cd</a> * 0.01f;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> = <a class="code" href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a>(<a class="code" href="classAP__TECS.html#a55b1f4cfa9b6cb2beb622316c0089d70">_pitch_max</a>, <a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#aeadf80d1d293b170933185bbefcf9534">pitch_limit_max_cd</a> * 0.01f);</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    }</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#ad483df34b0acfb5b06bb97826f6aa55f">_pitch_min</a> &gt;= 0) {</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a39cf5d851f4d3da4e4ef50953f27154a">pitch_limit_min_cd</a> * 0.01f;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code" href="AP__Math_8h.html#a5abc8871f1e7781a55afe9bf299f0a39">MAX</a>(<a class="code" href="classAP__TECS.html#ad483df34b0acfb5b06bb97826f6aa55f">_pitch_min</a>, <a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a39cf5d851f4d3da4e4ef50953f27154a">pitch_limit_min_cd</a> * 0.01f);</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    }</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="comment">// apply temporary pitch limit and clear</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#adb53c053feaac9e2b5fa7704cfd95d2c">_pitch_max_limit</a> &lt; 90) {</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>, -90, <a class="code" href="classAP__TECS.html#adb53c053feaac9e2b5fa7704cfd95d2c">_pitch_max_limit</a>);</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code" href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a>(<a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>, -<a class="code" href="classAP__TECS.html#adb53c053feaac9e2b5fa7704cfd95d2c">_pitch_max_limit</a>, <a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>);</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <a class="code" href="classAP__TECS.html#adb53c053feaac9e2b5fa7704cfd95d2c">_pitch_max_limit</a> = 90;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    }</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        </div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code" href="classAP__Landing.html#a5ff74bf65eb1a4083cc783af22276828">is_flaring</a>()) {</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <span class="comment">// in flare use min pitch from LAND_PITCH_CD</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code" href="AP__Math_8h.html#a5abc8871f1e7781a55afe9bf299f0a39">MAX</a>(<a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>, <a class="code" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code" href="classAP__Landing.html#aea63b41c71cd665c1933b83cd681e0b0">get_pitch_cd</a>() * 0.01f);</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <span class="comment">// and use max pitch from TECS_LAND_PMAX</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a0ba5d70bc0549b5226f1fe5179aba1b0">_land_pitch_max</a> != 0) {</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            <a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> = <a class="code" href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a>(<a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>, <a class="code" href="classAP__TECS.html#a0ba5d70bc0549b5226f1fe5179aba1b0">_land_pitch_max</a>);</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        }</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="comment">// and allow zero throttle</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <a class="code" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a> = 0;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code" href="classAP__Landing.html#a1429174262aa7716b6b00df8eed75e81">is_on_approach</a>() &amp;&amp; (-<a class="code" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a>) &gt; <a class="code" href="classAP__TECS.html#a8d23075cf7fd1752877a893bd689a2ab">_land_sink</a>) {</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <span class="comment">// constrain the pitch in landing as we get close to the flare</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <span class="comment">// point. Use a simple linear limit from 15 meters after the</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <span class="comment">// landing point</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        <span class="keywordtype">float</span> time_to_flare = (- hgt_afe / <a class="code" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a>) - <a class="code" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code" href="classAP__Landing.html#a0f36467307a46cb4b5558617638b7117">get_flare_sec</a>();</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <span class="keywordflow">if</span> (time_to_flare &lt; 0) {</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;            <span class="comment">// we should be flaring already</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;            <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code" href="AP__Math_8h.html#a5abc8871f1e7781a55afe9bf299f0a39">MAX</a>(<a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>, <a class="code" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code" href="classAP__Landing.html#aea63b41c71cd665c1933b83cd681e0b0">get_pitch_cd</a>() * 0.01f);</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (time_to_flare &lt; <a class="code" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">timeConstant</a>()*2) {</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;            <span class="comment">// smoothly move the min pitch to the flare min pitch over</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;            <span class="comment">// twice the time constant</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;            <span class="keywordtype">float</span> p = time_to_flare/(2*<a class="code" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">timeConstant</a>());</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            <span class="keywordtype">float</span> pitch_limit_cd = p*<a class="code" href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a39cf5d851f4d3da4e4ef50953f27154a">pitch_limit_min_cd</a> + (1-p)*<a class="code" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code" href="classAP__Landing.html#aea63b41c71cd665c1933b83cd681e0b0">get_pitch_cd</a>();</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            <a class="code" href="stdio_8h.html#a55f3d956bb2ba20b5059e9e25484a47f">::printf</a>(<span class="stringliteral">&quot;ttf=%.1f hgt_afe=%.1f _PITCHminf=%.1f pitch_limit=%.1f climb=%.1f\n&quot;</span>,</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                     time_to_flare, hgt_afe, <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>, pitch_limit_cd*0.01<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>, <a class="code" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a>);</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code" href="AP__Math_8h.html#a5abc8871f1e7781a55afe9bf299f0a39">MAX</a>(<a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>, pitch_limit_cd*0.01<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        }</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    }</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <span class="keywordflow">if</span> (flight_stage == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8ed28908fa8b9c9aa4d6a3b4145fce39">AP_Vehicle::FixedWing::FLIGHT_TAKEOFF</a> || flight_stage == <a class="code" href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8e59dbdfb0a9e837f6b86e4aea4a1c1f">AP_Vehicle::FixedWing::FLIGHT_ABORT_LAND</a>) {</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a83fb08f23acbfcfae39d614c5030eb78">reached_speed_takeoff</a> &amp;&amp; <a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> &gt;= <a class="code" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>) {</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            <span class="comment">// we have reached our target speed in takeoff, allow for</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            <span class="comment">// normal throttle control</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;            <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#a83fb08f23acbfcfae39d614c5030eb78">reached_speed_takeoff</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        }</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    }</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    </div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="comment">// convert to radians</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> = <a class="code" href="AP__Math_8h.html#a37d7c62a8231d9d22826261297b99da4">radians</a>(<a class="code" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>);</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code" href="AP__Math_8h.html#a37d7c62a8231d9d22826261297b99da4">radians</a>(<a class="code" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>);</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="comment">// initialise selected states and variables if DT &gt; 1 second or in climbout</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <a class="code" href="classAP__TECS.html#a2ecab25bceacdfb0c15694ff8428608f">_initialise_states</a>(ptchMinCO_cd, hgt_afe);</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <span class="comment">// Calculate Specific Total Energy Rate Limits</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <a class="code" href="classAP__TECS.html#a6eab6d44faa6a51fbdd7a59279e17035">_update_STE_rate_lim</a>();</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <span class="comment">// Calculate the speed demand</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <a class="code" href="classAP__TECS.html#a376593eecc4ab66559947a144106bdd5">_update_speed_demand</a>();</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="comment">// Calculate the height demand</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <a class="code" href="classAP__TECS.html#a91aeb22f68e2957bfad6285ec41182cf">_update_height_demand</a>();</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="comment">// Detect underspeed condition</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <a class="code" href="classAP__TECS.html#a7318e1b5998b99f4febe0d53040c5744">_detect_underspeed</a>();</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="comment">// Calculate specific energy quantitiues</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <a class="code" href="classAP__TECS.html#acf4aed1a469a3bce5d1f68ee8a73fed6">_update_energies</a>();</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="comment">// Calculate throttle demand - use simple pitch to throttle if no</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="comment">// airspeed sensor.</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="comment">// Note that caller can demand the use of</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="comment">// synthetic airspeed for one loop if needed. This is required</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="comment">// during QuadPlane transition when pitch is constrained</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a47ea335b3b317f0c5e54320f59d5ca8a">airspeed_sensor_enabled</a>() || <a class="code" href="classAP__TECS.html#ada65aa88ad9ecd6db58d55dd783b7a1f">_use_synthetic_airspeed</a> || <a class="code" href="classAP__TECS.html#a07f643564d913cf9020cd4a1b68f139d">_use_synthetic_airspeed_once</a>) {</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <a class="code" href="classAP__TECS.html#ab8413b71612f09140b6ce14120ca740b">_update_throttle_with_airspeed</a>();</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <a class="code" href="classAP__TECS.html#a07f643564d913cf9020cd4a1b68f139d">_use_synthetic_airspeed_once</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <a class="code" href="classAP__TECS.html#a758b6923067d18f52a0157f0e1af7737">_update_throttle_without_airspeed</a>(throttle_nudge);</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    }</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="comment">// Detect bad descent due to demanded airspeed being too high</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <a class="code" href="classAP__TECS.html#ab5ab1cc93f631786bb0c9df8596eef44">_detect_bad_descent</a>();</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="comment">// when soaring is active we never trigger a bad descent</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordflow">if</span> (soaring_active) {</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        <a class="code" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a> = <span class="keyword">false</span>;        </div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    }</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">// Calculate pitch demand</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <a class="code" href="classAP__TECS.html#a7854ecaf0d95d9da406568583f6e287f">_update_pitch</a>();</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="comment">// log to AP_Logger</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <a class="code" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().<a class="code" href="classAP__Logger.html#a320182e24dfaf50d436cf065c97169bb">Write</a>(</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        <span class="stringliteral">&quot;TECS&quot;</span>,</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        <span class="stringliteral">&quot;TimeUS,h,dh,hdem,dhdem,spdem,sp,dsp,ith,iph,th,ph,dspdem,w,f&quot;</span>,</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        <span class="stringliteral">&quot;smnmnnnn----o--&quot;</span>,</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        <span class="stringliteral">&quot;F0000000----0--&quot;</span>,</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        <span class="stringliteral">&quot;QfffffffffffffB&quot;</span>,</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        now,</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a>,</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a>,</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">_hgt_dem_adj</a>,</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a>,</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>,</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>,</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a4da8b5a68fcf0769d2200f4038ddebd8">_vel_dot</a>,</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a>,</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a161190aceb1f074b27be3c46607a9220">_integSEB_state</a>,</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a>,</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a>,</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">_TAS_rate_dem</a>,</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a4dccc15d0ea23bded1c8a48aa1591f8e">logging</a>.SKE_weighting,</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        <a class="code" href="classAP__TECS.html#af61e93b060aeade818382323b9430daa">_flags_byte</a>);</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <a class="code" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().<a class="code" href="classAP__Logger.html#a320182e24dfaf50d436cf065c97169bb">Write</a>(<span class="stringliteral">&quot;TEC2&quot;</span>, <span class="stringliteral">&quot;TimeUS,KErr,PErr,EDelta,LF&quot;</span>, <span class="stringliteral">&quot;Qffff&quot;</span>,</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                                           now,</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                                           (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a4dccc15d0ea23bded1c8a48aa1591f8e">logging</a>.SKE_error,</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                                           (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a4dccc15d0ea23bded1c8a48aa1591f8e">logging</a>.SPE_error,</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                                           (<span class="keywordtype">double</span>)<a class="code" href="classAP__TECS.html#a4dccc15d0ea23bded1c8a48aa1591f8e">logging</a>.SEB_delta,</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                                           (<span class="keywordtype">double</span>)load_factor);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;}</div><div class="ttc" id="classAP__TECS_html_aa7b382d5c5f219be2fe639173654fbda"><div class="ttname"><a href="classAP__TECS.html#aa7b382d5c5f219be2fe639173654fbda">AP_TECS::_underspeed_start_ms</a></div><div class="ttdeci">uint32_t _underspeed_start_ms</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00269">AP_TECS.h:269</a></div></div>
<div class="ttc" id="classAP__TECS_html_a2123d3693141c7bc46b31a2cecf0765f"><div class="ttname"><a href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">AP_TECS::_STEdot_min</a></div><div class="ttdeci">float _STEdot_min</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00279">AP_TECS.h:279</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_aa5eb40d64faea2d498f0e9524e321f5fa74a40af6a4a23b6ae3d38c842044dba0"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa74a40af6a4a23b6ae3d38c842044dba0">AP_Vehicle::FixedWing::FLIGHT_VTOL</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00066">AP_Vehicle.h:66</a></div></div>
<div class="ttc" id="classAP__TECS_html_ac5836e7e185100808a4bb2ba8c18e8b5"><div class="ttname"><a href="classAP__TECS.html#ac5836e7e185100808a4bb2ba8c18e8b5">AP_TECS::_minSinkRate</a></div><div class="ttdeci">AP_Float _minSinkRate</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00145">AP_TECS.h:145</a></div></div>
<div class="ttc" id="classAP__TECS_html_a38cefae79f201d04f9543f0163a34b7e"><div class="ttname"><a href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">AP_TECS::_TAS_dem_adj</a></div><div class="ttdeci">float _TAS_dem_adj</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00241">AP_TECS.h:241</a></div></div>
<div class="ttc" id="AP__Baro_8h_html"><div class="ttname"><a href="AP__Baro_8h.html">AP_Baro.h</a></div></div>
<div class="ttc" id="classAP__TECS_html_a41c98d353390a6bb386e5596c5d5a843"><div class="ttname"><a href="classAP__TECS.html#a41c98d353390a6bb386e5596c5d5a843">AP_TECS::_SKEdot</a></div><div class="ttdeci">float _SKEdot</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00297">AP_TECS.h:297</a></div></div>
<div class="ttc" id="classAP__TECS_html_aa8bb2218960edb71526d380f752b411e"><div class="ttname"><a href="classAP__TECS.html#aa8bb2218960edb71526d380f752b411e">AP_TECS::update_pitch_throttle</a></div><div class="ttdeci">void update_pitch_throttle(int32_t hgt_dem_cm, int32_t EAS_dem_cm, enum AP_Vehicle::FixedWing::FlightStage flight_stage, float distance_beyond_land_wp, int32_t ptchMinCO_cd, int16_t throttle_nudge, float hgt_afe, float load_factor, bool soaring_active) override</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00950">AP_TECS.cpp:950</a></div></div>
<div class="ttc" id="classAP__TECS_html_afa231bec5b2c1266c93ac3abf2608b1c"><div class="ttname"><a href="classAP__TECS.html#afa231bec5b2c1266c93ac3abf2608b1c">AP_TECS::_hgt_dem_adj</a></div><div class="ttdeci">float _hgt_dem_adj</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00233">AP_TECS.h:233</a></div></div>
<div class="ttc" id="classAverageFilter_html_a58f3da49063db38d512b15b8a0fc0995"><div class="ttname"><a href="classAverageFilter.html#a58f3da49063db38d512b15b8a0fc0995">AverageFilter::apply</a></div><div class="ttdeci">virtual T apply(T sample) override</div><div class="ttdef"><b>Definition:</b> <a href="AverageFilter_8h_source.html#l00079">AverageFilter.h:79</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a69b21caefc3aab8edc889cb7a181a756"><div class="ttname"><a href="classAP__AHRS.html#a69b21caefc3aab8edc889cb7a181a756">AP_AHRS::get_velocity_NED</a></div><div class="ttdeci">virtual bool get_velocity_NED(Vector3f &amp;vec) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00314">AP_AHRS.h:314</a></div></div>
<div class="ttc" id="classAP__Landing_html_aea63b41c71cd665c1933b83cd681e0b0"><div class="ttname"><a href="classAP__Landing.html#aea63b41c71cd665c1933b83cd681e0b0">AP_Landing::get_pitch_cd</a></div><div class="ttdeci">int16_t get_pitch_cd(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Landing_8h_source.html#l00092">AP_Landing.h:92</a></div></div>
<div class="ttc" id="classAP__TECS_html_a5ff6a926d1c3a14bc88cf9ce974cb18d"><div class="ttname"><a href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">AP_TECS::timeConstant</a></div><div class="ttdeci">float timeConstant(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00575">AP_TECS.cpp:575</a></div></div>
<div class="ttc" id="AP__TECS_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__TECS_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition:</b> <a href="AC__PID__test_8cpp_source.html#l00021">AC_PID_test.cpp:21</a></div></div>
<div class="ttc" id="classAP__TECS_html_ab1d7e52ac8d8c6aa305275a30ba72a93"><div class="ttname"><a href="classAP__TECS.html#ab1d7e52ac8d8c6aa305275a30ba72a93">AP_TECS::_land_sink_rate_change</a></div><div class="ttdeci">AP_Float _land_sink_rate_change</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00164">AP_TECS.h:164</a></div></div>
<div class="ttc" id="classAP__TECS_html_aa85725f73abc62c34534a631c650731f"><div class="ttname"><a href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">AP_TECS::_DT</a></div><div class="ttdeci">float _DT</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00303">AP_TECS.h:303</a></div></div>
<div class="ttc" id="classAP__TECS_html_a8db124836a733bfcee48843fb0ff28db"><div class="ttname"><a href="classAP__TECS.html#a8db124836a733bfcee48843fb0ff28db">AP_TECS::_update_pitch_throttle_last_usec</a></div><div class="ttdeci">uint64_t _update_pitch_throttle_last_usec</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00131">AP_TECS.h:131</a></div></div>
<div class="ttc" id="classAP__TECS_html_ac94ec1f860105c16d714eeb2f62fade7"><div class="ttname"><a href="classAP__TECS.html#ac94ec1f860105c16d714eeb2f62fade7">AP_TECS::_path_proportion</a></div><div class="ttdeci">float _path_proportion</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00312">AP_TECS.h:312</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_aa5eb40d64faea2d498f0e9524e321f5fad1825ed29ce7997edb9a9222e70fd8ad"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fad1825ed29ce7997edb9a9222e70fd8ad">AP_Vehicle::FixedWing::FLIGHT_LAND</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00068">AP_Vehicle.h:68</a></div></div>
<div class="ttc" id="classAP__TECS_html_a3bdfd7a87be82e3f38e2b74b11e79328"><div class="ttname"><a href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">AP_TECS::_THRmaxf</a></div><div class="ttdeci">float _THRmaxf</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00282">AP_TECS.h:282</a></div></div>
<div class="ttc" id="classAP__TECS_html_a620dd7d52dc60fd6914dbd7d98e1b9cd"><div class="ttname"><a href="classAP__TECS.html#a620dd7d52dc60fd6914dbd7d98e1b9cd">AP_TECS::_land_throttle_damp</a></div><div class="ttdeci">AP_Float _land_throttle_damp</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00153">AP_TECS.h:153</a></div></div>
<div class="ttc" id="classAP__TECS_html_a4dc0dac47faf337837f8c47c21494d67"><div class="ttname"><a href="classAP__TECS.html#a4dc0dac47faf337837f8c47c21494d67">AP_TECS::_distance_beyond_land_wp</a></div><div class="ttdeci">float _distance_beyond_land_wp</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00314">AP_TECS.h:314</a></div></div>
<div class="ttc" id="classAP__TECS_html_aeeaec3c74afc3770ced444525805028d"><div class="ttname"><a href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">AP_TECS::_pitch_dem</a></div><div class="ttdeci">float _pitch_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00180">AP_TECS.h:180</a></div></div>
<div class="ttc" id="classAP__TECS_html_a8d23075cf7fd1752877a893bd689a2ab"><div class="ttname"><a href="classAP__TECS.html#a8d23075cf7fd1752877a893bd689a2ab">AP_TECS::_land_sink</a></div><div class="ttdeci">AP_Float _land_sink</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00163">AP_TECS.h:163</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_a9aa0578c8a97b6bb874e5a01c2dc2c7d"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#a9aa0578c8a97b6bb874e5a01c2dc2c7d">AP_Vehicle::FixedWing::throttle_cruise</a></div><div class="ttdeci">AP_Int8 throttle_cruise</div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00034">AP_Vehicle.h:34</a></div></div>
<div class="ttc" id="classAP__TECS_html_a002c46ae3fbbd31dd4e110d13dfb9c08"><div class="ttname"><a href="classAP__TECS.html#a002c46ae3fbbd31dd4e110d13dfb9c08">AP_TECS::_SKEdot_dem</a></div><div class="ttdeci">float _SKEdot_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00293">AP_TECS.h:293</a></div></div>
<div class="ttc" id="AP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="structAP__TECS_1_1flags_html_ad5cf6c80c998986a106ec709f7a644c9"><div class="ttname"><a href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">AP_TECS::flags::badDescent</a></div><div class="ttdeci">bool badDescent</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00255">AP_TECS.h:255</a></div></div>
<div class="ttc" id="classAP__TECS_html_a3d61aa8551482d09712c3bd51bf58c20"><div class="ttname"><a href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">AP_TECS::_integTHR_state</a></div><div class="ttdeci">float _integTHR_state</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00203">AP_TECS.h:203</a></div></div>
<div class="ttc" id="AP__TECS_8h_html"><div class="ttname"><a href="AP__TECS_8h.html">AP_TECS.h</a></div><div class="ttdoc">Combined Total Energy Speed &amp; Height Control. This is a instance of an AP_SpdHgtControl class.</div></div>
<div class="ttc" id="classAP__TECS_html_afdffa63c3526767ad499609492c57b70"><div class="ttname"><a href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">AP_TECS::_ahrs</a></div><div class="ttdeci">AP_AHRS &amp; _ahrs</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00134">AP_TECS.h:134</a></div></div>
<div class="ttc" id="stdio_8h_html_a55f3d956bb2ba20b5059e9e25484a47f"><div class="ttname"><a href="stdio_8h.html#a55f3d956bb2ba20b5059e9e25484a47f">printf</a></div><div class="ttdeci">int printf(const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="stdio_8cpp_source.html#l00131">stdio.cpp:131</a></div></div>
<div class="ttc" id="classAP__TECS_html_a7318e1b5998b99f4febe0d53040c5744"><div class="ttname"><a href="classAP__TECS.html#a7318e1b5998b99f4febe0d53040c5744">AP_TECS::_detect_underspeed</a></div><div class="ttdeci">void _detect_underspeed(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00519">AP_TECS.cpp:519</a></div></div>
<div class="ttc" id="classAP__TECS_html_ac4ef736b39412013b47c62b8fbd65668"><div class="ttname"><a href="classAP__TECS.html#ac4ef736b39412013b47c62b8fbd65668">AP_TECS::_land_pitch_damp</a></div><div class="ttdeci">AP_Float _land_pitch_damp</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00150">AP_TECS.h:150</a></div></div>
<div class="ttc" id="classAP__TECS_html_a920b0cf7e46bcdb0a5081a02c8a75c00"><div class="ttname"><a href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">AP_TECS::_last_pitch_dem</a></div><div class="ttdeci">float _last_pitch_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00212">AP_TECS.h:212</a></div></div>
<div class="ttc" id="classAP__TECS_html_a08f575ea9d3b0a609fc3c359335c5d4a"><div class="ttname"><a href="classAP__TECS.html#a08f575ea9d3b0a609fc3c359335c5d4a">AP_TECS::_landThrottle</a></div><div class="ttdeci">AP_Float _landThrottle</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00161">AP_TECS.h:161</a></div></div>
<div class="ttc" id="classAP__TECS_html_a5e1f843d9d5342d181e114adbf2dae48"><div class="ttname"><a href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">AP_TECS::_TAS_state</a></div><div class="ttdeci">float _TAS_state</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00200">AP_TECS.h:200</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_aa5eb40d64faea2d498f0e9524e321f5fa8e59dbdfb0a9e837f6b86e4aea4a1c1f"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8e59dbdfb0a9e837f6b86e4aea4a1c1f">AP_Vehicle::FixedWing::FLIGHT_ABORT_LAND</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00069">AP_Vehicle.h:69</a></div></div>
<div class="ttc" id="classAP__TECS_html_a96bc0e6fadbf3202c5e5fc9ee2c01cec"><div class="ttname"><a href="classAP__TECS.html#a96bc0e6fadbf3202c5e5fc9ee2c01cec">AP_TECS::_maxSinkRate_approach</a></div><div class="ttdeci">AP_Float _maxSinkRate_approach</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00168">AP_TECS.h:168</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a321a91de43cfb2e95d40cde314d0a80f"><div class="ttname"><a href="AP__Math_8h.html#a321a91de43cfb2e95d40cde314d0a80f">MIN</a></div><div class="ttdeci">static auto MIN(const A &amp;one, const B &amp;two) -&gt; decltype(one&lt; two ? one :two)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00202">AP_Math.h:202</a></div></div>
<div class="ttc" id="classAP__TECS_html_a4dccc15d0ea23bded1c8a48aa1591f8e"><div class="ttname"><a href="classAP__TECS.html#a4dccc15d0ea23bded1c8a48aa1591f8e">AP_TECS::logging</a></div><div class="ttdeci">struct AP_TECS::@169 logging</div></div>
<div class="ttc" id="classAP__TECS_html_ab8413b71612f09140b6ce14120ca740b"><div class="ttname"><a href="classAP__TECS.html#ab8413b71612f09140b6ce14120ca740b">AP_TECS::_update_throttle_with_airspeed</a></div><div class="ttdeci">void _update_throttle_with_airspeed(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00592">AP_TECS.cpp:592</a></div></div>
<div class="ttc" id="classAP__TECS_html_ae14918501a123045d9d73dd3e501e57d"><div class="ttname"><a href="classAP__TECS.html#ae14918501a123045d9d73dd3e501e57d">AP_TECS::_height_filter</a></div><div class="ttdeci">struct AP_TECS::@166 _height_filter</div></div>
<div class="ttc" id="AP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00100">AP_Param.h:100</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a2aa61744614d8e0ef64803583359a56e"><div class="ttname"><a href="classAP__AHRS.html#a2aa61744614d8e0ef64803583359a56e">AP_AHRS::pitch</a></div><div class="ttdeci">float pitch</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00221">AP_AHRS.h:221</a></div></div>
<div class="ttc" id="AP__Logger_8h_html"><div class="ttname"><a href="AP__Logger_8h.html">AP_Logger.h</a></div></div>
<div class="ttc" id="classAP__TECS_html_ae4afaa108f4629b08efb5c19d3119233"><div class="ttname"><a href="classAP__TECS.html#ae4afaa108f4629b08efb5c19d3119233">AP_TECS::_integDTAS_state</a></div><div class="ttdeci">float _integDTAS_state</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00197">AP_TECS.h:197</a></div></div>
<div class="ttc" id="classAP__TECS_html_a6eab6d44faa6a51fbdd7a59279e17035"><div class="ttname"><a href="classAP__TECS.html#a6eab6d44faa6a51fbdd7a59279e17035">AP_TECS::_update_STE_rate_lim</a></div><div class="ttdeci">void _update_STE_rate_lim(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00941">AP_TECS.cpp:941</a></div></div>
<div class="ttc" id="classMatrix3_html"><div class="ttname"><a href="classMatrix3.html">Matrix3&lt; float &gt;</a></div></div>
<div class="ttc" id="classAP__TECS_html_a425d214dcedbca7ea37929cc32eaf58c"><div class="ttname"><a href="classAP__TECS.html#a425d214dcedbca7ea37929cc32eaf58c">AP_TECS::_ptchDamp</a></div><div class="ttdeci">AP_Float _ptchDamp</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00149">AP_TECS.h:149</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_ab774cbd438b0d68da5250de61dca6262"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#ab774cbd438b0d68da5250de61dca6262">AP_Vehicle::FixedWing::airspeed_max</a></div><div class="ttdeci">AP_Int16 airspeed_max</div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00037">AP_Vehicle.h:37</a></div></div>
<div class="ttc" id="classAP__TECS_html_ab4e43605acf8d36a5837334710d9c104"><div class="ttname"><a href="classAP__TECS.html#ab4e43605acf8d36a5837334710d9c104">AP_TECS::_update_50hz_last_usec</a></div><div class="ttdeci">uint64_t _update_50hz_last_usec</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00125">AP_TECS.h:125</a></div></div>
<div class="ttc" id="classAP__TECS_html_a161190aceb1f074b27be3c46607a9220"><div class="ttname"><a href="classAP__TECS.html#a161190aceb1f074b27be3c46607a9220">AP_TECS::_integSEB_state</a></div><div class="ttdeci">float _integSEB_state</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00206">AP_TECS.h:206</a></div></div>
<div class="ttc" id="classAP__TECS_html_ad2491f34594ebea479ce92259a36cce3"><div class="ttname"><a href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">AP_TECS::_THRminf</a></div><div class="ttdeci">float _THRminf</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00283">AP_TECS.h:283</a></div></div>
<div class="ttc" id="classAP__TECS_html_a44e826f3ccb606c79a99d09ec1462036"><div class="ttname"><a href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">AP_TECS::_landing</a></div><div class="ttdeci">const AP_Landing &amp; _landing</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00139">AP_TECS.h:139</a></div></div>
<div class="ttc" id="classAP__TECS_html_a9f94dc1aaf643448d9f0f056bb10137c"><div class="ttname"><a href="classAP__TECS.html#a9f94dc1aaf643448d9f0f056bb10137c">AP_TECS::_landDamp</a></div><div class="ttdeci">AP_Float _landDamp</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00151">AP_TECS.h:151</a></div></div>
<div class="ttc" id="classAP__TECS_html_ae23c577644577aaabc247ea3c42da36a"><div class="ttname"><a href="classAP__TECS.html#ae23c577644577aaabc247ea3c42da36a">AP_TECS::_SPE_dem</a></div><div class="ttdeci">float _SPE_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00290">AP_TECS.h:290</a></div></div>
<div class="ttc" id="classAP__TECS_html_a44a3b1b7342744ddb5a9fc88af0b73e5"><div class="ttname"><a href="classAP__TECS.html#a44a3b1b7342744ddb5a9fc88af0b73e5">AP_TECS::_hgtCompFiltOmega</a></div><div class="ttdeci">AP_Float _hgtCompFiltOmega</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00142">AP_TECS.h:142</a></div></div>
<div class="ttc" id="classAP__TECS_html_a3cfb2f2dede7bb64ddd7f340dea8c4e6"><div class="ttname"><a href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">AP_TECS::_TASmax</a></div><div class="ttdeci">float _TASmax</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00221">AP_TECS.h:221</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a8a1988bb283c488c86b329be18271fbf"><div class="ttname"><a href="classAP__AHRS.html#a8a1988bb283c488c86b329be18271fbf">AP_AHRS::get_rotation_body_to_ned</a></div><div class="ttdeci">virtual const Matrix3f &amp; get_rotation_body_to_ned(void) const =0</div></div>
<div class="ttc" id="classAP__TECS_html_ac3a90f55264799a5482b76abfe5b9a68"><div class="ttname"><a href="classAP__TECS.html#ac3a90f55264799a5482b76abfe5b9a68">AP_TECS::_update_speed</a></div><div class="ttdeci">void _update_speed(float load_factor)</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00337">AP_TECS.cpp:337</a></div></div>
<div class="ttc" id="classAP__TECS_html_a77974fa2a70b286445ead5271fcf41b5"><div class="ttname"><a href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">AP_TECS::_height</a></div><div class="ttdeci">float _height</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00174">AP_TECS.h:174</a></div></div>
<div class="ttc" id="classAP__TECS_html_ac01c54156991fe5b0a754cfa2e81c27d"><div class="ttname"><a href="classAP__TECS.html#ac01c54156991fe5b0a754cfa2e81c27d">AP_TECS::_flight_stage</a></div><div class="ttdeci">enum AP_Vehicle::FixedWing::FlightStage _flight_stage</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00272">AP_TECS.h:272</a></div></div>
<div class="ttc" id="classAP__TECS_html_af56a4ac86036ce9aad7063d5838eff6d"><div class="ttname"><a href="classAP__TECS.html#af56a4ac86036ce9aad7063d5838eff6d">AP_TECS::_spdWeight</a></div><div class="ttdeci">AP_Float _spdWeight</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00159">AP_TECS.h:159</a></div></div>
<div class="ttc" id="classAP__TECS_html_af345f0190f5c67d2b0bfb46613e4893d"><div class="ttname"><a href="classAP__TECS.html#af345f0190f5c67d2b0bfb46613e4893d">AP_TECS::_integGain_takeoff</a></div><div class="ttdeci">AP_Float _integGain_takeoff</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00155">AP_TECS.h:155</a></div></div>
<div class="ttc" id="classAP__TECS_html_a0ba5d70bc0549b5226f1fe5179aba1b0"><div class="ttname"><a href="classAP__TECS.html#a0ba5d70bc0549b5226f1fe5179aba1b0">AP_TECS::_land_pitch_max</a></div><div class="ttdeci">AP_Int8 _land_pitch_max</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00167">AP_TECS.h:167</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a5abc8871f1e7781a55afe9bf299f0a39"><div class="ttname"><a href="AP__Math_8h.html#a5abc8871f1e7781a55afe9bf299f0a39">MAX</a></div><div class="ttdeci">static auto MAX(const A &amp;one, const B &amp;two) -&gt; decltype(one &gt; two ? one :two)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00208">AP_Math.h:208</a></div></div>
<div class="ttc" id="classAP__TECS_html_a91aeb22f68e2957bfad6285ec41182cf"><div class="ttname"><a href="classAP__TECS.html#a91aeb22f68e2957bfad6285ec41182cf">AP_TECS::_update_height_demand</a></div><div class="ttdeci">void _update_height_demand(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00442">AP_TECS.cpp:442</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_a39cf5d851f4d3da4e4ef50953f27154a"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#a39cf5d851f4d3da4e4ef50953f27154a">AP_Vehicle::FixedWing::pitch_limit_min_cd</a></div><div class="ttdeci">AP_Int16 pitch_limit_min_cd</div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00043">AP_Vehicle.h:43</a></div></div>
<div class="ttc" id="classAP__TECS_html_a815bf2048b92487ff8ee539b57beecf0"><div class="ttname"><a href="classAP__TECS.html#a815bf2048b92487ff8ee539b57beecf0">AP_TECS::_update_speed_last_usec</a></div><div class="ttdeci">uint64_t _update_speed_last_usec</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00128">AP_TECS.h:128</a></div></div>
<div class="ttc" id="classAP__InertialSensor_html_a7a848d0332acb5b39d8e47fca5a1e77f"><div class="ttname"><a href="classAP__InertialSensor.html#a7a848d0332acb5b39d8e47fca5a1e77f">AP_InertialSensor::get_accel</a></div><div class="ttdeci">const Vector3f &amp; get_accel(uint8_t i) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8h_source.html#l00123">AP_InertialSensor.h:123</a></div></div>
<div class="ttc" id="namespaceAP_html_aa35bfac1ea2da16f110e8e72db7b3b20"><div class="ttname"><a href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a></div><div class="ttdeci">AP_Logger &amp; logger()</div><div class="ttdef"><b>Definition:</b> <a href="AP__Logger_8cpp_source.html#l01182">AP_Logger.cpp:1182</a></div></div>
<div class="ttc" id="classAP__Logger_html_a320182e24dfaf50d436cf065c97169bb"><div class="ttname"><a href="classAP__Logger.html#a320182e24dfaf50d436cf065c97169bb">AP_Logger::Write</a></div><div class="ttdeci">void Write(const char *name, const char *labels, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Logger_8cpp_source.html#l00735">AP_Logger.cpp:735</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_a4a9f5384cb498939d92a930436e43e12"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#a4a9f5384cb498939d92a930436e43e12">AP_Vehicle::FixedWing::takeoff_throttle_max</a></div><div class="ttdeci">AP_Int8 takeoff_throttle_max</div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00035">AP_Vehicle.h:35</a></div></div>
<div class="ttc" id="classAP__TECS_html_ae52e17111e872c29d269209efb7d5989"><div class="ttname"><a href="classAP__TECS.html#ae52e17111e872c29d269209efb7d5989">AP_TECS::_EAS_dem</a></div><div class="ttdeci">float _EAS_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00228">AP_TECS.h:228</a></div></div>
<div class="ttc" id="classAP__TECS_html_a6bc6c5cdb2dbeae5abe4091f50646fde"><div class="ttname"><a href="classAP__TECS.html#a6bc6c5cdb2dbeae5abe4091f50646fde">AP_TECS::_integGain_land</a></div><div class="ttdeci">AP_Float _integGain_land</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00156">AP_TECS.h:156</a></div></div>
<div class="ttc" id="classAP__TECS_html_ae8327f2367078272adce7f8f25c605f4"><div class="ttname"><a href="classAP__TECS.html#ae8327f2367078272adce7f8f25c605f4">AP_TECS::_SPEdot</a></div><div class="ttdeci">float _SPEdot</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00296">AP_TECS.h:296</a></div></div>
<div class="ttc" id="classAP__TECS_html_a07f643564d913cf9020cd4a1b68f139d"><div class="ttname"><a href="classAP__TECS.html#a07f643564d913cf9020cd4a1b68f139d">AP_TECS::_use_synthetic_airspeed_once</a></div><div class="ttdeci">bool _use_synthetic_airspeed_once</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00327">AP_TECS.h:327</a></div></div>
<div class="ttc" id="structAP__TECS_1_1flags_html_a9ba42eac2b8b0ddf8f0c36516f6a828d"><div class="ttname"><a href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">AP_TECS::flags::is_doing_auto_land</a></div><div class="ttdeci">bool is_doing_auto_land</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00258">AP_TECS.h:258</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_a45cdd563349ec5d4e135fed322b379b3"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#a45cdd563349ec5d4e135fed322b379b3">AP_Vehicle::FixedWing::throttle_max</a></div><div class="ttdeci">AP_Int8 throttle_max</div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00032">AP_Vehicle.h:32</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00021">HAL.h:21</a></div></div>
<div class="ttc" id="classAP__TECS_html_aea6abce622dc2d63d55351a2bc4a03de"><div class="ttname"><a href="classAP__TECS.html#aea6abce622dc2d63d55351a2bc4a03de">AP_TECS::_vertAccLim</a></div><div class="ttdeci">AP_Float _vertAccLim</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00157">AP_TECS.h:157</a></div></div>
<div class="ttc" id="classAP__TECS_html_a1a46eb22cdadf76b7fab1cbc307e6d81"><div class="ttname"><a href="classAP__TECS.html#a1a46eb22cdadf76b7fab1cbc307e6d81">AP_TECS::_thrDamp</a></div><div class="ttdeci">AP_Float _thrDamp</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00152">AP_TECS.h:152</a></div></div>
<div class="ttc" id="classAP__TECS_html_a3031b248e419021c7ccc83bd0cddb387"><div class="ttname"><a href="classAP__TECS.html#a3031b248e419021c7ccc83bd0cddb387">AP_TECS::update_50hz</a></div><div class="ttdeci">void update_50hz(void) override</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00264">AP_TECS.cpp:264</a></div></div>
<div class="ttc" id="classAP__TECS_html_a8beca0265536eb28905f01223c0fe9aa"><div class="ttname"><a href="classAP__TECS.html#a8beca0265536eb28905f01223c0fe9aa">AP_TECS::SKE_weighting</a></div><div class="ttdeci">float SKE_weighting</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00318">AP_TECS.h:318</a></div></div>
<div class="ttc" id="classAP__TECS_html_a55b1f4cfa9b6cb2beb622316c0089d70"><div class="ttname"><a href="classAP__TECS.html#a55b1f4cfa9b6cb2beb622316c0089d70">AP_TECS::_pitch_max</a></div><div class="ttdeci">AP_Int8 _pitch_max</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00165">AP_TECS.h:165</a></div></div>
<div class="ttc" id="classAP__TECS_html_a2ecab25bceacdfb0c15694ff8428608f"><div class="ttname"><a href="classAP__TECS.html#a2ecab25bceacdfb0c15694ff8428608f">AP_TECS::_initialise_states</a></div><div class="ttdeci">void _initialise_states(int32_t ptchMinCO_cd, float hgt_afe)</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00904">AP_TECS.cpp:904</a></div></div>
<div class="ttc" id="definitions_8h_html_aea8758bf61b23b46507902b46060ebfd"><div class="ttname"><a href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a></div><div class="ttdeci">#define GRAVITY_MSS</div><div class="ttdef"><b>Definition:</b> <a href="definitions_8h_source.html#l00047">definitions.h:47</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a2a12cce483e9b870da70d30406d82c60"><div class="ttname"><a href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a></div><div class="ttdeci">bool is_zero(const T fVal1)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00040">AP_Math.h:40</a></div></div>
<div class="ttc" id="DerivativeFilter_8cpp_html_a357394e0f6f88c8a57bd893ab28dc8f8"><div class="ttname"><a href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a></div><div class="ttdeci">#define f(i)</div></div>
<div class="ttc" id="classAP__TECS_html_a03df83679af5e791ca881cfe7bb1a024"><div class="ttname"><a href="classAP__TECS.html#a03df83679af5e791ca881cfe7bb1a024">AP_TECS::_integGain</a></div><div class="ttdeci">AP_Float _integGain</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00154">AP_TECS.h:154</a></div></div>
<div class="ttc" id="classAP__TECS_html_abef22d8ca912f65ae8abdff6e54d8d3c"><div class="ttname"><a href="classAP__TECS.html#abef22d8ca912f65ae8abdff6e54d8d3c">AP_TECS::_EAS</a></div><div class="ttdeci">float _EAS</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00218">AP_TECS.h:218</a></div></div>
<div class="ttc" id="classAP__AHRS_html_ac9a14475fecfad99bfac9372b1a4e9bd"><div class="ttname"><a href="classAP__AHRS.html#ac9a14475fecfad99bfac9372b1a4e9bd">AP_AHRS::get_accel_ef</a></div><div class="ttdeci">virtual const Vector3f &amp; get_accel_ef(uint8_t i) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00183">AP_AHRS.h:183</a></div></div>
<div class="ttc" id="classAP__TECS_html_af61e93b060aeade818382323b9430daa"><div class="ttname"><a href="classAP__TECS.html#af61e93b060aeade818382323b9430daa">AP_TECS::_flags_byte</a></div><div class="ttdeci">uint8_t _flags_byte</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00265">AP_TECS.h:265</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_ac1ac1710d4fcc246fb070eda0ec873ef"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#ac1ac1710d4fcc246fb070eda0ec873ef">AP_Vehicle::FixedWing::throttle_slewrate</a></div><div class="ttdeci">AP_Int8 throttle_slewrate</div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00033">AP_Vehicle.h:33</a></div></div>
<div class="ttc" id="classVector3_html_a561df88b28e106e337a25bb86554a569"><div class="ttname"><a href="classVector3.html#a561df88b28e106e337a25bb86554a569">Vector3::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00067">vector3.h:67</a></div></div>
<div class="ttc" id="classAP__TECS_html_a4da8b5a68fcf0769d2200f4038ddebd8"><div class="ttname"><a href="classAP__TECS.html#a4da8b5a68fcf0769d2200f4038ddebd8">AP_TECS::_vel_dot</a></div><div class="ttdeci">float _vel_dot</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00215">AP_TECS.h:215</a></div></div>
<div class="ttc" id="classMatrix3_html_a7efa0e7bd4c621a7fe76cd9168960b94"><div class="ttname"><a href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">Matrix3::c</a></div><div class="ttdeci">Vector3&lt; T &gt; c</div><div class="ttdef"><b>Definition:</b> <a href="matrix3_8h_source.html#l00049">matrix3.h:49</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_a849296d0681be75aa7002fbb5edc5963"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#a849296d0681be75aa7002fbb5edc5963">AP_Vehicle::FixedWing::throttle_min</a></div><div class="ttdeci">AP_Int8 throttle_min</div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00031">AP_Vehicle.h:31</a></div></div>
<div class="ttc" id="namespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition:</b> <a href="ChibiOS_2system_8cpp_source.html#l00157">system.cpp:157</a></div></div>
<div class="ttc" id="structAP__TECS_1_1flags_html_a83fb08f23acbfcfae39d614c5030eb78"><div class="ttname"><a href="structAP__TECS_1_1flags.html#a83fb08f23acbfcfae39d614c5030eb78">AP_TECS::flags::reached_speed_takeoff</a></div><div class="ttdeci">bool reached_speed_takeoff</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00261">AP_TECS.h:261</a></div></div>
<div class="ttc" id="classAP__TECS_html_aeebe79e85106c8096f2902bad5478cc5"><div class="ttname"><a href="classAP__TECS.html#aeebe79e85106c8096f2902bad5478cc5">AP_TECS::_SKE_dem</a></div><div class="ttdeci">float _SKE_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00291">AP_TECS.h:291</a></div></div>
<div class="ttc" id="classVector3_html_ab3e7f5401dd6e951978bfa746809f74f"><div class="ttname"><a href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">Vector3::z</a></div><div class="ttdeci">T z</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00067">vector3.h:67</a></div></div>
<div class="ttc" id="structAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00142">AP_Param.h:142</a></div></div>
<div class="ttc" id="namespaceAP__HAL_html_a7aa0ce7625c9680e30ff4a99940907a5"><div class="ttname"><a href="namespaceAP__HAL.html#a7aa0ce7625c9680e30ff4a99940907a5">AP_HAL::micros64</a></div><div class="ttdeci">uint64_t micros64()</div><div class="ttdef"><b>Definition:</b> <a href="ChibiOS_2system_8cpp_source.html#l00167">system.cpp:167</a></div></div>
<div class="ttc" id="classAP__TECS_html"><div class="ttname"><a href="classAP__TECS.html">AP_TECS</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00028">AP_TECS.h:28</a></div></div>
<div class="ttc" id="classAP__TECS_html_a1a3a014f36ba7b9fe2cc3d9c4cb75777"><div class="ttname"><a href="classAP__TECS.html#a1a3a014f36ba7b9fe2cc3d9c4cb75777">AP_TECS::_STEdotErrLast</a></div><div class="ttdeci">float _STEdotErrLast</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00248">AP_TECS.h:248</a></div></div>
<div class="ttc" id="classAP__TECS_html_a2a336bda4da710cfabcc7279902fd6d7"><div class="ttname"><a href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">AP_TECS::_TAS_rate_dem</a></div><div class="ttdeci">float _TAS_rate_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00245">AP_TECS.h:245</a></div></div>
<div class="ttc" id="classAP__TECS_html_a5ebe7a314a4a98513748f29fcf58f435"><div class="ttname"><a href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">AP_TECS::_hgt_dem</a></div><div class="ttdeci">float _hgt_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00231">AP_TECS.h:231</a></div></div>
<div class="ttc" id="classAP__TECS_html_ab09e31937002d75d0bb3c2b487cd6351"><div class="ttname"><a href="classAP__TECS.html#ab09e31937002d75d0bb3c2b487cd6351">AP_TECS::_last_throttle_dem</a></div><div class="ttdeci">float _last_throttle_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00209">AP_TECS.h:209</a></div></div>
<div class="ttc" id="classAP__TECS_html_a4219c1f6f04940016a6232b6bacc36bc"><div class="ttname"><a href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">AP_TECS::_climb_rate</a></div><div class="ttdeci">float _climb_rate</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00183">AP_TECS.h:183</a></div></div>
<div class="ttc" id="classAP__TECS_html_a7cd6a7f15461a776d453aebdbc1ba39f"><div class="ttname"><a href="classAP__TECS.html#a7cd6a7f15461a776d453aebdbc1ba39f">AP_TECS::_spdCompFiltOmega</a></div><div class="ttdeci">AP_Float _spdCompFiltOmega</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00143">AP_TECS.h:143</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_a88300cf5dda0e0f3cb5669c564756039"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#a88300cf5dda0e0f3cb5669c564756039">AP_Vehicle::FixedWing::airspeed_min</a></div><div class="ttdeci">AP_Int16 airspeed_min</div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00036">AP_Vehicle.h:36</a></div></div>
<div class="ttc" id="classAP__TECS_html_ada65aa88ad9ecd6db58d55dd783b7a1f"><div class="ttname"><a href="classAP__TECS.html#ada65aa88ad9ecd6db58d55dd783b7a1f">AP_TECS::_use_synthetic_airspeed</a></div><div class="ttdeci">AP_Int8 _use_synthetic_airspeed</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00324">AP_TECS.h:324</a></div></div>
<div class="ttc" id="structAP__TECS_1_1flags_html_aa01b6ef92c0cefa56836bb0095e56a61"><div class="ttname"><a href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">AP_TECS::flags::underspeed</a></div><div class="ttdeci">bool underspeed</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00252">AP_TECS.h:252</a></div></div>
<div class="ttc" id="classAP__TECS_html_a23b1e3cec4d5b7d5d2a16bb8142d2864"><div class="ttname"><a href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">AP_TECS::_TAS_dem</a></div><div class="ttdeci">float _TAS_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00225">AP_TECS.h:225</a></div></div>
<div class="ttc" id="classAP__TECS_html_aa6b37a801da411b61ba0a9fee93940cb"><div class="ttname"><a href="classAP__TECS.html#aa6b37a801da411b61ba0a9fee93940cb">AP_TECS::_landTimeConst</a></div><div class="ttdeci">AP_Float _landTimeConst</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00148">AP_TECS.h:148</a></div></div>
<div class="ttc" id="classAP__TECS_html_ac78f1d3d1bb76bcae15b87bb0f8f71d6"><div class="ttname"><a href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">AP_TECS::_PITCHmaxf</a></div><div class="ttdeci">float _PITCHmaxf</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00286">AP_TECS.h:286</a></div></div>
<div class="ttc" id="classAP__TECS_html_aceeb5b086fc333e84f45afea2a9fbe0c"><div class="ttname"><a href="classAP__TECS.html#aceeb5b086fc333e84f45afea2a9fbe0c">AP_TECS::_SPEdot_dem</a></div><div class="ttdeci">float _SPEdot_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00292">AP_TECS.h:292</a></div></div>
<div class="ttc" id="classAP__TECS_html_ac4c57b27adc7dc7e2edc7bcfc3e59de0"><div class="ttname"><a href="classAP__TECS.html#ac4c57b27adc7dc7e2edc7bcfc3e59de0">AP_TECS::_SPE_est</a></div><div class="ttdeci">float _SPE_est</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00294">AP_TECS.h:294</a></div></div>
<div class="ttc" id="classAP__TECS_html_af620e4427095f25219c46be7f75201fb"><div class="ttname"><a href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">AP_TECS::_STEdot_max</a></div><div class="ttdeci">float _STEdot_max</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00278">AP_TECS.h:278</a></div></div>
<div class="ttc" id="classAP__TECS_html_acf4aed1a469a3bce5d1f68ee8a73fed6"><div class="ttname"><a href="classAP__TECS.html#acf4aed1a469a3bce5d1f68ee8a73fed6">AP_TECS::_update_energies</a></div><div class="ttdeci">void _update_energies(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00552">AP_TECS.cpp:552</a></div></div>
<div class="ttc" id="classAP__TECS_html_a758b6923067d18f52a0157f0e1af7737"><div class="ttname"><a href="classAP__TECS.html#a758b6923067d18f52a0157f0e1af7737">AP_TECS::_update_throttle_without_airspeed</a></div><div class="ttdeci">void _update_throttle_without_airspeed(int16_t throttle_nudge)</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00712">AP_TECS.cpp:712</a></div></div>
<div class="ttc" id="AP__Math_8h_html_ad525609d9dba6ffa556a0fbf08a3f9b4"><div class="ttname"><a href="AP__Math_8h.html#ad525609d9dba6ffa556a0fbf08a3f9b4">constrain_float</a></div><div class="ttdeci">float constrain_float(const float amt, const float low, const float high)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00142">AP_Math.h:142</a></div></div>
<div class="ttc" id="stdio_8h_html"><div class="ttname"><a href="stdio_8h.html">stdio.h</a></div></div>
<div class="ttc" id="classAP__Baro_html_a50ae73cce1699d88638e3dfab4ffd330"><div class="ttname"><a href="classAP__Baro.html#a50ae73cce1699d88638e3dfab4ffd330">AP_Baro::get_altitude</a></div><div class="ttdeci">float get_altitude(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Baro_8h_source.html#l00084">AP_Baro.h:84</a></div></div>
<div class="ttc" id="classAP__TECS_html_abcf8efaf10d02b61998c9fbdc4b83d0b"><div class="ttname"><a href="classAP__TECS.html#abcf8efaf10d02b61998c9fbdc4b83d0b">AP_TECS::_STE_error</a></div><div class="ttdeci">float _STE_error</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00300">AP_TECS.h:300</a></div></div>
<div class="ttc" id="classAP__TECS_html_a75a17f39fa8b643cc3352f8bbf3fec90"><div class="ttname"><a href="classAP__TECS.html#a75a17f39fa8b643cc3352f8bbf3fec90">AP_TECS::_flare_counter</a></div><div class="ttdeci">uint8_t _flare_counter</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00306">AP_TECS.h:306</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a37d7c62a8231d9d22826261297b99da4"><div class="ttname"><a href="AP__Math_8h.html#a37d7c62a8231d9d22826261297b99da4">radians</a></div><div class="ttdeci">static constexpr float radians(float deg)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00163">AP_Math.h:163</a></div></div>
<div class="ttc" id="classAP__TECS_html_a7854ecaf0d95d9da406568583f6e287f"><div class="ttname"><a href="classAP__TECS.html#a7854ecaf0d95d9da406568583f6e287f">AP_TECS::_update_pitch</a></div><div class="ttdeci">void _update_pitch(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00772">AP_TECS.cpp:772</a></div></div>
<div class="ttc" id="classAP__Landing_html_a5ff74bf65eb1a4083cc783af22276828"><div class="ttname"><a href="classAP__Landing.html#a5ff74bf65eb1a4083cc783af22276828">AP_Landing::is_flaring</a></div><div class="ttdeci">bool is_flaring(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Landing_8cpp_source.html#l00279">AP_Landing.cpp:279</a></div></div>
<div class="ttc" id="classAP__TECS_html_ad854305ea3b2e02af2c63a29529652ac"><div class="ttname"><a href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">AP_TECS::_flags</a></div><div class="ttdeci">struct flags _flags</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00264">AP_TECS.h:264</a></div></div>
<div class="ttc" id="classAP__TECS_html_aabf43104f81a4de93b6b21dff03fce37"><div class="ttname"><a href="classAP__TECS.html#aabf43104f81a4de93b6b21dff03fce37">AP_TECS::_rollComp</a></div><div class="ttdeci">AP_Float _rollComp</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00158">AP_TECS.h:158</a></div></div>
<div class="ttc" id="classAP__TECS_html_a7c97ba3776836f5760b4b79f4926e452"><div class="ttname"><a href="classAP__TECS.html#a7c97ba3776836f5760b4b79f4926e452">AP_TECS::_maxSinkRate</a></div><div class="ttdeci">AP_Float _maxSinkRate</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00146">AP_TECS.h:146</a></div></div>
<div class="ttc" id="classAP__TECS_html_a12946b10e5890a34fa74e8f026a3c4d7"><div class="ttname"><a href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">AP_TECS::_throttle_dem</a></div><div class="ttdeci">float _throttle_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00177">AP_TECS.h:177</a></div></div>
<div class="ttc" id="classAP__TECS_html_a840180012d3976350258d370025b728d"><div class="ttname"><a href="classAP__TECS.html#a840180012d3976350258d370025b728d">AP_TECS::_land_hgt_dem</a></div><div class="ttdeci">float _land_hgt_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00237">AP_TECS.h:237</a></div></div>
<div class="ttc" id="classAP__TECS_html_a960b22fb125a25cb7ad6d63438e14622"><div class="ttname"><a href="classAP__TECS.html#a960b22fb125a25cb7ad6d63438e14622">AP_TECS::_hgt_dem_in_old</a></div><div class="ttdeci">float _hgt_dem_in_old</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00232">AP_TECS.h:232</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_aa5eb40d64faea2d498f0e9524e321f5fa8ed28908fa8b9c9aa4d6a3b4145fce39"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5fa8ed28908fa8b9c9aa4d6a3b4145fce39">AP_Vehicle::FixedWing::FLIGHT_TAKEOFF</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00065">AP_Vehicle.h:65</a></div></div>
<div class="ttc" id="classAP__TECS_html_ad5f8c48c5d674e0b4d2d289e8acfea2a"><div class="ttname"><a href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">AP_TECS::_TASmin</a></div><div class="ttdeci">float _TASmin</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00222">AP_TECS.h:222</a></div></div>
<div class="ttc" id="classAP__TECS_html_adb53c053feaac9e2b5fa7704cfd95d2c"><div class="ttname"><a href="classAP__TECS.html#adb53c053feaac9e2b5fa7704cfd95d2c">AP_TECS::_pitch_max_limit</a></div><div class="ttdeci">int8_t _pitch_max_limit</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00171">AP_TECS.h:171</a></div></div>
<div class="ttc" id="classAP__Landing_html_a0f36467307a46cb4b5558617638b7117"><div class="ttname"><a href="classAP__Landing.html#a0f36467307a46cb4b5558617638b7117">AP_Landing::get_flare_sec</a></div><div class="ttdeci">float get_flare_sec(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Landing_8h_source.html#l00093">AP_Landing.h:93</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_aafe6b1cf37e37cff0792496dd2c414ea"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#aafe6b1cf37e37cff0792496dd2c414ea">AP_Vehicle::FixedWing::stall_prevention</a></div><div class="ttdeci">AP_Int8 stall_prevention</div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00045">AP_Vehicle.h:45</a></div></div>
<div class="ttc" id="classVector3_html"><div class="ttname"><a href="classVector3.html">Vector3&lt; float &gt;</a></div></div>
<div class="ttc" id="classAP__TECS_html_aea68f106f8f04f199c8470e52532e6a5"><div class="ttname"><a href="classAP__TECS.html#aea68f106f8f04f199c8470e52532e6a5">AP_TECS::_maxClimbRate</a></div><div class="ttdeci">AP_Float _maxClimbRate</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00144">AP_TECS.h:144</a></div></div>
<div class="ttc" id="classAP__TECS_html_abdc88637f15f20df5e282bf2052940c2"><div class="ttname"><a href="classAP__TECS.html#abdc88637f15f20df5e282bf2052940c2">AP_TECS::_vdot_filter</a></div><div class="ttdeci">AverageFilterFloat_Size5 _vdot_filter</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00366">AP_TECS.h:366</a></div></div>
<div class="ttc" id="classAP__TECS_html_a344eb89d0ffbaf1ec9c06044451f56f2"><div class="ttname"><a href="classAP__TECS.html#a344eb89d0ffbaf1ec9c06044451f56f2">AP_TECS::_hgt_dem_adj_last</a></div><div class="ttdeci">float _hgt_dem_adj_last</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00234">AP_TECS.h:234</a></div></div>
<div class="ttc" id="classAP__TECS_html_a239be6d923951e7ebabb52ec498806da"><div class="ttname"><a href="classAP__TECS.html#a239be6d923951e7ebabb52ec498806da">AP_TECS::hgt_dem_lag_filter_slew</a></div><div class="ttdeci">float hgt_dem_lag_filter_slew</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00309">AP_TECS.h:309</a></div></div>
<div class="ttc" id="namespaceAP_html_ac571aa5a2ef71b7f4b4b2bfa09143fb9"><div class="ttname"><a href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9">AP::ins</a></div><div class="ttdeci">AP_InertialSensor &amp; ins()</div><div class="ttdef"><b>Definition:</b> <a href="AP__InertialSensor_8cpp_source.html#l02076">AP_InertialSensor.cpp:2076</a></div></div>
<div class="ttc" id="classMatrix3_html_ae16bed039ad87c3337f15837c33fe2fb"><div class="ttname"><a href="classMatrix3.html#ae16bed039ad87c3337f15837c33fe2fb">Matrix3::b</a></div><div class="ttdeci">Vector3&lt; T &gt; b</div><div class="ttdef"><b>Definition:</b> <a href="matrix3_8h_source.html#l00049">matrix3.h:49</a></div></div>
<div class="ttc" id="classAP__TECS_html_ac69991d02d3b1bed3bdc21ba18ec7faa"><div class="ttname"><a href="classAP__TECS.html#ac69991d02d3b1bed3bdc21ba18ec7faa">AP_TECS::aparm</a></div><div class="ttdeci">const AP_Vehicle::FixedWing &amp; aparm</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00136">AP_TECS.h:136</a></div></div>
<div class="ttc" id="classAP__AHRS_html_aba88eab2ab7bb6f525934fb06d30e780"><div class="ttname"><a href="classAP__AHRS.html#aba88eab2ab7bb6f525934fb06d30e780">AP_AHRS::airspeed_estimate</a></div><div class="ttdeci">virtual bool airspeed_estimate(float *airspeed_ret) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8cpp_source.html#l00183">AP_AHRS.cpp:183</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a47ea335b3b317f0c5e54320f59d5ca8a"><div class="ttname"><a href="classAP__AHRS.html#a47ea335b3b317f0c5e54320f59d5ca8a">AP_AHRS::airspeed_sensor_enabled</a></div><div class="ttdeci">bool airspeed_sensor_enabled(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00299">AP_AHRS.h:299</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a64786b58a1607ee420ed4f0696c755b6"><div class="ttname"><a href="classAP__AHRS.html#a64786b58a1607ee420ed4f0696c755b6">AP_AHRS::get_EAS2TAS</a></div><div class="ttdeci">float get_EAS2TAS(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8cpp_source.html#l00508">AP_AHRS.cpp:508</a></div></div>
<div class="ttc" id="classAP__TECS_html_ae12cafab2952c95615de86f723fc0d61"><div class="ttname"><a href="classAP__TECS.html#ae12cafab2952c95615de86f723fc0d61">AP_TECS::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00121">AP_TECS.h:121</a></div></div>
<div class="ttc" id="classAP__TECS_html_ad483df34b0acfb5b06bb97826f6aa55f"><div class="ttname"><a href="classAP__TECS.html#ad483df34b0acfb5b06bb97826f6aa55f">AP_TECS::_pitch_min</a></div><div class="ttdeci">AP_Int8 _pitch_min</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00166">AP_TECS.h:166</a></div></div>
<div class="ttc" id="moduletest_8c_html_a903c4797a4c2860e3b9a6a978f98a44d"><div class="ttname"><a href="moduletest_8c.html#a903c4797a4c2860e3b9a6a978f98a44d">degrees</a></div><div class="ttdeci">#define degrees(x)</div><div class="ttdef"><b>Definition:</b> <a href="moduletest_8c_source.html#l00023">moduletest.c:23</a></div></div>
<div class="ttc" id="namespaceAP_html_a8aec57eb0b7a79044cbc1f0ca4b75bcf"><div class="ttname"><a href="namespaceAP.html#a8aec57eb0b7a79044cbc1f0ca4b75bcf">AP::baro</a></div><div class="ttdeci">AP_Baro &amp; baro()</div><div class="ttdef"><b>Definition:</b> <a href="AP__Baro_8cpp_source.html#l00860">AP_Baro.cpp:860</a></div></div>
<div class="ttc" id="classAP__TECS_html_a8cf182de07003d0734293f16cb554cae"><div class="ttname"><a href="classAP__TECS.html#a8cf182de07003d0734293f16cb554cae">AP_TECS::_SKE_est</a></div><div class="ttdeci">float _SKE_est</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00295">AP_TECS.h:295</a></div></div>
<div class="ttc" id="classAP__TECS_html_a1bb8be88bde90cfa5eb9946dc6bf44f8"><div class="ttname"><a href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">AP_TECS::_hgt_rate_dem</a></div><div class="ttdeci">float _hgt_rate_dem</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00235">AP_TECS.h:235</a></div></div>
<div class="ttc" id="classAP__TECS_html_a372aa3467ce5ffef5b34a1046f6c1392"><div class="ttname"><a href="classAP__TECS.html#a372aa3467ce5ffef5b34a1046f6c1392">AP_TECS::_timeConst</a></div><div class="ttdeci">AP_Float _timeConst</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00147">AP_TECS.h:147</a></div></div>
<div class="ttc" id="classAP__TECS_html_ae160176b8170eb74b19b37db1413c70c"><div class="ttname"><a href="classAP__TECS.html#ae160176b8170eb74b19b37db1413c70c">AP_TECS::_spdWeightLand</a></div><div class="ttdeci">AP_Float _spdWeightLand</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00160">AP_TECS.h:160</a></div></div>
<div class="ttc" id="classMatrix3_html_acd7bf3421047fa155168a9c8e5164a2b"><div class="ttname"><a href="classMatrix3.html#acd7bf3421047fa155168a9c8e5164a2b">Matrix3::a</a></div><div class="ttdeci">Vector3&lt; T &gt; a</div><div class="ttdef"><b>Definition:</b> <a href="matrix3_8h_source.html#l00049">matrix3.h:49</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_aa5eb40d64faea2d498f0e9524e321f5f"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#aa5eb40d64faea2d498f0e9524e321f5f">AP_Vehicle::FixedWing::FlightStage</a></div><div class="ttdeci">FlightStage</div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00064">AP_Vehicle.h:64</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a6573f5db06887fb66661ecb18e03ec3f"><div class="ttname"><a href="classAP__AHRS.html#a6573f5db06887fb66661ecb18e03ec3f">AP_AHRS::get_relative_position_D_home</a></div><div class="ttdeci">virtual void get_relative_position_D_home(float &amp;posD) const =0</div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_aeadf80d1d293b170933185bbefcf9534"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#aeadf80d1d293b170933185bbefcf9534">AP_Vehicle::FixedWing::pitch_limit_max_cd</a></div><div class="ttdeci">AP_Int16 pitch_limit_max_cd</div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00042">AP_Vehicle.h:42</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00118">AP_Param.h:118</a></div></div>
<div class="ttc" id="classAP__Landing_html_a1429174262aa7716b6b00df8eed75e81"><div class="ttname"><a href="classAP__Landing.html#a1429174262aa7716b6b00df8eed75e81">AP_Landing::is_on_approach</a></div><div class="ttdeci">bool is_on_approach(void) const</div><div class="ttdef"><b>Definition:</b> <a href="AP__Landing_8cpp_source.html#l00299">AP_Landing.cpp:299</a></div></div>
<div class="ttc" id="classAP__TECS_html_ab5ab1cc93f631786bb0c9df8596eef44"><div class="ttname"><a href="classAP__TECS.html#ab5ab1cc93f631786bb0c9df8596eef44">AP_TECS::_detect_bad_descent</a></div><div class="ttdeci">void _detect_bad_descent(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00747">AP_TECS.cpp:747</a></div></div>
<div class="ttc" id="classAP__TECS_html_a376593eecc4ab66559947a144106bdd5"><div class="ttname"><a href="classAP__TECS.html#a376593eecc4ab66559947a144106bdd5">AP_TECS::_update_speed_demand</a></div><div class="ttdeci">void _update_speed_demand(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00397">AP_TECS.cpp:397</a></div></div>
<div class="ttc" id="classVector3_html_a1a0f7e168c71ca798099f0ba8a444244"><div class="ttname"><a href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">Vector3::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00067">vector3.h:67</a></div></div>
<div class="ttc" id="classAP__TECS_html_a3f83a3c0553d099adb949ef55e05fa2e"><div class="ttname"><a href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">AP_TECS::_hgt_dem_prev</a></div><div class="ttdeci">float _hgt_dem_prev</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00236">AP_TECS.h:236</a></div></div>
<div class="ttc" id="classAP__TECS_html_a95645382d976d27216d75bf47a623d32"><div class="ttname"><a href="classAP__TECS.html#a95645382d976d27216d75bf47a623d32">AP_TECS::_get_i_gain</a></div><div class="ttdeci">float _get_i_gain(void)</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8cpp_source.html#l00694">AP_TECS.cpp:694</a></div></div>
<div class="ttc" id="classAP__TECS_html_ab40a7ba8b52a3746d49f0bb1f3ceb197"><div class="ttname"><a href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">AP_TECS::_pitch_dem_unc</a></div><div class="ttdeci">float _pitch_dem_unc</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00275">AP_TECS.h:275</a></div></div>
<div class="ttc" id="classAP__TECS_html_a45ccf2e0cd87b0926fbcbb76963840c9"><div class="ttname"><a href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">AP_TECS::_PITCHminf</a></div><div class="ttdeci">float _PITCHminf</div><div class="ttdef"><b>Definition:</b> <a href="AP__TECS_8h_source.html#l00287">AP_TECS.h:287</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 11 2019 14:17:36 for APM:Libraries by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
